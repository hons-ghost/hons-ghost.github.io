/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t,e,i,n,s={146:function(t){t.exports=function(){"use strict";function t(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function e(e){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?t(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):t(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,m(n.key),n)}}function r(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t,e,i){return(e=m(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function a(t){return h(t)||l(t)||c(t)||d()}function h(t){if(Array.isArray(t))return u(t)}function l(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function c(t,e){if(t){if("string"==typeof t)return u(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?u(t,e):void 0}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function d(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function m(t){var e=p(t,"string");return"symbol"==typeof e?e:String(e)}var f="undefined"!=typeof window&&void 0!==window.document,g=f?window:{},v=!(!f||!g.document.documentElement)&&"ontouchstart"in g.document.documentElement,y=!!f&&"PointerEvent"in g,x="cropper",_="all",b="crop",w="move",M="zoom",S="e",T="w",E="s",A="n",C="ne",I="nw",R="se",P="sw",k="".concat(x,"-crop"),D="".concat(x,"-disabled"),L="".concat(x,"-hidden"),O="".concat(x,"-hide"),N="".concat(x,"-invisible"),B="".concat(x,"-modal"),z="".concat(x,"-move"),U="".concat(x,"Action"),F="".concat(x,"Preview"),G="crop",H="move",V="none",j="crop",W="cropend",X="cropmove",$="cropstart",q="dblclick",Y=v?"touchstart":"mousedown",K=v?"touchmove":"mousemove",Z=v?"touchend touchcancel":"mouseup",J=y?"pointerdown":Y,Q=y?"pointermove":K,tt=y?"pointerup pointercancel":Z,et="ready",it="resize",nt="wheel",st="zoom",rt="image/jpeg",ot=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,at=/^data:/,ht=/^data:image\/jpeg;base64,/,lt=/^img|canvas$/i,ct=200,ut=100,dt={viewMode:0,dragMode:G,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:ct,minContainerHeight:ut,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},pt='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',mt=Number.isNaN||g.isNaN;function ft(t){return"number"==typeof t&&!mt(t)}var gt=function(t){return t>0&&t<1/0};function vt(t){return void 0===t}function yt(t){return"object"===i(t)&&null!==t}var xt=Object.prototype.hasOwnProperty;function _t(t){if(!yt(t))return!1;try{var e=t.constructor,i=e.prototype;return e&&i&&xt.call(i,"isPrototypeOf")}catch(t){return!1}}function bt(t){return"function"==typeof t}var wt=Array.prototype.slice;function Mt(t){return Array.from?Array.from(t):wt.call(t)}function St(t,e){return t&&bt(e)&&(Array.isArray(t)||ft(t.length)?Mt(t).forEach((function(i,n){e.call(t,i,n,t)})):yt(t)&&Object.keys(t).forEach((function(i){e.call(t,t[i],i,t)}))),t}var Tt=Object.assign||function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];return yt(t)&&i.length>0&&i.forEach((function(e){yt(e)&&Object.keys(e).forEach((function(i){t[i]=e[i]}))})),t},Et=/\.\d*(?:0|9){12}\d*$/;function At(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return Et.test(t)?Math.round(t*e)/e:t}var Ct=/^width|height|left|top|marginLeft|marginTop$/;function It(t,e){var i=t.style;St(e,(function(t,e){Ct.test(e)&&ft(t)&&(t="".concat(t,"px")),i[e]=t}))}function Rt(t,e){return t.classList?t.classList.contains(e):t.className.indexOf(e)>-1}function Pt(t,e){if(e)if(ft(t.length))St(t,(function(t){Pt(t,e)}));else if(t.classList)t.classList.add(e);else{var i=t.className.trim();i?i.indexOf(e)<0&&(t.className="".concat(i," ").concat(e)):t.className=e}}function kt(t,e){e&&(ft(t.length)?St(t,(function(t){kt(t,e)})):t.classList?t.classList.remove(e):t.className.indexOf(e)>=0&&(t.className=t.className.replace(e,"")))}function Dt(t,e,i){e&&(ft(t.length)?St(t,(function(t){Dt(t,e,i)})):i?Pt(t,e):kt(t,e))}var Lt=/([a-z\d])([A-Z])/g;function Ot(t){return t.replace(Lt,"$1-$2").toLowerCase()}function Nt(t,e){return yt(t[e])?t[e]:t.dataset?t.dataset[e]:t.getAttribute("data-".concat(Ot(e)))}function Bt(t,e,i){yt(i)?t[e]=i:t.dataset?t.dataset[e]=i:t.setAttribute("data-".concat(Ot(e)),i)}function zt(t,e){if(yt(t[e]))try{delete t[e]}catch(i){t[e]=void 0}else if(t.dataset)try{delete t.dataset[e]}catch(i){t.dataset[e]=void 0}else t.removeAttribute("data-".concat(Ot(e)))}var Ut=/\s\s*/,Ft=function(){var t=!1;if(f){var e=!1,i=function(){},n=Object.defineProperty({},"once",{get:function(){return t=!0,e},set:function(t){e=t}});g.addEventListener("test",i,n),g.removeEventListener("test",i,n)}return t}();function Gt(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=i;e.trim().split(Ut).forEach((function(e){if(!Ft){var r=t.listeners;r&&r[e]&&r[e][i]&&(s=r[e][i],delete r[e][i],0===Object.keys(r[e]).length&&delete r[e],0===Object.keys(r).length&&delete t.listeners)}t.removeEventListener(e,s,n)}))}function Ht(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=i;e.trim().split(Ut).forEach((function(e){if(n.once&&!Ft){var r=t.listeners,o=void 0===r?{}:r;s=function(){delete o[e][i],t.removeEventListener(e,s,n);for(var r=arguments.length,a=new Array(r),h=0;h<r;h++)a[h]=arguments[h];i.apply(t,a)},o[e]||(o[e]={}),o[e][i]&&t.removeEventListener(e,o[e][i],n),o[e][i]=s,t.listeners=o}t.addEventListener(e,s,n)}))}function Vt(t,e,i){var n;return bt(Event)&&bt(CustomEvent)?n=new CustomEvent(e,{detail:i,bubbles:!0,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,i),t.dispatchEvent(n)}function jt(t){var e=t.getBoundingClientRect();return{left:e.left+(window.pageXOffset-document.documentElement.clientLeft),top:e.top+(window.pageYOffset-document.documentElement.clientTop)}}var Wt=g.location,Xt=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function $t(t){var e=t.match(Xt);return null!==e&&(e[1]!==Wt.protocol||e[2]!==Wt.hostname||e[3]!==Wt.port)}function qt(t){var e="timestamp=".concat((new Date).getTime());return t+(-1===t.indexOf("?")?"?":"&")+e}function Yt(t){var e=t.rotate,i=t.scaleX,n=t.scaleY,s=t.translateX,r=t.translateY,o=[];ft(s)&&0!==s&&o.push("translateX(".concat(s,"px)")),ft(r)&&0!==r&&o.push("translateY(".concat(r,"px)")),ft(e)&&0!==e&&o.push("rotate(".concat(e,"deg)")),ft(i)&&1!==i&&o.push("scaleX(".concat(i,")")),ft(n)&&1!==n&&o.push("scaleY(".concat(n,")"));var a=o.length?o.join(" "):"none";return{WebkitTransform:a,msTransform:a,transform:a}}function Kt(t){var i=e({},t),n=0;return St(t,(function(t,e){delete i[e],St(i,(function(e){var i=Math.abs(t.startX-e.startX),s=Math.abs(t.startY-e.startY),r=Math.abs(t.endX-e.endX),o=Math.abs(t.endY-e.endY),a=Math.sqrt(i*i+s*s),h=(Math.sqrt(r*r+o*o)-a)/a;Math.abs(h)>Math.abs(n)&&(n=h)}))})),n}function Zt(t,i){var n=t.pageX,s=t.pageY,r={endX:n,endY:s};return i?r:e({startX:n,startY:s},r)}function Jt(t){var e=0,i=0,n=0;return St(t,(function(t){var s=t.startX,r=t.startY;e+=s,i+=r,n+=1})),{pageX:e/=n,pageY:i/=n}}function Qt(t){var e=t.aspectRatio,i=t.height,n=t.width,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"contain",r=gt(n),o=gt(i);if(r&&o){var a=i*e;"contain"===s&&a>n||"cover"===s&&a<n?i=n/e:n=i*e}else r?i=n/e:o&&(n=i*e);return{width:n,height:i}}function te(t){var e=t.width,i=t.height,n=t.degree;if(90==(n=Math.abs(n)%180))return{width:i,height:e};var s=n%90*Math.PI/180,r=Math.sin(s),o=Math.cos(s),a=e*o+i*r,h=e*r+i*o;return n>90?{width:h,height:a}:{width:a,height:h}}function ee(t,e,i,n){var s=e.aspectRatio,r=e.naturalWidth,o=e.naturalHeight,h=e.rotate,l=void 0===h?0:h,c=e.scaleX,u=void 0===c?1:c,d=e.scaleY,p=void 0===d?1:d,m=i.aspectRatio,f=i.naturalWidth,g=i.naturalHeight,v=n.fillColor,y=void 0===v?"transparent":v,x=n.imageSmoothingEnabled,_=void 0===x||x,b=n.imageSmoothingQuality,w=void 0===b?"low":b,M=n.maxWidth,S=void 0===M?1/0:M,T=n.maxHeight,E=void 0===T?1/0:T,A=n.minWidth,C=void 0===A?0:A,I=n.minHeight,R=void 0===I?0:I,P=document.createElement("canvas"),k=P.getContext("2d"),D=Qt({aspectRatio:m,width:S,height:E}),L=Qt({aspectRatio:m,width:C,height:R},"cover"),O=Math.min(D.width,Math.max(L.width,f)),N=Math.min(D.height,Math.max(L.height,g)),B=Qt({aspectRatio:s,width:S,height:E}),z=Qt({aspectRatio:s,width:C,height:R},"cover"),U=Math.min(B.width,Math.max(z.width,r)),F=Math.min(B.height,Math.max(z.height,o)),G=[-U/2,-F/2,U,F];return P.width=At(O),P.height=At(N),k.fillStyle=y,k.fillRect(0,0,O,N),k.save(),k.translate(O/2,N/2),k.rotate(l*Math.PI/180),k.scale(u,p),k.imageSmoothingEnabled=_,k.imageSmoothingQuality=w,k.drawImage.apply(k,[t].concat(a(G.map((function(t){return Math.floor(At(t))}))))),k.restore(),P}var ie=String.fromCharCode;function ne(t,e,i){var n="";i+=e;for(var s=e;s<i;s+=1)n+=ie(t.getUint8(s));return n}var se=/^data:.*,/;function re(t){var e=t.replace(se,""),i=atob(e),n=new ArrayBuffer(i.length),s=new Uint8Array(n);return St(s,(function(t,e){s[e]=i.charCodeAt(e)})),n}function oe(t,e){for(var i=[],n=8192,s=new Uint8Array(t);s.length>0;)i.push(ie.apply(null,Mt(s.subarray(0,n)))),s=s.subarray(n);return"data:".concat(e,";base64,").concat(btoa(i.join("")))}function ae(t){var e,i=new DataView(t);try{var n,s,r;if(255===i.getUint8(0)&&216===i.getUint8(1))for(var o=i.byteLength,a=2;a+1<o;){if(255===i.getUint8(a)&&225===i.getUint8(a+1)){s=a;break}a+=1}if(s){var h=s+10;if("Exif"===ne(i,s+4,4)){var l=i.getUint16(h);if(((n=18761===l)||19789===l)&&42===i.getUint16(h+2,n)){var c=i.getUint32(h+4,n);c>=8&&(r=h+c)}}}if(r){var u,d,p=i.getUint16(r,n);for(d=0;d<p;d+=1)if(u=r+12*d+2,274===i.getUint16(u,n)){u+=8,e=i.getUint16(u,n),i.setUint16(u,1,n);break}}}catch(t){e=1}return e}function he(t){var e=0,i=1,n=1;switch(t){case 2:i=-1;break;case 3:e=-180;break;case 4:n=-1;break;case 5:e=90,n=-1;break;case 6:e=90;break;case 7:e=90,i=-1;break;case 8:e=-90}return{rotate:e,scaleX:i,scaleY:n}}var le={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.element,e=this.options,i=this.container,n=this.cropper,s=Number(e.minContainerWidth),r=Number(e.minContainerHeight);Pt(n,L),kt(t,L);var o={width:Math.max(i.offsetWidth,s>=0?s:ct),height:Math.max(i.offsetHeight,r>=0?r:ut)};this.containerData=o,It(n,{width:o.width,height:o.height}),Pt(t,L),kt(n,L)},initCanvas:function(){var t=this.containerData,e=this.imageData,i=this.options.viewMode,n=Math.abs(e.rotate)%180==90,s=n?e.naturalHeight:e.naturalWidth,r=n?e.naturalWidth:e.naturalHeight,o=s/r,a=t.width,h=t.height;t.height*o>t.width?3===i?a=t.height*o:h=t.width/o:3===i?h=t.width/o:a=t.height*o;var l={aspectRatio:o,naturalWidth:s,naturalHeight:r,width:a,height:h};this.canvasData=l,this.limited=1===i||2===i,this.limitCanvas(!0,!0),l.width=Math.min(Math.max(l.width,l.minWidth),l.maxWidth),l.height=Math.min(Math.max(l.height,l.minHeight),l.maxHeight),l.left=(t.width-l.width)/2,l.top=(t.height-l.height)/2,l.oldLeft=l.left,l.oldTop=l.top,this.initialCanvasData=Tt({},l)},limitCanvas:function(t,e){var i=this.options,n=this.containerData,s=this.canvasData,r=this.cropBoxData,o=i.viewMode,a=s.aspectRatio,h=this.cropped&&r;if(t){var l=Number(i.minCanvasWidth)||0,c=Number(i.minCanvasHeight)||0;o>1?(l=Math.max(l,n.width),c=Math.max(c,n.height),3===o&&(c*a>l?l=c*a:c=l/a)):o>0&&(l?l=Math.max(l,h?r.width:0):c?c=Math.max(c,h?r.height:0):h&&(l=r.width,(c=r.height)*a>l?l=c*a:c=l/a));var u=Qt({aspectRatio:a,width:l,height:c});l=u.width,c=u.height,s.minWidth=l,s.minHeight=c,s.maxWidth=1/0,s.maxHeight=1/0}if(e)if(o>(h?0:1)){var d=n.width-s.width,p=n.height-s.height;s.minLeft=Math.min(0,d),s.minTop=Math.min(0,p),s.maxLeft=Math.max(0,d),s.maxTop=Math.max(0,p),h&&this.limited&&(s.minLeft=Math.min(r.left,r.left+(r.width-s.width)),s.minTop=Math.min(r.top,r.top+(r.height-s.height)),s.maxLeft=r.left,s.maxTop=r.top,2===o&&(s.width>=n.width&&(s.minLeft=Math.min(0,d),s.maxLeft=Math.max(0,d)),s.height>=n.height&&(s.minTop=Math.min(0,p),s.maxTop=Math.max(0,p))))}else s.minLeft=-s.width,s.minTop=-s.height,s.maxLeft=n.width,s.maxTop=n.height},renderCanvas:function(t,e){var i=this.canvasData,n=this.imageData;if(e){var s=te({width:n.naturalWidth*Math.abs(n.scaleX||1),height:n.naturalHeight*Math.abs(n.scaleY||1),degree:n.rotate||0}),r=s.width,o=s.height,a=i.width*(r/i.naturalWidth),h=i.height*(o/i.naturalHeight);i.left-=(a-i.width)/2,i.top-=(h-i.height)/2,i.width=a,i.height=h,i.aspectRatio=r/o,i.naturalWidth=r,i.naturalHeight=o,this.limitCanvas(!0,!1)}(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCanvas(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,It(this.canvas,Tt({width:i.width,height:i.height},Yt({translateX:i.left,translateY:i.top}))),this.renderImage(t),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(t){var e=this.canvasData,i=this.imageData,n=i.naturalWidth*(e.width/e.naturalWidth),s=i.naturalHeight*(e.height/e.naturalHeight);Tt(i,{width:n,height:s,left:(e.width-n)/2,top:(e.height-s)/2}),It(this.image,Tt({width:i.width,height:i.height},Yt(Tt({translateX:i.left,translateY:i.top},i)))),t&&this.output()},initCropBox:function(){var t=this.options,e=this.canvasData,i=t.aspectRatio||t.initialAspectRatio,n=Number(t.autoCropArea)||.8,s={width:e.width,height:e.height};i&&(e.height*i>e.width?s.height=s.width/i:s.width=s.height*i),this.cropBoxData=s,this.limitCropBox(!0,!0),s.width=Math.min(Math.max(s.width,s.minWidth),s.maxWidth),s.height=Math.min(Math.max(s.height,s.minHeight),s.maxHeight),s.width=Math.max(s.minWidth,s.width*n),s.height=Math.max(s.minHeight,s.height*n),s.left=e.left+(e.width-s.width)/2,s.top=e.top+(e.height-s.height)/2,s.oldLeft=s.left,s.oldTop=s.top,this.initialCropBoxData=Tt({},s)},limitCropBox:function(t,e){var i=this.options,n=this.containerData,s=this.canvasData,r=this.cropBoxData,o=this.limited,a=i.aspectRatio;if(t){var h=Number(i.minCropBoxWidth)||0,l=Number(i.minCropBoxHeight)||0,c=o?Math.min(n.width,s.width,s.width+s.left,n.width-s.left):n.width,u=o?Math.min(n.height,s.height,s.height+s.top,n.height-s.top):n.height;h=Math.min(h,n.width),l=Math.min(l,n.height),a&&(h&&l?l*a>h?l=h/a:h=l*a:h?l=h/a:l&&(h=l*a),u*a>c?u=c/a:c=u*a),r.minWidth=Math.min(h,c),r.minHeight=Math.min(l,u),r.maxWidth=c,r.maxHeight=u}e&&(o?(r.minLeft=Math.max(0,s.left),r.minTop=Math.max(0,s.top),r.maxLeft=Math.min(n.width,s.left+s.width)-r.width,r.maxTop=Math.min(n.height,s.top+s.height)-r.height):(r.minLeft=0,r.minTop=0,r.maxLeft=n.width-r.width,r.maxTop=n.height-r.height))},renderCropBox:function(){var t=this.options,e=this.containerData,i=this.cropBoxData;(i.width>i.maxWidth||i.width<i.minWidth)&&(i.left=i.oldLeft),(i.height>i.maxHeight||i.height<i.minHeight)&&(i.top=i.oldTop),i.width=Math.min(Math.max(i.width,i.minWidth),i.maxWidth),i.height=Math.min(Math.max(i.height,i.minHeight),i.maxHeight),this.limitCropBox(!1,!0),i.left=Math.min(Math.max(i.left,i.minLeft),i.maxLeft),i.top=Math.min(Math.max(i.top,i.minTop),i.maxTop),i.oldLeft=i.left,i.oldTop=i.top,t.movable&&t.cropBoxMovable&&Bt(this.face,U,i.width>=e.width&&i.height>=e.height?w:_),It(this.cropBox,Tt({width:i.width,height:i.height},Yt({translateX:i.left,translateY:i.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),Vt(this.element,j,this.getData())}},ce={initPreview:function(){var t=this.element,e=this.crossOrigin,i=this.options.preview,n=e?this.crossOriginUrl:this.url,s=t.alt||"The image to preview",r=document.createElement("img");if(e&&(r.crossOrigin=e),r.src=n,r.alt=s,this.viewBox.appendChild(r),this.viewBoxImage=r,i){var o=i;"string"==typeof i?o=t.ownerDocument.querySelectorAll(i):i.querySelector&&(o=[i]),this.previews=o,St(o,(function(t){var i=document.createElement("img");Bt(t,F,{width:t.offsetWidth,height:t.offsetHeight,html:t.innerHTML}),e&&(i.crossOrigin=e),i.src=n,i.alt=s,i.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',t.innerHTML="",t.appendChild(i)}))}},resetPreview:function(){St(this.previews,(function(t){var e=Nt(t,F);It(t,{width:e.width,height:e.height}),t.innerHTML=e.html,zt(t,F)}))},preview:function(){var t=this.imageData,e=this.canvasData,i=this.cropBoxData,n=i.width,s=i.height,r=t.width,o=t.height,a=i.left-e.left-t.left,h=i.top-e.top-t.top;this.cropped&&!this.disabled&&(It(this.viewBoxImage,Tt({width:r,height:o},Yt(Tt({translateX:-a,translateY:-h},t)))),St(this.previews,(function(e){var i=Nt(e,F),l=i.width,c=i.height,u=l,d=c,p=1;n&&(d=s*(p=l/n)),s&&d>c&&(u=n*(p=c/s),d=c),It(e,{width:u,height:d}),It(e.getElementsByTagName("img")[0],Tt({width:r*p,height:o*p},Yt(Tt({translateX:-a*p,translateY:-h*p},t))))})))}},ue={bind:function(){var t=this.element,e=this.options,i=this.cropper;bt(e.cropstart)&&Ht(t,$,e.cropstart),bt(e.cropmove)&&Ht(t,X,e.cropmove),bt(e.cropend)&&Ht(t,W,e.cropend),bt(e.crop)&&Ht(t,j,e.crop),bt(e.zoom)&&Ht(t,st,e.zoom),Ht(i,J,this.onCropStart=this.cropStart.bind(this)),e.zoomable&&e.zoomOnWheel&&Ht(i,nt,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),e.toggleDragModeOnDblclick&&Ht(i,q,this.onDblclick=this.dblclick.bind(this)),Ht(t.ownerDocument,Q,this.onCropMove=this.cropMove.bind(this)),Ht(t.ownerDocument,tt,this.onCropEnd=this.cropEnd.bind(this)),e.responsive&&Ht(window,it,this.onResize=this.resize.bind(this))},unbind:function(){var t=this.element,e=this.options,i=this.cropper;bt(e.cropstart)&&Gt(t,$,e.cropstart),bt(e.cropmove)&&Gt(t,X,e.cropmove),bt(e.cropend)&&Gt(t,W,e.cropend),bt(e.crop)&&Gt(t,j,e.crop),bt(e.zoom)&&Gt(t,st,e.zoom),Gt(i,J,this.onCropStart),e.zoomable&&e.zoomOnWheel&&Gt(i,nt,this.onWheel,{passive:!1,capture:!0}),e.toggleDragModeOnDblclick&&Gt(i,q,this.onDblclick),Gt(t.ownerDocument,Q,this.onCropMove),Gt(t.ownerDocument,tt,this.onCropEnd),e.responsive&&Gt(window,it,this.onResize)}},de={resize:function(){if(!this.disabled){var t,e,i=this.options,n=this.container,s=this.containerData,r=n.offsetWidth/s.width,o=n.offsetHeight/s.height,a=Math.abs(r-1)>Math.abs(o-1)?r:o;1!==a&&(i.restore&&(t=this.getCanvasData(),e=this.getCropBoxData()),this.render(),i.restore&&(this.setCanvasData(St(t,(function(e,i){t[i]=e*a}))),this.setCropBoxData(St(e,(function(t,i){e[i]=t*a})))))}},dblclick:function(){this.disabled||this.options.dragMode===V||this.setDragMode(Rt(this.dragBox,k)?H:G)},wheel:function(t){var e=this,i=Number(this.options.wheelZoomRatio)||.1,n=1;this.disabled||(t.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout((function(){e.wheeling=!1}),50),t.deltaY?n=t.deltaY>0?1:-1:t.wheelDelta?n=-t.wheelDelta/120:t.detail&&(n=t.detail>0?1:-1),this.zoom(-n*i,t)))},cropStart:function(t){var e=t.buttons,i=t.button;if(!(this.disabled||("mousedown"===t.type||"pointerdown"===t.type&&"mouse"===t.pointerType)&&(ft(e)&&1!==e||ft(i)&&0!==i||t.ctrlKey))){var n,s=this.options,r=this.pointers;t.changedTouches?St(t.changedTouches,(function(t){r[t.identifier]=Zt(t)})):r[t.pointerId||0]=Zt(t),n=Object.keys(r).length>1&&s.zoomable&&s.zoomOnTouch?M:Nt(t.target,U),ot.test(n)&&!1!==Vt(this.element,$,{originalEvent:t,action:n})&&(t.preventDefault(),this.action=n,this.cropping=!1,n===b&&(this.cropping=!0,Pt(this.dragBox,B)))}},cropMove:function(t){var e=this.action;if(!this.disabled&&e){var i=this.pointers;t.preventDefault(),!1!==Vt(this.element,X,{originalEvent:t,action:e})&&(t.changedTouches?St(t.changedTouches,(function(t){Tt(i[t.identifier]||{},Zt(t,!0))})):Tt(i[t.pointerId||0]||{},Zt(t,!0)),this.change(t))}},cropEnd:function(t){if(!this.disabled){var e=this.action,i=this.pointers;t.changedTouches?St(t.changedTouches,(function(t){delete i[t.identifier]})):delete i[t.pointerId||0],e&&(t.preventDefault(),Object.keys(i).length||(this.action=""),this.cropping&&(this.cropping=!1,Dt(this.dragBox,B,this.cropped&&this.options.modal)),Vt(this.element,W,{originalEvent:t,action:e}))}}},pe={change:function(t){var e,i=this.options,n=this.canvasData,s=this.containerData,r=this.cropBoxData,o=this.pointers,a=this.action,h=i.aspectRatio,l=r.left,c=r.top,u=r.width,d=r.height,p=l+u,m=c+d,f=0,g=0,v=s.width,y=s.height,x=!0;!h&&t.shiftKey&&(h=u&&d?u/d:1),this.limited&&(f=r.minLeft,g=r.minTop,v=f+Math.min(s.width,n.width,n.left+n.width),y=g+Math.min(s.height,n.height,n.top+n.height));var k=o[Object.keys(o)[0]],D={x:k.endX-k.startX,y:k.endY-k.startY},O=function(t){switch(t){case S:p+D.x>v&&(D.x=v-p);break;case T:l+D.x<f&&(D.x=f-l);break;case A:c+D.y<g&&(D.y=g-c);break;case E:m+D.y>y&&(D.y=y-m)}};switch(a){case _:l+=D.x,c+=D.y;break;case S:if(D.x>=0&&(p>=v||h&&(c<=g||m>=y))){x=!1;break}O(S),(u+=D.x)<0&&(a=T,l-=u=-u),h&&(d=u/h,c+=(r.height-d)/2);break;case A:if(D.y<=0&&(c<=g||h&&(l<=f||p>=v))){x=!1;break}O(A),d-=D.y,c+=D.y,d<0&&(a=E,c-=d=-d),h&&(u=d*h,l+=(r.width-u)/2);break;case T:if(D.x<=0&&(l<=f||h&&(c<=g||m>=y))){x=!1;break}O(T),u-=D.x,l+=D.x,u<0&&(a=S,l-=u=-u),h&&(d=u/h,c+=(r.height-d)/2);break;case E:if(D.y>=0&&(m>=y||h&&(l<=f||p>=v))){x=!1;break}O(E),(d+=D.y)<0&&(a=A,c-=d=-d),h&&(u=d*h,l+=(r.width-u)/2);break;case C:if(h){if(D.y<=0&&(c<=g||p>=v)){x=!1;break}O(A),d-=D.y,c+=D.y,u=d*h}else O(A),O(S),D.x>=0?p<v?u+=D.x:D.y<=0&&c<=g&&(x=!1):u+=D.x,D.y<=0?c>g&&(d-=D.y,c+=D.y):(d-=D.y,c+=D.y);u<0&&d<0?(a=P,c-=d=-d,l-=u=-u):u<0?(a=I,l-=u=-u):d<0&&(a=R,c-=d=-d);break;case I:if(h){if(D.y<=0&&(c<=g||l<=f)){x=!1;break}O(A),d-=D.y,c+=D.y,u=d*h,l+=r.width-u}else O(A),O(T),D.x<=0?l>f?(u-=D.x,l+=D.x):D.y<=0&&c<=g&&(x=!1):(u-=D.x,l+=D.x),D.y<=0?c>g&&(d-=D.y,c+=D.y):(d-=D.y,c+=D.y);u<0&&d<0?(a=R,c-=d=-d,l-=u=-u):u<0?(a=C,l-=u=-u):d<0&&(a=P,c-=d=-d);break;case P:if(h){if(D.x<=0&&(l<=f||m>=y)){x=!1;break}O(T),u-=D.x,l+=D.x,d=u/h}else O(E),O(T),D.x<=0?l>f?(u-=D.x,l+=D.x):D.y>=0&&m>=y&&(x=!1):(u-=D.x,l+=D.x),D.y>=0?m<y&&(d+=D.y):d+=D.y;u<0&&d<0?(a=C,c-=d=-d,l-=u=-u):u<0?(a=R,l-=u=-u):d<0&&(a=I,c-=d=-d);break;case R:if(h){if(D.x>=0&&(p>=v||m>=y)){x=!1;break}O(S),d=(u+=D.x)/h}else O(E),O(S),D.x>=0?p<v?u+=D.x:D.y>=0&&m>=y&&(x=!1):u+=D.x,D.y>=0?m<y&&(d+=D.y):d+=D.y;u<0&&d<0?(a=I,c-=d=-d,l-=u=-u):u<0?(a=P,l-=u=-u):d<0&&(a=C,c-=d=-d);break;case w:this.move(D.x,D.y),x=!1;break;case M:this.zoom(Kt(o),t),x=!1;break;case b:if(!D.x||!D.y){x=!1;break}e=jt(this.cropper),l=k.startX-e.left,c=k.startY-e.top,u=r.minWidth,d=r.minHeight,D.x>0?a=D.y>0?R:C:D.x<0&&(l-=u,a=D.y>0?P:I),D.y<0&&(c-=d),this.cropped||(kt(this.cropBox,L),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}x&&(r.width=u,r.height=d,r.left=l,r.top=c,this.action=a,this.renderCropBox()),St(o,(function(t){t.startX=t.endX,t.startY=t.endY}))}},me={crop:function(){return!this.ready||this.cropped||this.disabled||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&Pt(this.dragBox,B),kt(this.cropBox,L),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=Tt({},this.initialImageData),this.canvasData=Tt({},this.initialCanvasData),this.cropBoxData=Tt({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(Tt(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),kt(this.dragBox,B),Pt(this.cropBox,L)),this},replace:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!this.disabled&&t&&(this.isImg&&(this.element.src=t),e?(this.url=t,this.image.src=t,this.ready&&(this.viewBoxImage.src=t,St(this.previews,(function(e){e.getElementsByTagName("img")[0].src=t})))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(t))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,kt(this.cropper,D)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,Pt(this.cropper,D)),this},destroy:function(){var t=this.element;return t[x]?(t[x]=void 0,this.isImg&&this.replaced&&(t.src=this.originalUrl),this.uncreate(),this):this},move:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,i=this.canvasData,n=i.left,s=i.top;return this.moveTo(vt(t)?t:n+Number(t),vt(e)?e:s+Number(e))},moveTo:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,i=this.canvasData,n=!1;return t=Number(t),e=Number(e),this.ready&&!this.disabled&&this.options.movable&&(ft(t)&&(i.left=t,n=!0),ft(e)&&(i.top=e,n=!0),n&&this.renderCanvas(!0)),this},zoom:function(t,e){var i=this.canvasData;return t=(t=Number(t))<0?1/(1-t):1+t,this.zoomTo(i.width*t/i.naturalWidth,null,e)},zoomTo:function(t,e,i){var n=this.options,s=this.canvasData,r=s.width,o=s.height,a=s.naturalWidth,h=s.naturalHeight;if((t=Number(t))>=0&&this.ready&&!this.disabled&&n.zoomable){var l=a*t,c=h*t;if(!1===Vt(this.element,st,{ratio:t,oldRatio:r/a,originalEvent:i}))return this;if(i){var u=this.pointers,d=jt(this.cropper),p=u&&Object.keys(u).length?Jt(u):{pageX:i.pageX,pageY:i.pageY};s.left-=(l-r)*((p.pageX-d.left-s.left)/r),s.top-=(c-o)*((p.pageY-d.top-s.top)/o)}else _t(e)&&ft(e.x)&&ft(e.y)?(s.left-=(l-r)*((e.x-s.left)/r),s.top-=(c-o)*((e.y-s.top)/o)):(s.left-=(l-r)/2,s.top-=(c-o)/2);s.width=l,s.height=c,this.renderCanvas(!0)}return this},rotate:function(t){return this.rotateTo((this.imageData.rotate||0)+Number(t))},rotateTo:function(t){return ft(t=Number(t))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=t%360,this.renderCanvas(!0,!0)),this},scaleX:function(t){var e=this.imageData.scaleY;return this.scale(t,ft(e)?e:1)},scaleY:function(t){var e=this.imageData.scaleX;return this.scale(ft(e)?e:1,t)},scale:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,i=this.imageData,n=!1;return t=Number(t),e=Number(e),this.ready&&!this.disabled&&this.options.scalable&&(ft(t)&&(i.scaleX=t,n=!0),ft(e)&&(i.scaleY=e,n=!0),n&&this.renderCanvas(!0,!0)),this},getData:function(){var t,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=this.options,n=this.imageData,s=this.canvasData,r=this.cropBoxData;if(this.ready&&this.cropped){t={x:r.left-s.left,y:r.top-s.top,width:r.width,height:r.height};var o=n.width/n.naturalWidth;if(St(t,(function(e,i){t[i]=e/o})),e){var a=Math.round(t.y+t.height),h=Math.round(t.x+t.width);t.x=Math.round(t.x),t.y=Math.round(t.y),t.width=h-t.x,t.height=a-t.y}}else t={x:0,y:0,width:0,height:0};return i.rotatable&&(t.rotate=n.rotate||0),i.scalable&&(t.scaleX=n.scaleX||1,t.scaleY=n.scaleY||1),t},setData:function(t){var e=this.options,i=this.imageData,n=this.canvasData,s={};if(this.ready&&!this.disabled&&_t(t)){var r=!1;e.rotatable&&ft(t.rotate)&&t.rotate!==i.rotate&&(i.rotate=t.rotate,r=!0),e.scalable&&(ft(t.scaleX)&&t.scaleX!==i.scaleX&&(i.scaleX=t.scaleX,r=!0),ft(t.scaleY)&&t.scaleY!==i.scaleY&&(i.scaleY=t.scaleY,r=!0)),r&&this.renderCanvas(!0,!0);var o=i.width/i.naturalWidth;ft(t.x)&&(s.left=t.x*o+n.left),ft(t.y)&&(s.top=t.y*o+n.top),ft(t.width)&&(s.width=t.width*o),ft(t.height)&&(s.height=t.height*o),this.setCropBoxData(s)}return this},getContainerData:function(){return this.ready?Tt({},this.containerData):{}},getImageData:function(){return this.sized?Tt({},this.imageData):{}},getCanvasData:function(){var t=this.canvasData,e={};return this.ready&&St(["left","top","width","height","naturalWidth","naturalHeight"],(function(i){e[i]=t[i]})),e},setCanvasData:function(t){var e=this.canvasData,i=e.aspectRatio;return this.ready&&!this.disabled&&_t(t)&&(ft(t.left)&&(e.left=t.left),ft(t.top)&&(e.top=t.top),ft(t.width)?(e.width=t.width,e.height=t.width/i):ft(t.height)&&(e.height=t.height,e.width=t.height*i),this.renderCanvas(!0)),this},getCropBoxData:function(){var t,e=this.cropBoxData;return this.ready&&this.cropped&&(t={left:e.left,top:e.top,width:e.width,height:e.height}),t||{}},setCropBoxData:function(t){var e,i,n=this.cropBoxData,s=this.options.aspectRatio;return this.ready&&this.cropped&&!this.disabled&&_t(t)&&(ft(t.left)&&(n.left=t.left),ft(t.top)&&(n.top=t.top),ft(t.width)&&t.width!==n.width&&(e=!0,n.width=t.width),ft(t.height)&&t.height!==n.height&&(i=!0,n.height=t.height),s&&(e?n.height=n.width/s:i&&(n.width=n.height*s)),this.renderCropBox()),this},getCroppedCanvas:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var e=this.canvasData,i=ee(this.image,this.imageData,e,t);if(!this.cropped)return i;var n=this.getData(t.rounded),s=n.x,r=n.y,o=n.width,h=n.height,l=i.width/Math.floor(e.naturalWidth);1!==l&&(s*=l,r*=l,o*=l,h*=l);var c=o/h,u=Qt({aspectRatio:c,width:t.maxWidth||1/0,height:t.maxHeight||1/0}),d=Qt({aspectRatio:c,width:t.minWidth||0,height:t.minHeight||0},"cover"),p=Qt({aspectRatio:c,width:t.width||(1!==l?i.width:o),height:t.height||(1!==l?i.height:h)}),m=p.width,f=p.height;m=Math.min(u.width,Math.max(d.width,m)),f=Math.min(u.height,Math.max(d.height,f));var g=document.createElement("canvas"),v=g.getContext("2d");g.width=At(m),g.height=At(f),v.fillStyle=t.fillColor||"transparent",v.fillRect(0,0,m,f);var y=t.imageSmoothingEnabled,x=void 0===y||y,_=t.imageSmoothingQuality;v.imageSmoothingEnabled=x,_&&(v.imageSmoothingQuality=_);var b,w,M,S,T,E,A=i.width,C=i.height,I=s,R=r;I<=-o||I>A?(I=0,b=0,M=0,T=0):I<=0?(M=-I,I=0,T=b=Math.min(A,o+I)):I<=A&&(M=0,T=b=Math.min(o,A-I)),b<=0||R<=-h||R>C?(R=0,w=0,S=0,E=0):R<=0?(S=-R,R=0,E=w=Math.min(C,h+R)):R<=C&&(S=0,E=w=Math.min(h,C-R));var P=[I,R,b,w];if(T>0&&E>0){var k=m/o;P.push(M*k,S*k,T*k,E*k)}return v.drawImage.apply(v,[i].concat(a(P.map((function(t){return Math.floor(At(t))}))))),g},setAspectRatio:function(t){var e=this.options;return this.disabled||vt(t)||(e.aspectRatio=Math.max(0,t)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(t){var e=this.options,i=this.dragBox,n=this.face;if(this.ready&&!this.disabled){var s=t===G,r=e.movable&&t===H;t=s||r?t:V,e.dragMode=t,Bt(i,U,t),Dt(i,k,s),Dt(i,z,r),e.cropBoxMovable||(Bt(n,U,t),Dt(n,k,s),Dt(n,z,r))}return this}},fe=g.Cropper,ge=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n(this,t),!e||!lt.test(e.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=e,this.options=Tt({},dt,_t(i)&&i),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return r(t,[{key:"init",value:function(){var t,e=this.element,i=e.tagName.toLowerCase();if(!e[x]){if(e[x]=this,"img"===i){if(this.isImg=!0,t=e.getAttribute("src")||"",this.originalUrl=t,!t)return;t=e.src}else"canvas"===i&&window.HTMLCanvasElement&&(t=e.toDataURL());this.load(t)}}},{key:"load",value:function(t){var e=this;if(t){this.url=t,this.imageData={};var i=this.element,n=this.options;if(n.rotatable||n.scalable||(n.checkOrientation=!1),n.checkOrientation&&window.ArrayBuffer)if(at.test(t))ht.test(t)?this.read(re(t)):this.clone();else{var s=new XMLHttpRequest,r=this.clone.bind(this);this.reloading=!0,this.xhr=s,s.onabort=r,s.onerror=r,s.ontimeout=r,s.onprogress=function(){s.getResponseHeader("content-type")!==rt&&s.abort()},s.onload=function(){e.read(s.response)},s.onloadend=function(){e.reloading=!1,e.xhr=null},n.checkCrossOrigin&&$t(t)&&i.crossOrigin&&(t=qt(t)),s.open("GET",t,!0),s.responseType="arraybuffer",s.withCredentials="use-credentials"===i.crossOrigin,s.send()}else this.clone()}}},{key:"read",value:function(t){var e=this.options,i=this.imageData,n=ae(t),s=0,r=1,o=1;if(n>1){this.url=oe(t,rt);var a=he(n);s=a.rotate,r=a.scaleX,o=a.scaleY}e.rotatable&&(i.rotate=s),e.scalable&&(i.scaleX=r,i.scaleY=o),this.clone()}},{key:"clone",value:function(){var t=this.element,e=this.url,i=t.crossOrigin,n=e;this.options.checkCrossOrigin&&$t(e)&&(i||(i="anonymous"),n=qt(e)),this.crossOrigin=i,this.crossOriginUrl=n;var s=document.createElement("img");i&&(s.crossOrigin=i),s.src=n||e,s.alt=t.alt||"The image to crop",this.image=s,s.onload=this.start.bind(this),s.onerror=this.stop.bind(this),Pt(s,O),t.parentNode.insertBefore(s,t.nextSibling)}},{key:"start",value:function(){var t=this,e=this.image;e.onload=null,e.onerror=null,this.sizing=!0;var i=g.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(g.navigator.userAgent),n=function(e,i){Tt(t.imageData,{naturalWidth:e,naturalHeight:i,aspectRatio:e/i}),t.initialImageData=Tt({},t.imageData),t.sizing=!1,t.sized=!0,t.build()};if(!e.naturalWidth||i){var s=document.createElement("img"),r=document.body||document.documentElement;this.sizingImage=s,s.onload=function(){n(s.width,s.height),i||r.removeChild(s)},s.src=e.src,i||(s.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",r.appendChild(s))}else n(e.naturalWidth,e.naturalHeight)}},{key:"stop",value:function(){var t=this.image;t.onload=null,t.onerror=null,t.parentNode.removeChild(t),this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var t=this.element,e=this.options,i=this.image,n=t.parentNode,s=document.createElement("div");s.innerHTML=pt;var r=s.querySelector(".".concat(x,"-container")),o=r.querySelector(".".concat(x,"-canvas")),a=r.querySelector(".".concat(x,"-drag-box")),h=r.querySelector(".".concat(x,"-crop-box")),l=h.querySelector(".".concat(x,"-face"));this.container=n,this.cropper=r,this.canvas=o,this.dragBox=a,this.cropBox=h,this.viewBox=r.querySelector(".".concat(x,"-view-box")),this.face=l,o.appendChild(i),Pt(t,L),n.insertBefore(r,t.nextSibling),kt(i,O),this.initPreview(),this.bind(),e.initialAspectRatio=Math.max(0,e.initialAspectRatio)||NaN,e.aspectRatio=Math.max(0,e.aspectRatio)||NaN,e.viewMode=Math.max(0,Math.min(3,Math.round(e.viewMode)))||0,Pt(h,L),e.guides||Pt(h.getElementsByClassName("".concat(x,"-dashed")),L),e.center||Pt(h.getElementsByClassName("".concat(x,"-center")),L),e.background&&Pt(r,"".concat(x,"-bg")),e.highlight||Pt(l,N),e.cropBoxMovable&&(Pt(l,z),Bt(l,U,_)),e.cropBoxResizable||(Pt(h.getElementsByClassName("".concat(x,"-line")),L),Pt(h.getElementsByClassName("".concat(x,"-point")),L)),this.render(),this.ready=!0,this.setDragMode(e.dragMode),e.autoCrop&&this.crop(),this.setData(e.data),bt(e.ready)&&Ht(t,et,e.ready,{once:!0}),Vt(t,et)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var t=this.cropper.parentNode;t&&t.removeChild(this.cropper),kt(this.element,L)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=fe,t}},{key:"setDefaults",value:function(t){Tt(dt,_t(t)&&t)}}]),t}();return Tt(ge.prototype,le,ce,ue,de,pe,me),ge}()},166:(t,e,i)=>{"use strict";var n=i(826);function s(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}t.exports=function(t){var e=new s;e.pre=t.pre,e.body=t.body,e.post=t.post;var i=t.args.slice(0);e.argTypes=i;for(var r=0;r<i.length;++r){var o=i[r];if("array"===o||"object"==typeof o&&o.blockIndices){if(e.argTypes[r]="array",e.arrayArgs.push(r),e.arrayBlockIndices.push(o.blockIndices?o.blockIndices:0),e.shimArgs.push("array"+r),r<e.pre.args.length&&e.pre.args[r].count>0)throw new Error("cwise: pre() block may not reference array args");if(r<e.post.args.length&&e.post.args[r].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===o)e.scalarArgs.push(r),e.shimArgs.push("scalar"+r);else if("index"===o){if(e.indexArgs.push(r),r<e.pre.args.length&&e.pre.args[r].count>0)throw new Error("cwise: pre() block may not reference array index");if(r<e.body.args.length&&e.body.args[r].lvalue)throw new Error("cwise: body() block may not write to array index");if(r<e.post.args.length&&e.post.args[r].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===o){if(e.shapeArgs.push(r),r<e.pre.args.length&&e.pre.args[r].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(r<e.body.args.length&&e.body.args[r].lvalue)throw new Error("cwise: body() block may not write to array shape");if(r<e.post.args.length&&e.post.args[r].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!=typeof o||!o.offset)throw new Error("cwise: Unknown argument type "+i[r]);e.argTypes[r]="offset",e.offsetArgs.push({array:o.array,offset:o.offset}),e.offsetArgIndex.push(r)}}if(e.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(e.pre.args.length>i.length)throw new Error("cwise: Too many arguments in pre() block");if(e.body.args.length>i.length)throw new Error("cwise: Too many arguments in body() block");if(e.post.args.length>i.length)throw new Error("cwise: Too many arguments in post() block");return e.debug=!!t.printCode||!!t.debug,e.funcName=t.funcName||"cwise",e.blockSize=t.blockSize||64,n(e)}},347:(t,e,i)=>{"use strict";var n=i(584);function s(t,e,i){var n,s,r=t.length,o=e.arrayArgs.length,a=e.indexArgs.length>0,h=[],l=[],c=0,u=0;for(n=0;n<r;++n)l.push(["i",n,"=0"].join(""));for(s=0;s<o;++s)for(n=0;n<r;++n)u=c,c=t[n],0===n?l.push(["d",s,"s",n,"=t",s,"p",c].join("")):l.push(["d",s,"s",n,"=(t",s,"p",c,"-s",u,"*t",s,"p",u,")"].join(""));for(l.length>0&&h.push("var "+l.join(",")),n=r-1;n>=0;--n)c=t[n],h.push(["for(i",n,"=0;i",n,"<s",c,";++i",n,"){"].join(""));for(h.push(i),n=0;n<r;++n){for(u=c,c=t[n],s=0;s<o;++s)h.push(["p",s,"+=d",s,"s",n].join(""));a&&(n>0&&h.push(["index[",u,"]-=s",u].join("")),h.push(["++index[",c,"]"].join(""))),h.push("}")}return h.join("\n")}function r(t,e,i){for(var n=t.body,s=[],r=[],o=0;o<t.args.length;++o){var a=t.args[o];if(!(a.count<=0)){var h=new RegExp(a.name,"g"),l="",c=e.arrayArgs.indexOf(o);switch(e.argTypes[o]){case"offset":var u=e.offsetArgIndex.indexOf(o);c=e.offsetArgs[u].array,l="+q"+u;case"array":l="p"+c+l;var d="l"+o,p="a"+c;if(0===e.arrayBlockIndices[c])1===a.count?"generic"===i[c]?a.lvalue?(s.push(["var ",d,"=",p,".get(",l,")"].join("")),n=n.replace(h,d),r.push([p,".set(",l,",",d,")"].join(""))):n=n.replace(h,[p,".get(",l,")"].join("")):n=n.replace(h,[p,"[",l,"]"].join("")):"generic"===i[c]?(s.push(["var ",d,"=",p,".get(",l,")"].join("")),n=n.replace(h,d),a.lvalue&&r.push([p,".set(",l,",",d,")"].join(""))):(s.push(["var ",d,"=",p,"[",l,"]"].join("")),n=n.replace(h,d),a.lvalue&&r.push([p,"[",l,"]=",d].join("")));else{for(var m=[a.name],f=[l],g=0;g<Math.abs(e.arrayBlockIndices[c]);g++)m.push("\\s*\\[([^\\]]+)\\]"),f.push("$"+(g+1)+"*t"+c+"b"+g);if(h=new RegExp(m.join(""),"g"),l=f.join("+"),"generic"===i[c])throw new Error("cwise: Generic arrays not supported in combination with blocks!");n=n.replace(h,[p,"[",l,"]"].join(""))}break;case"scalar":n=n.replace(h,"Y"+e.scalarArgs.indexOf(o));break;case"index":n=n.replace(h,"index");break;case"shape":n=n.replace(h,"shape")}}}return[s.join("\n"),n,r.join("\n")].join("\n").trim()}function o(t){for(var e=new Array(t.length),i=!0,n=0;n<t.length;++n){var s=t[n],r=s.match(/\d+/);r=r?r[0]:"",0===s.charAt(0)?e[n]="u"+s.charAt(1)+r:e[n]=s.charAt(0)+r,n>0&&(i=i&&e[n]===e[n-1])}return i?e[0]:e.join("")}t.exports=function(t,e){for(var i=e[1].length-Math.abs(t.arrayBlockIndices[0])|0,a=new Array(t.arrayArgs.length),h=new Array(t.arrayArgs.length),l=0;l<t.arrayArgs.length;++l)h[l]=e[2*l],a[l]=e[2*l+1];var c=[],u=[],d=[],p=[],m=[];for(l=0;l<t.arrayArgs.length;++l){t.arrayBlockIndices[l]<0?(d.push(0),p.push(i),c.push(i),u.push(i+t.arrayBlockIndices[l])):(d.push(t.arrayBlockIndices[l]),p.push(t.arrayBlockIndices[l]+i),c.push(0),u.push(t.arrayBlockIndices[l]));for(var f=[],g=0;g<a[l].length;g++)d[l]<=a[l][g]&&a[l][g]<p[l]&&f.push(a[l][g]-d[l]);m.push(f)}var v=["SS"],y=["'use strict'"],x=[];for(g=0;g<i;++g)x.push(["s",g,"=SS[",g,"]"].join(""));for(l=0;l<t.arrayArgs.length;++l){v.push("a"+l),v.push("t"+l),v.push("p"+l);for(g=0;g<i;++g)x.push(["t",l,"p",g,"=t",l,"[",d[l]+g,"]"].join(""));for(g=0;g<Math.abs(t.arrayBlockIndices[l]);++g)x.push(["t",l,"b",g,"=t",l,"[",c[l]+g,"]"].join(""))}for(l=0;l<t.scalarArgs.length;++l)v.push("Y"+l);if(t.shapeArgs.length>0&&x.push("shape=SS.slice(0)"),t.indexArgs.length>0){var _=new Array(i);for(l=0;l<i;++l)_[l]="0";x.push(["index=[",_.join(","),"]"].join(""))}for(l=0;l<t.offsetArgs.length;++l){var b=t.offsetArgs[l],w=[];for(g=0;g<b.offset.length;++g)0!==b.offset[g]&&(1===b.offset[g]?w.push(["t",b.array,"p",g].join("")):w.push([b.offset[g],"*t",b.array,"p",g].join("")));0===w.length?x.push("q"+l+"=0"):x.push(["q",l,"=",w.join("+")].join(""))}var M=n([].concat(t.pre.thisVars).concat(t.body.thisVars).concat(t.post.thisVars));for((x=x.concat(M)).length>0&&y.push("var "+x.join(",")),l=0;l<t.arrayArgs.length;++l)y.push("p"+l+"|=0");t.pre.body.length>3&&y.push(r(t.pre,t,h));var S=r(t.body,t,h),T=function(t){for(var e=0,i=t[0].length;e<i;){for(var n=1;n<t.length;++n)if(t[n][e]!==t[0][e])return e;++e}return e}(m);T<i?y.push(function(t,e,i,n){for(var r=e.length,o=i.arrayArgs.length,a=i.blockSize,h=i.indexArgs.length>0,l=[],c=0;c<o;++c)l.push(["var offset",c,"=p",c].join(""));for(c=t;c<r;++c)l.push(["for(var j"+c+"=SS[",e[c],"]|0;j",c,">0;){"].join("")),l.push(["if(j",c,"<",a,"){"].join("")),l.push(["s",e[c],"=j",c].join("")),l.push(["j",c,"=0"].join("")),l.push(["}else{s",e[c],"=",a].join("")),l.push(["j",c,"-=",a,"}"].join("")),h&&l.push(["index[",e[c],"]=j",c].join(""));for(c=0;c<o;++c){for(var u=["offset"+c],d=t;d<r;++d)u.push(["j",d,"*t",c,"p",e[d]].join(""));l.push(["p",c,"=(",u.join("+"),")"].join(""))}for(l.push(s(e,i,n)),c=t;c<r;++c)l.push("}");return l.join("\n")}(T,m[0],t,S)):y.push(s(m[0],t,S)),t.post.body.length>3&&y.push(r(t.post,t,h)),t.debug;var E=[t.funcName||"unnamed","_cwise_loop_",a[0].join("s"),"m",T,o(h)].join("");return new Function(["function ",E,"(",v.join(","),"){",y.join("\n"),"} return ",E].join(""))()}},826:(t,e,i)=>{"use strict";var n=i(347);t.exports=function(t){var e=["'use strict'","var CACHED={}"],i=[],s=t.funcName+"_cwise_thunk";e.push(["return function ",s,"(",t.shimArgs.join(","),"){"].join(""));for(var r=[],o=[],a=[["array",t.arrayArgs[0],".shape.slice(",Math.max(0,t.arrayBlockIndices[0]),t.arrayBlockIndices[0]<0?","+t.arrayBlockIndices[0]+")":")"].join("")],h=[],l=[],c=0;c<t.arrayArgs.length;++c){var u=t.arrayArgs[c];i.push(["t",u,"=array",u,".dtype,","r",u,"=array",u,".order"].join("")),r.push("t"+u),r.push("r"+u),o.push("t"+u),o.push("r"+u+".join()"),a.push("array"+u+".data"),a.push("array"+u+".stride"),a.push("array"+u+".offset|0"),c>0&&(h.push("array"+t.arrayArgs[0]+".shape.length===array"+u+".shape.length+"+(Math.abs(t.arrayBlockIndices[0])-Math.abs(t.arrayBlockIndices[c]))),l.push("array"+t.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[0])+"]===array"+u+".shape[shapeIndex+"+Math.max(0,t.arrayBlockIndices[c])+"]"))}for(t.arrayArgs.length>1&&(e.push("if (!("+h.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),e.push("for(var shapeIndex=array"+t.arrayArgs[0]+".shape.length-"+Math.abs(t.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),e.push("if (!("+l.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),e.push("}")),c=0;c<t.scalarArgs.length;++c)a.push("scalar"+t.scalarArgs[c]);return i.push(["type=[",o.join(","),"].join()"].join("")),i.push("proc=CACHED[type]"),e.push("var "+i.join(",")),e.push(["if(!proc){","CACHED[type]=proc=compile([",r.join(","),"])}","return proc(",a.join(","),")}"].join("")),t.debug,new Function("compile",e.join("\n"))(n.bind(void 0,t))}},990:t=>{"use strict";var e=Object.prototype.hasOwnProperty,i="~";function n(){}function s(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function r(t,e,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,r||t,o),h=i?i+e:e;return t._events[h]?t._events[h].fn?t._events[h]=[t._events[h],a]:t._events[h].push(a):(t._events[h]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new n:delete t._events[e]}function a(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,n,s=[];if(0===this._eventsCount)return s;for(n in t=this._events)e.call(t,n)&&s.push(i?n.slice(1):n);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(t)):s},a.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,r=n.length,o=new Array(r);s<r;s++)o[s]=n[s].fn;return o},a.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},a.prototype.emit=function(t,e,n,s,r,o){var a=i?i+t:t;if(!this._events[a])return!1;var h,l,c=this._events[a],u=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),u){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,s),!0;case 5:return c.fn.call(c.context,e,n,s,r),!0;case 6:return c.fn.call(c.context,e,n,s,r,o),!0}for(l=1,h=new Array(u-1);l<u;l++)h[l-1]=arguments[l];c.fn.apply(c.context,h)}else{var d,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),u){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,n);break;case 4:c[l].fn.call(c[l].context,e,n,s);break;default:if(!h)for(d=1,h=new Array(u-1);d<u;d++)h[d-1]=arguments[d];c[l].fn.apply(c[l].context,h)}}return!0},a.prototype.on=function(t,e,i){return r(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return r(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,n,s){var r=i?i+t:t;if(!this._events[r])return this;if(!e)return o(this,r),this;var a=this._events[r];if(a.fn)a.fn!==e||s&&!a.once||n&&a.context!==n||o(this,r);else{for(var h=0,l=[],c=a.length;h<c;h++)(a[h].fn!==e||s&&!a[h].once||n&&a[h].context!==n)&&l.push(a[h]);l.length?this._events[r]=1===l.length?l[0]:l:o(this,r)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&o(this,e)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a},772:t=>{"use strict";t.exports=function(t){for(var e=new Array(t),i=0;i<t;++i)e[i]=i;return e}},460:t=>{function e(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}t.exports=function(t){return null!=t&&(e(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&e(t.slice(0,0))}(t)||!!t._isBuffer)}},367:(t,e,i)=>{"use strict";var n=i(166),s={body:"",args:[],thisVars:[],localVars:[]};function r(t){if(!t)return s;for(var e=0;e<t.args.length;++e){var i=t.args[e];t.args[e]=0===e?{name:i,lvalue:!0,rvalue:!!t.rvalue,count:t.count||1}:{name:i,lvalue:!1,rvalue:!0,count:1}}return t.thisVars||(t.thisVars=[]),t.localVars||(t.localVars=[]),t}function o(t){for(var e=[],i=0;i<t.args.length;++i)e.push("a"+i);return new Function("P",["return function ",t.funcName,"_ndarrayops(",e.join(","),") {P(",e.join(","),");return a0}"].join(""))(function(t){return n({args:t.args,pre:r(t.pre),body:r(t.body),post:r(t.proc),funcName:t.funcName})}(t))}var a={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var t in a){var i=a[t];e[t]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+i+"c"},funcName:t}),e[t+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a"+i+"=b"},rvalue:!0,funcName:t+"eq"}),e[t+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+i+"s"},funcName:t+"s"}),e[t+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a"+i+"=s"},rvalue:!0,funcName:t+"seq"})}}();var h={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var t in h){var i=h[t];e[t]=o({args:["array","array"],body:{args:["a","b"],body:"a="+i+"b"},funcName:t}),e[t+"eq"]=o({args:["array"],body:{args:["a"],body:"a="+i+"a"},rvalue:!0,count:2,funcName:t+"eq"})}}();var l={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var t in l){var i=l[t];e[t]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+i+"c"},funcName:t}),e[t+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+i+"s"},funcName:t+"s"}),e[t+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a=a"+i+"b"},rvalue:!0,count:2,funcName:t+"eq"}),e[t+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+i+"s"},rvalue:!0,count:2,funcName:t+"seq"})}}();var c=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var t=0;t<c.length;++t){var i=c[t];e[i]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:i}),e[i+"eq"]=o({args:["array"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:i+"eq"})}}();var u=["max","min","atan2","pow"];!function(){for(var t=0;t<u.length;++t){var i=u[t];e[i]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:i}),e[i+"s"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:i+"s"}),e[i+"eq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:i+"eq"}),e[i+"seq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:i+"seq"})}}();var d=["atan2","pow"];!function(){for(var t=0;t<d.length;++t){var i=d[t];e[i+"op"]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:i+"op"}),e[i+"ops"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:i+"ops"}),e[i+"opeq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:i+"opeq"}),e[i+"opseq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+i,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:i+"opseq"})}}(),e.any=n({args:["array"],pre:s,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),e.all=n({args:["array"],pre:s,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),e.sum=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),e.prod=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),e.norm2squared=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),e.norm2=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),e.norminf=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),e.norm1=n({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),e.sup=n({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.inf=n({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),e.argmin=n({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.argmax=n({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),e.random=o({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),e.assign=o({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),e.assigns=o({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),e.equals=n({args:["array","array"],pre:s,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},448:(t,e,i)=>{var n=i(772),s=i(460),r="undefined"!=typeof Float64Array;function o(t,e){return t[0]-e[0]}function a(){var t,e=this.stride,i=new Array(e.length);for(t=0;t<i.length;++t)i[t]=[Math.abs(e[t]),t];i.sort(o);var n=new Array(i.length);for(t=0;t<n.length;++t)n[t]=i[t][1];return n}function h(t,e){var i=["View",e,"d",t].join("");e<0&&(i="View_Nil"+t);var s="generic"===t;if(-1===e){var r="function "+i+"(a){this.data=a;};var proto="+i+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+i+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+i+"(a){return new "+i+"(a);}";return new Function(r)()}if(0===e){r="function "+i+"(a,d) {this.data = a;this.offset = d};var proto="+i+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+i+"_copy() {return new "+i+"(this.data,this.offset)};proto.pick=function "+i+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+i+"_get(){return "+(s?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+i+"_set(v){return "+(s?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+i+"(a,b,c,d){return new "+i+"(a,d)}";return new Function("TrivialArray",r)(l[t][0])}r=["'use strict'"];var o=n(e),h=o.map((function(t){return"i"+t})),c="this.offset+"+o.map((function(t){return"this.stride["+t+"]*i"+t})).join("+"),u=o.map((function(t){return"b"+t})).join(","),d=o.map((function(t){return"c"+t})).join(",");r.push("function "+i+"(a,"+u+","+d+",d){this.data=a","this.shape=["+u+"]","this.stride=["+d+"]","this.offset=d|0}","var proto="+i+".prototype","proto.dtype='"+t+"'","proto.dimension="+e),r.push("Object.defineProperty(proto,'size',{get:function "+i+"_size(){return "+o.map((function(t){return"this.shape["+t+"]"})).join("*"),"}})"),1===e?r.push("proto.order=[0]"):(r.push("Object.defineProperty(proto,'order',{get:"),e<4?(r.push("function "+i+"_order(){"),2===e?r.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===e&&r.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):r.push("ORDER})")),r.push("proto.set=function "+i+"_set("+h.join(",")+",v){"),s?r.push("return this.data.set("+c+",v)}"):r.push("return this.data["+c+"]=v}"),r.push("proto.get=function "+i+"_get("+h.join(",")+"){"),s?r.push("return this.data.get("+c+")}"):r.push("return this.data["+c+"]}"),r.push("proto.index=function "+i+"_index(",h.join(),"){return "+c+"}"),r.push("proto.hi=function "+i+"_hi("+h.join(",")+"){return new "+i+"(this.data,"+o.map((function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")})).join(",")+","+o.map((function(t){return"this.stride["+t+"]"})).join(",")+",this.offset)}");var p=o.map((function(t){return"a"+t+"=this.shape["+t+"]"})),m=o.map((function(t){return"c"+t+"=this.stride["+t+"]"}));r.push("proto.lo=function "+i+"_lo("+h.join(",")+"){var b=this.offset,d=0,"+p.join(",")+","+m.join(","));for(var f=0;f<e;++f)r.push("if(typeof i"+f+"==='number'&&i"+f+">=0){d=i"+f+"|0;b+=c"+f+"*d;a"+f+"-=d}");r.push("return new "+i+"(this.data,"+o.map((function(t){return"a"+t})).join(",")+","+o.map((function(t){return"c"+t})).join(",")+",b)}"),r.push("proto.step=function "+i+"_step("+h.join(",")+"){var "+o.map((function(t){return"a"+t+"=this.shape["+t+"]"})).join(",")+","+o.map((function(t){return"b"+t+"=this.stride["+t+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(f=0;f<e;++f)r.push("if(typeof i"+f+"==='number'){d=i"+f+"|0;if(d<0){c+=b"+f+"*(a"+f+"-1);a"+f+"=ceil(-a"+f+"/d)}else{a"+f+"=ceil(a"+f+"/d)}b"+f+"*=d}");r.push("return new "+i+"(this.data,"+o.map((function(t){return"a"+t})).join(",")+","+o.map((function(t){return"b"+t})).join(",")+",c)}");var g=new Array(e),v=new Array(e);for(f=0;f<e;++f)g[f]="a[i"+f+"]",v[f]="b[i"+f+"]";r.push("proto.transpose=function "+i+"_transpose("+h+"){"+h.map((function(t,e){return t+"=("+t+"===undefined?"+e+":"+t+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+i+"(this.data,"+g.join(",")+","+v.join(",")+",this.offset)}"),r.push("proto.pick=function "+i+"_pick("+h+"){var a=[],b=[],c=this.offset");for(f=0;f<e;++f)r.push("if(typeof i"+f+"==='number'&&i"+f+">=0){c=(c+this.stride["+f+"]*i"+f+")|0}else{a.push(this.shape["+f+"]);b.push(this.stride["+f+"])}");return r.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),r.push("return function construct_"+i+"(data,shape,stride,offset){return new "+i+"(data,"+o.map((function(t){return"shape["+t+"]"})).join(",")+","+o.map((function(t){return"stride["+t+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",r.join("\n"))(l[t],a)}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};t.exports=function(t,e,i,n){if(void 0===t)return(0,l.array[0])([]);"number"==typeof t&&(t=[t]),void 0===e&&(e=[t.length]);var o=e.length;if(void 0===i){i=new Array(o);for(var a=o-1,c=1;a>=0;--a)i[a]=c,c*=e[a]}if(void 0===n){n=0;for(a=0;a<o;++a)i[a]<0&&(n-=(e[a]-1)*i[a])}for(var u=function(t){if(s(t))return"buffer";if(r)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(t)?"array":"generic"}(t),d=l[u];d.length<=o+1;)d.push(h(u,d.length-1));return(0,d[o+1])(t,e,i,n)}},49:function(t){t.exports=function(){var t=function(){function e(t){return s.appendChild(t.dom),t}function i(t){for(var e=0;e<s.children.length;e++)s.children[e].style.display=e===t?"block":"none";n=t}var n=0,s=document.createElement("div");s.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",s.addEventListener("click",(function(t){t.preventDefault(),i(++n%s.children.length)}),!1);var r=(performance||Date).now(),o=r,a=0,h=e(new t.Panel("FPS","#0ff","#002")),l=e(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=e(new t.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:s,addPanel:e,showPanel:i,begin:function(){r=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(l.update(t-r,200),t>o+1e3&&(h.update(1e3*a/(t-o),100),o=t,a=0,c)){var e=performance.memory;c.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){r=this.end()},domElement:s,setMode:i}};return t.Panel=function(t,e,i){var n=1/0,s=0,r=Math.round,o=r(window.devicePixelRatio||1),a=80*o,h=48*o,l=3*o,c=2*o,u=3*o,d=15*o,p=74*o,m=30*o,f=document.createElement("canvas");f.width=a,f.height=h,f.style.cssText="width:80px;height:48px";var g=f.getContext("2d");return g.font="bold "+9*o+"px Helvetica,Arial,sans-serif",g.textBaseline="top",g.fillStyle=i,g.fillRect(0,0,a,h),g.fillStyle=e,g.fillText(t,l,c),g.fillRect(u,d,p,m),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(u,d,p,m),{dom:f,update:function(h,v){n=Math.min(n,h),s=Math.max(s,h),g.fillStyle=i,g.globalAlpha=1,g.fillRect(0,0,a,d),g.fillStyle=e,g.fillText(r(h)+" "+t+" ("+r(n)+"-"+r(s)+")",l,c),g.drawImage(f,u+o,d,p-o,m,u,d,p-o,m),g.fillRect(u+p-o,d,o,m),g.fillStyle=i,g.globalAlpha=.9,g.fillRect(u+p-o,d,o,r((1-h/v)*m))}}},t}()},584:t=>{"use strict";t.exports=function(t,e,i){return 0===t.length?t:e?(i||t.sort(e),function(t,e){for(var i=1,n=t.length,s=t[0],r=t[0],o=1;o<n;++o)if(r=s,e(s=t[o],r)){if(o===i){i++;continue}t[i++]=s}return t.length=i,t}(t,e)):(i||t.sort(),function(t){for(var e=1,i=t.length,n=t[0],s=t[0],r=1;r<i;++r,s=n)if(s=n,(n=t[r])!==s){if(r===e){e++;continue}t[e++]=n}return t.length=e,t}(t))}}},r={};function o(t){var e=r[t];if(void 0!==e)return e.exports;var i=r[t]={exports:{}};return s[t].call(i.exports,i,i.exports,o),i.exports}o.m=s,o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,o.t=function(i,n){if(1&n&&(i=this(i)),8&n)return i;if("object"==typeof i&&i){if(4&n&&i.__esModule)return i;if(16&n&&"function"==typeof i.then)return i}var s=Object.create(null);o.r(s);var r={};t=t||[null,e({}),e([]),e(e)];for(var a=2&n&&i;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((t=>r[t]=()=>i[t]));return r.default=()=>i,o.d(s,r),s},o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce(((e,i)=>(o.f[i](t,e),e)),[])),o.u=t=>t+".bundle.js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i={},n="hons:",o.l=(t,e,s,r)=>{if(i[t])i[t].push(e);else{var a,h;if(void 0!==s)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var u=l[c];if(u.getAttribute("src")==t||u.getAttribute("data-webpack")==n+s){a=u;break}}a||(h=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",n+s),a.src=t),i[t]=[e];var d=(e,n)=>{a.onerror=a.onload=null,clearTimeout(p);var s=i[t];if(delete i[t],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach((t=>t(n))),e)return e(n)},p=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),h&&document.head.appendChild(a)}},o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&!t;)t=i[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),(()=>{var t={179:0};o.f.j=(e,i)=>{var n=o.o(t,e)?t[e]:void 0;if(0!==n)if(n)i.push(n[2]);else{var s=new Promise(((i,s)=>n=t[e]=[i,s]));i.push(n[2]=s);var r=o.p+o.u(e),a=new Error;o.l(r,(i=>{if(o.o(t,e)&&(0!==(n=t[e])&&(t[e]=void 0),n)){var s=i&&("load"===i.type?"missing":i.type),r=i&&i.target&&i.target.src;a.message="Loading chunk "+e+" failed.\n("+s+": "+r+")",a.name="ChunkLoadError",a.type=s,a.request=r,n[1](a)}}),"chunk-"+e,e)}};var e=(e,i)=>{var n,s,[r,a,h]=i,l=0;if(r.some((e=>0!==t[e]))){for(n in a)o.o(a,n)&&(o.m[n]=a[n]);if(h)h(o)}for(e&&e(i);l<r.length;l++)s=r[l],o.o(t,s)&&t[s]&&t[s][0](),t[s]=0},i=self.webpackChunkhons=self.webpackChunkhons||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})(),(()=>{"use strict";var t={};o.r(t),o.d(t,{afterMain:()=>WA,afterRead:()=>HA,afterWrite:()=>qA,applyStyles:()=>eC,arrow:()=>bC,auto:()=>RA,basePlacements:()=>PA,beforeMain:()=>VA,beforeRead:()=>FA,beforeWrite:()=>XA,bottom:()=>AA,clippingParents:()=>LA,computeStyles:()=>TC,createPopper:()=>iI,createPopperBase:()=>eI,createPopperLite:()=>nI,detectOverflow:()=>GC,end:()=>DA,eventListeners:()=>AC,flip:()=>HC,hide:()=>WC,left:()=>IA,main:()=>jA,modifierPhases:()=>YA,offset:()=>XC,placements:()=>UA,popper:()=>NA,popperGenerator:()=>tI,popperOffsets:()=>$C,preventOverflow:()=>qC,read:()=>GA,reference:()=>BA,right:()=>CA,start:()=>kA,top:()=>EA,variationPlacements:()=>zA,viewport:()=>OA,write:()=>$A});const e="8Dia+AvRXD44FD7tbWIqesVIiQKZ7f11+vQUXG5FH48=",i="r2e4a6XJ50SaoZcqZf4iXK9t5AqPvlUHynDONQUOkLY=",n="GInp96yk5yW/RSY8c0dVH1+uaA/e8YlL4/WJXpTFWBQ=",s="bzMGsbUxMD5yg5V3Z7FFLTUm/jHnAgOkNMA7kje/jQo=",r=n,a=s,h=a,l="ztY04MiyZPHrhKract3zXWv3xjIQ69X+F75gDqlRxAU=",c=l;var u=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class d{constructor(){this.hons=new Map,this.profiles=new Map,this.models=new Map,this.honviews=new Map,this.invens=new Map}SaveHonView(t,e){this.honviews.set(t,e)}LoadHonView(t){return this.honviews.get(t)}FetchInventory(t,e){const i=this.invens.get(e);if(null!=i)return Promise.resolve(i);const n=t+"/glambda?txid="+encodeURIComponent(s)+"&table=inventory&key="+e;return fetch(n).then((t=>t.json())).then((t=>{if("data"in t){return JSON.parse(t.data)}}))}UpdateInventory(t,e){this.invens.set(e,t)}GetInventory(t){return this.invens.get(t)}UpdateModels(t,e){this.models.set(e,t)}GetModel(t){return this.models.get(t)}FetchModels(t){const e=t+"/glambda?txid="+encodeURIComponent(n)+"&table=meta&start=0&count=20",i=new Map;return fetch(e).then((t=>t.json())).then((t=>{if("json"in t){return JSON.parse(t.json)}throw""})).then((e=>u(this,void 0,void 0,(function*(){const n=[],s=e.map((e=>u(this,void 0,void 0,(function*(){const s=yield this.FetchModel(t,atob(e)).then((t=>{i.set(t.id,t.models)}));n.push(s)}))));return Promise.all(s)})))).then((()=>i)).catch((()=>i))}FetchModel(t,e){const i=this.models.get(e);if(null!=i)return Promise.resolve(i);const n=t+"/glambda?txid="+encodeURIComponent(s)+"&table=meta&key="+e;return fetch(n).then((t=>t.json())).then((t=>(this.models.set(e,t),t)))}FetchHon(t,e){const i=this.hons.get(e);if(null!=i)return Promise.resolve(i);const n=t+"/glambda?txid="+encodeURIComponent(a)+"&table=feeds&key="+e;return fetch(n).then((t=>t.json())).then((t=>(this.hons.set(e,t),t)))}FetchProfile(t,e){const i=this.profiles.get(e);if(null!=i)return Promise.resolve(i);const n=t+"/glambda?txid="+encodeURIComponent(a)+"&table=profile&key="+e;return fetch(n).then((t=>t.json())).then((t=>(this.profiles.set(e,t),t)))}}class p{constructor(){this.m_opend=!1,this.m_handler={}}OpenChannel(t){const e=new WebSocket(t);e.onopen=()=>{this.m_opend=!0,e.onmessage=t=>{const e=JSON.parse(t.data);e.types,this.m_handler[e.types](e.params)}},e.onclose=()=>{this.m_opend=!1,this.m_handler.close()},this.m_ws=e}IsOpen(){return this.m_opend}RegisterMsgHandler(t,e){this.m_handler[t]=t=>{e(t)}}SendMsg(t,...e){var i;const n={types:t,params:[...e]};null===(i=this.m_ws)||void 0===i||i.send(JSON.stringify(n))}}var m=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};const f=(t,e,i)=>m(void 0,void 0,void 0,(function*(){let n="";yield t.FetchProfile(window.MasterAddr,e.email).then((t=>m(void 0,void 0,void 0,(function*(){""!=t.file&&"file"in t?yield fetch("data:image/jpg;base64,"+t.file).then((t=>t.blob())).then((t=>{n=URL.createObjectURL(t)})):n="static/img/ghost_background_black.png"}))));let s="";void 0!==e.file&&""!=e.file&&(yield fetch("data:image/jpg;base64,"+e.file).then((t=>t.blob())).then((t=>{s=URL.createObjectURL(t),s='<span class="m-1"> <img src="'+s+'" class="rounded img-fluid w-100"> </span> '})));const r=yield g(i),o=e.tag;try{e.tag=decodeURIComponent(atob(e.tag))}catch(t){e.tag=""}const a=null==e.tag||""==e.tag?"":`\n        <div class="row">\n        <div class="col">\n            <span class='badge bg-primary' onclick="ClickLoadPage('hons', false, '&tag=${o}')">${e.tag}</span>\n        </div>\n        </div>`;return`\n<div class="container p-2 border-bottom container-honview">\n    <div class="row p-0 handcursor">\n        <div class="col-auto text-center pe-0">\n                    <a href="javascript:void(0)" onclick="ClickLoadPage('hondetail', false, '&email=${e.email}')">\n                    <span class="m-1">\n                    <img class="profile-sm" src="${n}"></span>\n                    </a>\n        </div>\n        <div class="col m-0 p-0">\n            <div class="container ps-1">\n                <div class="row">\n                <div class="col-auto pe-0">\n                    <a href="javascript:void(0)" onclick="ClickLoadPage('hondetail', false, '&email=${e.email}')">\n                    <strong class="me-auto">${e.id}</strong>\n                    </a>\n                    </div>\n                <div class="col ps-1" onclick="ClickLoadPage('hon', false, '&key=${i}')">\n                    <small>@${e.email} · ${function(t){const e=new Date(t),i=((new Date).getTime()-e.getTime())/1e3;if(isNaN(i))return"";const n=[{name:"years",milliSeconds:31536e3},{name:"months",milliSeconds:2592e3},{name:"days",milliSeconds:86400},{name:"hrs",milliSeconds:3600},{name:"mins",milliSeconds:60}];for(const t of n){const e=Math.floor(i/t.milliSeconds);if(e>0)return`${e} ${t.name} ago`}return"now"}(Number(e.time))}</small>\n                    </div>\n                </div>\n                <div class="row" onclick="ClickLoadPage('hon', false, '&key=${i}')">\n                    <pre class="hon-contents m-0" style="font-size:medium;">${e.content}</pre>\n                </div>\n                <div class="row" onclick="ClickLoadPage('hon', false, '&key=${i}')">\n                    ${s}\n                </div>\n                ${a}\n                <div class="row" onclick="ClickLoadPage('hon', false, '&key=${i}')">\n                    <div class="col-auto pe-0">\n                    <span class="material-symbols-outlined" style="font-size:14px;">\n                        chat_bubble\n                    </span>\n                    </div>\n                    <div class="col ps-1">\n                    <small>${r}</small>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n        `})),g=t=>{const e=`\n        ${window.MasterAddr}/glambda?txid=${encodeURIComponent(l)}&table=replylink&key=${t}`;return fetch(e).then((t=>t.json())).then((t=>t.result.constructor==Array?t.result.length:""))};var v=o(990);const y="160",x=0,_=1,b=2,w=0,M=1,S=2,T=3,E=1,A=2,C=3,I=0,R=1,P=100,k=0,D=1,L=2,O=0,N=1,B=2,z=3,U=4,F=5,G=6,H="attached",V=301,j=302,W=303,X=304,$=306,q=1e3,Y=1001,K=1002,Z=1003,J=1004,Q=1005,tt=1006,et=1007,it=1008,nt=1009,st=1012,rt=1013,ot=1014,at=1015,ht=1016,lt=1020,ct=1023,ut=1026,dt=1027,pt=33776,mt=33777,ft=33778,gt=33779,vt=36492,yt=2200,xt=2201,_t=2300,bt=2301,wt=2302,Mt=2400,St=2401,Tt=2402,Et=2500,At=3001,Ct="",It="srgb",Rt="srgb-linear",Pt="display-p3",kt="display-p3-linear",Dt="linear",Lt="srgb",Ot="rec709",Nt="p3",Bt=7680,zt=35044,Ut="300 es",Ft=1035,Gt=2e3,Ht=2001;class Vt{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t);t.target=null}}}const jt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Wt=1234567;const Xt=Math.PI/180,$t=180/Math.PI;function qt(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(jt[255&t]+jt[t>>8&255]+jt[t>>16&255]+jt[t>>24&255]+"-"+jt[255&e]+jt[e>>8&255]+"-"+jt[e>>16&15|64]+jt[e>>24&255]+"-"+jt[63&i|128]+jt[i>>8&255]+"-"+jt[i>>16&255]+jt[i>>24&255]+jt[255&n]+jt[n>>8&255]+jt[n>>16&255]+jt[n>>24&255]).toLowerCase()}function Yt(t,e,i){return Math.max(e,Math.min(i,t))}function Kt(t,e){return(t%e+e)%e}function Zt(t,e,i){return(1-i)*t+i*e}function Jt(t){return 0==(t&t-1)&&0!==t}function Qt(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function te(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function ee(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const ie={DEG2RAD:Xt,RAD2DEG:$t,generateUUID:qt,clamp:Yt,euclideanModulo:Kt,mapLinear:function(t,e,i,n,s){return n+(t-e)*(s-n)/(i-e)},inverseLerp:function(t,e,i){return t!==e?(i-t)/(e-t):0},lerp:Zt,damp:function(t,e,i,n){return Zt(t,e,1-Math.exp(-i*n))},pingpong:function(t,e=1){return e-Math.abs(Kt(t,2*e)-e)},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(Wt=t);let e=Wt+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*Xt},radToDeg:function(t){return t*$t},isPowerOfTwo:Jt,ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:Qt,setQuaternionFromProperEuler:function(t,e,i,n,s){const r=Math.cos,o=Math.sin,a=r(i/2),h=o(i/2),l=r((e+n)/2),c=o((e+n)/2),u=r((e-n)/2),d=o((e-n)/2),p=r((n-e)/2),m=o((n-e)/2);switch(s){case"XYX":t.set(a*c,h*u,h*d,a*l);break;case"YZY":t.set(h*d,a*c,h*u,a*l);break;case"ZXZ":t.set(h*u,h*d,a*c,a*l);break;case"XZX":t.set(a*c,h*m,h*p,a*l);break;case"YXY":t.set(h*p,a*c,h*m,a*l);break;case"ZYZ":t.set(h*m,h*p,a*c,a*l)}},normalize:ee,denormalize:te};class ne{constructor(t=0,e=0){ne.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Yt(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),s=this.x-t.x,r=this.y-t.y;return this.x=s*i-r*n+t.x,this.y=s*n+r*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class se{constructor(t,e,i,n,s,r,o,a,h){se.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,i,n,s,r,o,a,h)}set(t,e,i,n,s,r,o,a,h){const l=this.elements;return l[0]=t,l[1]=n,l[2]=o,l[3]=e,l[4]=s,l[5]=a,l[6]=i,l[7]=r,l[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,r=i[0],o=i[3],a=i[6],h=i[1],l=i[4],c=i[7],u=i[2],d=i[5],p=i[8],m=n[0],f=n[3],g=n[6],v=n[1],y=n[4],x=n[7],_=n[2],b=n[5],w=n[8];return s[0]=r*m+o*v+a*_,s[3]=r*f+o*y+a*b,s[6]=r*g+o*x+a*w,s[1]=h*m+l*v+c*_,s[4]=h*f+l*y+c*b,s[7]=h*g+l*x+c*w,s[2]=u*m+d*v+p*_,s[5]=u*f+d*y+p*b,s[8]=u*g+d*x+p*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8];return e*r*l-e*o*h-i*s*l+i*o*a+n*s*h-n*r*a}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8],c=l*r-o*h,u=o*a-l*s,d=h*s-r*a,p=e*c+i*u+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=c*m,t[1]=(n*h-l*i)*m,t[2]=(o*i-n*r)*m,t[3]=u*m,t[4]=(l*e-n*a)*m,t[5]=(n*s-o*e)*m,t[6]=d*m,t[7]=(i*a-h*e)*m,t[8]=(r*e-i*s)*m,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,s,r,o){const a=Math.cos(s),h=Math.sin(s);return this.set(i*a,i*h,-i*(a*r+h*o)+r+t,-n*h,n*a,-n*(-h*r+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(re.makeScale(t,e)),this}rotate(t){return this.premultiply(re.makeRotation(-t)),this}translate(t,e){return this.premultiply(re.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const re=new se;function oe(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;function ae(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function he(){const t=ae("canvas");return t.style.display="block",t}const le={};function ce(t){t in le||(le[t]=!0)}const ue=(new se).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),de=(new se).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),pe={[Rt]:{transfer:Dt,primaries:Ot,toReference:t=>t,fromReference:t=>t},[It]:{transfer:Lt,primaries:Ot,toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[kt]:{transfer:Dt,primaries:Nt,toReference:t=>t.applyMatrix3(de),fromReference:t=>t.applyMatrix3(ue)},[Pt]:{transfer:Lt,primaries:Nt,toReference:t=>t.convertSRGBToLinear().applyMatrix3(de),fromReference:t=>t.applyMatrix3(ue).convertLinearToSRGB()}},me=new Set([Rt,kt]),fe={enabled:!0,_workingColorSpace:Rt,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!me.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,i){if(!1===this.enabled||e===i||!e||!i)return t;const n=pe[e].toReference;return(0,pe[i].fromReference)(n(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return pe[t].primaries},getTransfer:function(t){return t===Ct?Dt:pe[t].transfer}};function ge(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function ve(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let ye;class xe{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===ye&&(ye=ae("canvas")),ye.width=t.width,ye.height=t.height;const i=ye.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=ye}return e.width>2048||e.height>2048?e.toDataURL("image/jpeg",.6):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=ae("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height),s=n.data;for(let t=0;t<s.length;t++)s[t]=255*ge(s[t]/255);return i.putImageData(n,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*ge(e[t]/255)):e[t]=ge(e[t]);return{data:e,width:t.width,height:t.height}}return t}}let _e=0;class be{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_e++}),this.uuid=qt(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(we(n[e].image)):t.push(we(n[e]))}else t=we(n);i.url=t}return e||(t.images[this.uuid]=i),i}}function we(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?xe.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:{}}let Me=0;class Se extends Vt{constructor(t=Se.DEFAULT_IMAGE,e=Se.DEFAULT_MAPPING,i=1001,n=1001,s=1006,r=1008,o=1023,a=1009,h=Se.DEFAULT_ANISOTROPY,l=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Me++}),this.uuid=qt(),this.name="",this.source=new be(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=s,this.minFilter=r,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=a,this.offset=new ne(0,0),this.repeat=new ne(1,1),this.center=new ne(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new se,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,"string"==typeof l?this.colorSpace=l:(ce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=l===At?It:Ct),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case q:t.x=t.x-Math.floor(t.x);break;case Y:t.x=t.x<0?0:1;break;case K:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case q:t.y=t.y-Math.floor(t.y);break;case Y:t.y=t.y<0?0:1;break;case K:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return ce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===It?At:3e3}set encoding(t){ce("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===At?It:Ct}}Se.DEFAULT_IMAGE=null,Se.DEFAULT_MAPPING=300,Se.DEFAULT_ANISOTROPY=1;class Te{constructor(t=0,e=0,i=0,n=1){Te.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,s=this.w,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n+r[12]*s,this.y=r[1]*e+r[5]*i+r[9]*n+r[13]*s,this.z=r[2]*e+r[6]*i+r[10]*n+r[14]*s,this.w=r[3]*e+r[7]*i+r[11]*n+r[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,s;const r=.01,o=.1,a=t.elements,h=a[0],l=a[4],c=a[8],u=a[1],d=a[5],p=a[9],m=a[2],f=a[6],g=a[10];if(Math.abs(l-u)<r&&Math.abs(c-m)<r&&Math.abs(p-f)<r){if(Math.abs(l+u)<o&&Math.abs(c+m)<o&&Math.abs(p+f)<o&&Math.abs(h+d+g-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(h+1)/2,a=(d+1)/2,v=(g+1)/2,y=(l+u)/4,x=(c+m)/4,_=(p+f)/4;return t>a&&t>v?t<r?(i=0,n=.707106781,s=.707106781):(i=Math.sqrt(t),n=y/i,s=x/i):a>v?a<r?(i=.707106781,n=0,s=.707106781):(n=Math.sqrt(a),i=y/n,s=_/n):v<r?(i=.707106781,n=.707106781,s=0):(s=Math.sqrt(v),i=x/s,n=_/s),this.set(i,n,s,e),this}let v=Math.sqrt((f-p)*(f-p)+(c-m)*(c-m)+(u-l)*(u-l));return Math.abs(v)<.001&&(v=1),this.x=(f-p)/v,this.y=(c-m)/v,this.z=(u-l)/v,this.w=Math.acos((h+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Ee extends Vt{constructor(t=1,e=1,i={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new Te(0,0,t,e),this.scissorTest=!1,this.viewport=new Te(0,0,t,e);const n={width:t,height:e,depth:1};void 0!==i.encoding&&(ce("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),i.colorSpace=i.encoding===At?It:Ct),i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:tt,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0},i),this.texture=new Se(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=i.generateMipmaps,this.texture.internalFormat=i.internalFormat,this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}setSize(t,e,i=1){this.width===t&&this.height===e&&this.depth===i||(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new be(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ae extends Ee{constructor(t=1,e=1,i={}){super(t,e,i),this.isWebGLRenderTarget=!0}}class Ce extends Se{constructor(t=null,e=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=Z,this.minFilter=Z,this.wrapR=Y,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ie extends Se{constructor(t=null,e=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=Z,this.minFilter=Z,this.wrapR=Y,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Re{constructor(t=0,e=0,i=0,n=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=n}static slerpFlat(t,e,i,n,s,r,o){let a=i[n+0],h=i[n+1],l=i[n+2],c=i[n+3];const u=s[r+0],d=s[r+1],p=s[r+2],m=s[r+3];if(0===o)return t[e+0]=a,t[e+1]=h,t[e+2]=l,void(t[e+3]=c);if(1===o)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=m);if(c!==m||a!==u||h!==d||l!==p){let t=1-o;const e=a*u+h*d+l*p+c*m,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const s=Math.sqrt(n),r=Math.atan2(s,e*i);t=Math.sin(t*r)/s,o=Math.sin(o*r)/s}const s=o*i;if(a=a*t+u*s,h=h*t+d*s,l=l*t+p*s,c=c*t+m*s,t===1-o){const t=1/Math.sqrt(a*a+h*h+l*l+c*c);a*=t,h*=t,l*=t,c*=t}}t[e]=a,t[e+1]=h,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,n,s,r){const o=i[n],a=i[n+1],h=i[n+2],l=i[n+3],c=s[r],u=s[r+1],d=s[r+2],p=s[r+3];return t[e]=o*p+l*c+a*d-h*u,t[e+1]=a*p+l*u+h*c-o*d,t[e+2]=h*p+l*d+o*u-a*c,t[e+3]=l*p-o*c-a*u-h*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const i=t._x,n=t._y,s=t._z,r=t._order,o=Math.cos,a=Math.sin,h=o(i/2),l=o(n/2),c=o(s/2),u=a(i/2),d=a(n/2),p=a(s/2);switch(r){case"XYZ":this._x=u*l*c+h*d*p,this._y=h*d*c-u*l*p,this._z=h*l*p+u*d*c,this._w=h*l*c-u*d*p;break;case"YXZ":this._x=u*l*c+h*d*p,this._y=h*d*c-u*l*p,this._z=h*l*p-u*d*c,this._w=h*l*c+u*d*p;break;case"ZXY":this._x=u*l*c-h*d*p,this._y=h*d*c+u*l*p,this._z=h*l*p+u*d*c,this._w=h*l*c-u*d*p;break;case"ZYX":this._x=u*l*c-h*d*p,this._y=h*d*c+u*l*p,this._z=h*l*p-u*d*c,this._w=h*l*c+u*d*p;break;case"YZX":this._x=u*l*c+h*d*p,this._y=h*d*c+u*l*p,this._z=h*l*p-u*d*c,this._w=h*l*c-u*d*p;break;case"XZY":this._x=u*l*c-h*d*p,this._y=h*d*c-u*l*p,this._z=h*l*p+u*d*c,this._w=h*l*c+u*d*p}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],s=e[8],r=e[1],o=e[5],a=e[9],h=e[2],l=e[6],c=e[10],u=i+o+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(l-a)*t,this._y=(s-h)*t,this._z=(r-n)*t}else if(i>o&&i>c){const t=2*Math.sqrt(1+i-o-c);this._w=(l-a)/t,this._x=.25*t,this._y=(n+r)/t,this._z=(s+h)/t}else if(o>c){const t=2*Math.sqrt(1+o-i-c);this._w=(s-h)/t,this._x=(n+r)/t,this._y=.25*t,this._z=(a+l)/t}else{const t=2*Math.sqrt(1+c-i-o);this._w=(r-n)/t,this._x=(s+h)/t,this._y=(a+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Yt(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,s=t._z,r=t._w,o=e._x,a=e._y,h=e._z,l=e._w;return this._x=i*l+r*o+n*h-s*a,this._y=n*l+r*a+s*o-i*h,this._z=s*l+r*h+i*a-n*o,this._w=r*l-i*o-n*a-s*h,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,s=this._z,r=this._w;let o=r*t._w+i*t._x+n*t._y+s*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=r,this._x=i,this._y=n,this._z=s,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*r+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*s+e*this._z,this.normalize(),this}const h=Math.sqrt(a),l=Math.atan2(h,o),c=Math.sin((1-e)*l)/h,u=Math.sin(e*l)/h;return this._w=r*c+this._w*u,this._x=i*c+this._x*u,this._y=n*c+this._y*u,this._z=s*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(s),i*Math.cos(s),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Pe{constructor(t=0,e=0,i=0){Pe.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(De.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(De.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6]*n,this.y=s[1]*e+s[4]*i+s[7]*n,this.z=s[2]*e+s[5]*i+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,s=t.elements,r=1/(s[3]*e+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*e+s[4]*i+s[8]*n+s[12])*r,this.y=(s[1]*e+s[5]*i+s[9]*n+s[13])*r,this.z=(s[2]*e+s[6]*i+s[10]*n+s[14])*r,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,s=t.x,r=t.y,o=t.z,a=t.w,h=2*(r*n-o*i),l=2*(o*e-s*n),c=2*(s*i-r*e);return this.x=e+a*h+r*c-o*l,this.y=i+a*l+o*h-s*c,this.z=n+a*c+s*l-r*h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n,this.y=s[1]*e+s[5]*i+s[9]*n,this.z=s[2]*e+s[6]*i+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,s=t.z,r=e.x,o=e.y,a=e.z;return this.x=n*a-s*o,this.y=s*r-i*a,this.z=i*o-n*r,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return ke.copy(this).projectOnVector(t),this.sub(ke)}reflect(t){return this.sub(ke.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(Yt(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const ke=new Pe,De=new Re;class Le{constructor(t=new Pe(1/0,1/0,1/0),e=new Pe(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e+=3)this.expandByPoint(Ne.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,i=t.count;e<i;e++)this.expandByPoint(Ne.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Ne.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(void 0!==i){const n=i.getAttribute("position");if(!0===e&&void 0!==n&&!0!==t.isInstancedMesh)for(let e=0,i=n.count;e<i;e++)!0===t.isMesh?t.getVertexPosition(e,Ne):Ne.fromBufferAttribute(n,e),Ne.applyMatrix4(t.matrixWorld),this.expandByPoint(Ne);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),Be.copy(t.boundingBox)):(null===i.boundingBox&&i.computeBoundingBox(),Be.copy(i.boundingBox)),Be.applyMatrix4(t.matrixWorld),this.union(Be)}const n=t.children;for(let t=0,i=n.length;t<i;t++)this.expandByObject(n[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,Ne),Ne.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(je),We.subVectors(this.max,je),ze.subVectors(t.a,je),Ue.subVectors(t.b,je),Fe.subVectors(t.c,je),Ge.subVectors(Ue,ze),He.subVectors(Fe,Ue),Ve.subVectors(ze,Fe);let e=[0,-Ge.z,Ge.y,0,-He.z,He.y,0,-Ve.z,Ve.y,Ge.z,0,-Ge.x,He.z,0,-He.x,Ve.z,0,-Ve.x,-Ge.y,Ge.x,0,-He.y,He.x,0,-Ve.y,Ve.x,0];return!!qe(e,ze,Ue,Fe,We)&&(e=[1,0,0,0,1,0,0,0,1],!!qe(e,ze,Ue,Fe,We)&&(Xe.crossVectors(Ge,He),e=[Xe.x,Xe.y,Xe.z],qe(e,ze,Ue,Fe,We)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Ne).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(Ne).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Oe[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Oe[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Oe[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Oe[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Oe[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Oe[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Oe[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Oe[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Oe)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Oe=[new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe,new Pe],Ne=new Pe,Be=new Le,ze=new Pe,Ue=new Pe,Fe=new Pe,Ge=new Pe,He=new Pe,Ve=new Pe,je=new Pe,We=new Pe,Xe=new Pe,$e=new Pe;function qe(t,e,i,n,s){for(let r=0,o=t.length-3;r<=o;r+=3){$e.fromArray(t,r);const o=s.x*Math.abs($e.x)+s.y*Math.abs($e.y)+s.z*Math.abs($e.z),a=e.dot($e),h=i.dot($e),l=n.dot($e);if(Math.max(-Math.max(a,h,l),Math.min(a,h,l))>o)return!1}return!0}const Ye=new Le,Ke=new Pe,Ze=new Pe;class Je{constructor(t=new Pe,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):Ye.setFromPoints(t).getCenter(i);let n=0;for(let e=0,s=t.length;e<s;e++)n=Math.max(n,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Ke.subVectors(t,this.center);const e=Ke.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.addScaledVector(Ke,i/t),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(Ze.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Ke.copy(t.center).add(Ze)),this.expandByPoint(Ke.copy(t.center).sub(Ze))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Qe=new Pe,ti=new Pe,ei=new Pe,ii=new Pe,ni=new Pe,si=new Pe,ri=new Pe;class oi{constructor(t=new Pe,e=new Pe(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Qe)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Qe.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Qe.copy(this.origin).addScaledVector(this.direction,e),Qe.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){ti.copy(t).add(e).multiplyScalar(.5),ei.copy(e).sub(t).normalize(),ii.copy(this.origin).sub(ti);const s=.5*t.distanceTo(e),r=-this.direction.dot(ei),o=ii.dot(this.direction),a=-ii.dot(ei),h=ii.lengthSq(),l=Math.abs(1-r*r);let c,u,d,p;if(l>0)if(c=r*a-o,u=r*o-a,p=s*l,c>=0)if(u>=-p)if(u<=p){const t=1/l;c*=t,u*=t,d=c*(c+r*u+2*o)+u*(r*c+u+2*a)+h}else u=s,c=Math.max(0,-(r*u+o)),d=-c*c+u*(u+2*a)+h;else u=-s,c=Math.max(0,-(r*u+o)),d=-c*c+u*(u+2*a)+h;else u<=-p?(c=Math.max(0,-(-r*s+o)),u=c>0?-s:Math.min(Math.max(-s,-a),s),d=-c*c+u*(u+2*a)+h):u<=p?(c=0,u=Math.min(Math.max(-s,-a),s),d=u*(u+2*a)+h):(c=Math.max(0,-(r*s+o)),u=c>0?s:Math.min(Math.max(-s,-a),s),d=-c*c+u*(u+2*a)+h);else u=r>0?-s:s,c=Math.max(0,-(r*u+o)),d=-c*c+u*(u+2*a)+h;return i&&i.copy(this.origin).addScaledVector(this.direction,c),n&&n.copy(ti).addScaledVector(ei,u),d}intersectSphere(t,e){Qe.subVectors(t.center,this.origin);const i=Qe.dot(this.direction),n=Qe.dot(Qe)-i*i,s=t.radius*t.radius;if(n>s)return null;const r=Math.sqrt(s-n),o=i-r,a=i+r;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,s,r,o,a;const h=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,u=this.origin;return h>=0?(i=(t.min.x-u.x)*h,n=(t.max.x-u.x)*h):(i=(t.max.x-u.x)*h,n=(t.min.x-u.x)*h),l>=0?(s=(t.min.y-u.y)*l,r=(t.max.y-u.y)*l):(s=(t.max.y-u.y)*l,r=(t.min.y-u.y)*l),i>r||s>n?null:((s>i||isNaN(i))&&(i=s),(r<n||isNaN(n))&&(n=r),c>=0?(o=(t.min.z-u.z)*c,a=(t.max.z-u.z)*c):(o=(t.max.z-u.z)*c,a=(t.min.z-u.z)*c),i>a||o>n?null:((o>i||i!=i)&&(i=o),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,Qe)}intersectTriangle(t,e,i,n,s){ni.subVectors(e,t),si.subVectors(i,t),ri.crossVectors(ni,si);let r,o=this.direction.dot(ri);if(o>0){if(n)return null;r=1}else{if(!(o<0))return null;r=-1,o=-o}ii.subVectors(this.origin,t);const a=r*this.direction.dot(si.crossVectors(ii,si));if(a<0)return null;const h=r*this.direction.dot(ni.cross(ii));if(h<0)return null;if(a+h>o)return null;const l=-r*ii.dot(ri);return l<0?null:this.at(l/o,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class ai{constructor(t,e,i,n,s,r,o,a,h,l,c,u,d,p,m,f){ai.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,i,n,s,r,o,a,h,l,c,u,d,p,m,f)}set(t,e,i,n,s,r,o,a,h,l,c,u,d,p,m,f){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=s,g[5]=r,g[9]=o,g[13]=a,g[2]=h,g[6]=l,g[10]=c,g[14]=u,g[3]=d,g[7]=p,g[11]=m,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new ai).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/hi.setFromMatrixColumn(t,0).length(),s=1/hi.setFromMatrixColumn(t,1).length(),r=1/hi.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*s,e[5]=i[5]*s,e[6]=i[6]*s,e[7]=0,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,n=t.y,s=t.z,r=Math.cos(i),o=Math.sin(i),a=Math.cos(n),h=Math.sin(n),l=Math.cos(s),c=Math.sin(s);if("XYZ"===t.order){const t=r*l,i=r*c,n=o*l,s=o*c;e[0]=a*l,e[4]=-a*c,e[8]=h,e[1]=i+n*h,e[5]=t-s*h,e[9]=-o*a,e[2]=s-t*h,e[6]=n+i*h,e[10]=r*a}else if("YXZ"===t.order){const t=a*l,i=a*c,n=h*l,s=h*c;e[0]=t+s*o,e[4]=n*o-i,e[8]=r*h,e[1]=r*c,e[5]=r*l,e[9]=-o,e[2]=i*o-n,e[6]=s+t*o,e[10]=r*a}else if("ZXY"===t.order){const t=a*l,i=a*c,n=h*l,s=h*c;e[0]=t-s*o,e[4]=-r*c,e[8]=n+i*o,e[1]=i+n*o,e[5]=r*l,e[9]=s-t*o,e[2]=-r*h,e[6]=o,e[10]=r*a}else if("ZYX"===t.order){const t=r*l,i=r*c,n=o*l,s=o*c;e[0]=a*l,e[4]=n*h-i,e[8]=t*h+s,e[1]=a*c,e[5]=s*h+t,e[9]=i*h-n,e[2]=-h,e[6]=o*a,e[10]=r*a}else if("YZX"===t.order){const t=r*a,i=r*h,n=o*a,s=o*h;e[0]=a*l,e[4]=s-t*c,e[8]=n*c+i,e[1]=c,e[5]=r*l,e[9]=-o*l,e[2]=-h*l,e[6]=i*c+n,e[10]=t-s*c}else if("XZY"===t.order){const t=r*a,i=r*h,n=o*a,s=o*h;e[0]=a*l,e[4]=-c,e[8]=h*l,e[1]=t*c+s,e[5]=r*l,e[9]=i*c-n,e[2]=n*c-i,e[6]=o*l,e[10]=s*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(ci,t,ui)}lookAt(t,e,i){const n=this.elements;return mi.subVectors(t,e),0===mi.lengthSq()&&(mi.z=1),mi.normalize(),di.crossVectors(i,mi),0===di.lengthSq()&&(1===Math.abs(i.z)?mi.x+=1e-4:mi.z+=1e-4,mi.normalize(),di.crossVectors(i,mi)),di.normalize(),pi.crossVectors(mi,di),n[0]=di.x,n[4]=pi.x,n[8]=mi.x,n[1]=di.y,n[5]=pi.y,n[9]=mi.y,n[2]=di.z,n[6]=pi.z,n[10]=mi.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,r=i[0],o=i[4],a=i[8],h=i[12],l=i[1],c=i[5],u=i[9],d=i[13],p=i[2],m=i[6],f=i[10],g=i[14],v=i[3],y=i[7],x=i[11],_=i[15],b=n[0],w=n[4],M=n[8],S=n[12],T=n[1],E=n[5],A=n[9],C=n[13],I=n[2],R=n[6],P=n[10],k=n[14],D=n[3],L=n[7],O=n[11],N=n[15];return s[0]=r*b+o*T+a*I+h*D,s[4]=r*w+o*E+a*R+h*L,s[8]=r*M+o*A+a*P+h*O,s[12]=r*S+o*C+a*k+h*N,s[1]=l*b+c*T+u*I+d*D,s[5]=l*w+c*E+u*R+d*L,s[9]=l*M+c*A+u*P+d*O,s[13]=l*S+c*C+u*k+d*N,s[2]=p*b+m*T+f*I+g*D,s[6]=p*w+m*E+f*R+g*L,s[10]=p*M+m*A+f*P+g*O,s[14]=p*S+m*C+f*k+g*N,s[3]=v*b+y*T+x*I+_*D,s[7]=v*w+y*E+x*R+_*L,s[11]=v*M+y*A+x*P+_*O,s[15]=v*S+y*C+x*k+_*N,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],s=t[12],r=t[1],o=t[5],a=t[9],h=t[13],l=t[2],c=t[6],u=t[10],d=t[14];return t[3]*(+s*a*c-n*h*c-s*o*u+i*h*u+n*o*d-i*a*d)+t[7]*(+e*a*d-e*h*u+s*r*u-n*r*d+n*h*l-s*a*l)+t[11]*(+e*h*c-e*o*d-s*r*c+i*r*d+s*o*l-i*h*l)+t[15]*(-n*o*l-e*a*c+e*o*u+n*r*c-i*r*u+i*a*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],l=t[8],c=t[9],u=t[10],d=t[11],p=t[12],m=t[13],f=t[14],g=t[15],v=c*f*h-m*u*h+m*a*d-o*f*d-c*a*g+o*u*g,y=p*u*h-l*f*h-p*a*d+r*f*d+l*a*g-r*u*g,x=l*m*h-p*c*h+p*o*d-r*m*d-l*o*g+r*c*g,_=p*c*a-l*m*a-p*o*u+r*m*u+l*o*f-r*c*f,b=e*v+i*y+n*x+s*_;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/b;return t[0]=v*w,t[1]=(m*u*s-c*f*s-m*n*d+i*f*d+c*n*g-i*u*g)*w,t[2]=(o*f*s-m*a*s+m*n*h-i*f*h-o*n*g+i*a*g)*w,t[3]=(c*a*s-o*u*s-c*n*h+i*u*h+o*n*d-i*a*d)*w,t[4]=y*w,t[5]=(l*f*s-p*u*s+p*n*d-e*f*d-l*n*g+e*u*g)*w,t[6]=(p*a*s-r*f*s-p*n*h+e*f*h+r*n*g-e*a*g)*w,t[7]=(r*u*s-l*a*s+l*n*h-e*u*h-r*n*d+e*a*d)*w,t[8]=x*w,t[9]=(p*c*s-l*m*s-p*i*d+e*m*d+l*i*g-e*c*g)*w,t[10]=(r*m*s-p*o*s+p*i*h-e*m*h-r*i*g+e*o*g)*w,t[11]=(l*o*s-r*c*s-l*i*h+e*c*h+r*i*d-e*o*d)*w,t[12]=_*w,t[13]=(l*m*n-p*c*n+p*i*u-e*m*u-l*i*f+e*c*f)*w,t[14]=(p*o*n-r*m*n-p*i*a+e*m*a+r*i*f-e*o*f)*w,t[15]=(r*c*n-l*o*n+l*i*a-e*c*a-r*i*u+e*o*u)*w,this}scale(t){const e=this.elements,i=t.x,n=t.y,s=t.z;return e[0]*=i,e[4]*=n,e[8]*=s,e[1]*=i,e[5]*=n,e[9]*=s,e[2]*=i,e[6]*=n,e[10]*=s,e[3]*=i,e[7]*=n,e[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),s=1-i,r=t.x,o=t.y,a=t.z,h=s*r,l=s*o;return this.set(h*r+i,h*o-n*a,h*a+n*o,0,h*o+n*a,l*o+i,l*a-n*r,0,h*a-n*o,l*a+n*r,s*a*a+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,s,r){return this.set(1,i,s,0,t,1,r,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,s=e._x,r=e._y,o=e._z,a=e._w,h=s+s,l=r+r,c=o+o,u=s*h,d=s*l,p=s*c,m=r*l,f=r*c,g=o*c,v=a*h,y=a*l,x=a*c,_=i.x,b=i.y,w=i.z;return n[0]=(1-(m+g))*_,n[1]=(d+x)*_,n[2]=(p-y)*_,n[3]=0,n[4]=(d-x)*b,n[5]=(1-(u+g))*b,n[6]=(f+v)*b,n[7]=0,n[8]=(p+y)*w,n[9]=(f-v)*w,n[10]=(1-(u+m))*w,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let s=hi.set(n[0],n[1],n[2]).length();const r=hi.set(n[4],n[5],n[6]).length(),o=hi.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],li.copy(this);const a=1/s,h=1/r,l=1/o;return li.elements[0]*=a,li.elements[1]*=a,li.elements[2]*=a,li.elements[4]*=h,li.elements[5]*=h,li.elements[6]*=h,li.elements[8]*=l,li.elements[9]*=l,li.elements[10]*=l,e.setFromRotationMatrix(li),i.x=s,i.y=r,i.z=o,this}makePerspective(t,e,i,n,s,r,o=2e3){const a=this.elements,h=2*s/(e-t),l=2*s/(i-n),c=(e+t)/(e-t),u=(i+n)/(i-n);let d,p;if(o===Gt)d=-(r+s)/(r-s),p=-2*r*s/(r-s);else{if(o!==Ht)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);d=-r/(r-s),p=-r*s/(r-s)}return a[0]=h,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=u,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,n,s,r,o=2e3){const a=this.elements,h=1/(e-t),l=1/(i-n),c=1/(r-s),u=(e+t)*h,d=(i+n)*l;let p,m;if(o===Gt)p=(r+s)*c,m=-2*c;else{if(o!==Ht)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);p=s*c,m=-1*c}return a[0]=2*h,a[4]=0,a[8]=0,a[12]=-u,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=m,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const hi=new Pe,li=new ai,ci=new Pe(0,0,0),ui=new Pe(1,1,1),di=new Pe,pi=new Pe,mi=new Pe,fi=new ai,gi=new Re;class vi{constructor(t=0,e=0,i=0,n=vi.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,s=n[0],r=n[4],o=n[8],a=n[1],h=n[5],l=n[9],c=n[2],u=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin(Yt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-r,s)):(this._x=Math.atan2(u,h),this._z=0);break;case"YXZ":this._x=Math.asin(-Yt(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,d),this._z=Math.atan2(a,h)):(this._y=Math.atan2(-c,s),this._z=0);break;case"ZXY":this._x=Math.asin(Yt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-r,h)):(this._y=0,this._z=Math.atan2(a,s));break;case"ZYX":this._y=Math.asin(-Yt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,s)):(this._x=0,this._z=Math.atan2(-r,h));break;case"YZX":this._z=Math.asin(Yt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-c,s)):(this._x=0,this._y=Math.atan2(o,d));break;case"XZY":this._z=Math.asin(-Yt(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(u,h),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-l,d),this._y=0)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return fi.makeRotationFromQuaternion(t),this.setFromRotationMatrix(fi,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return gi.setFromEuler(this),this.setFromQuaternion(gi,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}vi.DEFAULT_ORDER="XYZ";class yi{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let xi=0;const _i=new Pe,bi=new Re,wi=new ai,Mi=new Pe,Si=new Pe,Ti=new Pe,Ei=new Re,Ai=new Pe(1,0,0),Ci=new Pe(0,1,0),Ii=new Pe(0,0,1),Ri={type:"added"},Pi={type:"removed"};class ki extends Vt{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:xi++}),this.uuid=qt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ki.DEFAULT_UP.clone();const t=new Pe,e=new vi,i=new Re,n=new Pe(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new ai},normalMatrix:{value:new se}}),this.matrix=new ai,this.matrixWorld=new ai,this.matrixAutoUpdate=ki.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ki.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new yi,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return bi.setFromAxisAngle(t,e),this.quaternion.multiply(bi),this}rotateOnWorldAxis(t,e){return bi.setFromAxisAngle(t,e),this.quaternion.premultiply(bi),this}rotateX(t){return this.rotateOnAxis(Ai,t)}rotateY(t){return this.rotateOnAxis(Ci,t)}rotateZ(t){return this.rotateOnAxis(Ii,t)}translateOnAxis(t,e){return _i.copy(t).applyQuaternion(this.quaternion),this.position.add(_i.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Ai,t)}translateY(t){return this.translateOnAxis(Ci,t)}translateZ(t){return this.translateOnAxis(Ii,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(wi.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?Mi.copy(t):Mi.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),Si.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?wi.lookAt(Si,Mi,this.up):wi.lookAt(Mi,Si,this.up),this.quaternion.setFromRotationMatrix(wi),n&&(wi.extractRotation(n.matrixWorld),bi.setFromRotationMatrix(wi),this.quaternion.premultiply(bi.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this||t&&t.isObject3D&&(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Ri)),this}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Pi)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),wi.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),wi.multiply(t.parent.matrixWorld)),t.applyMatrix4(wi),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}}getObjectsByProperty(t,e,i=[]){this[t]===e&&i.push(this);const n=this.children;for(let s=0,r=n.length;s<r;s++)n[s].getObjectsByProperty(t,e,i);return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Si,t,Ti),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Si,Ei,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++){const n=e[i];!0!==n.matrixWorldAutoUpdate&&!0!==t||n.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};function s(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map((t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}))),n.maxGeometryCount=this._maxGeometryCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(t),null!==this.boundingSphere&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),null!==this.boundingBox&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const n=i[e];s(t.shapes,n)}else s(t.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(s(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(s(t.materials,this.material[i]));n.material=e}else n.material=s(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];n.animations.push(s(t.animations,i))}}if(e){const e=r(t.geometries),n=r(t.materials),s=r(t.textures),o=r(t.images),a=r(t.shapes),h=r(t.skeletons),l=r(t.animations),c=r(t.nodes);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),s.length>0&&(i.textures=s),o.length>0&&(i.images=o),a.length>0&&(i.shapes=a),h.length>0&&(i.skeletons=h),l.length>0&&(i.animations=l),c.length>0&&(i.nodes=c)}return i.object=n,i;function r(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}ki.DEFAULT_UP=new Pe(0,1,0),ki.DEFAULT_MATRIX_AUTO_UPDATE=!0,ki.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Di=new Pe,Li=new Pe,Oi=new Pe,Ni=new Pe,Bi=new Pe,zi=new Pe,Ui=new Pe,Fi=new Pe,Gi=new Pe,Hi=new Pe;let Vi=!1;class ji{constructor(t=new Pe,e=new Pe,i=new Pe){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),Di.subVectors(t,e),n.cross(Di);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(t,e,i,n,s){Di.subVectors(n,e),Li.subVectors(i,e),Oi.subVectors(t,e);const r=Di.dot(Di),o=Di.dot(Li),a=Di.dot(Oi),h=Li.dot(Li),l=Li.dot(Oi),c=r*h-o*o;if(0===c)return s.set(0,0,0),null;const u=1/c,d=(h*a-o*l)*u,p=(r*l-o*a)*u;return s.set(1-d-p,p,d)}static containsPoint(t,e,i,n){return null!==this.getBarycoord(t,e,i,n,Ni)&&(Ni.x>=0&&Ni.y>=0&&Ni.x+Ni.y<=1)}static getUV(t,e,i,n,s,r,o,a){return!1===Vi&&(Vi=!0),this.getInterpolation(t,e,i,n,s,r,o,a)}static getInterpolation(t,e,i,n,s,r,o,a){return null===this.getBarycoord(t,e,i,n,Ni)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(s,Ni.x),a.addScaledVector(r,Ni.y),a.addScaledVector(o,Ni.z),a)}static isFrontFacing(t,e,i,n){return Di.subVectors(i,e),Li.subVectors(t,e),Di.cross(Li).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Di.subVectors(this.c,this.b),Li.subVectors(this.a,this.b),.5*Di.cross(Li).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ji.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return ji.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,s){return!1===Vi&&(Vi=!0),ji.getInterpolation(t,this.a,this.b,this.c,e,i,n,s)}getInterpolation(t,e,i,n,s){return ji.getInterpolation(t,this.a,this.b,this.c,e,i,n,s)}containsPoint(t){return ji.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ji.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,s=this.c;let r,o;Bi.subVectors(n,i),zi.subVectors(s,i),Fi.subVectors(t,i);const a=Bi.dot(Fi),h=zi.dot(Fi);if(a<=0&&h<=0)return e.copy(i);Gi.subVectors(t,n);const l=Bi.dot(Gi),c=zi.dot(Gi);if(l>=0&&c<=l)return e.copy(n);const u=a*c-l*h;if(u<=0&&a>=0&&l<=0)return r=a/(a-l),e.copy(i).addScaledVector(Bi,r);Hi.subVectors(t,s);const d=Bi.dot(Hi),p=zi.dot(Hi);if(p>=0&&d<=p)return e.copy(s);const m=d*h-a*p;if(m<=0&&h>=0&&p<=0)return o=h/(h-p),e.copy(i).addScaledVector(zi,o);const f=l*p-d*c;if(f<=0&&c-l>=0&&d-p>=0)return Ui.subVectors(s,n),o=(c-l)/(c-l+(d-p)),e.copy(n).addScaledVector(Ui,o);const g=1/(f+m+u);return r=m*g,o=u*g,e.copy(i).addScaledVector(Bi,r).addScaledVector(zi,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Wi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Xi={h:0,s:0,l:0},$i={h:0,s:0,l:0};function qi(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}class Yi{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,i)}set(t,e,i){if(void 0===e&&void 0===i){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,i);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=It){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,fe.toWorkingColorSpace(this,e),this}setRGB(t,e,i,n=fe.workingColorSpace){return this.r=t,this.g=e,this.b=i,fe.toWorkingColorSpace(this,n),this}setHSL(t,e,i,n=fe.workingColorSpace){if(t=Kt(t,1),e=Yt(e,0,1),i=Yt(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,s=2*i-n;this.r=qi(s,n,t+1/3),this.g=qi(s,n,t),this.b=qi(s,n,t-1/3)}return fe.toWorkingColorSpace(this,n),this}setStyle(t,e=It){function i(t){void 0!==t&&parseFloat(t)}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(t)){let t;const s=n[1],r=n[2];switch(s){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return i(t[4]),this.setRGB(Math.min(255,parseInt(t[1],10))/255,Math.min(255,parseInt(t[2],10))/255,Math.min(255,parseInt(t[3],10))/255,e);if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return i(t[4]),this.setRGB(Math.min(100,parseInt(t[1],10))/100,Math.min(100,parseInt(t[2],10))/100,Math.min(100,parseInt(t[3],10))/100,e);break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return i(t[4]),this.setHSL(parseFloat(t[1])/360,parseFloat(t[2])/100,parseFloat(t[3])/100,e)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=n[1],i=t.length;if(3===i)return this.setRGB(parseInt(t.charAt(0),16)/15,parseInt(t.charAt(1),16)/15,parseInt(t.charAt(2),16)/15,e);if(6===i)return this.setHex(parseInt(t,16),e)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=It){const i=Wi[t.toLowerCase()];return void 0!==i&&this.setHex(i,e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=ge(t.r),this.g=ge(t.g),this.b=ge(t.b),this}copyLinearToSRGB(t){return this.r=ve(t.r),this.g=ve(t.g),this.b=ve(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=It){return fe.fromWorkingColorSpace(Ki.copy(this),t),65536*Math.round(Yt(255*Ki.r,0,255))+256*Math.round(Yt(255*Ki.g,0,255))+Math.round(Yt(255*Ki.b,0,255))}getHexString(t=It){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=fe.workingColorSpace){fe.fromWorkingColorSpace(Ki.copy(this),e);const i=Ki.r,n=Ki.g,s=Ki.b,r=Math.max(i,n,s),o=Math.min(i,n,s);let a,h;const l=(o+r)/2;if(o===r)a=0,h=0;else{const t=r-o;switch(h=l<=.5?t/(r+o):t/(2-r-o),r){case i:a=(n-s)/t+(n<s?6:0);break;case n:a=(s-i)/t+2;break;case s:a=(i-n)/t+4}a/=6}return t.h=a,t.s=h,t.l=l,t}getRGB(t,e=fe.workingColorSpace){return fe.fromWorkingColorSpace(Ki.copy(this),e),t.r=Ki.r,t.g=Ki.g,t.b=Ki.b,t}getStyle(t=It){fe.fromWorkingColorSpace(Ki.copy(this),t);const e=Ki.r,i=Ki.g,n=Ki.b;return t!==It?`color(${t} ${e.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*n)})`}offsetHSL(t,e,i){return this.getHSL(Xi),this.setHSL(Xi.h+t,Xi.s+e,Xi.l+i)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(Xi),t.getHSL($i);const i=Zt(Xi.h,$i.h,e),n=Zt(Xi.s,$i.s,e),s=Zt(Xi.l,$i.l,e);return this.setHSL(i,n,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,i=this.g,n=this.b,s=t.elements;return this.r=s[0]*e+s[3]*i+s[6]*n,this.g=s[1]*e+s[4]*i+s[7]*n,this.b=s[2]*e+s[5]*i+s[8]*n,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ki=new Yi;Yi.NAMES=Wi;let Zi=0;class Ji extends Vt{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Zi++}),this.uuid=qt(),this.name="",this.type="Material",this.blending=1,this.side=I,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=P,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Yi(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Bt,this.stencilZFail=Bt,this.stencilZPass=Bt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i)continue;const n=this[e];void 0!==n&&(n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function n(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(i.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),this.side!==I&&(i.side=this.side),!0===this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=!0),204!==this.blendSrc&&(i.blendSrc=this.blendSrc),205!==this.blendDst&&(i.blendDst=this.blendDst),this.blendEquation!==P&&(i.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(i.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(i.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(i.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(i.depthFunc=this.depthFunc),!1===this.depthTest&&(i.depthTest=this.depthTest),!1===this.depthWrite&&(i.depthWrite=this.depthWrite),!1===this.colorWrite&&(i.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(i.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(i.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(i.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Bt&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Bt&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Bt&&(i.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(i.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaHash&&(i.alphaHash=!0),!0===this.alphaToCoverage&&(i.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=!0),!0===this.forceSinglePass&&(i.forceSinglePass=!0),!0===this.wireframe&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),e){const e=n(t.textures),s=n(t.images);e.length>0&&(i.textures=e),s.length>0&&(i.images=s)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class Qi extends Ji{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Yi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=k,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const tn=new Pe,en=new ne;class nn{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=i,this.usage=zt,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=at,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)en.fromBufferAttribute(this,e),en.applyMatrix3(t),this.setXY(e,en.x,en.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)tn.fromBufferAttribute(this,e),tn.applyMatrix3(t),this.setXYZ(e,tn.x,tn.y,tn.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)tn.fromBufferAttribute(this,e),tn.applyMatrix4(t),this.setXYZ(e,tn.x,tn.y,tn.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)tn.fromBufferAttribute(this,e),tn.applyNormalMatrix(t),this.setXYZ(e,tn.x,tn.y,tn.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)tn.fromBufferAttribute(this,e),tn.transformDirection(t),this.setXYZ(e,tn.x,tn.y,tn.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let i=this.array[t*this.itemSize+e];return this.normalized&&(i=te(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=ee(i,this.array)),this.array[t*this.itemSize+e]=i,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=te(e,this.array)),e}setX(t,e){return this.normalized&&(e=ee(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=te(e,this.array)),e}setY(t,e){return this.normalized&&(e=ee(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=te(e,this.array)),e}setZ(t,e){return this.normalized&&(e=ee(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=te(e,this.array)),e}setW(t,e){return this.normalized&&(e=ee(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=ee(e,this.array),i=ee(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.normalized&&(e=ee(e,this.array),i=ee(i,this.array),n=ee(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,s){return t*=this.itemSize,this.normalized&&(e=ee(e,this.array),i=ee(i,this.array),n=ee(n,this.array),s=ee(s,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==zt&&(t.usage=this.usage),t}}class sn extends nn{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class rn extends nn{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class on extends nn{constructor(t,e,i){super(new Float32Array(t),e,i)}}let an=0;const hn=new ai,ln=new ki,cn=new Pe,un=new Le,dn=new Le,pn=new Pe;class mn extends Vt{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:an++}),this.uuid=qt(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(oe(t)?rn:sn)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new se).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return hn.makeRotationFromQuaternion(t),this.applyMatrix4(hn),this}rotateX(t){return hn.makeRotationX(t),this.applyMatrix4(hn),this}rotateY(t){return hn.makeRotationY(t),this.applyMatrix4(hn),this}rotateZ(t){return hn.makeRotationZ(t),this.applyMatrix4(hn),this}translate(t,e,i){return hn.makeTranslation(t,e,i),this.applyMatrix4(hn),this}scale(t,e,i){return hn.makeScale(t,e,i),this.applyMatrix4(hn),this}lookAt(t){return ln.lookAt(t),ln.updateMatrix(),this.applyMatrix4(ln.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(cn).negate(),this.translate(cn.x,cn.y,cn.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new on(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Le);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)this.boundingBox.set(new Pe(-1/0,-1/0,-1/0),new Pe(1/0,1/0,1/0));else{if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];un.setFromBufferAttribute(i),this.morphTargetsRelative?(pn.addVectors(this.boundingBox.min,un.min),this.boundingBox.expandByPoint(pn),pn.addVectors(this.boundingBox.max,un.max),this.boundingBox.expandByPoint(pn)):(this.boundingBox.expandByPoint(un.min),this.boundingBox.expandByPoint(un.max))}}else this.boundingBox.makeEmpty();isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)}}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Je);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)this.boundingSphere.set(new Pe,1/0);else if(t){const i=this.boundingSphere.center;if(un.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];dn.setFromBufferAttribute(i),this.morphTargetsRelative?(pn.addVectors(un.min,dn.min),un.expandByPoint(pn),pn.addVectors(un.max,dn.max),un.expandByPoint(pn)):(un.expandByPoint(dn.min),un.expandByPoint(dn.max))}un.getCenter(i);let n=0;for(let e=0,s=t.count;e<s;e++)pn.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(pn));if(e)for(let s=0,r=e.length;s<r;s++){const r=e[s],o=this.morphTargetsRelative;for(let e=0,s=r.count;e<s;e++)pn.fromBufferAttribute(r,e),o&&(cn.fromBufferAttribute(t,e),pn.add(cn)),n=Math.max(n,i.distanceToSquared(pn))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return;const i=t.array,n=e.position.array,s=e.normal.array,r=e.uv.array,o=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new nn(new Float32Array(4*o),4));const a=this.getAttribute("tangent").array,h=[],l=[];for(let t=0;t<o;t++)h[t]=new Pe,l[t]=new Pe;const c=new Pe,u=new Pe,d=new Pe,p=new ne,m=new ne,f=new ne,g=new Pe,v=new Pe;function y(t,e,i){c.fromArray(n,3*t),u.fromArray(n,3*e),d.fromArray(n,3*i),p.fromArray(r,2*t),m.fromArray(r,2*e),f.fromArray(r,2*i),u.sub(c),d.sub(c),m.sub(p),f.sub(p);const s=1/(m.x*f.y-f.x*m.y);isFinite(s)&&(g.copy(u).multiplyScalar(f.y).addScaledVector(d,-m.y).multiplyScalar(s),v.copy(d).multiplyScalar(m.x).addScaledVector(u,-f.x).multiplyScalar(s),h[t].add(g),h[e].add(g),h[i].add(g),l[t].add(v),l[e].add(v),l[i].add(v))}let x=this.groups;0===x.length&&(x=[{start:0,count:i.length}]);for(let t=0,e=x.length;t<e;++t){const e=x[t],n=e.start;for(let t=n,s=n+e.count;t<s;t+=3)y(i[t+0],i[t+1],i[t+2])}const _=new Pe,b=new Pe,w=new Pe,M=new Pe;function S(t){w.fromArray(s,3*t),M.copy(w);const e=h[t];_.copy(e),_.sub(w.multiplyScalar(w.dot(e))).normalize(),b.crossVectors(M,e);const i=b.dot(l[t])<0?-1:1;a[4*t]=_.x,a[4*t+1]=_.y,a[4*t+2]=_.z,a[4*t+3]=i}for(let t=0,e=x.length;t<e;++t){const e=x[t],n=e.start;for(let t=n,s=n+e.count;t<s;t+=3)S(i[t+0]),S(i[t+1]),S(i[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new nn(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const n=new Pe,s=new Pe,r=new Pe,o=new Pe,a=new Pe,h=new Pe,l=new Pe,c=new Pe;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),m=t.getX(u+2);n.fromBufferAttribute(e,d),s.fromBufferAttribute(e,p),r.fromBufferAttribute(e,m),l.subVectors(r,s),c.subVectors(n,s),l.cross(c),o.fromBufferAttribute(i,d),a.fromBufferAttribute(i,p),h.fromBufferAttribute(i,m),o.add(l),a.add(l),h.add(l),i.setXYZ(d,o.x,o.y,o.z),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(m,h.x,h.y,h.z)}else for(let t=0,o=e.count;t<o;t+=3)n.fromBufferAttribute(e,t+0),s.fromBufferAttribute(e,t+1),r.fromBufferAttribute(e,t+2),l.subVectors(r,s),c.subVectors(n,s),l.cross(c),i.setXYZ(t+0,l.x,l.y,l.z),i.setXYZ(t+1,l.x,l.y,l.z),i.setXYZ(t+2,l.x,l.y,l.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)pn.fromBufferAttribute(t,e),pn.normalize(),t.setXYZ(e,pn.x,pn.y,pn.z)}toNonIndexed(){function t(t,e){const i=t.array,n=t.itemSize,s=t.normalized,r=new i.constructor(e.length*n);let o=0,a=0;for(let s=0,h=e.length;s<h;s++){o=t.isInterleavedBufferAttribute?e[s]*t.data.stride+t.offset:e[s]*n;for(let t=0;t<n;t++)r[a++]=i[o++]}return new nn(r,n,s)}if(null===this.index)return this;const e=new mn,i=this.index.array,n=this.attributes;for(const s in n){const r=t(n[s],i);e.setAttribute(s,r)}const s=this.morphAttributes;for(const n in s){const r=[],o=s[n];for(let e=0,n=o.length;e<n;e++){const n=t(o[e],i);r.push(n)}e.morphAttributes[n]=r}e.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let t=0,i=r.length;t<i;t++){const i=r[t];e.addGroup(i.start,i.count,i.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const n=i[e];t.data.attributes[e]=n.toJSON(t.data)}const n={};let s=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],r=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];r.push(n.toJSON(t.data))}r.length>0&&(n[e]=r,s=!0)}s&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(t.data.groups=JSON.parse(JSON.stringify(r)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const n=t.attributes;for(const t in n){const i=n[t];this.setAttribute(t,i.clone(e))}const s=t.morphAttributes;for(const t in s){const i=[],n=s[t];for(let t=0,s=n.length;t<s;t++)i.push(n[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const r=t.groups;for(let t=0,e=r.length;t<e;t++){const e=r[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const fn=new ai,gn=new oi,vn=new Je,yn=new Pe,xn=new Pe,_n=new Pe,bn=new Pe,wn=new Pe,Mn=new Pe,Sn=new ne,Tn=new ne,En=new ne,An=new Pe,Cn=new Pe,In=new Pe,Rn=new Pe,Pn=new Pe;class kn extends ki{constructor(t=new mn,e=new Qi){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const i=this.geometry,n=i.attributes.position,s=i.morphAttributes.position,r=i.morphTargetsRelative;e.fromBufferAttribute(n,t);const o=this.morphTargetInfluences;if(s&&o){Mn.set(0,0,0);for(let i=0,n=s.length;i<n;i++){const n=o[i],a=s[i];0!==n&&(wn.fromBufferAttribute(a,t),r?Mn.addScaledVector(wn,n):Mn.addScaledVector(wn.sub(e),n))}e.add(Mn)}return e}raycast(t,e){const i=this.geometry,n=this.material,s=this.matrixWorld;if(void 0!==n){if(null===i.boundingSphere&&i.computeBoundingSphere(),vn.copy(i.boundingSphere),vn.applyMatrix4(s),gn.copy(t.ray).recast(t.near),!1===vn.containsPoint(gn.origin)){if(null===gn.intersectSphere(vn,yn))return;if(gn.origin.distanceToSquared(yn)>(t.far-t.near)**2)return}fn.copy(s).invert(),gn.copy(t.ray).applyMatrix4(fn),null!==i.boundingBox&&!1===gn.intersectsBox(i.boundingBox)||this._computeIntersections(t,e,gn)}}_computeIntersections(t,e,i){let n;const s=this.geometry,r=this.material,o=s.index,a=s.attributes.position,h=s.attributes.uv,l=s.attributes.uv1,c=s.attributes.normal,u=s.groups,d=s.drawRange;if(null!==o)if(Array.isArray(r))for(let s=0,a=u.length;s<a;s++){const a=u[s],p=r[a.materialIndex];for(let s=Math.max(a.start,d.start),r=Math.min(o.count,Math.min(a.start+a.count,d.start+d.count));s<r;s+=3){n=Dn(this,p,t,i,h,l,c,o.getX(s),o.getX(s+1),o.getX(s+2)),n&&(n.faceIndex=Math.floor(s/3),n.face.materialIndex=a.materialIndex,e.push(n))}}else{for(let s=Math.max(0,d.start),a=Math.min(o.count,d.start+d.count);s<a;s+=3){n=Dn(this,r,t,i,h,l,c,o.getX(s),o.getX(s+1),o.getX(s+2)),n&&(n.faceIndex=Math.floor(s/3),e.push(n))}}else if(void 0!==a)if(Array.isArray(r))for(let s=0,o=u.length;s<o;s++){const o=u[s],p=r[o.materialIndex];for(let s=Math.max(o.start,d.start),r=Math.min(a.count,Math.min(o.start+o.count,d.start+d.count));s<r;s+=3){n=Dn(this,p,t,i,h,l,c,s,s+1,s+2),n&&(n.faceIndex=Math.floor(s/3),n.face.materialIndex=o.materialIndex,e.push(n))}}else{for(let s=Math.max(0,d.start),o=Math.min(a.count,d.start+d.count);s<o;s+=3){n=Dn(this,r,t,i,h,l,c,s,s+1,s+2),n&&(n.faceIndex=Math.floor(s/3),e.push(n))}}}}function Dn(t,e,i,n,s,r,o,a,h,l){t.getVertexPosition(a,xn),t.getVertexPosition(h,_n),t.getVertexPosition(l,bn);const c=function(t,e,i,n,s,r,o,a){let h;if(h=e.side===R?n.intersectTriangle(o,r,s,!0,a):n.intersectTriangle(s,r,o,e.side===I,a),null===h)return null;Pn.copy(a),Pn.applyMatrix4(t.matrixWorld);const l=i.ray.origin.distanceTo(Pn);return l<i.near||l>i.far?null:{distance:l,point:Pn.clone(),object:t}}(t,e,i,n,xn,_n,bn,Rn);if(c){s&&(Sn.fromBufferAttribute(s,a),Tn.fromBufferAttribute(s,h),En.fromBufferAttribute(s,l),c.uv=ji.getInterpolation(Rn,xn,_n,bn,Sn,Tn,En,new ne)),r&&(Sn.fromBufferAttribute(r,a),Tn.fromBufferAttribute(r,h),En.fromBufferAttribute(r,l),c.uv1=ji.getInterpolation(Rn,xn,_n,bn,Sn,Tn,En,new ne),c.uv2=c.uv1),o&&(An.fromBufferAttribute(o,a),Cn.fromBufferAttribute(o,h),In.fromBufferAttribute(o,l),c.normal=ji.getInterpolation(Rn,xn,_n,bn,An,Cn,In,new Pe),c.normal.dot(n.direction)>0&&c.normal.multiplyScalar(-1));const t={a,b:h,c:l,normal:new Pe,materialIndex:0};ji.getNormal(xn,_n,bn,t.normal),c.face=t}return c}class Ln extends mn{constructor(t=1,e=1,i=1,n=1,s=1,r=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:s,depthSegments:r};const o=this;n=Math.floor(n),s=Math.floor(s),r=Math.floor(r);const a=[],h=[],l=[],c=[];let u=0,d=0;function p(t,e,i,n,s,r,p,m,f,g,v){const y=r/f,x=p/g,_=r/2,b=p/2,w=m/2,M=f+1,S=g+1;let T=0,E=0;const A=new Pe;for(let r=0;r<S;r++){const o=r*x-b;for(let a=0;a<M;a++){const u=a*y-_;A[t]=u*n,A[e]=o*s,A[i]=w,h.push(A.x,A.y,A.z),A[t]=0,A[e]=0,A[i]=m>0?1:-1,l.push(A.x,A.y,A.z),c.push(a/f),c.push(1-r/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<f;e++){const i=u+e+M*t,n=u+e+M*(t+1),s=u+(e+1)+M*(t+1),r=u+(e+1)+M*t;a.push(i,n,r),a.push(n,s,r),E+=6}o.addGroup(d,E,v),d+=E,u+=T}p("z","y","x",-1,-1,i,e,t,r,s,0),p("z","y","x",1,-1,i,e,-t,r,s,1),p("x","z","y",1,1,t,i,e,n,r,2),p("x","z","y",1,-1,t,i,-e,n,r,3),p("x","y","z",1,-1,t,e,i,n,s,4),p("x","y","z",-1,-1,t,e,-i,n,s,5),this.setIndex(a),this.setAttribute("position",new on(h,3)),this.setAttribute("normal",new on(l,3)),this.setAttribute("uv",new on(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ln(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function On(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const s=t[i][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?e[i][n]=null:e[i][n]=s.clone():Array.isArray(s)?e[i][n]=s.slice():e[i][n]=s}}return e}function Nn(t){const e={};for(let i=0;i<t.length;i++){const n=On(t[i]);for(const t in n)e[t]=n[t]}return e}function Bn(t){return null===t.getRenderTarget()?t.outputColorSpace:fe.workingColorSpace}const zn={clone:On,merge:Nn};class Un extends Ji{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=On(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}class Fn extends ki{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ai,this.projectionMatrix=new ai,this.projectionMatrixInverse=new ai,this.coordinateSystem=Gt}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class Gn extends Fn{constructor(t=50,e=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*$t*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*Xt*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*$t*Math.atan(Math.tan(.5*Xt*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,s,r){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*Xt*this.fov)/this.zoom,i=2*e,n=this.aspect*i,s=-.5*n;const r=this.view;if(null!==this.view&&this.view.enabled){const t=r.fullWidth,o=r.fullHeight;s+=r.offsetX*n/t,e-=r.offsetY*i/o,n*=r.width/t,i*=r.height/o}const o=this.filmOffset;0!==o&&(s+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,e,e-i,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const Hn=-90;class Vn extends ki{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new Gn(Hn,1,t,e);n.layers=this.layers,this.add(n);const s=new Gn(Hn,1,t,e);s.layers=this.layers,this.add(s);const r=new Gn(Hn,1,t,e);r.layers=this.layers,this.add(r);const o=new Gn(Hn,1,t,e);o.layers=this.layers,this.add(o);const a=new Gn(Hn,1,t,e);a.layers=this.layers,this.add(a);const h=new Gn(Hn,1,t,e);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[i,n,s,r,o,a]=e;for(const t of e)this.remove(t);if(t===Gt)i.up.set(0,1,0),i.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),r.up.set(0,0,1),r.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(t!==Ht)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);i.up.set(0,-1,0),i.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),r.up.set(0,0,-1),r.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const t of e)this.add(t),t.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:n}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[s,r,o,a,h,l]=this.children,c=t.getRenderTarget(),u=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),p=t.xr.enabled;t.xr.enabled=!1;const m=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0,n),t.render(e,s),t.setRenderTarget(i,1,n),t.render(e,r),t.setRenderTarget(i,2,n),t.render(e,o),t.setRenderTarget(i,3,n),t.render(e,a),t.setRenderTarget(i,4,n),t.render(e,h),i.texture.generateMipmaps=m,t.setRenderTarget(i,5,n),t.render(e,l),t.setRenderTarget(c,u,d),t.xr.enabled=p,i.texture.needsPMREMUpdate=!0}}class jn extends Se{constructor(t,e,i,n,s,r,o,a,h,l){super(t=void 0!==t?t:[],e=void 0!==e?e:V,i,n,s,r,o,a,h,l),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class Wn extends Ae{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const i={width:t,height:t,depth:1},n=[i,i,i,i,i,i];void 0!==e.encoding&&(ce("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),e.colorSpace=e.encoding===At?It:Ct),this.texture=new jn(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:tt}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new Ln(5,5,5),s=new Un({name:"CubemapFromEquirect",uniforms:On(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:R,blending:0});s.uniforms.tEquirect.value=e;const r=new kn(n,s),o=e.minFilter;e.minFilter===it&&(e.minFilter=tt);return new Vn(1,10,this).update(t,r),e.minFilter=o,r.geometry.dispose(),r.material.dispose(),this}clear(t,e,i,n){const s=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(this,s),t.clear(e,i,n);t.setRenderTarget(s)}}const Xn=new Pe,$n=new Pe,qn=new se;class Yn{constructor(t=new Pe(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=Xn.subVectors(i,e).cross($n.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const i=t.delta(Xn),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:e.copy(t.start).addScaledVector(i,s)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||qn.getNormalMatrix(t),n=this.coplanarPoint(Xn).applyMatrix4(t),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Kn=new Je,Zn=new Pe;class Jn{constructor(t=new Yn,e=new Yn,i=new Yn,n=new Yn,s=new Yn,r=new Yn){this.planes=[t,e,i,n,s,r]}set(t,e,i,n,s,r){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(n),o[4].copy(s),o[5].copy(r),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t,e=2e3){const i=this.planes,n=t.elements,s=n[0],r=n[1],o=n[2],a=n[3],h=n[4],l=n[5],c=n[6],u=n[7],d=n[8],p=n[9],m=n[10],f=n[11],g=n[12],v=n[13],y=n[14],x=n[15];if(i[0].setComponents(a-s,u-h,f-d,x-g).normalize(),i[1].setComponents(a+s,u+h,f+d,x+g).normalize(),i[2].setComponents(a+r,u+l,f+p,x+v).normalize(),i[3].setComponents(a-r,u-l,f-p,x-v).normalize(),i[4].setComponents(a-o,u-c,f-m,x-y).normalize(),e===Gt)i[5].setComponents(a+o,u+c,f+m,x+y).normalize();else{if(e!==Ht)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);i[5].setComponents(o,c,m,y).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),Kn.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),Kn.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(Kn)}intersectsSprite(t){return Kn.center.set(0,0,0),Kn.radius=.7071067811865476,Kn.applyMatrix4(t.matrixWorld),this.intersectsSphere(Kn)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(i)<n)return!1}return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(Zn.x=n.normal.x>0?t.max.x:t.min.x,Zn.y=n.normal.y>0?t.max.y:t.min.y,Zn.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(Zn)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Qn(){let t=null,e=!1,i=null,n=null;function s(e,r){i(e,r),n=t.requestAnimationFrame(s)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(s),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function ts(t,e){const i=e.isWebGL2,n=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const i=n.get(e);i&&(t.deleteBuffer(i.buffer),n.delete(e))},update:function(e,s){if(e.isGLBufferAttribute){const t=n.get(e);return void((!t||t.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const r=n.get(e);if(void 0===r)n.set(e,function(e,n){const s=e.array,r=e.usage,o=s.byteLength,a=t.createBuffer();let h;if(t.bindBuffer(n,a),t.bufferData(n,s,r),e.onUploadCallback(),s instanceof Float32Array)h=t.FLOAT;else if(s instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");h=t.HALF_FLOAT}else h=t.UNSIGNED_SHORT;else if(s instanceof Int16Array)h=t.SHORT;else if(s instanceof Uint32Array)h=t.UNSIGNED_INT;else if(s instanceof Int32Array)h=t.INT;else if(s instanceof Int8Array)h=t.BYTE;else if(s instanceof Uint8Array)h=t.UNSIGNED_BYTE;else{if(!(s instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+s);h=t.UNSIGNED_BYTE}return{buffer:a,type:h,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version,size:o}}(e,s));else if(r.version<e.version){if(r.size!==e.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(e,n,s){const r=n.array,o=n._updateRange,a=n.updateRanges;if(t.bindBuffer(s,e),-1===o.count&&0===a.length&&t.bufferSubData(s,0,r),0!==a.length){for(let e=0,n=a.length;e<n;e++){const n=a[e];i?t.bufferSubData(s,n.start*r.BYTES_PER_ELEMENT,r,n.start,n.count):t.bufferSubData(s,n.start*r.BYTES_PER_ELEMENT,r.subarray(n.start,n.start+n.count))}n.clearUpdateRanges()}-1!==o.count&&(i?t.bufferSubData(s,o.offset*r.BYTES_PER_ELEMENT,r,o.offset,o.count):t.bufferSubData(s,o.offset*r.BYTES_PER_ELEMENT,r.subarray(o.offset,o.offset+o.count)),o.count=-1),n.onUploadCallback()}(r.buffer,e,s),r.version=e.version}}}}class es extends mn{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const s=t/2,r=e/2,o=Math.floor(i),a=Math.floor(n),h=o+1,l=a+1,c=t/o,u=e/a,d=[],p=[],m=[],f=[];for(let t=0;t<l;t++){const e=t*u-r;for(let i=0;i<h;i++){const n=i*c-s;p.push(n,-e,0),m.push(0,0,1),f.push(i/o),f.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const i=e+h*t,n=e+h*(t+1),s=e+1+h*(t+1),r=e+1+h*t;d.push(i,n,r),d.push(n,s,r)}this.setIndex(d),this.setAttribute("position",new on(p,3)),this.setAttribute("normal",new on(m,3)),this.setAttribute("uv",new on(f,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new es(t.width,t.height,t.widthSegments,t.heightSegments)}}const is={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\tattribute float batchId;\n\tuniform highp sampler2D batchingTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor *= toneMappingExposure;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\treturn color;\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},ns={common:{diffuse:{value:new Yi(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new se},alphaMap:{value:null},alphaMapTransform:{value:new se},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new se}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new se}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new se}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new se},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new se},normalScale:{value:new ne(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new se},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new se}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new se}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new se}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Yi(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Yi(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new se},alphaTest:{value:0},uvTransform:{value:new se}},sprite:{diffuse:{value:new Yi(16777215)},opacity:{value:1},center:{value:new ne(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new se},alphaMap:{value:null},alphaMapTransform:{value:new se},alphaTest:{value:0}}},ss={basic:{uniforms:Nn([ns.common,ns.specularmap,ns.envmap,ns.aomap,ns.lightmap,ns.fog]),vertexShader:is.meshbasic_vert,fragmentShader:is.meshbasic_frag},lambert:{uniforms:Nn([ns.common,ns.specularmap,ns.envmap,ns.aomap,ns.lightmap,ns.emissivemap,ns.bumpmap,ns.normalmap,ns.displacementmap,ns.fog,ns.lights,{emissive:{value:new Yi(0)}}]),vertexShader:is.meshlambert_vert,fragmentShader:is.meshlambert_frag},phong:{uniforms:Nn([ns.common,ns.specularmap,ns.envmap,ns.aomap,ns.lightmap,ns.emissivemap,ns.bumpmap,ns.normalmap,ns.displacementmap,ns.fog,ns.lights,{emissive:{value:new Yi(0)},specular:{value:new Yi(1118481)},shininess:{value:30}}]),vertexShader:is.meshphong_vert,fragmentShader:is.meshphong_frag},standard:{uniforms:Nn([ns.common,ns.envmap,ns.aomap,ns.lightmap,ns.emissivemap,ns.bumpmap,ns.normalmap,ns.displacementmap,ns.roughnessmap,ns.metalnessmap,ns.fog,ns.lights,{emissive:{value:new Yi(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:is.meshphysical_vert,fragmentShader:is.meshphysical_frag},toon:{uniforms:Nn([ns.common,ns.aomap,ns.lightmap,ns.emissivemap,ns.bumpmap,ns.normalmap,ns.displacementmap,ns.gradientmap,ns.fog,ns.lights,{emissive:{value:new Yi(0)}}]),vertexShader:is.meshtoon_vert,fragmentShader:is.meshtoon_frag},matcap:{uniforms:Nn([ns.common,ns.bumpmap,ns.normalmap,ns.displacementmap,ns.fog,{matcap:{value:null}}]),vertexShader:is.meshmatcap_vert,fragmentShader:is.meshmatcap_frag},points:{uniforms:Nn([ns.points,ns.fog]),vertexShader:is.points_vert,fragmentShader:is.points_frag},dashed:{uniforms:Nn([ns.common,ns.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:is.linedashed_vert,fragmentShader:is.linedashed_frag},depth:{uniforms:Nn([ns.common,ns.displacementmap]),vertexShader:is.depth_vert,fragmentShader:is.depth_frag},normal:{uniforms:Nn([ns.common,ns.bumpmap,ns.normalmap,ns.displacementmap,{opacity:{value:1}}]),vertexShader:is.meshnormal_vert,fragmentShader:is.meshnormal_frag},sprite:{uniforms:Nn([ns.sprite,ns.fog]),vertexShader:is.sprite_vert,fragmentShader:is.sprite_frag},background:{uniforms:{uvTransform:{value:new se},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:is.background_vert,fragmentShader:is.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:is.backgroundCube_vert,fragmentShader:is.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:is.cube_vert,fragmentShader:is.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:is.equirect_vert,fragmentShader:is.equirect_frag},distanceRGBA:{uniforms:Nn([ns.common,ns.displacementmap,{referencePosition:{value:new Pe},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:is.distanceRGBA_vert,fragmentShader:is.distanceRGBA_frag},shadow:{uniforms:Nn([ns.lights,ns.fog,{color:{value:new Yi(0)},opacity:{value:1}}]),vertexShader:is.shadow_vert,fragmentShader:is.shadow_frag}};ss.physical={uniforms:Nn([ss.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new se},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new se},clearcoatNormalScale:{value:new ne(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new se},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new se},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new se},sheen:{value:0},sheenColor:{value:new Yi(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new se},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new se},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new se},transmissionSamplerSize:{value:new ne},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new se},attenuationDistance:{value:0},attenuationColor:{value:new Yi(0)},specularColor:{value:new Yi(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new se},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new se},anisotropyVector:{value:new ne},anisotropyMap:{value:null},anisotropyMapTransform:{value:new se}}]),vertexShader:is.meshphysical_vert,fragmentShader:is.meshphysical_frag};const rs={r:0,b:0,g:0};function os(t,e,i,n,s,r,o){const a=new Yi(0);let h,l,c=!0===r?0:1,u=null,d=0,p=null;function m(e,i){e.getRGB(rs,Bn(t)),n.buffers.color.setClear(rs.r,rs.g,rs.b,i,o)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a.set(t),c=e,m(a,c)},getClearAlpha:function(){return c},setClearAlpha:function(t){c=t,m(a,c)},render:function(r,f){let g=!1,v=!0===f.isScene?f.background:null;if(v&&v.isTexture){v=(f.backgroundBlurriness>0?i:e).get(v)}null===v?m(a,c):v&&v.isColor&&(m(v,1),g=!0);const y=t.xr.getEnvironmentBlendMode();"additive"===y?n.buffers.color.setClear(0,0,0,1,o):"alpha-blend"===y&&n.buffers.color.setClear(0,0,0,0,o),(t.autoClear||g)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),v&&(v.isCubeTexture||v.mapping===$)?(void 0===l&&(l=new kn(new Ln(1,1,1),new Un({name:"BackgroundCubeMaterial",uniforms:On(ss.backgroundCube.uniforms),vertexShader:ss.backgroundCube.vertexShader,fragmentShader:ss.backgroundCube.fragmentShader,side:R,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(l)),l.material.uniforms.envMap.value=v,l.material.uniforms.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,l.material.uniforms.backgroundBlurriness.value=f.backgroundBlurriness,l.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,l.material.toneMapped=fe.getTransfer(v.colorSpace)!==Lt,u===v&&d===v.version&&p===t.toneMapping||(l.material.needsUpdate=!0,u=v,d=v.version,p=t.toneMapping),l.layers.enableAll(),r.unshift(l,l.geometry,l.material,0,0,null)):v&&v.isTexture&&(void 0===h&&(h=new kn(new es(2,2),new Un({name:"BackgroundMaterial",uniforms:On(ss.background.uniforms),vertexShader:ss.background.vertexShader,fragmentShader:ss.background.fragmentShader,side:I,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),Object.defineProperty(h.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(h)),h.material.uniforms.t2D.value=v,h.material.uniforms.backgroundIntensity.value=f.backgroundIntensity,h.material.toneMapped=fe.getTransfer(v.colorSpace)!==Lt,!0===v.matrixAutoUpdate&&v.updateMatrix(),h.material.uniforms.uvTransform.value.copy(v.matrix),u===v&&d===v.version&&p===t.toneMapping||(h.material.needsUpdate=!0,u=v,d=v.version,p=t.toneMapping),h.layers.enableAll(),r.unshift(h,h.geometry,h.material,0,0,null))}}}function as(t,e,i,n){const s=t.getParameter(t.MAX_VERTEX_ATTRIBS),r=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||null!==r,a={},h=p(null);let l=h,c=!1;function u(e){return n.isWebGL2?t.bindVertexArray(e):r.bindVertexArrayOES(e)}function d(e){return n.isWebGL2?t.deleteVertexArray(e):r.deleteVertexArrayOES(e)}function p(t){const e=[],i=[],n=[];for(let t=0;t<s;t++)e[t]=0,i[t]=0,n[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:n,object:t,attributes:{},index:null}}function m(){const t=l.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function f(t){g(t,0)}function g(i,s){const r=l.newAttributes,o=l.enabledAttributes,a=l.attributeDivisors;if(r[i]=1,0===o[i]&&(t.enableVertexAttribArray(i),o[i]=1),a[i]!==s){(n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,s),a[i]=s}}function v(){const e=l.newAttributes,i=l.enabledAttributes;for(let n=0,s=i.length;n<s;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function y(e,i,n,s,r,o,a){!0===a?t.vertexAttribIPointer(e,i,n,r,o):t.vertexAttribPointer(e,i,n,s,r,o)}function x(){_(),c=!0,l!==h&&(l=h,u(l.object))}function _(){h.geometry=null,h.program=null,h.wireframe=!1}return{setup:function(s,h,d,x,_){let b=!1;if(o){const e=function(e,i,s){const o=!0===s.wireframe;let h=a[e.id];void 0===h&&(h={},a[e.id]=h);let l=h[i.id];void 0===l&&(l={},h[i.id]=l);let c=l[o];void 0===c&&(c=p(n.isWebGL2?t.createVertexArray():r.createVertexArrayOES()),l[o]=c);return c}(x,d,h);l!==e&&(l=e,u(l.object)),b=function(t,e,i,n){const s=l.attributes,r=e.attributes;let o=0;const a=i.getAttributes();for(const e in a){if(a[e].location>=0){const i=s[e];let n=r[e];if(void 0===n&&("instanceMatrix"===e&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(n=t.instanceColor)),void 0===i)return!0;if(i.attribute!==n)return!0;if(n&&i.data!==n.data)return!0;o++}}return l.attributesNum!==o||l.index!==n}(s,x,d,_),b&&function(t,e,i,n){const s={},r=e.attributes;let o=0;const a=i.getAttributes();for(const e in a){if(a[e].location>=0){let i=r[e];void 0===i&&("instanceMatrix"===e&&t.instanceMatrix&&(i=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(i=t.instanceColor));const n={};n.attribute=i,i&&i.data&&(n.data=i.data),s[e]=n,o++}}l.attributes=s,l.attributesNum=o,l.index=n}(s,x,d,_)}else{const t=!0===h.wireframe;l.geometry===x.id&&l.program===d.id&&l.wireframe===t||(l.geometry=x.id,l.program=d.id,l.wireframe=t,b=!0)}null!==_&&i.update(_,t.ELEMENT_ARRAY_BUFFER),(b||c)&&(c=!1,function(s,r,o,a){if(!1===n.isWebGL2&&(s.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;m();const h=a.attributes,l=o.getAttributes(),c=r.defaultAttributeValues;for(const e in l){const r=l[e];if(r.location>=0){let o=h[e];if(void 0===o&&("instanceMatrix"===e&&s.instanceMatrix&&(o=s.instanceMatrix),"instanceColor"===e&&s.instanceColor&&(o=s.instanceColor)),void 0!==o){const e=o.normalized,h=o.itemSize,l=i.get(o);if(void 0===l)continue;const c=l.buffer,u=l.type,d=l.bytesPerElement,p=!0===n.isWebGL2&&(u===t.INT||u===t.UNSIGNED_INT||o.gpuType===rt);if(o.isInterleavedBufferAttribute){const i=o.data,n=i.stride,l=o.offset;if(i.isInstancedInterleavedBuffer){for(let t=0;t<r.locationSize;t++)g(r.location+t,i.meshPerAttribute);!0!==s.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let t=0;t<r.locationSize;t++)f(r.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<r.locationSize;t++)y(r.location+t,h/r.locationSize,u,e,n*d,(l+h/r.locationSize*t)*d,p)}else{if(o.isInstancedBufferAttribute){for(let t=0;t<r.locationSize;t++)g(r.location+t,o.meshPerAttribute);!0!==s.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let t=0;t<r.locationSize;t++)f(r.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<r.locationSize;t++)y(r.location+t,h/r.locationSize,u,e,h*d,h/r.locationSize*t*d,p)}}else if(void 0!==c){const i=c[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(r.location,i);break;case 3:t.vertexAttrib3fv(r.location,i);break;case 4:t.vertexAttrib4fv(r.location,i);break;default:t.vertexAttrib1fv(r.location,i)}}}}v()}(s,h,d,x),null!==_&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.get(_).buffer))},reset:x,resetDefaultState:_,dispose:function(){x();for(const t in a){const e=a[t];for(const t in e){const i=e[t];for(const t in i)d(i[t].object),delete i[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const i=e[t];for(const t in i)d(i[t].object),delete i[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const i=a[e];if(void 0===i[t.id])continue;const n=i[t.id];for(const t in n)d(n[t].object),delete n[t];delete i[t.id]}},initAttributes:m,enableAttribute:f,disableUnusedAttributes:v}}function hs(t,e,i,n){const s=n.isWebGL2;let r;this.setMode=function(t){r=t},this.render=function(e,n){t.drawArrays(r,e,n),i.update(n,r,1)},this.renderInstances=function(n,o,a){if(0===a)return;let h,l;if(s)h=t,l="drawArraysInstanced";else if(h=e.get("ANGLE_instanced_arrays"),l="drawArraysInstancedANGLE",null===h)return;h[l](r,n,o,a),i.update(o,r,a)},this.renderMultiDraw=function(t,n,s){if(0===s)return;const o=e.get("WEBGL_multi_draw");if(null===o)for(let e=0;e<s;e++)this.render(t[e],n[e]);else{o.multiDrawArraysWEBGL(r,t,0,n,0,s);let e=0;for(let t=0;t<s;t++)e+=n[t];i.update(e,r,1)}}}function ls(t,e,i){let n;function s(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const r="undefined"!=typeof WebGL2RenderingContext&&"WebGL2RenderingContext"===t.constructor.name;let o=void 0!==i.precision?i.precision:"highp";const a=s(o);a!==o&&(o=a);const h=r||e.has("WEBGL_draw_buffers"),l=!0===i.logarithmicDepthBuffer,c=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),u=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),d=t.getParameter(t.MAX_TEXTURE_SIZE),p=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),m=t.getParameter(t.MAX_VERTEX_ATTRIBS),f=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),g=t.getParameter(t.MAX_VARYING_VECTORS),v=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),y=u>0,x=r||e.has("OES_texture_float");return{isWebGL2:r,drawBuffers:h,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:s,precision:o,logarithmicDepthBuffer:l,maxTextures:c,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:f,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:x,floatVertexTextures:y&&x,maxSamples:r?t.getParameter(t.MAX_SAMPLES):0}}function cs(t){const e=this;let i=null,n=0,s=!1,r=!1;const o=new Yn,a=new se,h={value:null,needsUpdate:!1};function l(t,i,n,s){const r=null!==t?t.length:0;let l=null;if(0!==r){if(l=h.value,!0!==s||null===l){const e=n+4*r,s=i.matrixWorldInverse;a.getNormalMatrix(s),(null===l||l.length<e)&&(l=new Float32Array(e));for(let e=0,i=n;e!==r;++e,i+=4)o.copy(t[e]).applyMatrix4(s,a),o.normal.toArray(l,i),l[i+3]=o.constant}h.value=l,h.needsUpdate=!0}return e.numPlanes=r,e.numIntersection=0,l}this.uniform=h,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){const i=0!==t.length||e||0!==n||s;return s=e,n=t.length,i},this.beginShadows=function(){r=!0,l(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(t,e){i=l(t,e,0)},this.setState=function(o,a,c){const u=o.clippingPlanes,d=o.clipIntersection,p=o.clipShadows,m=t.get(o);if(!s||null===u||0===u.length||r&&!p)r?l(null):function(){h.value!==i&&(h.value=i,h.needsUpdate=n>0);e.numPlanes=n,e.numIntersection=0}();else{const t=r?0:n,e=4*t;let s=m.clippingState||null;h.value=s,s=l(u,a,e,c);for(let t=0;t!==e;++t)s[t]=i[t];m.clippingState=s,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function us(t){let e=new WeakMap;function i(t,e){return e===W?t.mapping=V:e===X&&(t.mapping=j),t}function n(t){const i=t.target;i.removeEventListener("dispose",n);const s=e.get(i);void 0!==s&&(e.delete(i),s.dispose())}return{get:function(s){if(s&&s.isTexture){const r=s.mapping;if(r===W||r===X){if(e.has(s)){return i(e.get(s).texture,s.mapping)}{const r=s.image;if(r&&r.height>0){const o=new Wn(r.height/2);return o.fromEquirectangularTexture(t,s),e.set(s,o),s.addEventListener("dispose",n),i(o.texture,s.mapping)}return null}}}return s},dispose:function(){e=new WeakMap}}}class ds extends Fn{constructor(t=-1,e=1,i=1,n=-1,s=.1,r=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=s,this.far=r,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,s,r){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-t,r=i+t,o=n+e,a=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=t*this.view.offsetX,r=s+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(s,r,o,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const ps=[.125,.215,.35,.446,.526,.582],ms=20,fs=new ds,gs=new Yi;let vs=null,ys=0,xs=0;const _s=(1+Math.sqrt(5))/2,bs=1/_s,ws=[new Pe(1,1,1),new Pe(-1,1,1),new Pe(1,1,-1),new Pe(-1,1,-1),new Pe(0,_s,bs),new Pe(0,_s,-bs),new Pe(bs,0,_s),new Pe(-bs,0,_s),new Pe(_s,bs,0),new Pe(-_s,bs,0)];class Ms{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){vs=this._renderer.getRenderTarget(),ys=this._renderer.getActiveCubeFace(),xs=this._renderer.getActiveMipmapLevel(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,i,n,s),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=As(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Es(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(vs,ys,xs),t.scissorTest=!1,Ts(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===V||t.mapping===j?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),vs=this._renderer.getRenderTarget(),ys=this._renderer.getActiveCubeFace(),xs=this._renderer.getActiveMipmapLevel();const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:tt,minFilter:tt,generateMipmaps:!1,type:ht,format:ct,colorSpace:Rt,depthBuffer:!1},n=Ss(t,e,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Ss(t,e,i);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],i=[],n=[];let s=t;const r=t-4+1+ps.length;for(let o=0;o<r;o++){const r=Math.pow(2,s);i.push(r);let a=1/r;o>t-4?a=ps[o-t+4-1]:0===o&&(a=0),n.push(a);const h=1/(r-2),l=-h,c=1+h,u=[l,l,c,l,c,c,l,l,c,c,l,c],d=6,p=6,m=3,f=2,g=1,v=new Float32Array(m*p*d),y=new Float32Array(f*p*d),x=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];v.set(n,m*p*t),y.set(u,f*p*t);const s=[t,t,t,t,t,t];x.set(s,g*p*t)}const _=new mn;_.setAttribute("position",new nn(v,m)),_.setAttribute("uv",new nn(y,f)),_.setAttribute("faceIndex",new nn(x,g)),e.push(_),s>4&&s--}return{lodPlanes:e,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=function(t,e,i){const n=new Float32Array(ms),s=new Pe(0,1,0),r=new Un({name:"SphericalGaussianBlur",defines:{n:ms,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:Cs(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return r}(n,t,e)}return n}_compileMaterial(t){const e=new kn(this._lodPlanes[0],t);this._renderer.compile(e,fs)}_sceneToCubeUV(t,e,i,n){const s=new Gn(90,1,e,i),r=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,h=a.autoClear,l=a.toneMapping;a.getClearColor(gs),a.toneMapping=O,a.autoClear=!1;const c=new Qi({name:"PMREM.Background",side:R,depthWrite:!1,depthTest:!1}),u=new kn(new Ln,c);let d=!1;const p=t.background;p?p.isColor&&(c.color.copy(p),t.background=null,d=!0):(c.color.copy(gs),d=!0);for(let e=0;e<6;e++){const i=e%3;0===i?(s.up.set(0,r[e],0),s.lookAt(o[e],0,0)):1===i?(s.up.set(0,0,r[e]),s.lookAt(0,o[e],0)):(s.up.set(0,r[e],0),s.lookAt(0,0,o[e]));const h=this._cubeSize;Ts(n,i*h,e>2?h:0,h,h),a.setRenderTarget(n),d&&a.render(u,s),a.render(t,s)}u.geometry.dispose(),u.material.dispose(),a.toneMapping=l,a.autoClear=h,t.background=p}_textureToCubeUV(t,e){const i=this._renderer,n=t.mapping===V||t.mapping===j;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=As()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Es());const s=n?this._cubemapMaterial:this._equirectMaterial,r=new kn(this._lodPlanes[0],s);s.uniforms.envMap.value=t;const o=this._cubeSize;Ts(e,0,0,3*o,2*o),i.setRenderTarget(e),i.render(r,fs)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const i=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),n=ws[(e-1)%ws.length];this._blur(t,e-1,e,i,n)}e.autoClear=i}_blur(t,e,i,n,s){const r=this._pingPongRenderTarget;this._halfBlur(t,r,e,i,n,"latitudinal",s),this._halfBlur(r,t,i,i,n,"longitudinal",s)}_halfBlur(t,e,i,n,s,r,o){const a=this._renderer,h=this._blurMaterial,l=new kn(this._lodPlanes[n],h),c=h.uniforms,u=this._sizeLods[i]-1,d=isFinite(s)?Math.PI/(2*u):2*Math.PI/39,p=s/d,m=isFinite(s)?1+Math.floor(3*p):ms,f=[];let g=0;for(let t=0;t<ms;++t){const e=t/p,i=Math.exp(-e*e/2);f.push(i),0===t?g+=i:t<m&&(g+=2*i)}for(let t=0;t<f.length;t++)f[t]=f[t]/g;c.envMap.value=t.texture,c.samples.value=m,c.weights.value=f,c.latitudinal.value="latitudinal"===r,o&&(c.poleAxis.value=o);const{_lodMax:v}=this;c.dTheta.value=d,c.mipInt.value=v-i;const y=this._sizeLods[n];Ts(e,3*y*(n>v-4?n-v+4:0),4*(this._cubeSize-y),3*y,2*y),a.setRenderTarget(e),a.render(l,fs)}}function Ss(t,e,i){const n=new Ae(t,e,i);return n.texture.mapping=$,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Ts(t,e,i,n,s){t.viewport.set(e,i,n,s),t.scissor.set(e,i,n,s)}function Es(){return new Un({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Cs(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function As(){return new Un({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Cs(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Cs(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Is(t){let e=new WeakMap,i=null;function n(t){const i=t.target;i.removeEventListener("dispose",n);const s=e.get(i);void 0!==s&&(e.delete(i),s.dispose())}return{get:function(s){if(s&&s.isTexture){const r=s.mapping,o=r===W||r===X,a=r===V||r===j;if(o||a){if(s.isRenderTargetTexture&&!0===s.needsPMREMUpdate){s.needsPMREMUpdate=!1;let n=e.get(s);return null===i&&(i=new Ms(t)),n=o?i.fromEquirectangular(s,n):i.fromCubemap(s,n),e.set(s,n),n.texture}if(e.has(s))return e.get(s).texture;{const r=s.image;if(o&&r&&r.height>0||a&&r&&function(t){let e=0;const i=6;for(let n=0;n<i;n++)void 0!==t[n]&&e++;return e===i}(r)){null===i&&(i=new Ms(t));const r=o?i.fromEquirectangular(s):i.fromCubemap(s);return e.set(s,r),s.addEventListener("dispose",n),r.texture}return null}}}return s},dispose:function(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function Rs(t){const e={};function i(i){if(void 0!==e[i])return e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,n}return{has:function(t){return null!==i(t)},init:function(t){t.isWebGL2?(i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance")):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(t){const e=i(t);return e}}}function Ps(t,e,i,n){const s={},r=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);for(const t in a.morphAttributes){const i=a.morphAttributes[t];for(let t=0,n=i.length;t<n;t++)e.remove(i[t])}a.removeEventListener("dispose",o),delete s[a.id];const h=r.get(a);h&&(e.remove(h),r.delete(a)),n.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(t){const i=[],n=t.index,s=t.attributes.position;let o=0;if(null!==n){const t=n.array;o=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],s=t[e+1],r=t[e+2];i.push(n,s,s,r,r,n)}}else{if(void 0===s)return;{const t=s.array;o=s.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,s=e+2;i.push(t,n,n,s,s,t)}}}const a=new(oe(i)?rn:sn)(i,1);a.version=o;const h=r.get(t);h&&e.remove(h),r.set(t,a)}return{get:function(t,e){return!0===s[e.id]||(e.addEventListener("dispose",o),s[e.id]=!0,i.memory.geometries++),e},update:function(i){const n=i.attributes;for(const i in n)e.update(n[i],t.ARRAY_BUFFER);const s=i.morphAttributes;for(const i in s){const n=s[i];for(let i=0,s=n.length;i<s;i++)e.update(n[i],t.ARRAY_BUFFER)}},getWireframeAttribute:function(t){const e=r.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&a(t)}else a(t);return r.get(t)}}}function ks(t,e,i,n){const s=n.isWebGL2;let r,o,a;this.setMode=function(t){r=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,n){t.drawElements(r,n,o,e*a),i.update(n,r,1)},this.renderInstances=function(n,h,l){if(0===l)return;let c,u;if(s)c=t,u="drawElementsInstanced";else if(c=e.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===c)return;c[u](r,h,o,n*a,l),i.update(h,r,l)},this.renderMultiDraw=function(t,n,s){if(0===s)return;const h=e.get("WEBGL_multi_draw");if(null===h)for(let e=0;e<s;e++)this.render(t[e]/a,n[e]);else{h.multiDrawElementsWEBGL(r,n,0,o,t,0,s);let e=0;for(let t=0;t<s;t++)e+=n[t];i.update(e,r,1)}}}function Ds(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(i,n,s){switch(e.calls++,n){case t.TRIANGLES:e.triangles+=s*(i/3);break;case t.LINES:e.lines+=s*(i/2);break;case t.LINE_STRIP:e.lines+=s*(i-1);break;case t.LINE_LOOP:e.lines+=s*i;break;case t.POINTS:e.points+=s*i}}}}function Ls(t,e){return t[0]-e[0]}function Os(t,e){return Math.abs(e[1])-Math.abs(t[1])}function Ns(t,e,i){const n={},s=new Float32Array(8),r=new WeakMap,o=new Te,a=[];for(let t=0;t<8;t++)a[t]=[t,0];return{update:function(h,l,c){const u=h.morphTargetInfluences;if(!0===e.isWebGL2){const d=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,p=void 0!==d?d.length:0;let m=r.get(l);if(void 0===m||m.count!==p){void 0!==m&&m.texture.dispose();const v=void 0!==l.morphAttributes.position,y=void 0!==l.morphAttributes.normal,x=void 0!==l.morphAttributes.color,_=l.morphAttributes.position||[],b=l.morphAttributes.normal||[],w=l.morphAttributes.color||[];let M=0;!0===v&&(M=1),!0===y&&(M=2),!0===x&&(M=3);let S=l.attributes.position.count*M,T=1;S>e.maxTextureSize&&(T=Math.ceil(S/e.maxTextureSize),S=e.maxTextureSize);const E=new Float32Array(S*T*4*p),A=new Ce(E,S,T,p);A.type=at,A.needsUpdate=!0;const C=4*M;for(let R=0;R<p;R++){const P=_[R],k=b[R],D=w[R],L=S*T*4*R;for(let O=0;O<P.count;O++){const N=O*C;!0===v&&(o.fromBufferAttribute(P,O),E[L+N+0]=o.x,E[L+N+1]=o.y,E[L+N+2]=o.z,E[L+N+3]=0),!0===y&&(o.fromBufferAttribute(k,O),E[L+N+4]=o.x,E[L+N+5]=o.y,E[L+N+6]=o.z,E[L+N+7]=0),!0===x&&(o.fromBufferAttribute(D,O),E[L+N+8]=o.x,E[L+N+9]=o.y,E[L+N+10]=o.z,E[L+N+11]=4===D.itemSize?o.w:1)}}function I(){A.dispose(),r.delete(l),l.removeEventListener("dispose",I)}m={count:p,texture:A,size:new ne(S,T)},r.set(l,m),l.addEventListener("dispose",I)}let f=0;for(let B=0;B<u.length;B++)f+=u[B];const g=l.morphTargetsRelative?1:1-f;c.getUniforms().setValue(t,"morphTargetBaseInfluence",g),c.getUniforms().setValue(t,"morphTargetInfluences",u),c.getUniforms().setValue(t,"morphTargetsTexture",m.texture,i),c.getUniforms().setValue(t,"morphTargetsTextureSize",m.size)}else{const z=void 0===u?0:u.length;let U=n[l.id];if(void 0===U||U.length!==z){U=[];for(let j=0;j<z;j++)U[j]=[j,0];n[l.id]=U}for(let W=0;W<z;W++){const X=U[W];X[0]=W,X[1]=u[W]}U.sort(Os);for(let $=0;$<8;$++)$<z&&U[$][1]?(a[$][0]=U[$][0],a[$][1]=U[$][1]):(a[$][0]=Number.MAX_SAFE_INTEGER,a[$][1]=0);a.sort(Ls);const F=l.morphAttributes.position,G=l.morphAttributes.normal;let H=0;for(let q=0;q<8;q++){const Y=a[q],K=Y[0],Z=Y[1];K!==Number.MAX_SAFE_INTEGER&&Z?(F&&l.getAttribute("morphTarget"+q)!==F[K]&&l.setAttribute("morphTarget"+q,F[K]),G&&l.getAttribute("morphNormal"+q)!==G[K]&&l.setAttribute("morphNormal"+q,G[K]),s[q]=Z,H+=Z):(F&&!0===l.hasAttribute("morphTarget"+q)&&l.deleteAttribute("morphTarget"+q),G&&!0===l.hasAttribute("morphNormal"+q)&&l.deleteAttribute("morphNormal"+q),s[q]=0)}const V=l.morphTargetsRelative?1:1-H;c.getUniforms().setValue(t,"morphTargetBaseInfluence",V),c.getUniforms().setValue(t,"morphTargetInfluences",s)}}}}function Bs(t,e,i,n){let s=new WeakMap;function r(t){const e=t.target;e.removeEventListener("dispose",r),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(o){const a=n.render.frame,h=o.geometry,l=e.get(o,h);if(s.get(l)!==a&&(e.update(l),s.set(l,a)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",r)&&o.addEventListener("dispose",r),s.get(o)!==a&&(i.update(o.instanceMatrix,t.ARRAY_BUFFER),null!==o.instanceColor&&i.update(o.instanceColor,t.ARRAY_BUFFER),s.set(o,a))),o.isSkinnedMesh){const t=o.skeleton;s.get(t)!==a&&(t.update(),s.set(t,a))}return l},dispose:function(){s=new WeakMap}}}class zs extends Se{constructor(t,e,i,n,s,r,o,a,h,l){if((l=void 0!==l?l:ut)!==ut&&l!==dt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&l===ut&&(i=ot),void 0===i&&l===dt&&(i=lt),super(null,n,s,r,o,a,l,i,h),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==o?o:Z,this.minFilter=void 0!==a?a:Z,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}const Us=new Se,Fs=new zs(1,1);Fs.compareFunction=515;const Gs=new Ce,Hs=new Ie,Vs=new jn,js=[],Ws=[],Xs=new Float32Array(16),$s=new Float32Array(9),qs=new Float32Array(4);function Ys(t,e,i){const n=t[0];if(n<=0||n>0)return t;const s=e*i;let r=js[s];if(void 0===r&&(r=new Float32Array(s),js[s]=r),0!==e){n.toArray(r,0);for(let n=1,s=0;n!==e;++n)s+=i,t[n].toArray(r,s)}return r}function Ks(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function Zs(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function Js(t,e){let i=Ws[e];void 0===i&&(i=new Int32Array(e),Ws[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function Qs(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function tr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Ks(i,e))return;t.uniform2fv(this.addr,e),Zs(i,e)}}function er(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(Ks(i,e))return;t.uniform3fv(this.addr,e),Zs(i,e)}}function ir(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Ks(i,e))return;t.uniform4fv(this.addr,e),Zs(i,e)}}function nr(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(Ks(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),Zs(i,e)}else{if(Ks(i,n))return;qs.set(n),t.uniformMatrix2fv(this.addr,!1,qs),Zs(i,n)}}function sr(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(Ks(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),Zs(i,e)}else{if(Ks(i,n))return;$s.set(n),t.uniformMatrix3fv(this.addr,!1,$s),Zs(i,n)}}function rr(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(Ks(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),Zs(i,e)}else{if(Ks(i,n))return;Xs.set(n),t.uniformMatrix4fv(this.addr,!1,Xs),Zs(i,n)}}function or(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function ar(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Ks(i,e))return;t.uniform2iv(this.addr,e),Zs(i,e)}}function hr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(Ks(i,e))return;t.uniform3iv(this.addr,e),Zs(i,e)}}function lr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Ks(i,e))return;t.uniform4iv(this.addr,e),Zs(i,e)}}function cr(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function ur(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(Ks(i,e))return;t.uniform2uiv(this.addr,e),Zs(i,e)}}function dr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(Ks(i,e))return;t.uniform3uiv(this.addr,e),Zs(i,e)}}function pr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(Ks(i,e))return;t.uniform4uiv(this.addr,e),Zs(i,e)}}function mr(t,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(t.uniform1i(this.addr,s),n[0]=s);const r=this.type===t.SAMPLER_2D_SHADOW?Fs:Us;i.setTexture2D(e||r,s)}function fr(t,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(t.uniform1i(this.addr,s),n[0]=s),i.setTexture3D(e||Hs,s)}function gr(t,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(t.uniform1i(this.addr,s),n[0]=s),i.setTextureCube(e||Vs,s)}function vr(t,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(t.uniform1i(this.addr,s),n[0]=s),i.setTexture2DArray(e||Gs,s)}function yr(t,e){t.uniform1fv(this.addr,e)}function xr(t,e){const i=Ys(e,this.size,2);t.uniform2fv(this.addr,i)}function _r(t,e){const i=Ys(e,this.size,3);t.uniform3fv(this.addr,i)}function br(t,e){const i=Ys(e,this.size,4);t.uniform4fv(this.addr,i)}function wr(t,e){const i=Ys(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function Mr(t,e){const i=Ys(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function Sr(t,e){const i=Ys(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function Tr(t,e){t.uniform1iv(this.addr,e)}function Er(t,e){t.uniform2iv(this.addr,e)}function Ar(t,e){t.uniform3iv(this.addr,e)}function Cr(t,e){t.uniform4iv(this.addr,e)}function Ir(t,e){t.uniform1uiv(this.addr,e)}function Rr(t,e){t.uniform2uiv(this.addr,e)}function Pr(t,e){t.uniform3uiv(this.addr,e)}function kr(t,e){t.uniform4uiv(this.addr,e)}function Dr(t,e,i){const n=this.cache,s=e.length,r=Js(i,s);Ks(n,r)||(t.uniform1iv(this.addr,r),Zs(n,r));for(let t=0;t!==s;++t)i.setTexture2D(e[t]||Us,r[t])}function Lr(t,e,i){const n=this.cache,s=e.length,r=Js(i,s);Ks(n,r)||(t.uniform1iv(this.addr,r),Zs(n,r));for(let t=0;t!==s;++t)i.setTexture3D(e[t]||Hs,r[t])}function Or(t,e,i){const n=this.cache,s=e.length,r=Js(i,s);Ks(n,r)||(t.uniform1iv(this.addr,r),Zs(n,r));for(let t=0;t!==s;++t)i.setTextureCube(e[t]||Vs,r[t])}function Nr(t,e,i){const n=this.cache,s=e.length,r=Js(i,s);Ks(n,r)||(t.uniform1iv(this.addr,r),Zs(n,r));for(let t=0;t!==s;++t)i.setTexture2DArray(e[t]||Gs,r[t])}class Br{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.type=e.type,this.setValue=function(t){switch(t){case 5126:return Qs;case 35664:return tr;case 35665:return er;case 35666:return ir;case 35674:return nr;case 35675:return sr;case 35676:return rr;case 5124:case 35670:return or;case 35667:case 35671:return ar;case 35668:case 35672:return hr;case 35669:case 35673:return lr;case 5125:return cr;case 36294:return ur;case 36295:return dr;case 36296:return pr;case 35678:case 36198:case 36298:case 36306:case 35682:return mr;case 35679:case 36299:case 36307:return fr;case 35680:case 36300:case 36308:case 36293:return gr;case 36289:case 36303:case 36311:case 36292:return vr}}(e.type)}}class zr{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return yr;case 35664:return xr;case 35665:return _r;case 35666:return br;case 35674:return wr;case 35675:return Mr;case 35676:return Sr;case 5124:case 35670:return Tr;case 35667:case 35671:return Er;case 35668:case 35672:return Ar;case 35669:case 35673:return Cr;case 5125:return Ir;case 36294:return Rr;case 36295:return Pr;case 36296:return kr;case 35678:case 36198:case 36298:case 36306:case 35682:return Dr;case 35679:case 36299:case 36307:return Lr;case 35680:case 36300:case 36308:case 36293:return Or;case 36289:case 36303:case 36311:case 36292:return Nr}}(e.type)}}class Ur{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){const n=this.seq;for(let s=0,r=n.length;s!==r;++s){const r=n[s];r.setValue(t,e[r.id],i)}}}const Fr=/(\w+)(\])?(\[|\.)?/g;function Gr(t,e){t.seq.push(e),t.map[e.id]=e}function Hr(t,e,i){const n=t.name,s=n.length;for(Fr.lastIndex=0;;){const r=Fr.exec(n),o=Fr.lastIndex;let a=r[1];const h="]"===r[2],l=r[3];if(h&&(a|=0),void 0===l||"["===l&&o+2===s){Gr(i,void 0===l?new Br(a,t,e):new zr(a,t,e));break}{let t=i.map[a];void 0===t&&(t=new Ur(a),Gr(i,t)),i=t}}}class Vr{constructor(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){const i=t.getActiveUniform(e,n);Hr(i,t.getUniformLocation(e,i.name),this)}}setValue(t,e,i,n){const s=this.map[e];void 0!==s&&s.setValue(t,i,n)}setOptional(t,e,i){const n=e[i];void 0!==n&&this.setValue(t,i,n)}static upload(t,e,i,n){for(let s=0,r=e.length;s!==r;++s){const r=e[s],o=i[r.id];!1!==o.needsUpdate&&r.setValue(t,o.value,n)}}static seqWithValue(t,e){const i=[];for(let n=0,s=t.length;n!==s;++n){const s=t[n];s.id in e&&i.push(s)}return i}}function jr(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}const Wr=37297;let Xr=0;function $r(t,e,i){const n=t.getShaderParameter(e,t.COMPILE_STATUS),s=t.getShaderInfoLog(e).trim();if(n&&""===s)return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const n=parseInt(r[1]);return i.toUpperCase()+"\n\n"+s+"\n\n"+function(t,e){const i=t.split("\n"),n=[],s=Math.max(e-6,0),r=Math.min(e+6,i.length);for(let t=s;t<r;t++){const s=t+1;n.push(`${s===e?">":" "} ${s}: ${i[t]}`)}return n.join("\n")}(t.getShaderSource(e),n)}return s}function qr(t,e){const i=function(t){const e=fe.getPrimaries(fe.workingColorSpace),i=fe.getPrimaries(t);let n;switch(e===i?n="":e===Nt&&i===Ot?n="LinearDisplayP3ToLinearSRGB":e===Ot&&i===Nt&&(n="LinearSRGBToLinearDisplayP3"),t){case Rt:case kt:return[n,"LinearTransferOETF"];case It:case Pt:return[n,"sRGBTransferOETF"];default:return[n,"LinearTransferOETF"]}}(e);return`vec4 ${t}( vec4 value ) { return ${i[0]}( ${i[1]}( value ) ); }`}function Yr(t,e){let i;switch(e){case N:i="Linear";break;case B:i="Reinhard";break;case z:i="OptimizedCineon";break;case U:i="ACESFilmic";break;case G:i="AgX";break;case F:i="Custom";break;default:i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function Kr(t){return""!==t}function Zr(t,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Jr(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Qr=/^[ \t]*#include +<([\w\d./]+)>/gm;function to(t){return t.replace(Qr,io)}const eo=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function io(t,e){let i=is[e];if(void 0===i){const t=eo.get(e);if(void 0===t)throw new Error("Can not resolve #include <"+e+">");i=is[t]}return to(i)}const no=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function so(t){return t.replace(no,ro)}function ro(t,e,i,n){let s="";for(let t=parseInt(e);t<parseInt(i);t++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return s}function oo(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function ao(t,e,i,n){const s=t.getContext(),r=i.defines;let o=i.vertexShader,a=i.fragmentShader;const h=function(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===E?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===A?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===C&&(e="SHADOWMAP_TYPE_VSM"),e}(i),l=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case V:case j:e="ENVMAP_TYPE_CUBE";break;case $:e="ENVMAP_TYPE_CUBE_UV"}return e}(i),c=function(t){let e="ENVMAP_MODE_REFLECTION";t.envMap&&t.envMapMode===j&&(e="ENVMAP_MODE_REFRACTION");return e}(i),u=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case k:e="ENVMAP_BLENDING_MULTIPLY";break;case D:e="ENVMAP_BLENDING_MIX";break;case L:e="ENVMAP_BLENDING_ADD"}return e}(i),d=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const i=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),p=i.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.normalMapTangentSpace||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Kr).join("\n")}(i),m=function(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":""].filter(Kr).join("\n")}(i),f=function(t){const e=[];for(const i in t){const n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(r),g=s.createProgram();let v,y,x=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(v=["#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(Kr).join("\n"),v.length>0&&(v+="\n"),y=[p,"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f].filter(Kr).join("\n"),y.length>0&&(y+="\n")):(v=[oo(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",i.batching?"#define USE_BATCHING":"",i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.displacementMap?"#define USE_DISPLACEMENTMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.mapUv?"#define MAP_UV "+i.mapUv:"",i.alphaMapUv?"#define ALPHAMAP_UV "+i.alphaMapUv:"",i.lightMapUv?"#define LIGHTMAP_UV "+i.lightMapUv:"",i.aoMapUv?"#define AOMAP_UV "+i.aoMapUv:"",i.emissiveMapUv?"#define EMISSIVEMAP_UV "+i.emissiveMapUv:"",i.bumpMapUv?"#define BUMPMAP_UV "+i.bumpMapUv:"",i.normalMapUv?"#define NORMALMAP_UV "+i.normalMapUv:"",i.displacementMapUv?"#define DISPLACEMENTMAP_UV "+i.displacementMapUv:"",i.metalnessMapUv?"#define METALNESSMAP_UV "+i.metalnessMapUv:"",i.roughnessMapUv?"#define ROUGHNESSMAP_UV "+i.roughnessMapUv:"",i.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+i.anisotropyMapUv:"",i.clearcoatMapUv?"#define CLEARCOATMAP_UV "+i.clearcoatMapUv:"",i.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+i.clearcoatNormalMapUv:"",i.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+i.clearcoatRoughnessMapUv:"",i.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+i.iridescenceMapUv:"",i.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+i.iridescenceThicknessMapUv:"",i.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+i.sheenColorMapUv:"",i.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+i.sheenRoughnessMapUv:"",i.specularMapUv?"#define SPECULARMAP_UV "+i.specularMapUv:"",i.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+i.specularColorMapUv:"",i.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+i.specularIntensityMapUv:"",i.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+i.transmissionMapUv:"",i.thicknessMapUv?"#define THICKNESSMAP_UV "+i.thicknessMapUv:"",i.vertexTangents&&!1===i.flatShading?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Kr).join("\n"),y=[p,oo(i),"#define SHADER_TYPE "+i.shaderType,"#define SHADER_NAME "+i.shaderName,f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+l:"",i.envMap?"#define "+c:"",i.envMap?"#define "+u:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",i.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.anisotropy?"#define USE_ANISOTROPY":"",i.anisotropyMap?"#define USE_ANISOTROPYMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",i.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.alphaHash?"#define USE_ALPHAHASH":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents&&!1===i.flatShading?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUv1s?"#define USE_UV1":"",i.vertexUv2s?"#define USE_UV2":"",i.vertexUv3s?"#define USE_UV3":"",i.pointsUvs?"#define USE_POINTS_UV":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+h:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.numLightProbes>0?"#define USE_LIGHT_PROBES":"",i.useLegacyLights?"#define LEGACY_LIGHTS":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==O?"#define TONE_MAPPING":"",i.toneMapping!==O?is.tonemapping_pars_fragment:"",i.toneMapping!==O?Yr("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",is.colorspace_pars_fragment,qr("linearToOutputTexel",i.outputColorSpace),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(Kr).join("\n")),o=to(o),o=Zr(o,i),o=Jr(o,i),a=to(a),a=Zr(a,i),a=Jr(a,i),o=so(o),a=so(a),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(x="#version 300 es\n",v=[m,"precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+v,y=["precision mediump sampler2DArray;","#define varying in",i.glslVersion===Ut?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===Ut?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y);const _=x+v+o,b=x+y+a,w=jr(s,s.VERTEX_SHADER,_),M=jr(s,s.FRAGMENT_SHADER,b);function S(e){if(t.debug.checkShaderErrors){const i=s.getProgramInfoLog(g).trim(),n=s.getShaderInfoLog(w).trim(),r=s.getShaderInfoLog(M).trim();let o=!0,a=!0;if(!1===s.getProgramParameter(g,s.LINK_STATUS))if(o=!1,"function"==typeof t.debug.onShaderError)t.debug.onShaderError(s,g,w,M);else{$r(s,w,"vertex"),$r(s,M,"fragment")}else""!==i||""!==n&&""!==r||(a=!1);a&&(e.diagnostics={runnable:o,programLog:i,vertexShader:{log:n,prefix:v},fragmentShader:{log:r,prefix:y}})}s.deleteShader(w),s.deleteShader(M),T=new Vr(s,g),I=function(t,e){const i={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let s=0;s<n;s++){const n=t.getActiveAttrib(e,s),r=n.name;let o=1;n.type===t.FLOAT_MAT2&&(o=2),n.type===t.FLOAT_MAT3&&(o=3),n.type===t.FLOAT_MAT4&&(o=4),i[r]={type:n.type,location:t.getAttribLocation(e,r),locationSize:o}}return i}(s,g)}let T,I;s.attachShader(g,w),s.attachShader(g,M),void 0!==i.index0AttributeName?s.bindAttribLocation(g,0,i.index0AttributeName):!0===i.morphTargets&&s.bindAttribLocation(g,0,"position"),s.linkProgram(g),this.getUniforms=function(){return void 0===T&&S(this),T},this.getAttributes=function(){return void 0===I&&S(this),I};let R=!1===i.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===R&&(R=s.getProgramParameter(g,Wr)),R},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(g),this.program=void 0},this.type=i.shaderType,this.name=i.shaderName,this.id=Xr++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=w,this.fragmentShader=M,this}let ho=0;class lo{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,n=this._getShaderStage(e),s=this._getShaderStage(i),r=this._getShaderCacheForMaterial(t);return!1===r.has(n)&&(r.add(n),n.usedTimes++),!1===r.has(s)&&(r.add(s),s.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let i=e.get(t);return void 0===i&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){const e=this.shaderCache;let i=e.get(t);return void 0===i&&(i=new co(t),e.set(t,i)),i}}class co{constructor(t){this.id=ho++,this.code=t,this.usedTimes=0}}function uo(t,e,i,n,s,r,o){const a=new yi,h=new lo,l=[],c=s.isWebGL2,u=s.logarithmicDepthBuffer,d=s.vertexTextures;let p=s.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function f(t){return 0===t?"uv":`uv${t}`}return{getParameters:function(r,a,l,g,v){const y=g.fog,x=v.geometry,_=r.isMeshStandardMaterial?g.environment:null,b=(r.isMeshStandardMaterial?i:e).get(r.envMap||_),w=b&&b.mapping===$?b.image.height:null,M=m[r.type];null!==r.precision&&(p=s.getMaxPrecision(r.precision),r.precision);const S=x.morphAttributes.position||x.morphAttributes.normal||x.morphAttributes.color,T=void 0!==S?S.length:0;let E,A,C,I,P=0;if(void 0!==x.morphAttributes.position&&(P=1),void 0!==x.morphAttributes.normal&&(P=2),void 0!==x.morphAttributes.color&&(P=3),M){const t=ss[M];E=t.vertexShader,A=t.fragmentShader}else E=r.vertexShader,A=r.fragmentShader,h.update(r),C=h.getVertexShaderID(r),I=h.getFragmentShaderID(r);const k=t.getRenderTarget(),D=!0===v.isInstancedMesh,L=!0===v.isBatchedMesh,N=!!r.map,B=!!r.matcap,z=!!b,U=!!r.aoMap,F=!!r.lightMap,G=!!r.bumpMap,H=!!r.normalMap,V=!!r.displacementMap,j=!!r.emissiveMap,W=!!r.metalnessMap,X=!!r.roughnessMap,q=r.anisotropy>0,Y=r.clearcoat>0,K=r.iridescence>0,Z=r.sheen>0,J=r.transmission>0,Q=q&&!!r.anisotropyMap,tt=Y&&!!r.clearcoatMap,et=Y&&!!r.clearcoatNormalMap,it=Y&&!!r.clearcoatRoughnessMap,nt=K&&!!r.iridescenceMap,st=K&&!!r.iridescenceThicknessMap,rt=Z&&!!r.sheenColorMap,ot=Z&&!!r.sheenRoughnessMap,at=!!r.specularMap,ht=!!r.specularColorMap,lt=!!r.specularIntensityMap,ct=J&&!!r.transmissionMap,ut=J&&!!r.thicknessMap,dt=!!r.gradientMap,pt=!!r.alphaMap,mt=r.alphaTest>0,ft=!!r.alphaHash,gt=!!r.extensions,vt=!!x.attributes.uv1,yt=!!x.attributes.uv2,xt=!!x.attributes.uv3;let _t=O;return r.toneMapped&&(null!==k&&!0!==k.isXRRenderTarget||(_t=t.toneMapping)),{isWebGL2:c,shaderID:M,shaderType:r.type,shaderName:r.name,vertexShader:E,fragmentShader:A,defines:r.defines,customVertexShaderID:C,customFragmentShaderID:I,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:p,batching:L,instancing:D,instancingColor:D&&null!==v.instanceColor,supportsVertexTextures:d,outputColorSpace:null===k?t.outputColorSpace:!0===k.isXRRenderTarget?k.texture.colorSpace:Rt,map:N,matcap:B,envMap:z,envMapMode:z&&b.mapping,envMapCubeUVHeight:w,aoMap:U,lightMap:F,bumpMap:G,normalMap:H,displacementMap:d&&V,emissiveMap:j,normalMapObjectSpace:H&&1===r.normalMapType,normalMapTangentSpace:H&&0===r.normalMapType,metalnessMap:W,roughnessMap:X,anisotropy:q,anisotropyMap:Q,clearcoat:Y,clearcoatMap:tt,clearcoatNormalMap:et,clearcoatRoughnessMap:it,iridescence:K,iridescenceMap:nt,iridescenceThicknessMap:st,sheen:Z,sheenColorMap:rt,sheenRoughnessMap:ot,specularMap:at,specularColorMap:ht,specularIntensityMap:lt,transmission:J,transmissionMap:ct,thicknessMap:ut,gradientMap:dt,opaque:!1===r.transparent&&1===r.blending,alphaMap:pt,alphaTest:mt,alphaHash:ft,combine:r.combine,mapUv:N&&f(r.map.channel),aoMapUv:U&&f(r.aoMap.channel),lightMapUv:F&&f(r.lightMap.channel),bumpMapUv:G&&f(r.bumpMap.channel),normalMapUv:H&&f(r.normalMap.channel),displacementMapUv:V&&f(r.displacementMap.channel),emissiveMapUv:j&&f(r.emissiveMap.channel),metalnessMapUv:W&&f(r.metalnessMap.channel),roughnessMapUv:X&&f(r.roughnessMap.channel),anisotropyMapUv:Q&&f(r.anisotropyMap.channel),clearcoatMapUv:tt&&f(r.clearcoatMap.channel),clearcoatNormalMapUv:et&&f(r.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:it&&f(r.clearcoatRoughnessMap.channel),iridescenceMapUv:nt&&f(r.iridescenceMap.channel),iridescenceThicknessMapUv:st&&f(r.iridescenceThicknessMap.channel),sheenColorMapUv:rt&&f(r.sheenColorMap.channel),sheenRoughnessMapUv:ot&&f(r.sheenRoughnessMap.channel),specularMapUv:at&&f(r.specularMap.channel),specularColorMapUv:ht&&f(r.specularColorMap.channel),specularIntensityMapUv:lt&&f(r.specularIntensityMap.channel),transmissionMapUv:ct&&f(r.transmissionMap.channel),thicknessMapUv:ut&&f(r.thicknessMap.channel),alphaMapUv:pt&&f(r.alphaMap.channel),vertexTangents:!!x.attributes.tangent&&(H||q),vertexColors:r.vertexColors,vertexAlphas:!0===r.vertexColors&&!!x.attributes.color&&4===x.attributes.color.itemSize,vertexUv1s:vt,vertexUv2s:yt,vertexUv3s:xt,pointsUvs:!0===v.isPoints&&!!x.attributes.uv&&(N||pt),fog:!!y,useFog:!0===r.fog,fogExp2:y&&y.isFogExp2,flatShading:!0===r.flatShading,sizeAttenuation:!0===r.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==x.morphAttributes.position,morphNormals:void 0!==x.morphAttributes.normal,morphColors:void 0!==x.morphAttributes.color,morphTargetsCount:T,morphTextureStride:P,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numSpotLightMaps:a.spotLightMap.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numSpotLightShadowsWithMaps:a.numSpotLightShadowsWithMaps,numLightProbes:a.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:r.dithering,shadowMapEnabled:t.shadowMap.enabled&&l.length>0,shadowMapType:t.shadowMap.type,toneMapping:_t,useLegacyLights:t._useLegacyLights,decodeVideoTexture:N&&!0===r.map.isVideoTexture&&fe.getTransfer(r.map.colorSpace)===Lt,premultipliedAlpha:r.premultipliedAlpha,doubleSided:2===r.side,flipSided:r.side===R,useDepthPacking:r.depthPacking>=0,depthPacking:r.depthPacking||0,index0AttributeName:r.index0AttributeName,extensionDerivatives:gt&&!0===r.extensions.derivatives,extensionFragDepth:gt&&!0===r.extensions.fragDepth,extensionDrawBuffers:gt&&!0===r.extensions.drawBuffers,extensionShaderTextureLOD:gt&&!0===r.extensions.shaderTextureLOD,extensionClipCullDistance:gt&&r.extensions.clipCullDistance&&n.has("WEBGL_clip_cull_distance"),rendererExtensionFragDepth:c||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:c||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:c||n.has("EXT_shader_texture_lod"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.customVertexShaderID),i.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.numLightProbes),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(i,e),function(t,e){a.disableAll(),e.isWebGL2&&a.enable(0);e.supportsVertexTextures&&a.enable(1);e.instancing&&a.enable(2);e.instancingColor&&a.enable(3);e.matcap&&a.enable(4);e.envMap&&a.enable(5);e.normalMapObjectSpace&&a.enable(6);e.normalMapTangentSpace&&a.enable(7);e.clearcoat&&a.enable(8);e.iridescence&&a.enable(9);e.alphaTest&&a.enable(10);e.vertexColors&&a.enable(11);e.vertexAlphas&&a.enable(12);e.vertexUv1s&&a.enable(13);e.vertexUv2s&&a.enable(14);e.vertexUv3s&&a.enable(15);e.vertexTangents&&a.enable(16);e.anisotropy&&a.enable(17);e.alphaHash&&a.enable(18);e.batching&&a.enable(19);t.push(a.mask),a.disableAll(),e.fog&&a.enable(0);e.useFog&&a.enable(1);e.flatShading&&a.enable(2);e.logarithmicDepthBuffer&&a.enable(3);e.skinning&&a.enable(4);e.morphTargets&&a.enable(5);e.morphNormals&&a.enable(6);e.morphColors&&a.enable(7);e.premultipliedAlpha&&a.enable(8);e.shadowMapEnabled&&a.enable(9);e.useLegacyLights&&a.enable(10);e.doubleSided&&a.enable(11);e.flipSided&&a.enable(12);e.useDepthPacking&&a.enable(13);e.dithering&&a.enable(14);e.transmission&&a.enable(15);e.sheen&&a.enable(16);e.opaque&&a.enable(17);e.pointsUvs&&a.enable(18);e.decodeVideoTexture&&a.enable(19);t.push(a.mask)}(i,e),i.push(t.outputColorSpace)),i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=m[t.type];let i;if(e){const t=ss[e];i=zn.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let n;for(let t=0,e=l.length;t<e;t++){const e=l[t];if(e.cacheKey===i){n=e,++n.usedTimes;break}}return void 0===n&&(n=new ao(t,i,e,r),l.push(n)),n},releaseProgram:function(t){if(0==--t.usedTimes){const e=l.indexOf(t);l[e]=l[l.length-1],l.pop(),t.destroy()}},releaseShaderCache:function(t){h.remove(t)},programs:l,dispose:function(){h.dispose()}}}function po(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,n){t.get(e)[i]=n},dispose:function(){t=new WeakMap}}}function mo(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function fo(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function go(){const t=[];let e=0;const i=[],n=[],s=[];function r(i,n,s,r,o,a){let h=t[e];return void 0===h?(h={id:i.id,object:i,geometry:n,material:s,groupOrder:r,renderOrder:i.renderOrder,z:o,group:a},t[e]=h):(h.id=i.id,h.object=i,h.geometry=n,h.material=s,h.groupOrder=r,h.renderOrder=i.renderOrder,h.z=o,h.group=a),e++,h}return{opaque:i,transmissive:n,transparent:s,init:function(){e=0,i.length=0,n.length=0,s.length=0},push:function(t,e,o,a,h,l){const c=r(t,e,o,a,h,l);o.transmission>0?n.push(c):!0===o.transparent?s.push(c):i.push(c)},unshift:function(t,e,o,a,h,l){const c=r(t,e,o,a,h,l);o.transmission>0?n.unshift(c):!0===o.transparent?s.unshift(c):i.unshift(c)},finish:function(){for(let i=e,n=t.length;i<n;i++){const e=t[i];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){i.length>1&&i.sort(t||mo),n.length>1&&n.sort(e||fo),s.length>1&&s.sort(e||fo)}}}function vo(){let t=new WeakMap;return{get:function(e,i){const n=t.get(e);let s;return void 0===n?(s=new go,t.set(e,[s])):i>=n.length?(s=new go,n.push(s)):s=n[i],s},dispose:function(){t=new WeakMap}}}function yo(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new Pe,color:new Yi};break;case"SpotLight":i={position:new Pe,direction:new Pe,color:new Yi,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Pe,color:new Yi,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Pe,skyColor:new Yi,groundColor:new Yi};break;case"RectAreaLight":i={color:new Yi,position:new Pe,halfWidth:new Pe,halfHeight:new Pe}}return t[e.id]=i,i}}}let xo=0;function _o(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function bo(t,e){const i=new yo,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ne};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ne,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let t=0;t<9;t++)s.probe.push(new Pe);const r=new Pe,o=new ai,a=new ai;return{setup:function(r,o){let a=0,h=0,l=0;for(let t=0;t<9;t++)s.probe[t].set(0,0,0);let c=0,u=0,d=0,p=0,m=0,f=0,g=0,v=0,y=0,x=0,_=0;r.sort(_o);const b=!0===o?Math.PI:1;for(let t=0,e=r.length;t<e;t++){const e=r[t],o=e.color,w=e.intensity,M=e.distance,S=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)a+=o.r*w*b,h+=o.g*w*b,l+=o.b*w*b;else if(e.isLightProbe){for(let t=0;t<9;t++)s.probe[t].addScaledVector(e.sh.coefficients[t],w);_++}else if(e.isDirectionalLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*b),e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,s.directionalShadow[c]=i,s.directionalShadowMap[c]=S,s.directionalShadowMatrix[c]=e.shadow.matrix,f++}s.directional[c]=t,c++}else if(e.isSpotLight){const t=i.get(e);t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(o).multiplyScalar(w*b),t.distance=M,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,s.spot[d]=t;const r=e.shadow;if(e.map&&(s.spotLightMap[y]=e.map,y++,r.updateMatrices(e),e.castShadow&&x++),s.spotLightMatrix[d]=r.matrix,e.castShadow){const t=n.get(e);t.shadowBias=r.bias,t.shadowNormalBias=r.normalBias,t.shadowRadius=r.radius,t.shadowMapSize=r.mapSize,s.spotShadow[d]=t,s.spotShadowMap[d]=S,v++}d++}else if(e.isRectAreaLight){const t=i.get(e);t.color.copy(o).multiplyScalar(w),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),s.rectArea[p]=t,p++}else if(e.isPointLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*b),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,s.pointShadow[u]=i,s.pointShadowMap[u]=S,s.pointShadowMatrix[u]=e.shadow.matrix,g++}s.point[u]=t,u++}else if(e.isHemisphereLight){const t=i.get(e);t.skyColor.copy(e.color).multiplyScalar(w*b),t.groundColor.copy(e.groundColor).multiplyScalar(w*b),s.hemi[m]=t,m++}}p>0&&(e.isWebGL2?!0===t.has("OES_texture_float_linear")?(s.rectAreaLTC1=ns.LTC_FLOAT_1,s.rectAreaLTC2=ns.LTC_FLOAT_2):(s.rectAreaLTC1=ns.LTC_HALF_1,s.rectAreaLTC2=ns.LTC_HALF_2):!0===t.has("OES_texture_float_linear")?(s.rectAreaLTC1=ns.LTC_FLOAT_1,s.rectAreaLTC2=ns.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")&&(s.rectAreaLTC1=ns.LTC_HALF_1,s.rectAreaLTC2=ns.LTC_HALF_2)),s.ambient[0]=a,s.ambient[1]=h,s.ambient[2]=l;const w=s.hash;w.directionalLength===c&&w.pointLength===u&&w.spotLength===d&&w.rectAreaLength===p&&w.hemiLength===m&&w.numDirectionalShadows===f&&w.numPointShadows===g&&w.numSpotShadows===v&&w.numSpotMaps===y&&w.numLightProbes===_||(s.directional.length=c,s.spot.length=d,s.rectArea.length=p,s.point.length=u,s.hemi.length=m,s.directionalShadow.length=f,s.directionalShadowMap.length=f,s.pointShadow.length=g,s.pointShadowMap.length=g,s.spotShadow.length=v,s.spotShadowMap.length=v,s.directionalShadowMatrix.length=f,s.pointShadowMatrix.length=g,s.spotLightMatrix.length=v+y-x,s.spotLightMap.length=y,s.numSpotLightShadowsWithMaps=x,s.numLightProbes=_,w.directionalLength=c,w.pointLength=u,w.spotLength=d,w.rectAreaLength=p,w.hemiLength=m,w.numDirectionalShadows=f,w.numPointShadows=g,w.numSpotShadows=v,w.numSpotMaps=y,w.numLightProbes=_,s.version=xo++)},setupView:function(t,e){let i=0,n=0,h=0,l=0,c=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=s.directional[i];t.direction.setFromMatrixPosition(d.matrixWorld),r.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(u),i++}else if(d.isSpotLight){const t=s.spot[h];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),r.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(r),t.direction.transformDirection(u),h++}else if(d.isRectAreaLight){const t=s.rectArea[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),a.identity(),o.copy(d.matrixWorld),o.premultiply(u),a.extractRotation(o),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),l++}else if(d.isPointLight){const t=s.point[n];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),n++}else if(d.isHemisphereLight){const t=s.hemi[c];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),c++}}},state:s}}function wo(t,e){const i=new bo(t,e),n=[],s=[];return{init:function(){n.length=0,s.length=0},state:{lightsArray:n,shadowsArray:s,lights:i},setupLights:function(t){i.setup(n,t)},setupLightsView:function(t){i.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){s.push(t)}}}function Mo(t,e){let i=new WeakMap;return{get:function(n,s=0){const r=i.get(n);let o;return void 0===r?(o=new wo(t,e),i.set(n,[o])):s>=r.length?(o=new wo(t,e),r.push(o)):o=r[s],o},dispose:function(){i=new WeakMap}}}class So extends Ji{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class To extends Ji{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function Eo(t,e,i){let n=new Jn;const s=new ne,r=new ne,o=new Te,a=new So({depthPacking:3201}),h=new To,l={},c=i.maxTextureSize,u={[I]:R,[R]:I,2:2},d=new Un({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ne},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=d.clone();p.defines.HORIZONTAL_PASS=1;const m=new mn;m.setAttribute("position",new nn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const f=new kn(m,d),g=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=E;let v=this.type;function y(i,n){const r=e.update(f);d.defines.VSM_SAMPLES!==i.blurSamples&&(d.defines.VSM_SAMPLES=i.blurSamples,p.defines.VSM_SAMPLES=i.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),null===i.mapPass&&(i.mapPass=new Ae(s.x,s.y)),d.uniforms.shadow_pass.value=i.map.texture,d.uniforms.resolution.value=i.mapSize,d.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(n,null,r,d,f,null),p.uniforms.shadow_pass.value=i.mapPass.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(n,null,r,p,f,null)}function x(e,i,n,s){let r=null;const o=!0===n.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==o)r=o;else if(r=!0===n.isPointLight?h:a,t.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0||i.map&&i.alphaTest>0){const t=r.uuid,e=i.uuid;let n=l[t];void 0===n&&(n={},l[t]=n);let s=n[e];void 0===s&&(s=r.clone(),n[e]=s,i.addEventListener("dispose",b)),r=s}if(r.visible=i.visible,r.wireframe=i.wireframe,r.side=s===C?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:u[i.side],r.alphaMap=i.alphaMap,r.alphaTest=i.alphaTest,r.map=i.map,r.clipShadows=i.clipShadows,r.clippingPlanes=i.clippingPlanes,r.clipIntersection=i.clipIntersection,r.displacementMap=i.displacementMap,r.displacementScale=i.displacementScale,r.displacementBias=i.displacementBias,r.wireframeLinewidth=i.wireframeLinewidth,r.linewidth=i.linewidth,!0===n.isPointLight&&!0===r.isMeshDistanceMaterial){t.properties.get(r).light=n}return r}function _(i,s,r,o,a){if(!1===i.visible)return;if(i.layers.test(s.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&a===C)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,i.matrixWorld);const n=e.update(i),h=i.material;if(Array.isArray(h)){const e=n.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],u=h[c.materialIndex];if(u&&u.visible){const e=x(i,u,o,a);i.onBeforeShadow(t,i,s,r,n,e,c),t.renderBufferDirect(r,null,n,e,i,c),i.onAfterShadow(t,i,s,r,n,e,c)}}}else if(h.visible){const e=x(i,h,o,a);i.onBeforeShadow(t,i,s,r,n,e,null),t.renderBufferDirect(r,null,n,e,i,null),i.onAfterShadow(t,i,s,r,n,e,null)}}const h=i.children;for(let t=0,e=h.length;t<e;t++)_(h[t],s,r,o,a)}function b(t){t.target.removeEventListener("dispose",b);for(const e in l){const i=l[e],n=t.target.uuid;if(n in i){i[n].dispose(),delete i[n]}}}this.render=function(e,i,a){if(!1===g.enabled)return;if(!1===g.autoUpdate&&!1===g.needsUpdate)return;if(0===e.length)return;const h=t.getRenderTarget(),l=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.state;d.setBlending(0),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);const p=v!==C&&this.type===C,m=v===C&&this.type!==C;for(let h=0,l=e.length;h<l;h++){const l=e[h],u=l.shadow;if(void 0===u)continue;if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;s.copy(u.mapSize);const f=u.getFrameExtents();if(s.multiply(f),r.copy(u.mapSize),(s.x>c||s.y>c)&&(s.x>c&&(r.x=Math.floor(c/f.x),s.x=r.x*f.x,u.mapSize.x=r.x),s.y>c&&(r.y=Math.floor(c/f.y),s.y=r.y*f.y,u.mapSize.y=r.y)),null===u.map||!0===p||!0===m){const t=this.type!==C?{minFilter:Z,magFilter:Z}:{};null!==u.map&&u.map.dispose(),u.map=new Ae(s.x,s.y,t),u.map.texture.name=l.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const g=u.getViewportCount();for(let t=0;t<g;t++){const e=u.getViewport(t);o.set(r.x*e.x,r.y*e.y,r.x*e.z,r.y*e.w),d.viewport(o),u.updateMatrices(l,t),n=u.getFrustum(),_(i,a,u.camera,l,this.type)}!0!==u.isPointLightShadow&&this.type===C&&y(u,a),u.needsUpdate=!1}v=this.type,g.needsUpdate=!1,t.setRenderTarget(h,l,u)}}function Ao(t,e,i){const n=i.isWebGL2;const s=new function(){let e=!1;const i=new Te;let n=null;const s=new Te(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,r,o,a){!0===a&&(e*=o,n*=o,r*=o),i.set(e,n,r,o),!1===s.equals(i)&&(t.clearColor(e,n,r,o),s.copy(i))},reset:function(){e=!1,n=null,s.set(-1,0,0,0)}}},r=new function(){let e=!1,i=null,n=null,s=null;return{setTest:function(e){e?j(t.DEPTH_TEST):W(t.DEPTH_TEST)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}n=e}},setLocked:function(t){e=t},setClear:function(e){s!==e&&(t.clearDepth(e),s=e)},reset:function(){e=!1,i=null,n=null,s=null}}},o=new function(){let e=!1,i=null,n=null,s=null,r=null,o=null,a=null,h=null,l=null;return{setTest:function(i){e||(i?j(t.STENCIL_TEST):W(t.STENCIL_TEST))},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,o){n===e&&s===i&&r===o||(t.stencilFunc(e,i,o),n=e,s=i,r=o)},setOp:function(e,i,n){o===e&&a===i&&h===n||(t.stencilOp(e,i,n),o=e,a=i,h=n)},setLocked:function(t){e=t},setClear:function(e){l!==e&&(t.clearStencil(e),l=e)},reset:function(){e=!1,i=null,n=null,s=null,r=null,o=null,a=null,h=null,l=null}}},a=new WeakMap,h=new WeakMap;let l={},c={},u=new WeakMap,d=[],p=null,m=!1,f=null,g=null,v=null,y=null,x=null,_=null,b=null,w=new Yi(0,0,0),M=0,S=!1,T=null,E=null,A=null,C=null,I=null;const k=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let D=!1,L=0;const O=t.getParameter(t.VERSION);-1!==O.indexOf("WebGL")?(L=parseFloat(/^WebGL (\d)/.exec(O)[1]),D=L>=1):-1!==O.indexOf("OpenGL ES")&&(L=parseFloat(/^OpenGL ES (\d)/.exec(O)[1]),D=L>=2);let N=null,B={};const z=t.getParameter(t.SCISSOR_BOX),U=t.getParameter(t.VIEWPORT),F=(new Te).fromArray(z),G=(new Te).fromArray(U);function H(e,i,s,r){const o=new Uint8Array(4),a=t.createTexture();t.bindTexture(e,a),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let a=0;a<s;a++)!n||e!==t.TEXTURE_3D&&e!==t.TEXTURE_2D_ARRAY?t.texImage2D(i+a,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,o):t.texImage3D(i,0,t.RGBA,1,1,r,0,t.RGBA,t.UNSIGNED_BYTE,o);return a}const V={};function j(e){!0!==l[e]&&(t.enable(e),l[e]=!0)}function W(e){!1!==l[e]&&(t.disable(e),l[e]=!1)}V[t.TEXTURE_2D]=H(t.TEXTURE_2D,t.TEXTURE_2D,1),V[t.TEXTURE_CUBE_MAP]=H(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(V[t.TEXTURE_2D_ARRAY]=H(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),V[t.TEXTURE_3D]=H(t.TEXTURE_3D,t.TEXTURE_3D,1,1)),s.setClear(0,0,0,1),r.setClear(1),o.setClear(0),j(t.DEPTH_TEST),r.setFunc(3),Y(!1),K(1),j(t.CULL_FACE),q(0);const X={[P]:t.FUNC_ADD,101:t.FUNC_SUBTRACT,102:t.FUNC_REVERSE_SUBTRACT};if(n)X[103]=t.MIN,X[104]=t.MAX;else{const t=e.get("EXT_blend_minmax");null!==t&&(X[103]=t.MIN_EXT,X[104]=t.MAX_EXT)}const $={200:t.ZERO,201:t.ONE,202:t.SRC_COLOR,204:t.SRC_ALPHA,210:t.SRC_ALPHA_SATURATE,208:t.DST_COLOR,206:t.DST_ALPHA,203:t.ONE_MINUS_SRC_COLOR,205:t.ONE_MINUS_SRC_ALPHA,209:t.ONE_MINUS_DST_COLOR,207:t.ONE_MINUS_DST_ALPHA,211:t.CONSTANT_COLOR,212:t.ONE_MINUS_CONSTANT_COLOR,213:t.CONSTANT_ALPHA,214:t.ONE_MINUS_CONSTANT_ALPHA};function q(e,i,n,s,r,o,a,h,l,c){if(0!==e){if(!1===m&&(j(t.BLEND),m=!0),5===e)r=r||i,o=o||n,a=a||s,i===g&&r===x||(t.blendEquationSeparate(X[i],X[r]),g=i,x=r),n===v&&s===y&&o===_&&a===b||(t.blendFuncSeparate($[n],$[s],$[o],$[a]),v=n,y=s,_=o,b=a),!1!==h.equals(w)&&l===M||(t.blendColor(h.r,h.g,h.b,l),w.copy(h),M=l),f=e,S=!1;else if(e!==f||c!==S){if(g===P&&x===P||(t.blendEquation(t.FUNC_ADD),g=P,x=P),c)switch(e){case 1:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.ONE,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA)}else switch(e){case 1:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFunc(t.ZERO,t.SRC_COLOR)}v=null,y=null,_=null,b=null,w.set(0,0,0),M=0,f=e,S=c}}else!0===m&&(W(t.BLEND),m=!1)}function Y(e){T!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),T=e)}function K(e){0!==e?(j(t.CULL_FACE),e!==E&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):W(t.CULL_FACE),E=e}function Z(e,i,n){e?(j(t.POLYGON_OFFSET_FILL),C===i&&I===n||(t.polygonOffset(i,n),C=i,I=n)):W(t.POLYGON_OFFSET_FILL)}return{buffers:{color:s,depth:r,stencil:o},enable:j,disable:W,bindFramebuffer:function(e,i){return c[e]!==i&&(t.bindFramebuffer(e,i),c[e]=i,n&&(e===t.DRAW_FRAMEBUFFER&&(c[t.FRAMEBUFFER]=i),e===t.FRAMEBUFFER&&(c[t.DRAW_FRAMEBUFFER]=i)),!0)},drawBuffers:function(n,s){let r=d,o=!1;if(n)if(r=u.get(s),void 0===r&&(r=[],u.set(s,r)),n.isWebGLMultipleRenderTargets){const e=n.texture;if(r.length!==e.length||r[0]!==t.COLOR_ATTACHMENT0){for(let i=0,n=e.length;i<n;i++)r[i]=t.COLOR_ATTACHMENT0+i;r.length=e.length,o=!0}}else r[0]!==t.COLOR_ATTACHMENT0&&(r[0]=t.COLOR_ATTACHMENT0,o=!0);else r[0]!==t.BACK&&(r[0]=t.BACK,o=!0);o&&(i.isWebGL2?t.drawBuffers(r):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(r))},useProgram:function(e){return p!==e&&(t.useProgram(e),p=e,!0)},setBlending:q,setMaterial:function(e,i){2===e.side?W(t.CULL_FACE):j(t.CULL_FACE);let n=e.side===R;i&&(n=!n),Y(n),1===e.blending&&!1===e.transparent?q(0):q(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.blendColor,e.blendAlpha,e.premultipliedAlpha),r.setFunc(e.depthFunc),r.setTest(e.depthTest),r.setMask(e.depthWrite),s.setMask(e.colorWrite);const a=e.stencilWrite;o.setTest(a),a&&(o.setMask(e.stencilWriteMask),o.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),o.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Z(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?j(t.SAMPLE_ALPHA_TO_COVERAGE):W(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:Y,setCullFace:K,setLineWidth:function(e){e!==A&&(D&&t.lineWidth(e),A=e)},setPolygonOffset:Z,setScissorTest:function(e){e?j(t.SCISSOR_TEST):W(t.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=t.TEXTURE0+k-1),N!==e&&(t.activeTexture(e),N=e)},bindTexture:function(e,i,n){void 0===n&&(n=null===N?t.TEXTURE0+k-1:N);let s=B[n];void 0===s&&(s={type:void 0,texture:void 0},B[n]=s),s.type===e&&s.texture===i||(N!==n&&(t.activeTexture(n),N=n),t.bindTexture(e,i||V[e]),s.type=e,s.texture=i)},unbindTexture:function(){const e=B[N];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){}},compressedTexImage3D:function(){try{t.compressedTexImage3D.apply(t,arguments)}catch(t){}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){}},updateUBOMapping:function(e,i){let n=h.get(i);void 0===n&&(n=new WeakMap,h.set(i,n));let s=n.get(e);void 0===s&&(s=t.getUniformBlockIndex(i,e.name),n.set(e,s))},uniformBlockBinding:function(e,i){const n=h.get(i).get(e);a.get(i)!==n&&(t.uniformBlockBinding(i,n,e.__bindingPointIndex),a.set(i,n))},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(t){}},scissor:function(e){!1===F.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),F.copy(e))},viewport:function(e){!1===G.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),G.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),!0===n&&(t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),l={},N=null,B={},c={},u=new WeakMap,d=[],p=null,m=!1,f=null,g=null,v=null,y=null,x=null,_=null,b=null,w=new Yi(0,0,0),M=0,S=!1,T=null,E=null,A=null,C=null,I=null,F.set(0,0,t.canvas.width,t.canvas.height),G.set(0,0,t.canvas.width,t.canvas.height),s.reset(),r.reset(),o.reset()}}}function Co(t,e,i,n,s,r,o){const a=s.isWebGL2,h=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new WeakMap;let u;const d=new WeakMap;let p=!1;try{p="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function m(t,e){return p?new OffscreenCanvas(t,e):ae("canvas")}function f(t,e,i,n){let s=1;if((t.width>n||t.height>n)&&(s=n/Math.max(t.width,t.height)),s<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const n=e?Qt:Math.floor,r=n(s*t.width),o=n(s*t.height);void 0===u&&(u=m(r,o));const a=i?m(r,o):u;a.width=r,a.height=o;return a.getContext("2d").drawImage(t,0,0,r,o),a}return t}return t}function g(t){return Jt(t.width)&&Jt(t.height)}function v(t,e){return t.generateMipmaps&&e&&t.minFilter!==Z&&t.minFilter!==tt}function y(e){t.generateMipmap(e)}function x(i,n,s,r,o=!1){if(!1===a)return n;if(null!==i&&void 0!==t[i])return t[i];let h=n;if(n===t.RED&&(s===t.FLOAT&&(h=t.R32F),s===t.HALF_FLOAT&&(h=t.R16F),s===t.UNSIGNED_BYTE&&(h=t.R8)),n===t.RED_INTEGER&&(s===t.UNSIGNED_BYTE&&(h=t.R8UI),s===t.UNSIGNED_SHORT&&(h=t.R16UI),s===t.UNSIGNED_INT&&(h=t.R32UI),s===t.BYTE&&(h=t.R8I),s===t.SHORT&&(h=t.R16I),s===t.INT&&(h=t.R32I)),n===t.RG&&(s===t.FLOAT&&(h=t.RG32F),s===t.HALF_FLOAT&&(h=t.RG16F),s===t.UNSIGNED_BYTE&&(h=t.RG8)),n===t.RGBA){const e=o?Dt:fe.getTransfer(r);s===t.FLOAT&&(h=t.RGBA32F),s===t.HALF_FLOAT&&(h=t.RGBA16F),s===t.UNSIGNED_BYTE&&(h=e===Lt?t.SRGB8_ALPHA8:t.RGBA8),s===t.UNSIGNED_SHORT_4_4_4_4&&(h=t.RGBA4),s===t.UNSIGNED_SHORT_5_5_5_1&&(h=t.RGB5_A1)}return h!==t.R16F&&h!==t.R32F&&h!==t.RG16F&&h!==t.RG32F&&h!==t.RGBA16F&&h!==t.RGBA32F||e.get("EXT_color_buffer_float"),h}function _(t,e,i){return!0===v(t,i)||t.isFramebufferTexture&&t.minFilter!==Z&&t.minFilter!==tt?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function b(e){return e===Z||e===J||e===Q?t.NEAREST:t.LINEAR}function w(t){const e=t.target;e.removeEventListener("dispose",w),function(t){const e=n.get(t);if(void 0===e.__webglInit)return;const i=t.source,s=d.get(i);if(s){const n=s[e.__cacheKey];n.usedTimes--,0===n.usedTimes&&S(t),0===Object.keys(s).length&&d.delete(i)}n.remove(t)}(e),e.isVideoTexture&&c.delete(e)}function M(e){const i=e.target;i.removeEventListener("dispose",M),function(e){const i=e.texture,s=n.get(e),r=n.get(i);void 0!==r.__webglTexture&&(t.deleteTexture(r.__webglTexture),o.memory.textures--);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++){if(Array.isArray(s.__webglFramebuffer[e]))for(let i=0;i<s.__webglFramebuffer[e].length;i++)t.deleteFramebuffer(s.__webglFramebuffer[e][i]);else t.deleteFramebuffer(s.__webglFramebuffer[e]);s.__webglDepthbuffer&&t.deleteRenderbuffer(s.__webglDepthbuffer[e])}else{if(Array.isArray(s.__webglFramebuffer))for(let e=0;e<s.__webglFramebuffer.length;e++)t.deleteFramebuffer(s.__webglFramebuffer[e]);else t.deleteFramebuffer(s.__webglFramebuffer);if(s.__webglDepthbuffer&&t.deleteRenderbuffer(s.__webglDepthbuffer),s.__webglMultisampledFramebuffer&&t.deleteFramebuffer(s.__webglMultisampledFramebuffer),s.__webglColorRenderbuffer)for(let e=0;e<s.__webglColorRenderbuffer.length;e++)s.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(s.__webglColorRenderbuffer[e]);s.__webglDepthRenderbuffer&&t.deleteRenderbuffer(s.__webglDepthRenderbuffer)}if(e.isWebGLMultipleRenderTargets)for(let e=0,s=i.length;e<s;e++){const s=n.get(i[e]);s.__webglTexture&&(t.deleteTexture(s.__webglTexture),o.memory.textures--),n.remove(i[e])}n.remove(i),n.remove(e)}(i)}function S(e){const i=n.get(e);t.deleteTexture(i.__webglTexture);const s=e.source;delete d.get(s)[i.__cacheKey],o.memory.textures--}let T=0;function E(e,s){const r=n.get(e);if(e.isVideoTexture&&function(t){const e=o.render.frame;c.get(t)!==e&&(c.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&r.__version!==e.version){const t=e.image;if(null===t);else if(!1!==t.complete)return void k(r,e,s)}i.bindTexture(t.TEXTURE_2D,r.__webglTexture,t.TEXTURE0+s)}const A={[q]:t.REPEAT,[Y]:t.CLAMP_TO_EDGE,[K]:t.MIRRORED_REPEAT},C={[Z]:t.NEAREST,[J]:t.NEAREST_MIPMAP_NEAREST,[Q]:t.NEAREST_MIPMAP_LINEAR,[tt]:t.LINEAR,[et]:t.LINEAR_MIPMAP_NEAREST,[it]:t.LINEAR_MIPMAP_LINEAR},I={512:t.NEVER,519:t.ALWAYS,513:t.LESS,515:t.LEQUAL,514:t.EQUAL,518:t.GEQUAL,516:t.GREATER,517:t.NOTEQUAL};function R(i,r,o){if(o?(t.texParameteri(i,t.TEXTURE_WRAP_S,A[r.wrapS]),t.texParameteri(i,t.TEXTURE_WRAP_T,A[r.wrapT]),i!==t.TEXTURE_3D&&i!==t.TEXTURE_2D_ARRAY||t.texParameteri(i,t.TEXTURE_WRAP_R,A[r.wrapR]),t.texParameteri(i,t.TEXTURE_MAG_FILTER,C[r.magFilter]),t.texParameteri(i,t.TEXTURE_MIN_FILTER,C[r.minFilter])):(t.texParameteri(i,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(i,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i!==t.TEXTURE_3D&&i!==t.TEXTURE_2D_ARRAY||t.texParameteri(i,t.TEXTURE_WRAP_R,t.CLAMP_TO_EDGE),r.wrapS!==Y||r.wrapT,t.texParameteri(i,t.TEXTURE_MAG_FILTER,b(r.magFilter)),t.texParameteri(i,t.TEXTURE_MIN_FILTER,b(r.minFilter)),r.minFilter!==Z&&r.minFilter),r.compareFunction&&(t.texParameteri(i,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(i,t.TEXTURE_COMPARE_FUNC,I[r.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){const o=e.get("EXT_texture_filter_anisotropic");if(r.magFilter===Z)return;if(r.minFilter!==Q&&r.minFilter!==it)return;if(r.type===at&&!1===e.has("OES_texture_float_linear"))return;if(!1===a&&r.type===ht&&!1===e.has("OES_texture_half_float_linear"))return;(r.anisotropy>1||n.get(r).__currentAnisotropy)&&(t.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r.anisotropy,s.getMaxAnisotropy())),n.get(r).__currentAnisotropy=r.anisotropy)}}function P(e,i){let n=!1;void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",w));const s=i.source;let r=d.get(s);void 0===r&&(r={},d.set(s,r));const a=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join()}(i);if(a!==e.__cacheKey){void 0===r[a]&&(r[a]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,n=!0),r[a].usedTimes++;const s=r[e.__cacheKey];void 0!==s&&(r[e.__cacheKey].usedTimes--,0===s.usedTimes&&S(i)),e.__cacheKey=a,e.__webglTexture=r[a].texture}return n}function k(e,o,h){let l=t.TEXTURE_2D;(o.isDataArrayTexture||o.isCompressedArrayTexture)&&(l=t.TEXTURE_2D_ARRAY),o.isData3DTexture&&(l=t.TEXTURE_3D);const c=P(e,o),u=o.source;i.bindTexture(l,e.__webglTexture,t.TEXTURE0+h);const d=n.get(u);if(u.version!==d.__version||!0===c){i.activeTexture(t.TEXTURE0+h);const e=fe.getPrimaries(fe.workingColorSpace),n=o.colorSpace===Ct?null:fe.getPrimaries(o.colorSpace),p=o.colorSpace===Ct||e===n?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,o.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,p);const m=function(t){return!a&&(t.wrapS!==Y||t.wrapT!==Y||t.minFilter!==Z&&t.minFilter!==tt)}(o)&&!1===g(o.image);let b=f(o.image,m,!1,s.maxTextureSize);b=z(o,b);const w=g(b)||a,M=r.convert(o.format,o.colorSpace);let S,T=r.convert(o.type),E=x(o.internalFormat,M,T,o.colorSpace,o.isVideoTexture);R(l,o,w);const A=o.mipmaps,C=a&&!0!==o.isVideoTexture&&36196!==E,I=void 0===d.__version||!0===c,P=_(o,b,w);if(o.isDepthTexture)E=t.DEPTH_COMPONENT,a?E=o.type===at?t.DEPTH_COMPONENT32F:o.type===ot?t.DEPTH_COMPONENT24:o.type===lt?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT16:o.type,o.format===ut&&E===t.DEPTH_COMPONENT&&o.type!==st&&o.type!==ot&&(o.type=ot,T=r.convert(o.type)),o.format===dt&&E===t.DEPTH_COMPONENT&&(E=t.DEPTH_STENCIL,o.type!==lt&&(o.type=lt,T=r.convert(o.type))),I&&(C?i.texStorage2D(t.TEXTURE_2D,1,E,b.width,b.height):i.texImage2D(t.TEXTURE_2D,0,E,b.width,b.height,0,M,T,null));else if(o.isDataTexture)if(A.length>0&&w){C&&I&&i.texStorage2D(t.TEXTURE_2D,P,E,A[0].width,A[0].height);for(let e=0,n=A.length;e<n;e++)S=A[e],C?i.texSubImage2D(t.TEXTURE_2D,e,0,0,S.width,S.height,M,T,S.data):i.texImage2D(t.TEXTURE_2D,e,E,S.width,S.height,0,M,T,S.data);o.generateMipmaps=!1}else C?(I&&i.texStorage2D(t.TEXTURE_2D,P,E,b.width,b.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,b.width,b.height,M,T,b.data)):i.texImage2D(t.TEXTURE_2D,0,E,b.width,b.height,0,M,T,b.data);else if(o.isCompressedTexture)if(o.isCompressedArrayTexture){C&&I&&i.texStorage3D(t.TEXTURE_2D_ARRAY,P,E,A[0].width,A[0].height,b.depth);for(let e=0,n=A.length;e<n;e++)S=A[e],o.format!==ct?null!==M&&(C?i.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,S.width,S.height,b.depth,M,S.data,0,0):i.compressedTexImage3D(t.TEXTURE_2D_ARRAY,e,E,S.width,S.height,b.depth,0,S.data,0,0)):C?i.texSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,S.width,S.height,b.depth,M,T,S.data):i.texImage3D(t.TEXTURE_2D_ARRAY,e,E,S.width,S.height,b.depth,0,M,T,S.data)}else{C&&I&&i.texStorage2D(t.TEXTURE_2D,P,E,A[0].width,A[0].height);for(let e=0,n=A.length;e<n;e++)S=A[e],o.format!==ct?null!==M&&(C?i.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,S.width,S.height,M,S.data):i.compressedTexImage2D(t.TEXTURE_2D,e,E,S.width,S.height,0,S.data)):C?i.texSubImage2D(t.TEXTURE_2D,e,0,0,S.width,S.height,M,T,S.data):i.texImage2D(t.TEXTURE_2D,e,E,S.width,S.height,0,M,T,S.data)}else if(o.isDataArrayTexture)C?(I&&i.texStorage3D(t.TEXTURE_2D_ARRAY,P,E,b.width,b.height,b.depth),i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,b.width,b.height,b.depth,M,T,b.data)):i.texImage3D(t.TEXTURE_2D_ARRAY,0,E,b.width,b.height,b.depth,0,M,T,b.data);else if(o.isData3DTexture)C?(I&&i.texStorage3D(t.TEXTURE_3D,P,E,b.width,b.height,b.depth),i.texSubImage3D(t.TEXTURE_3D,0,0,0,0,b.width,b.height,b.depth,M,T,b.data)):i.texImage3D(t.TEXTURE_3D,0,E,b.width,b.height,b.depth,0,M,T,b.data);else if(o.isFramebufferTexture){if(I)if(C)i.texStorage2D(t.TEXTURE_2D,P,E,b.width,b.height);else{let e=b.width,n=b.height;for(let s=0;s<P;s++)i.texImage2D(t.TEXTURE_2D,s,E,e,n,0,M,T,null),e>>=1,n>>=1}}else if(A.length>0&&w){C&&I&&i.texStorage2D(t.TEXTURE_2D,P,E,A[0].width,A[0].height);for(let e=0,n=A.length;e<n;e++)S=A[e],C?i.texSubImage2D(t.TEXTURE_2D,e,0,0,M,T,S):i.texImage2D(t.TEXTURE_2D,e,E,M,T,S);o.generateMipmaps=!1}else C?(I&&i.texStorage2D(t.TEXTURE_2D,P,E,b.width,b.height),i.texSubImage2D(t.TEXTURE_2D,0,0,0,M,T,b)):i.texImage2D(t.TEXTURE_2D,0,E,M,T,b);v(o,w)&&y(l),d.__version=u.version,o.onUpdate&&o.onUpdate(o)}e.__version=o.version}function D(e,s,o,a,l,c){const u=r.convert(o.format,o.colorSpace),d=r.convert(o.type),p=x(o.internalFormat,u,d,o.colorSpace);if(!n.get(s).__hasExternalTextures){const e=Math.max(1,s.width>>c),n=Math.max(1,s.height>>c);l===t.TEXTURE_3D||l===t.TEXTURE_2D_ARRAY?i.texImage3D(l,c,p,e,n,s.depth,0,u,d,null):i.texImage2D(l,c,p,e,n,0,u,d,null)}i.bindFramebuffer(t.FRAMEBUFFER,e),B(s)?h.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,a,l,n.get(o).__webglTexture,0,N(s)):(l===t.TEXTURE_2D||l>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&l<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,a,l,n.get(o).__webglTexture,c),i.bindFramebuffer(t.FRAMEBUFFER,null)}function L(e,i,n){if(t.bindRenderbuffer(t.RENDERBUFFER,e),i.depthBuffer&&!i.stencilBuffer){let s=!0===a?t.DEPTH_COMPONENT24:t.DEPTH_COMPONENT16;if(n||B(i)){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===at?s=t.DEPTH_COMPONENT32F:e.type===ot&&(s=t.DEPTH_COMPONENT24));const n=N(i);B(i)?h.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,n,s,i.width,i.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,n,s,i.width,i.height)}else t.renderbufferStorage(t.RENDERBUFFER,s,i.width,i.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)}else if(i.depthBuffer&&i.stencilBuffer){const s=N(i);n&&!1===B(i)?t.renderbufferStorageMultisample(t.RENDERBUFFER,s,t.DEPTH24_STENCIL8,i.width,i.height):B(i)?h.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,s,t.DEPTH24_STENCIL8,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)}else{const e=!0===i.isWebGLMultipleRenderTargets?i.texture:[i.texture];for(let s=0;s<e.length;s++){const o=e[s],a=r.convert(o.format,o.colorSpace),l=r.convert(o.type),c=x(o.internalFormat,a,l,o.colorSpace),u=N(i);n&&!1===B(i)?t.renderbufferStorageMultisample(t.RENDERBUFFER,u,c,i.width,i.height):B(i)?h.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,u,c,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,c,i.width,i.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function O(e){const s=n.get(e),r=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!s.__autoAllocateDepthBuffer){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,s){if(s&&s.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(t.FRAMEBUFFER,e),!s.depthTexture||!s.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(s.depthTexture).__webglTexture&&s.depthTexture.image.width===s.width&&s.depthTexture.image.height===s.height||(s.depthTexture.image.width=s.width,s.depthTexture.image.height=s.height,s.depthTexture.needsUpdate=!0),E(s.depthTexture,0);const r=n.get(s.depthTexture).__webglTexture,o=N(s);if(s.depthTexture.format===ut)B(s)?h.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,r,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,r,0);else{if(s.depthTexture.format!==dt)throw new Error("Unknown depthTexture format");B(s)?h.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,r,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,r,0)}}(s.__webglFramebuffer,e)}else if(r){s.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(t.FRAMEBUFFER,s.__webglFramebuffer[n]),s.__webglDepthbuffer[n]=t.createRenderbuffer(),L(s.__webglDepthbuffer[n],e,!1)}else i.bindFramebuffer(t.FRAMEBUFFER,s.__webglFramebuffer),s.__webglDepthbuffer=t.createRenderbuffer(),L(s.__webglDepthbuffer,e,!1);i.bindFramebuffer(t.FRAMEBUFFER,null)}function N(t){return Math.min(s.maxSamples,t.samples)}function B(t){const i=n.get(t);return a&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function z(t,i){const n=t.colorSpace,s=t.format;t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===Ft||n!==Rt&&n!==Ct&&fe.getTransfer(n)===Lt&&!1===a&&(!0===e.has("EXT_sRGB")&&s===ct?(t.format=Ft,t.minFilter=tt,t.generateMipmaps=!1):i=xe.sRGBToLinear(i)),i}this.allocateTextureUnit=function(){const t=T;return s.maxTextures,T+=1,t},this.resetTextureUnits=function(){T=0},this.setTexture2D=E,this.setTexture2DArray=function(e,s){const r=n.get(e);e.version>0&&r.__version!==e.version?k(r,e,s):i.bindTexture(t.TEXTURE_2D_ARRAY,r.__webglTexture,t.TEXTURE0+s)},this.setTexture3D=function(e,s){const r=n.get(e);e.version>0&&r.__version!==e.version?k(r,e,s):i.bindTexture(t.TEXTURE_3D,r.__webglTexture,t.TEXTURE0+s)},this.setTextureCube=function(e,o){const h=n.get(e);e.version>0&&h.__version!==e.version?function(e,o,h){if(6!==o.image.length)return;const l=P(e,o),c=o.source;i.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture,t.TEXTURE0+h);const u=n.get(c);if(c.version!==u.__version||!0===l){i.activeTexture(t.TEXTURE0+h);const e=fe.getPrimaries(fe.workingColorSpace),n=o.colorSpace===Ct?null:fe.getPrimaries(o.colorSpace),d=o.colorSpace===Ct||e===n?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,o.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,d);const p=o.isCompressedTexture||o.image[0].isCompressedTexture,m=o.image[0]&&o.image[0].isDataTexture,b=[];for(let t=0;t<6;t++)b[t]=p||m?m?o.image[t].image:o.image[t]:f(o.image[t],!1,!0,s.maxCubemapSize),b[t]=z(o,b[t]);const w=b[0],M=g(w)||a,S=r.convert(o.format,o.colorSpace),T=r.convert(o.type),E=x(o.internalFormat,S,T,o.colorSpace),A=a&&!0!==o.isVideoTexture,C=void 0===u.__version||!0===l;let I,P=_(o,w,M);if(R(t.TEXTURE_CUBE_MAP,o,M),p){A&&C&&i.texStorage2D(t.TEXTURE_CUBE_MAP,P,E,w.width,w.height);for(let e=0;e<6;e++){I=b[e].mipmaps;for(let n=0;n<I.length;n++){const s=I[n];o.format!==ct?null!==S&&(A?i.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,0,0,s.width,s.height,S,s.data):i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,E,s.width,s.height,0,s.data)):A?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,0,0,s.width,s.height,S,T,s.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,E,s.width,s.height,0,S,T,s.data)}}}else{I=o.mipmaps,A&&C&&(I.length>0&&P++,i.texStorage2D(t.TEXTURE_CUBE_MAP,P,E,b[0].width,b[0].height));for(let e=0;e<6;e++)if(m){A?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,b[e].width,b[e].height,S,T,b[e].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,E,b[e].width,b[e].height,0,S,T,b[e].data);for(let n=0;n<I.length;n++){const s=I[n].image[e].image;A?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,0,0,s.width,s.height,S,T,s.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,E,s.width,s.height,0,S,T,s.data)}}else{A?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,S,T,b[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,E,S,T,b[e]);for(let n=0;n<I.length;n++){const s=I[n];A?i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,0,0,S,T,s.image[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,E,S,T,s.image[e])}}}v(o,M)&&y(t.TEXTURE_CUBE_MAP),u.__version=c.version,o.onUpdate&&o.onUpdate(o)}e.__version=o.version}(h,e,o):i.bindTexture(t.TEXTURE_CUBE_MAP,h.__webglTexture,t.TEXTURE0+o)},this.rebindTextures=function(e,i,s){const r=n.get(e);void 0!==i&&D(r.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),void 0!==s&&O(e)},this.setupRenderTarget=function(e){const h=e.texture,l=n.get(e),c=n.get(h);e.addEventListener("dispose",M),!0!==e.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=t.createTexture()),c.__version=h.version,o.memory.textures++);const u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=g(e)||a;if(u){l.__webglFramebuffer=[];for(let e=0;e<6;e++)if(a&&h.mipmaps&&h.mipmaps.length>0){l.__webglFramebuffer[e]=[];for(let i=0;i<h.mipmaps.length;i++)l.__webglFramebuffer[e][i]=t.createFramebuffer()}else l.__webglFramebuffer[e]=t.createFramebuffer()}else{if(a&&h.mipmaps&&h.mipmaps.length>0){l.__webglFramebuffer=[];for(let e=0;e<h.mipmaps.length;e++)l.__webglFramebuffer[e]=t.createFramebuffer()}else l.__webglFramebuffer=t.createFramebuffer();if(d&&s.drawBuffers){const i=e.texture;for(let e=0,s=i.length;e<s;e++){const s=n.get(i[e]);void 0===s.__webglTexture&&(s.__webglTexture=t.createTexture(),o.memory.textures++)}}if(a&&e.samples>0&&!1===B(e)){const n=d?h:[h];l.__webglMultisampledFramebuffer=t.createFramebuffer(),l.__webglColorRenderbuffer=[],i.bindFramebuffer(t.FRAMEBUFFER,l.__webglMultisampledFramebuffer);for(let i=0;i<n.length;i++){const s=n[i];l.__webglColorRenderbuffer[i]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,l.__webglColorRenderbuffer[i]);const o=r.convert(s.format,s.colorSpace),a=r.convert(s.type),h=x(s.internalFormat,o,a,s.colorSpace,!0===e.isXRRenderTarget),c=N(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,c,h,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+i,t.RENDERBUFFER,l.__webglColorRenderbuffer[i])}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(l.__webglDepthRenderbuffer=t.createRenderbuffer(),L(l.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(t.FRAMEBUFFER,null)}}if(u){i.bindTexture(t.TEXTURE_CUBE_MAP,c.__webglTexture),R(t.TEXTURE_CUBE_MAP,h,p);for(let i=0;i<6;i++)if(a&&h.mipmaps&&h.mipmaps.length>0)for(let n=0;n<h.mipmaps.length;n++)D(l.__webglFramebuffer[i][n],e,h,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+i,n);else D(l.__webglFramebuffer[i],e,h,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0);v(h,p)&&y(t.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(d){const s=e.texture;for(let r=0,o=s.length;r<o;r++){const o=s[r],a=n.get(o);i.bindTexture(t.TEXTURE_2D,a.__webglTexture),R(t.TEXTURE_2D,o,p),D(l.__webglFramebuffer,e,o,t.COLOR_ATTACHMENT0+r,t.TEXTURE_2D,0),v(o,p)&&y(t.TEXTURE_2D)}i.unbindTexture()}else{let n=t.TEXTURE_2D;if((e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&a&&(n=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),i.bindTexture(n,c.__webglTexture),R(n,h,p),a&&h.mipmaps&&h.mipmaps.length>0)for(let i=0;i<h.mipmaps.length;i++)D(l.__webglFramebuffer[i],e,h,t.COLOR_ATTACHMENT0,n,i);else D(l.__webglFramebuffer,e,h,t.COLOR_ATTACHMENT0,n,0);v(h,p)&&y(n),i.unbindTexture()}e.depthBuffer&&O(e)},this.updateRenderTargetMipmap=function(e){const s=g(e)||a,r=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let o=0,a=r.length;o<a;o++){const a=r[o];if(v(a,s)){const s=e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,r=n.get(a).__webglTexture;i.bindTexture(s,r),y(s),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(a&&e.samples>0&&!1===B(e)){const s=e.isWebGLMultipleRenderTargets?e.texture:[e.texture],r=e.width,o=e.height;let a=t.COLOR_BUFFER_BIT;const h=[],c=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,u=n.get(e),d=!0===e.isWebGLMultipleRenderTargets;if(d)for(let e=0;e<s.length;e++)i.bindFramebuffer(t.FRAMEBUFFER,u.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),i.bindFramebuffer(t.FRAMEBUFFER,u.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);i.bindFramebuffer(t.READ_FRAMEBUFFER,u.__webglMultisampledFramebuffer),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,u.__webglFramebuffer);for(let i=0;i<s.length;i++){h.push(t.COLOR_ATTACHMENT0+i),e.depthBuffer&&h.push(c);const p=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;if(!1===p&&(e.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&(a|=t.STENCIL_BUFFER_BIT)),d&&t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,u.__webglColorRenderbuffer[i]),!0===p&&(t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[c]),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[c])),d){const e=n.get(s[i]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}t.blitFramebuffer(0,0,r,o,0,0,r,o,a,t.NEAREST),l&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,h)}if(i.bindFramebuffer(t.READ_FRAMEBUFFER,null),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),d)for(let e=0;e<s.length;e++){i.bindFramebuffer(t.FRAMEBUFFER,u.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,u.__webglColorRenderbuffer[e]);const r=n.get(s[e]).__webglTexture;i.bindFramebuffer(t.FRAMEBUFFER,u.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,r,0)}i.bindFramebuffer(t.DRAW_FRAMEBUFFER,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=O,this.setupFrameBufferTexture=D,this.useMultisampledRTT=B}function Io(t,e,i){const n=i.isWebGL2;return{convert:function(i,s=""){let r;const o=fe.getTransfer(s);if(i===nt)return t.UNSIGNED_BYTE;if(1017===i)return t.UNSIGNED_SHORT_4_4_4_4;if(1018===i)return t.UNSIGNED_SHORT_5_5_5_1;if(1010===i)return t.BYTE;if(1011===i)return t.SHORT;if(i===st)return t.UNSIGNED_SHORT;if(i===rt)return t.INT;if(i===ot)return t.UNSIGNED_INT;if(i===at)return t.FLOAT;if(i===ht)return n?t.HALF_FLOAT:(r=e.get("OES_texture_half_float"),null!==r?r.HALF_FLOAT_OES:null);if(1021===i)return t.ALPHA;if(i===ct)return t.RGBA;if(1024===i)return t.LUMINANCE;if(1025===i)return t.LUMINANCE_ALPHA;if(i===ut)return t.DEPTH_COMPONENT;if(i===dt)return t.DEPTH_STENCIL;if(i===Ft)return r=e.get("EXT_sRGB"),null!==r?r.SRGB_ALPHA_EXT:null;if(1028===i)return t.RED;if(1029===i)return t.RED_INTEGER;if(1030===i)return t.RG;if(1031===i)return t.RG_INTEGER;if(1033===i)return t.RGBA_INTEGER;if(i===pt||i===mt||i===ft||i===gt)if(o===Lt){if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(i===pt)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===mt)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===ft)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===gt)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=e.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(i===pt)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===mt)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===ft)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===gt)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===i||35841===i||35842===i||35843===i){if(r=e.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(35840===i)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===i)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===i)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===i)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===i)return r=e.get("WEBGL_compressed_texture_etc1"),null!==r?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===i||37496===i){if(r=e.get("WEBGL_compressed_texture_etc"),null===r)return null;if(37492===i)return o===Lt?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(37496===i)return o===Lt?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(37808===i||37809===i||37810===i||37811===i||37812===i||37813===i||37814===i||37815===i||37816===i||37817===i||37818===i||37819===i||37820===i||37821===i){if(r=e.get("WEBGL_compressed_texture_astc"),null===r)return null;if(37808===i)return o===Lt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===i)return o===Lt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===i)return o===Lt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===i)return o===Lt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===i)return o===Lt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===i)return o===Lt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===i)return o===Lt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===i)return o===Lt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===i)return o===Lt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===i)return o===Lt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===i)return o===Lt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===i)return o===Lt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===i)return o===Lt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===i)return o===Lt?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===vt||36494===i||36495===i){if(r=e.get("EXT_texture_compression_bptc"),null===r)return null;if(i===vt)return o===Lt?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===i)return r.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===i)return r.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===i||36284===i||36285===i||36286===i){if(r=e.get("EXT_texture_compression_rgtc"),null===r)return null;if(i===vt)return r.COMPRESSED_RED_RGTC1_EXT;if(36284===i)return r.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===i)return r.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===i)return r.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return i===lt?n?t.UNSIGNED_INT_24_8:(r=e.get("WEBGL_depth_texture"),null!==r?r.UNSIGNED_INT_24_8_WEBGL:null):void 0!==t[i]?t[i]:null}}}class Ro extends Gn{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class Po extends ki{constructor(){super(),this.isGroup=!0,this.type="Group"}}const ko={type:"move"};class Do{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Po,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Po,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Pe,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Pe),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Po,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Pe,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Pe),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const i of t.hand.values())this._getHandJoint(e,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,s=null,r=null;const o=this._targetRay,a=this._grip,h=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(h&&t.hand){r=!0;for(const n of t.hand.values()){const t=e.getJointPose(n,i),s=this._getHandJoint(h,n);null!==t&&(s.matrix.fromArray(t.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,s.jointRadius=t.radius),s.visible=null!==t}const n=h.joints["index-finger-tip"],s=h.joints["thumb-tip"],o=n.position.distanceTo(s.position),a=.02,l=.005;h.inputState.pinching&&o>a+l?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!h.inputState.pinching&&o<=a-l&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(s=e.getPose(t.gripSpace,i),null!==s&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(n=e.getPose(t.targetRaySpace,i),null===n&&null!==s&&(n=s),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(ko)))}return null!==o&&(o.visible=null!==n),null!==a&&(a.visible=null!==s),null!==h&&(h.visible=null!==r),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const i=new Po;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[e.jointName]=i,t.add(i)}return t.joints[e.jointName]}}class Lo extends Vt{constructor(t,e){super();const i=this;let n=null,s=1,r=null,o="local-floor",a=1,h=null,l=null,c=null,u=null,d=null,p=null;const m=e.getContextAttributes();let f=null,g=null;const v=[],y=[],x=new ne;let _=null;const b=new Gn;b.layers.enable(1),b.viewport=new Te;const w=new Gn;w.layers.enable(2),w.viewport=new Te;const M=[b,w],S=new Ro;S.layers.enable(1),S.layers.enable(2);let T=null,E=null;function A(t){const e=y.indexOf(t.inputSource);if(-1===e)return;const i=v[e];void 0!==i&&(i.update(t.inputSource,t.frame,h||r),i.dispatchEvent({type:t.type,data:t.inputSource}))}function C(){n.removeEventListener("select",A),n.removeEventListener("selectstart",A),n.removeEventListener("selectend",A),n.removeEventListener("squeeze",A),n.removeEventListener("squeezestart",A),n.removeEventListener("squeezeend",A),n.removeEventListener("end",C),n.removeEventListener("inputsourceschange",I);for(let t=0;t<v.length;t++){const e=y[t];null!==e&&(y[t]=null,v[t].disconnect(e))}T=null,E=null,t.setRenderTarget(f),d=null,u=null,c=null,n=null,g=null,L.stop(),i.isPresenting=!1,t.setPixelRatio(_),t.setSize(x.width,x.height,!1),i.dispatchEvent({type:"sessionend"})}function I(t){for(let e=0;e<t.removed.length;e++){const i=t.removed[e],n=y.indexOf(i);n>=0&&(y[n]=null,v[n].disconnect(i))}for(let e=0;e<t.added.length;e++){const i=t.added[e];let n=y.indexOf(i);if(-1===n){for(let t=0;t<v.length;t++){if(t>=y.length){y.push(i),n=t;break}if(null===y[t]){y[t]=i,n=t;break}}if(-1===n)break}const s=v[n];s&&s.connect(i)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=v[t];return void 0===e&&(e=new Do,v[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=v[t];return void 0===e&&(e=new Do,v[t]=e),e.getGripSpace()},this.getHand=function(t){let e=v[t];return void 0===e&&(e=new Do,v[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){s=t,i.isPresenting},this.setReferenceSpaceType=function(t){o=t,i.isPresenting},this.getReferenceSpace=function(){return h||r},this.setReferenceSpace=function(t){h=t},this.getBaseLayer=function(){return null!==u?u:d},this.getBinding=function(){return c},this.getFrame=function(){return p},this.getSession=function(){return n},this.setSession=async function(l){if(n=l,null!==n){if(f=t.getRenderTarget(),n.addEventListener("select",A),n.addEventListener("selectstart",A),n.addEventListener("selectend",A),n.addEventListener("squeeze",A),n.addEventListener("squeezestart",A),n.addEventListener("squeezeend",A),n.addEventListener("end",C),n.addEventListener("inputsourceschange",I),!0!==m.xrCompatible&&await e.makeXRCompatible(),_=t.getPixelRatio(),t.getSize(x),void 0===n.renderState.layers||!1===t.capabilities.isWebGL2){const i={antialias:void 0!==n.renderState.layers||m.antialias,alpha:!0,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:s};d=new XRWebGLLayer(n,e,i),n.updateRenderState({baseLayer:d}),t.setPixelRatio(1),t.setSize(d.framebufferWidth,d.framebufferHeight,!1),g=new Ae(d.framebufferWidth,d.framebufferHeight,{format:ct,type:nt,colorSpace:t.outputColorSpace,stencilBuffer:m.stencil})}else{let i=null,r=null,o=null;m.depth&&(o=m.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,i=m.stencil?dt:ut,r=m.stencil?lt:ot);const a={colorFormat:e.RGBA8,depthFormat:o,scaleFactor:s};c=new XRWebGLBinding(n,e),u=c.createProjectionLayer(a),n.updateRenderState({layers:[u]}),t.setPixelRatio(1),t.setSize(u.textureWidth,u.textureHeight,!1),g=new Ae(u.textureWidth,u.textureHeight,{format:ct,type:nt,depthTexture:new zs(u.textureWidth,u.textureHeight,r,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:m.stencil,colorSpace:t.outputColorSpace,samples:m.antialias?4:0});t.properties.get(g).__ignoreDepthValues=u.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(a),h=null,r=await n.requestReferenceSpace(o),L.setContext(n),L.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==n)return n.environmentBlendMode};const R=new Pe,P=new Pe;function k(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===n)return;S.near=w.near=b.near=t.near,S.far=w.far=b.far=t.far,T===S.near&&E===S.far||(n.updateRenderState({depthNear:S.near,depthFar:S.far}),T=S.near,E=S.far);const e=t.parent,i=S.cameras;k(S,e);for(let t=0;t<i.length;t++)k(i[t],e);2===i.length?function(t,e,i){R.setFromMatrixPosition(e.matrixWorld),P.setFromMatrixPosition(i.matrixWorld);const n=R.distanceTo(P),s=e.projectionMatrix.elements,r=i.projectionMatrix.elements,o=s[14]/(s[10]-1),a=s[14]/(s[10]+1),h=(s[9]+1)/s[5],l=(s[9]-1)/s[5],c=(s[8]-1)/s[0],u=(r[8]+1)/r[0],d=o*c,p=o*u,m=n/(-c+u),f=m*-c;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(f),t.translateZ(m),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=o+m,v=a+m,y=d-f,x=p+(n-f),_=h*a/v*g,b=l*a/v*g;t.projectionMatrix.makePerspective(y,x,_,b,g,v),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}(S,b,w):S.projectionMatrix.copy(b.projectionMatrix),function(t,e,i){null===i?t.matrix.copy(e.matrixWorld):(t.matrix.copy(i.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld));t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*$t*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}(t,S,e)},this.getCamera=function(){return S},this.getFoveation=function(){if(null!==u||null!==d)return a},this.setFoveation=function(t){a=t,null!==u&&(u.fixedFoveation=t),null!==d&&void 0!==d.fixedFoveation&&(d.fixedFoveation=t)};let D=null;const L=new Qn;L.setAnimationLoop((function(e,n){if(l=n.getViewerPose(h||r),p=n,null!==l){const e=l.views;null!==d&&(t.setRenderTargetFramebuffer(g,d.framebuffer),t.setRenderTarget(g));let i=!1;e.length!==S.cameras.length&&(S.cameras.length=0,i=!0);for(let n=0;n<e.length;n++){const s=e[n];let r=null;if(null!==d)r=d.getViewport(s);else{const e=c.getViewSubImage(u,s);r=e.viewport,0===n&&(t.setRenderTargetTextures(g,e.colorTexture,u.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(g))}let o=M[n];void 0===o&&(o=new Gn,o.layers.enable(n),o.viewport=new Te,M[n]=o),o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(s.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(r.x,r.y,r.width,r.height),0===n&&(S.matrix.copy(o.matrix),S.matrix.decompose(S.position,S.quaternion,S.scale)),!0===i&&S.cameras.push(o)}}for(let t=0;t<v.length;t++){const e=y[t],i=v[t];null!==e&&void 0!==i&&i.update(e,n,h||r)}D&&D(e,n),n.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:n}),p=null})),this.setAnimationLoop=function(t){D=t},this.dispose=function(){}}}function Oo(t,e){function i(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix)}function n(n,s){n.opacity.value=s.opacity,s.color&&n.diffuse.value.copy(s.color),s.emissive&&n.emissive.value.copy(s.emissive).multiplyScalar(s.emissiveIntensity),s.map&&(n.map.value=s.map,i(s.map,n.mapTransform)),s.alphaMap&&(n.alphaMap.value=s.alphaMap,i(s.alphaMap,n.alphaMapTransform)),s.bumpMap&&(n.bumpMap.value=s.bumpMap,i(s.bumpMap,n.bumpMapTransform),n.bumpScale.value=s.bumpScale,s.side===R&&(n.bumpScale.value*=-1)),s.normalMap&&(n.normalMap.value=s.normalMap,i(s.normalMap,n.normalMapTransform),n.normalScale.value.copy(s.normalScale),s.side===R&&n.normalScale.value.negate()),s.displacementMap&&(n.displacementMap.value=s.displacementMap,i(s.displacementMap,n.displacementMapTransform),n.displacementScale.value=s.displacementScale,n.displacementBias.value=s.displacementBias),s.emissiveMap&&(n.emissiveMap.value=s.emissiveMap,i(s.emissiveMap,n.emissiveMapTransform)),s.specularMap&&(n.specularMap.value=s.specularMap,i(s.specularMap,n.specularMapTransform)),s.alphaTest>0&&(n.alphaTest.value=s.alphaTest);const r=e.get(s).envMap;if(r&&(n.envMap.value=r,n.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,n.reflectivity.value=s.reflectivity,n.ior.value=s.ior,n.refractionRatio.value=s.refractionRatio),s.lightMap){n.lightMap.value=s.lightMap;const e=!0===t._useLegacyLights?Math.PI:1;n.lightMapIntensity.value=s.lightMapIntensity*e,i(s.lightMap,n.lightMapTransform)}s.aoMap&&(n.aoMap.value=s.aoMap,n.aoMapIntensity.value=s.aoMapIntensity,i(s.aoMap,n.aoMapTransform))}return{refreshFogUniforms:function(e,i){i.color.getRGB(e.fogColor.value,Bn(t)),i.isFog?(e.fogNear.value=i.near,e.fogFar.value=i.far):i.isFogExp2&&(e.fogDensity.value=i.density)},refreshMaterialUniforms:function(t,s,r,o,a){s.isMeshBasicMaterial||s.isMeshLambertMaterial?n(t,s):s.isMeshToonMaterial?(n(t,s),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,s)):s.isMeshPhongMaterial?(n(t,s),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,s)):s.isMeshStandardMaterial?(n(t,s),function(t,n){t.metalness.value=n.metalness,n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap,i(n.metalnessMap,t.metalnessMapTransform));t.roughness.value=n.roughness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap,i(n.roughnessMap,t.roughnessMapTransform));const s=e.get(n).envMap;s&&(t.envMapIntensity.value=n.envMapIntensity)}(t,s),s.isMeshPhysicalMaterial&&function(t,e,n){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,i(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,i(e.sheenRoughnessMap,t.sheenRoughnessMapTransform)));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,i(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,i(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,i(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),e.side===R&&t.clearcoatNormalScale.value.negate()));e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,i(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,i(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform)));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,i(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,i(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));e.anisotropy>0&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,i(e.anisotropyMap,t.anisotropyMapTransform)));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,i(e.specularColorMap,t.specularColorMapTransform));e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,i(e.specularIntensityMap,t.specularIntensityMapTransform))}(t,s,a)):s.isMeshMatcapMaterial?(n(t,s),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,s)):s.isMeshDepthMaterial?n(t,s):s.isMeshDistanceMaterial?(n(t,s),function(t,i){const n=e.get(i).light;t.referencePosition.value.setFromMatrixPosition(n.matrixWorld),t.nearDistance.value=n.shadow.camera.near,t.farDistance.value=n.shadow.camera.far}(t,s)):s.isMeshNormalMaterial?n(t,s):s.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,i(e.map,t.mapTransform))}(t,s),s.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,s)):s.isPointsMaterial?function(t,e,n,s){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*s,e.map&&(t.map.value=e.map,i(e.map,t.uvTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,i(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,s,r,o):s.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,i(e.map,t.mapTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,i(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,s):s.isShadowMaterial?(t.color.value.copy(s.color),t.opacity.value=s.opacity):s.isShaderMaterial&&(s.uniformsNeedUpdate=!1)}}}function No(t,e,i,n){let s={},r={},o=[];const a=i.isWebGL2?t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS):0;function h(t,e,i,n){const s=t.value,r=e+"_"+i;if(void 0===n[r])return n[r]="number"==typeof s||"boolean"==typeof s?s:s.clone(),!0;{const t=n[r];if("number"==typeof s||"boolean"==typeof s){if(t!==s)return n[r]=s,!0}else if(!1===t.equals(s))return t.copy(s),!0}return!1}function l(t){const e={boundary:0,storage:0};return"number"==typeof t||"boolean"==typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture,e}function c(e){const i=e.target;i.removeEventListener("dispose",c);const n=o.indexOf(i.__bindingPointIndex);o.splice(n,1),t.deleteBuffer(s[i.id]),delete s[i.id],delete r[i.id]}return{bind:function(t,e){const i=e.program;n.uniformBlockBinding(t,i)},update:function(i,u){let d=s[i.id];void 0===d&&(!function(t){const e=t.uniforms;let i=0;const n=16;for(let t=0,s=e.length;t<s;t++){const s=Array.isArray(e[t])?e[t]:[e[t]];for(let t=0,e=s.length;t<e;t++){const e=s[t],r=Array.isArray(e.value)?e.value:[e.value];for(let t=0,s=r.length;t<s;t++){const s=l(r[t]),o=i%n;0!==o&&n-o<s.boundary&&(i+=n-o),e.__data=new Float32Array(s.storage/Float32Array.BYTES_PER_ELEMENT),e.__offset=i,i+=s.storage}}}const s=i%n;s>0&&(i+=n-s);t.__size=i,t.__cache={}}(i),d=function(e){const i=function(){for(let t=0;t<a;t++)if(-1===o.indexOf(t))return o.push(t),t;return 0}();e.__bindingPointIndex=i;const n=t.createBuffer(),s=e.__size,r=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,n),t.bufferData(t.UNIFORM_BUFFER,s,r),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,i,n),n}(i),s[i.id]=d,i.addEventListener("dispose",c));const p=u.program;n.updateUBOMapping(i,p);const m=e.render.frame;r[i.id]!==m&&(!function(e){const i=s[e.id],n=e.uniforms,r=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,i);for(let e=0,i=n.length;e<i;e++){const i=Array.isArray(n[e])?n[e]:[n[e]];for(let n=0,s=i.length;n<s;n++){const s=i[n];if(!0===h(s,e,n,r)){const e=s.__offset,i=Array.isArray(s.value)?s.value:[s.value];let n=0;for(let r=0;r<i.length;r++){const o=i[r],a=l(o);"number"==typeof o||"boolean"==typeof o?(s.__data[0]=o,t.bufferSubData(t.UNIFORM_BUFFER,e+n,s.__data)):o.isMatrix3?(s.__data[0]=o.elements[0],s.__data[1]=o.elements[1],s.__data[2]=o.elements[2],s.__data[3]=0,s.__data[4]=o.elements[3],s.__data[5]=o.elements[4],s.__data[6]=o.elements[5],s.__data[7]=0,s.__data[8]=o.elements[6],s.__data[9]=o.elements[7],s.__data[10]=o.elements[8],s.__data[11]=0):(o.toArray(s.__data,n),n+=a.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,e,s.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}(i),r[i.id]=m)},dispose:function(){for(const e in s)t.deleteBuffer(s[e]);o=[],s={},r={}}}}class Bo{constructor(t={}){const{canvas:e=he(),context:i=null,depth:n=!0,stencil:s=!0,alpha:r=!1,antialias:o=!1,premultipliedAlpha:a=!0,preserveDrawingBuffer:h=!1,powerPreference:l="default",failIfMajorPerformanceCaveat:c=!1}=t;let u;this.isWebGLRenderer=!0,u=null!==i?i.getContextAttributes().alpha:r;const d=new Uint32Array(4),p=new Int32Array(4);let m=null,f=null;const g=[],v=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=It,this._useLegacyLights=!1,this.toneMapping=O,this.toneMappingExposure=1;const x=this;let _=!1,b=0,w=0,M=null,S=-1,T=null;const E=new Te,A=new Te;let C=null;const P=new Yi(0);let k=0,D=e.width,L=e.height,N=1,B=null,z=null;const U=new Te(0,0,D,L),F=new Te(0,0,D,L);let G=!1;const H=new Jn;let V=!1,j=!1,W=null;const X=new ai,$=new ne,q=new Pe,Y={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function K(){return null===M?N:1}let Z,J,Q,tt,et,rt,ut,dt,pt,mt,ft,gt,vt,yt,xt,_t,bt,wt,Mt,St,Tt,Et,At,Ct,Pt=i;function kt(t,i){for(let n=0;n<t.length;n++){const s=t[n],r=e.getContext(s,i);if(null!==r)return r}return null}try{const t={alpha:!0,depth:n,stencil:s,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:h,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${y}`),e.addEventListener("webglcontextlost",Ot,!1),e.addEventListener("webglcontextrestored",Nt,!1),e.addEventListener("webglcontextcreationerror",Bt,!1),null===Pt){const e=["webgl2","webgl","experimental-webgl"];if(!0===x.isWebGL1Renderer&&e.shift(),Pt=kt(e,t),null===Pt)throw kt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}"undefined"!=typeof WebGLRenderingContext&&WebGLRenderingContext,void 0===Pt.getShaderPrecisionFormat&&(Pt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw t}function Dt(){Z=new Rs(Pt),J=new ls(Pt,Z,t),Z.init(J),Et=new Io(Pt,Z,J),Q=new Ao(Pt,Z,J),tt=new Ds(Pt),et=new po,rt=new Co(Pt,Z,Q,et,J,Et,tt),ut=new us(x),dt=new Is(x),pt=new ts(Pt,J),At=new as(Pt,Z,pt,J),mt=new Ps(Pt,pt,tt,At),ft=new Bs(Pt,mt,pt,tt),Mt=new Ns(Pt,J,rt),_t=new cs(et),gt=new uo(x,ut,dt,Z,J,At,_t),vt=new Oo(x,et),yt=new vo,xt=new Mo(Z,J),wt=new os(x,ut,dt,Q,ft,u,a),bt=new Eo(x,ft,J),Ct=new No(Pt,tt,J,Q),St=new hs(Pt,Z,tt,J),Tt=new ks(Pt,Z,tt,J),tt.programs=gt.programs,x.capabilities=J,x.extensions=Z,x.properties=et,x.renderLists=yt,x.shadowMap=bt,x.state=Q,x.info=tt}Dt();const Lt=new Lo(x,Pt);function Ot(t){t.preventDefault(),_=!0}function Nt(){_=!1;const t=tt.autoReset,e=bt.enabled,i=bt.autoUpdate,n=bt.needsUpdate,s=bt.type;Dt(),tt.autoReset=t,bt.enabled=e,bt.autoUpdate=i,bt.needsUpdate=n,bt.type=s}function Bt(t){}function zt(t){const e=t.target;e.removeEventListener("dispose",zt),function(t){(function(t){const e=et.get(t).programs;void 0!==e&&(e.forEach((function(t){gt.releaseProgram(t)})),t.isShaderMaterial&&gt.releaseShaderCache(t))})(t),et.remove(t)}(e)}function Ut(t,e,i){!0===t.transparent&&2===t.side&&!1===t.forceSinglePass?(t.side=R,t.needsUpdate=!0,qt(t,e,i),t.side=I,t.needsUpdate=!0,qt(t,e,i),t.side=2):qt(t,e,i)}this.xr=Lt,this.getContext=function(){return Pt},this.getContextAttributes=function(){return Pt.getContextAttributes()},this.forceContextLoss=function(){const t=Z.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=Z.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return N},this.setPixelRatio=function(t){void 0!==t&&(N=t,this.setSize(D,L,!1))},this.getSize=function(t){return t.set(D,L)},this.setSize=function(t,i,n=!0){Lt.isPresenting||(D=t,L=i,e.width=Math.floor(t*N),e.height=Math.floor(i*N),!0===n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return t.set(D*N,L*N).floor()},this.setDrawingBufferSize=function(t,i,n){D=t,L=i,N=n,e.width=Math.floor(t*n),e.height=Math.floor(i*n),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return t.copy(E)},this.getViewport=function(t){return t.copy(U)},this.setViewport=function(t,e,i,n){t.isVector4?U.set(t.x,t.y,t.z,t.w):U.set(t,e,i,n),Q.viewport(E.copy(U).multiplyScalar(N).floor())},this.getScissor=function(t){return t.copy(F)},this.setScissor=function(t,e,i,n){t.isVector4?F.set(t.x,t.y,t.z,t.w):F.set(t,e,i,n),Q.scissor(A.copy(F).multiplyScalar(N).floor())},this.getScissorTest=function(){return G},this.setScissorTest=function(t){Q.setScissorTest(G=t)},this.setOpaqueSort=function(t){B=t},this.setTransparentSort=function(t){z=t},this.getClearColor=function(t){return t.copy(wt.getClearColor())},this.setClearColor=function(){wt.setClearColor.apply(wt,arguments)},this.getClearAlpha=function(){return wt.getClearAlpha()},this.setClearAlpha=function(){wt.setClearAlpha.apply(wt,arguments)},this.clear=function(t=!0,e=!0,i=!0){let n=0;if(t){let t=!1;if(null!==M){const e=M.texture.format;t=1033===e||1031===e||1029===e}if(t){const t=M.texture.type,e=t===nt||t===ot||t===st||t===lt||1017===t||1018===t,i=wt.getClearColor(),n=wt.getClearAlpha(),s=i.r,r=i.g,o=i.b;e?(d[0]=s,d[1]=r,d[2]=o,d[3]=n,Pt.clearBufferuiv(Pt.COLOR,0,d)):(p[0]=s,p[1]=r,p[2]=o,p[3]=n,Pt.clearBufferiv(Pt.COLOR,0,p))}else n|=Pt.COLOR_BUFFER_BIT}e&&(n|=Pt.DEPTH_BUFFER_BIT),i&&(n|=Pt.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Pt.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Ot,!1),e.removeEventListener("webglcontextrestored",Nt,!1),e.removeEventListener("webglcontextcreationerror",Bt,!1),yt.dispose(),xt.dispose(),et.dispose(),ut.dispose(),dt.dispose(),ft.dispose(),At.dispose(),Ct.dispose(),gt.dispose(),Lt.dispose(),Lt.removeEventListener("sessionstart",Gt),Lt.removeEventListener("sessionend",Ht),W&&(W.dispose(),W=null),Vt.stop()},this.renderBufferDirect=function(t,e,i,n,s,r){null===e&&(e=Y);const o=s.isMesh&&s.matrixWorld.determinant()<0,a=function(t,e,i,n,s){!0!==e.isScene&&(e=Y);rt.resetTextureUnits();const r=e.fog,o=n.isMeshStandardMaterial?e.environment:null,a=null===M?x.outputColorSpace:!0===M.isXRRenderTarget?M.texture.colorSpace:Rt,h=(n.isMeshStandardMaterial?dt:ut).get(n.envMap||o),l=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,c=!!i.attributes.tangent&&(!!n.normalMap||n.anisotropy>0),u=!!i.morphAttributes.position,d=!!i.morphAttributes.normal,p=!!i.morphAttributes.color;let m=O;n.toneMapped&&(null!==M&&!0!==M.isXRRenderTarget||(m=x.toneMapping));const g=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,v=void 0!==g?g.length:0,y=et.get(n),_=f.state.lights;if(!0===V&&(!0===j||t!==T)){const e=t===T&&n.id===S;_t.setState(n,t,e)}let b=!1;n.version===y.__version?y.needsLights&&y.lightsStateVersion!==_.state.version||y.outputColorSpace!==a||s.isBatchedMesh&&!1===y.batching?b=!0:s.isBatchedMesh||!0!==y.batching?s.isInstancedMesh&&!1===y.instancing?b=!0:s.isInstancedMesh||!0!==y.instancing?s.isSkinnedMesh&&!1===y.skinning?b=!0:s.isSkinnedMesh||!0!==y.skinning?s.isInstancedMesh&&!0===y.instancingColor&&null===s.instanceColor||s.isInstancedMesh&&!1===y.instancingColor&&null!==s.instanceColor||y.envMap!==h||!0===n.fog&&y.fog!==r?b=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===_t.numPlanes&&y.numIntersection===_t.numIntersection?(y.vertexAlphas!==l||y.vertexTangents!==c||y.morphTargets!==u||y.morphNormals!==d||y.morphColors!==p||y.toneMapping!==m||!0===J.isWebGL2&&y.morphTargetsCount!==v)&&(b=!0):b=!0:b=!0:b=!0:b=!0:(b=!0,y.__version=n.version);let w=y.currentProgram;!0===b&&(w=qt(n,e,s));let E=!1,A=!1,C=!1;const I=w.getUniforms(),R=y.uniforms;Q.useProgram(w.program)&&(E=!0,A=!0,C=!0);n.id!==S&&(S=n.id,A=!0);if(E||T!==t){I.setValue(Pt,"projectionMatrix",t.projectionMatrix),I.setValue(Pt,"viewMatrix",t.matrixWorldInverse);const e=I.map.cameraPosition;void 0!==e&&e.setValue(Pt,q.setFromMatrixPosition(t.matrixWorld)),J.logarithmicDepthBuffer&&I.setValue(Pt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&I.setValue(Pt,"isOrthographic",!0===t.isOrthographicCamera),T!==t&&(T=t,A=!0,C=!0)}if(s.isSkinnedMesh){I.setOptional(Pt,s,"bindMatrix"),I.setOptional(Pt,s,"bindMatrixInverse");const t=s.skeleton;t&&J.floatVertexTextures&&(null===t.boneTexture&&t.computeBoneTexture(),I.setValue(Pt,"boneTexture",t.boneTexture,rt))}s.isBatchedMesh&&(I.setOptional(Pt,s,"batchingTexture"),I.setValue(Pt,"batchingTexture",s._matricesTexture,rt));const P=i.morphAttributes;(void 0!==P.position||void 0!==P.normal||void 0!==P.color&&!0===J.isWebGL2)&&Mt.update(s,i,w);(A||y.receiveShadow!==s.receiveShadow)&&(y.receiveShadow=s.receiveShadow,I.setValue(Pt,"receiveShadow",s.receiveShadow));n.isMeshGouraudMaterial&&null!==n.envMap&&(R.envMap.value=h,R.flipEnvMap.value=h.isCubeTexture&&!1===h.isRenderTargetTexture?-1:1);A&&(I.setValue(Pt,"toneMappingExposure",x.toneMappingExposure),y.needsLights&&(D=C,(k=R).ambientLightColor.needsUpdate=D,k.lightProbe.needsUpdate=D,k.directionalLights.needsUpdate=D,k.directionalLightShadows.needsUpdate=D,k.pointLights.needsUpdate=D,k.pointLightShadows.needsUpdate=D,k.spotLights.needsUpdate=D,k.spotLightShadows.needsUpdate=D,k.rectAreaLights.needsUpdate=D,k.hemisphereLights.needsUpdate=D),r&&!0===n.fog&&vt.refreshFogUniforms(R,r),vt.refreshMaterialUniforms(R,n,N,L,W),Vr.upload(Pt,Yt(y),R,rt));var k,D;n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Vr.upload(Pt,Yt(y),R,rt),n.uniformsNeedUpdate=!1);n.isSpriteMaterial&&I.setValue(Pt,"center",s.center);if(I.setValue(Pt,"modelViewMatrix",s.modelViewMatrix),I.setValue(Pt,"normalMatrix",s.normalMatrix),I.setValue(Pt,"modelMatrix",s.matrixWorld),n.isShaderMaterial||n.isRawShaderMaterial){const t=n.uniformsGroups;for(let e=0,i=t.length;e<i;e++)if(J.isWebGL2){const i=t[e];Ct.update(i,w),Ct.bind(i,w)}}return w}(t,e,i,n,s);Q.setMaterial(n,o);let h=i.index,l=1;if(!0===n.wireframe){if(h=mt.getWireframeAttribute(i),void 0===h)return;l=2}const c=i.drawRange,u=i.attributes.position;let d=c.start*l,p=(c.start+c.count)*l;null!==r&&(d=Math.max(d,r.start*l),p=Math.min(p,(r.start+r.count)*l)),null!==h?(d=Math.max(d,0),p=Math.min(p,h.count)):null!=u&&(d=Math.max(d,0),p=Math.min(p,u.count));const m=p-d;if(m<0||m===1/0)return;let g;At.setup(s,n,a,i,h);let v=St;if(null!==h&&(g=pt.get(h),v=Tt,v.setIndex(g)),s.isMesh)!0===n.wireframe?(Q.setLineWidth(n.wireframeLinewidth*K()),v.setMode(Pt.LINES)):v.setMode(Pt.TRIANGLES);else if(s.isLine){let t=n.linewidth;void 0===t&&(t=1),Q.setLineWidth(t*K()),s.isLineSegments?v.setMode(Pt.LINES):s.isLineLoop?v.setMode(Pt.LINE_LOOP):v.setMode(Pt.LINE_STRIP)}else s.isPoints?v.setMode(Pt.POINTS):s.isSprite&&v.setMode(Pt.TRIANGLES);if(s.isBatchedMesh)v.renderMultiDraw(s._multiDrawStarts,s._multiDrawCounts,s._multiDrawCount);else if(s.isInstancedMesh)v.renderInstances(d,m,s.count);else if(i.isInstancedBufferGeometry){const t=void 0!==i._maxInstanceCount?i._maxInstanceCount:1/0,e=Math.min(i.instanceCount,t);v.renderInstances(d,m,e)}else v.render(d,m)},this.compile=function(t,e,i=null){null===i&&(i=t),f=xt.get(i),f.init(),v.push(f),i.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(f.pushLight(t),t.castShadow&&f.pushShadow(t))})),t!==i&&t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(f.pushLight(t),t.castShadow&&f.pushShadow(t))})),f.setupLights(x._useLegacyLights);const n=new Set;return t.traverse((function(t){const e=t.material;if(e)if(Array.isArray(e))for(let s=0;s<e.length;s++){const r=e[s];Ut(r,i,t),n.add(r)}else Ut(e,i,t),n.add(e)})),v.pop(),f=null,n},this.compileAsync=function(t,e,i=null){const n=this.compile(t,e,i);return new Promise((e=>{function i(){n.forEach((function(t){et.get(t).currentProgram.isReady()&&n.delete(t)})),0!==n.size?setTimeout(i,10):e(t)}null!==Z.get("KHR_parallel_shader_compile")?i():setTimeout(i,10)}))};let Ft=null;function Gt(){Vt.stop()}function Ht(){Vt.start()}const Vt=new Qn;function jt(t,e,i,n){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)f.pushLight(t),t.castShadow&&f.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||H.intersectsSprite(t)){n&&q.setFromMatrixPosition(t.matrixWorld).applyMatrix4(X);const e=ft.update(t),s=t.material;s.visible&&m.push(t,e,s,i,q.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||H.intersectsObject(t))){const e=ft.update(t),s=t.material;if(n&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),q.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),q.copy(e.boundingSphere.center)),q.applyMatrix4(t.matrixWorld).applyMatrix4(X)),Array.isArray(s)){const n=e.groups;for(let r=0,o=n.length;r<o;r++){const o=n[r],a=s[o.materialIndex];a&&a.visible&&m.push(t,e,a,i,q.z,o)}}else s.visible&&m.push(t,e,s,i,q.z,null)}const s=t.children;for(let t=0,r=s.length;t<r;t++)jt(s[t],e,i,n)}function Wt(t,e,i,n){const s=t.opaque,r=t.transmissive,o=t.transparent;f.setupLightsView(i),!0===V&&_t.setGlobalState(x.clippingPlanes,i),r.length>0&&function(t,e,i,n){const s=!0===i.isScene?i.overrideMaterial:null;if(null!==s)return;const r=J.isWebGL2;null===W&&(W=new Ae(1,1,{generateMipmaps:!0,type:Z.has("EXT_color_buffer_half_float")?ht:nt,minFilter:it,samples:r?4:0}));x.getDrawingBufferSize($),r?W.setSize($.x,$.y):W.setSize(Qt($.x),Qt($.y));const o=x.getRenderTarget();x.setRenderTarget(W),x.getClearColor(P),k=x.getClearAlpha(),k<1&&x.setClearColor(16777215,.5);x.clear();const a=x.toneMapping;x.toneMapping=O,Xt(t,i,n),rt.updateMultisampleRenderTarget(W),rt.updateRenderTargetMipmap(W);let h=!1;for(let t=0,s=e.length;t<s;t++){const s=e[t],r=s.object,o=s.geometry,a=s.material,l=s.group;if(2===a.side&&r.layers.test(n.layers)){const t=a.side;a.side=R,a.needsUpdate=!0,$t(r,i,n,o,a,l),a.side=t,a.needsUpdate=!0,h=!0}}!0===h&&(rt.updateMultisampleRenderTarget(W),rt.updateRenderTargetMipmap(W));x.setRenderTarget(o),x.setClearColor(P,k),x.toneMapping=a}(s,r,e,i),n&&Q.viewport(E.copy(n)),s.length>0&&Xt(s,e,i),r.length>0&&Xt(r,e,i),o.length>0&&Xt(o,e,i),Q.buffers.depth.setTest(!0),Q.buffers.depth.setMask(!0),Q.buffers.color.setMask(!0),Q.setPolygonOffset(!1)}function Xt(t,e,i){const n=!0===e.isScene?e.overrideMaterial:null;for(let s=0,r=t.length;s<r;s++){const r=t[s],o=r.object,a=r.geometry,h=null===n?r.material:n,l=r.group;o.layers.test(i.layers)&&$t(o,e,i,a,h,l)}}function $t(t,e,i,n,s,r){t.onBeforeRender(x,e,i,n,s,r),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),s.onBeforeRender(x,e,i,n,t,r),!0===s.transparent&&2===s.side&&!1===s.forceSinglePass?(s.side=R,s.needsUpdate=!0,x.renderBufferDirect(i,e,n,s,t,r),s.side=I,s.needsUpdate=!0,x.renderBufferDirect(i,e,n,s,t,r),s.side=2):x.renderBufferDirect(i,e,n,s,t,r),t.onAfterRender(x,e,i,n,s,r)}function qt(t,e,i){!0!==e.isScene&&(e=Y);const n=et.get(t),s=f.state.lights,r=f.state.shadowsArray,o=s.state.version,a=gt.getParameters(t,s.state,r,e,i),h=gt.getProgramCacheKey(a);let l=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?dt:ut).get(t.envMap||n.environment),void 0===l&&(t.addEventListener("dispose",zt),l=new Map,n.programs=l);let c=l.get(h);if(void 0!==c){if(n.currentProgram===c&&n.lightsStateVersion===o)return Kt(t,a),c}else a.uniforms=gt.getUniforms(t),t.onBuild(i,a,x),t.onBeforeCompile(a,x),c=gt.acquireProgram(a,h),l.set(h,c),n.uniforms=a.uniforms;const u=n.uniforms;return(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=_t.uniform),Kt(t,a),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=o,n.needsLights&&(u.ambientLightColor.value=s.state.ambient,u.lightProbe.value=s.state.probe,u.directionalLights.value=s.state.directional,u.directionalLightShadows.value=s.state.directionalShadow,u.spotLights.value=s.state.spot,u.spotLightShadows.value=s.state.spotShadow,u.rectAreaLights.value=s.state.rectArea,u.ltc_1.value=s.state.rectAreaLTC1,u.ltc_2.value=s.state.rectAreaLTC2,u.pointLights.value=s.state.point,u.pointLightShadows.value=s.state.pointShadow,u.hemisphereLights.value=s.state.hemi,u.directionalShadowMap.value=s.state.directionalShadowMap,u.directionalShadowMatrix.value=s.state.directionalShadowMatrix,u.spotShadowMap.value=s.state.spotShadowMap,u.spotLightMatrix.value=s.state.spotLightMatrix,u.spotLightMap.value=s.state.spotLightMap,u.pointShadowMap.value=s.state.pointShadowMap,u.pointShadowMatrix.value=s.state.pointShadowMatrix),n.currentProgram=c,n.uniformsList=null,c}function Yt(t){if(null===t.uniformsList){const e=t.currentProgram.getUniforms();t.uniformsList=Vr.seqWithValue(e.seq,t.uniforms)}return t.uniformsList}function Kt(t,e){const i=et.get(t);i.outputColorSpace=e.outputColorSpace,i.batching=e.batching,i.instancing=e.instancing,i.instancingColor=e.instancingColor,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphColors=e.morphColors,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents,i.toneMapping=e.toneMapping}Vt.setAnimationLoop((function(t){Ft&&Ft(t)})),"undefined"!=typeof self&&Vt.setContext(self),this.setAnimationLoop=function(t){Ft=t,Lt.setAnimationLoop(t),null===t?Vt.stop():Vt.start()},Lt.addEventListener("sessionstart",Gt),Lt.addEventListener("sessionend",Ht),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return;if(!0===_)return;!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===Lt.enabled&&!0===Lt.isPresenting&&(!0===Lt.cameraAutoUpdate&&Lt.updateCamera(e),e=Lt.getCamera()),!0===t.isScene&&t.onBeforeRender(x,t,e,M),f=xt.get(t,v.length),f.init(),v.push(f),X.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),H.setFromProjectionMatrix(X),j=this.localClippingEnabled,V=_t.init(this.clippingPlanes,j),m=yt.get(t,g.length),m.init(),g.push(m),jt(t,e,0,x.sortObjects),m.finish(),!0===x.sortObjects&&m.sort(B,z),this.info.render.frame++,!0===V&&_t.beginShadows();const i=f.state.shadowsArray;if(bt.render(i,t,e),!0===V&&_t.endShadows(),!0===this.info.autoReset&&this.info.reset(),wt.render(m,t),f.setupLights(x._useLegacyLights),e.isArrayCamera){const i=e.cameras;for(let e=0,n=i.length;e<n;e++){const n=i[e];Wt(m,t,n,n.viewport)}}else Wt(m,t,e);null!==M&&(rt.updateMultisampleRenderTarget(M),rt.updateRenderTargetMipmap(M)),!0===t.isScene&&t.onAfterRender(x,t,e),At.resetDefaultState(),S=-1,T=null,v.pop(),f=v.length>0?v[v.length-1]:null,g.pop(),m=g.length>0?g[g.length-1]:null},this.getActiveCubeFace=function(){return b},this.getActiveMipmapLevel=function(){return w},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(t,e,i){et.get(t.texture).__webglTexture=e,et.get(t.depthTexture).__webglTexture=i;const n=et.get(t);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||!0===Z.has("WEBGL_multisampled_render_to_texture")&&(n.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){const i=et.get(t);i.__webglFramebuffer=e,i.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,i=0){M=t,b=e,w=i;let n=!0,s=null,r=!1,o=!1;if(t){const a=et.get(t);void 0!==a.__useDefaultFramebuffer?(Q.bindFramebuffer(Pt.FRAMEBUFFER,null),n=!1):void 0===a.__webglFramebuffer?rt.setupRenderTarget(t):a.__hasExternalTextures&&rt.rebindTextures(t,et.get(t.texture).__webglTexture,et.get(t.depthTexture).__webglTexture);const h=t.texture;(h.isData3DTexture||h.isDataArrayTexture||h.isCompressedArrayTexture)&&(o=!0);const l=et.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(s=Array.isArray(l[e])?l[e][i]:l[e],r=!0):s=J.isWebGL2&&t.samples>0&&!1===rt.useMultisampledRTT(t)?et.get(t).__webglMultisampledFramebuffer:Array.isArray(l)?l[i]:l,E.copy(t.viewport),A.copy(t.scissor),C=t.scissorTest}else E.copy(U).multiplyScalar(N).floor(),A.copy(F).multiplyScalar(N).floor(),C=G;if(Q.bindFramebuffer(Pt.FRAMEBUFFER,s)&&J.drawBuffers&&n&&Q.drawBuffers(t,s),Q.viewport(E),Q.scissor(A),Q.setScissorTest(C),r){const n=et.get(t.texture);Pt.framebufferTexture2D(Pt.FRAMEBUFFER,Pt.COLOR_ATTACHMENT0,Pt.TEXTURE_CUBE_MAP_POSITIVE_X+e,n.__webglTexture,i)}else if(o){const n=et.get(t.texture),s=e||0;Pt.framebufferTextureLayer(Pt.FRAMEBUFFER,Pt.COLOR_ATTACHMENT0,n.__webglTexture,i||0,s)}S=-1},this.readRenderTargetPixels=function(t,e,i,n,s,r,o){if(!t||!t.isWebGLRenderTarget)return;let a=et.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){Q.bindFramebuffer(Pt.FRAMEBUFFER,a);try{const o=t.texture,a=o.format,h=o.type;if(a!==ct&&Et.convert(a)!==Pt.getParameter(Pt.IMPLEMENTATION_COLOR_READ_FORMAT))return;const l=h===ht&&(Z.has("EXT_color_buffer_half_float")||J.isWebGL2&&Z.has("EXT_color_buffer_float"));if(!(h===nt||Et.convert(h)===Pt.getParameter(Pt.IMPLEMENTATION_COLOR_READ_TYPE)||h===at&&(J.isWebGL2||Z.has("OES_texture_float")||Z.has("WEBGL_color_buffer_float"))||l))return;e>=0&&e<=t.width-n&&i>=0&&i<=t.height-s&&Pt.readPixels(e,i,n,s,Et.convert(a),Et.convert(h),r)}finally{const t=null!==M?et.get(M).__webglFramebuffer:null;Q.bindFramebuffer(Pt.FRAMEBUFFER,t)}}},this.copyFramebufferToTexture=function(t,e,i=0){const n=Math.pow(2,-i),s=Math.floor(e.image.width*n),r=Math.floor(e.image.height*n);rt.setTexture2D(e,0),Pt.copyTexSubImage2D(Pt.TEXTURE_2D,i,0,0,t.x,t.y,s,r),Q.unbindTexture()},this.copyTextureToTexture=function(t,e,i,n=0){const s=e.image.width,r=e.image.height,o=Et.convert(i.format),a=Et.convert(i.type);rt.setTexture2D(i,0),Pt.pixelStorei(Pt.UNPACK_FLIP_Y_WEBGL,i.flipY),Pt.pixelStorei(Pt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),Pt.pixelStorei(Pt.UNPACK_ALIGNMENT,i.unpackAlignment),e.isDataTexture?Pt.texSubImage2D(Pt.TEXTURE_2D,n,t.x,t.y,s,r,o,a,e.image.data):e.isCompressedTexture?Pt.compressedTexSubImage2D(Pt.TEXTURE_2D,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):Pt.texSubImage2D(Pt.TEXTURE_2D,n,t.x,t.y,o,a,e.image),0===n&&i.generateMipmaps&&Pt.generateMipmap(Pt.TEXTURE_2D),Q.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i,n,s=0){if(x.isWebGL1Renderer)return;const r=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,a=t.max.z-t.min.z+1,h=Et.convert(n.format),l=Et.convert(n.type);let c;if(n.isData3DTexture)rt.setTexture3D(n,0),c=Pt.TEXTURE_3D;else{if(!n.isDataArrayTexture&&!n.isCompressedArrayTexture)return;rt.setTexture2DArray(n,0),c=Pt.TEXTURE_2D_ARRAY}Pt.pixelStorei(Pt.UNPACK_FLIP_Y_WEBGL,n.flipY),Pt.pixelStorei(Pt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),Pt.pixelStorei(Pt.UNPACK_ALIGNMENT,n.unpackAlignment);const u=Pt.getParameter(Pt.UNPACK_ROW_LENGTH),d=Pt.getParameter(Pt.UNPACK_IMAGE_HEIGHT),p=Pt.getParameter(Pt.UNPACK_SKIP_PIXELS),m=Pt.getParameter(Pt.UNPACK_SKIP_ROWS),f=Pt.getParameter(Pt.UNPACK_SKIP_IMAGES),g=i.isCompressedTexture?i.mipmaps[s]:i.image;Pt.pixelStorei(Pt.UNPACK_ROW_LENGTH,g.width),Pt.pixelStorei(Pt.UNPACK_IMAGE_HEIGHT,g.height),Pt.pixelStorei(Pt.UNPACK_SKIP_PIXELS,t.min.x),Pt.pixelStorei(Pt.UNPACK_SKIP_ROWS,t.min.y),Pt.pixelStorei(Pt.UNPACK_SKIP_IMAGES,t.min.z),i.isDataTexture||i.isData3DTexture?Pt.texSubImage3D(c,s,e.x,e.y,e.z,r,o,a,h,l,g.data):i.isCompressedArrayTexture?Pt.compressedTexSubImage3D(c,s,e.x,e.y,e.z,r,o,a,h,g.data):Pt.texSubImage3D(c,s,e.x,e.y,e.z,r,o,a,h,l,g),Pt.pixelStorei(Pt.UNPACK_ROW_LENGTH,u),Pt.pixelStorei(Pt.UNPACK_IMAGE_HEIGHT,d),Pt.pixelStorei(Pt.UNPACK_SKIP_PIXELS,p),Pt.pixelStorei(Pt.UNPACK_SKIP_ROWS,m),Pt.pixelStorei(Pt.UNPACK_SKIP_IMAGES,f),0===s&&n.generateMipmaps&&Pt.generateMipmap(c),Q.unbindTexture()},this.initTexture=function(t){t.isCubeTexture?rt.setTextureCube(t,0):t.isData3DTexture?rt.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?rt.setTexture2DArray(t,0):rt.setTexture2D(t,0),Q.unbindTexture()},this.resetState=function(){b=0,w=0,M=null,Q.reset(),At.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Gt}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorSpace=t===Pt?"display-p3":"srgb",e.unpackColorSpace=fe.workingColorSpace===kt?"display-p3":"srgb"}get outputEncoding(){return this.outputColorSpace===It?At:3e3}set outputEncoding(t){this.outputColorSpace=t===At?It:Rt}get useLegacyLights(){return this._useLegacyLights}set useLegacyLights(t){this._useLegacyLights=t}}(class extends Bo{}).prototype.isWebGL1Renderer=!0;class zo extends ki{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e}}class Uo{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=zt,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=qt()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,s=this.stride;n<s;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=qt()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=qt()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Fo=new Pe;class Go{constructor(t,e,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)Fo.fromBufferAttribute(this,e),Fo.applyMatrix4(t),this.setXYZ(e,Fo.x,Fo.y,Fo.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Fo.fromBufferAttribute(this,e),Fo.applyNormalMatrix(t),this.setXYZ(e,Fo.x,Fo.y,Fo.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Fo.fromBufferAttribute(this,e),Fo.transformDirection(t),this.setXYZ(e,Fo.x,Fo.y,Fo.z);return this}setX(t,e){return this.normalized&&(e=ee(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=ee(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=ee(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=ee(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=te(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=te(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=te(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=te(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=ee(e,this.array),i=ee(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=ee(e,this.array),i=ee(i,this.array),n=ee(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=ee(e,this.array),i=ee(i,this.array),n=ee(n,this.array),s=ee(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=s,this}clone(t){if(void 0===t){const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new nn(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Go(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class Ho extends Ji{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Yi(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let Vo;const jo=new Pe,Wo=new Pe,Xo=new Pe,$o=new ne,qo=new ne,Yo=new ai,Ko=new Pe,Zo=new Pe,Jo=new Pe,Qo=new ne,ta=new ne,ea=new ne;class ia extends ki{constructor(t=new Ho){if(super(),this.isSprite=!0,this.type="Sprite",void 0===Vo){Vo=new mn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new Uo(t,5);Vo.setIndex([0,1,2,0,2,3]),Vo.setAttribute("position",new Go(e,3,0,!1)),Vo.setAttribute("uv",new Go(e,2,3,!1))}this.geometry=Vo,this.material=t,this.center=new ne(.5,.5)}raycast(t,e){t.camera,Wo.setFromMatrixScale(this.matrixWorld),Yo.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Xo.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Wo.multiplyScalar(-Xo.z);const i=this.material.rotation;let n,s;0!==i&&(s=Math.cos(i),n=Math.sin(i));const r=this.center;na(Ko.set(-.5,-.5,0),Xo,r,Wo,n,s),na(Zo.set(.5,-.5,0),Xo,r,Wo,n,s),na(Jo.set(.5,.5,0),Xo,r,Wo,n,s),Qo.set(0,0),ta.set(1,0),ea.set(1,1);let o=t.ray.intersectTriangle(Ko,Zo,Jo,!1,jo);if(null===o&&(na(Zo.set(-.5,.5,0),Xo,r,Wo,n,s),ta.set(0,1),o=t.ray.intersectTriangle(Ko,Jo,Zo,!1,jo),null===o))return;const a=t.ray.origin.distanceTo(jo);a<t.near||a>t.far||e.push({distance:a,point:jo.clone(),uv:ji.getInterpolation(jo,Ko,Zo,Jo,Qo,ta,ea,new ne),face:null,object:this})}copy(t,e){return super.copy(t,e),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function na(t,e,i,n,s,r){$o.subVectors(t,i).addScalar(.5).multiply(n),void 0!==s?(qo.x=r*$o.x-s*$o.y,qo.y=s*$o.x+r*$o.y):qo.copy($o),t.copy(e),t.x+=qo.x,t.y+=qo.y,t.applyMatrix4(Yo)}const sa=new Pe,ra=new Te,oa=new Te,aa=new Pe,ha=new ai,la=new Pe,ca=new Je,ua=new ai,da=new oi;class pa extends kn{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=H,this.bindMatrix=new ai,this.bindMatrixInverse=new ai,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;null===this.boundingBox&&(this.boundingBox=new Le),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,la),this.boundingBox.expandByPoint(la)}computeBoundingSphere(){const t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new Je),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,la),this.boundingSphere.expandByPoint(la)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const i=this.material,n=this.matrixWorld;void 0!==i&&(null===this.boundingSphere&&this.computeBoundingSphere(),ca.copy(this.boundingSphere),ca.applyMatrix4(n),!1!==t.ray.intersectsSphere(ca)&&(ua.copy(n).invert(),da.copy(t.ray).applyMatrix4(ua),null!==this.boundingBox&&!1===da.intersectsBox(this.boundingBox)||this._computeIntersections(t,e,da)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Te,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.fromBufferAttribute(e,i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===H?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode&&this.bindMatrixInverse.copy(this.bindMatrix).invert()}applyBoneTransform(t,e){const i=this.skeleton,n=this.geometry;ra.fromBufferAttribute(n.attributes.skinIndex,t),oa.fromBufferAttribute(n.attributes.skinWeight,t),sa.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const n=oa.getComponent(t);if(0!==n){const s=ra.getComponent(t);ha.multiplyMatrices(i.bones[s].matrixWorld,i.boneInverses[s]),e.addScaledVector(aa.copy(sa).applyMatrix4(ha),n)}}return e.applyMatrix4(this.bindMatrixInverse)}boneTransform(t,e){return this.applyBoneTransform(t,e)}}class ma extends ki{constructor(){super(),this.isBone=!0,this.type="Bone"}}class fa extends Se{constructor(t=null,e=1,i=1,n,s,r,o,a,h=1003,l=1003,c,u){super(null,r,o,a,h,l,n,s,c,u),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const ga=new ai,va=new ai;class ya{constructor(t=[],e=[]){this.uuid=qt(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new ai)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new ai;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,s=t.length;n<s;n++){const s=t[n]?t[n].matrixWorld:va;ga.multiplyMatrices(s,e[n]),ga.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new ya(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new fa(e,t,t,ct,at);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,n=t.bones.length;i<n;i++){let n=e[t.bones[i]];void 0===n&&(n=new ma),this.bones.push(n),this.boneInverses.push((new ai).fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let n=0,s=e.length;n<s;n++){const s=e[n];t.bones.push(s.uuid);const r=i[n];t.boneInverses.push(r.toArray())}return t}}class xa extends nn{constructor(t,e,i,n=1){super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const _a=new ai,ba=new ai,wa=[],Ma=new Le,Sa=new ai,Ta=new kn,Ea=new Je;class Aa extends kn{constructor(t,e,i){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new xa(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let t=0;t<i;t++)this.setMatrixAt(t,Sa)}computeBoundingBox(){const t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new Le),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,_a),Ma.copy(t.boundingBox).applyMatrix4(_a),this.boundingBox.union(Ma)}computeBoundingSphere(){const t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new Je),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,_a),Ea.copy(t.boundingSphere).applyMatrix4(_a),this.boundingSphere.union(Ea)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const i=this.matrixWorld,n=this.count;if(Ta.geometry=this.geometry,Ta.material=this.material,void 0!==Ta.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Ea.copy(this.boundingSphere),Ea.applyMatrix4(i),!1!==t.ray.intersectsSphere(Ea)))for(let s=0;s<n;s++){this.getMatrixAt(s,_a),ba.multiplyMatrices(i,_a),Ta.matrixWorld=ba,Ta.raycast(t,wa);for(let t=0,i=wa.length;t<i;t++){const i=wa[t];i.instanceId=s,i.object=this,e.push(i)}wa.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new xa(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Ca extends Ji{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Yi(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const Ia=new Pe,Ra=new Pe,Pa=new ai,ka=new oi,Da=new Je;class La extends ki{constructor(t=new mn,e=new Ca){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)Ia.fromBufferAttribute(e,t-1),Ra.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=Ia.distanceTo(Ra);t.setAttribute("lineDistance",new on(i,1))}return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,s=t.params.Line.threshold,r=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Da.copy(i.boundingSphere),Da.applyMatrix4(n),Da.radius+=s,!1===t.ray.intersectsSphere(Da))return;Pa.copy(n).invert(),ka.copy(t.ray).applyMatrix4(Pa);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,h=new Pe,l=new Pe,c=new Pe,u=new Pe,d=this.isLineSegments?2:1,p=i.index,m=i.attributes.position;if(null!==p){for(let i=Math.max(0,r.start),n=Math.min(p.count,r.start+r.count)-1;i<n;i+=d){const n=p.getX(i),s=p.getX(i+1);h.fromBufferAttribute(m,n),l.fromBufferAttribute(m,s);if(ka.distanceSqToSegment(h,l,u,c)>a)continue;u.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(u);r<t.near||r>t.far||e.push({distance:r,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,r.start),n=Math.min(m.count,r.start+r.count)-1;i<n;i+=d){h.fromBufferAttribute(m,i),l.fromBufferAttribute(m,i+1);if(ka.distanceSqToSegment(h,l,u,c)>a)continue;u.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(u);n<t.near||n>t.far||e.push({distance:n,point:c.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}const Oa=new Pe,Na=new Pe;class Ba extends La{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)Oa.fromBufferAttribute(e,t),Na.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+Oa.distanceTo(Na);t.setAttribute("lineDistance",new on(i,1))}return this}}class za extends La{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class Ua extends Ji{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Yi(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const Fa=new ai,Ga=new oi,Ha=new Je,Va=new Pe;class ja extends ki{constructor(t=new mn,e=new Ua){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,s=t.params.Points.threshold,r=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Ha.copy(i.boundingSphere),Ha.applyMatrix4(n),Ha.radius+=s,!1===t.ray.intersectsSphere(Ha))return;Fa.copy(n).invert(),Ga.copy(t.ray).applyMatrix4(Fa);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,h=i.index,l=i.attributes.position;if(null!==h){for(let i=Math.max(0,r.start),s=Math.min(h.count,r.start+r.count);i<s;i++){const s=h.getX(i);Va.fromBufferAttribute(l,s),Wa(Va,s,a,n,t,e,this)}}else{for(let i=Math.max(0,r.start),s=Math.min(l.count,r.start+r.count);i<s;i++)Va.fromBufferAttribute(l,i),Wa(Va,i,a,n,t,e,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function Wa(t,e,i,n,s,r,o){const a=Ga.distanceSqToPoint(t);if(a<i){const i=new Pe;Ga.closestPointToPoint(t,i),i.applyMatrix4(n);const h=s.ray.origin.distanceTo(i);if(h<s.near||h>s.far)return;r.push({distance:h,distanceToRay:Math.sqrt(a),point:i,index:e,face:null,object:o})}}class Xa extends Se{constructor(t,e,i,n,s,r,o,a,h){super(t,e,i,n,s,r,o,a,h),this.isCanvasTexture=!0,this.needsUpdate=!0}}class $a{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),s=0;e.push(0);for(let r=1;r<=t;r++)i=this.getPoint(r/t),s+=i.distanceTo(n),e.push(s),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const s=i.length;let r;r=e||t*i[s-1];let o,a=0,h=s-1;for(;a<=h;)if(n=Math.floor(a+(h-a)/2),o=i[n]-r,o<0)a=n+1;else{if(!(o>0)){h=n;break}h=n-1}if(n=h,i[n]===r)return n/(s-1);const l=i[n];return(n+(r-l)/(i[n+1]-l))/(s-1)}getTangent(t,e){const i=1e-4;let n=t-i,s=t+i;n<0&&(n=0),s>1&&(s=1);const r=this.getPoint(n),o=this.getPoint(s),a=e||(r.isVector2?new ne:new Pe);return a.copy(o).sub(r).normalize(),a}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new Pe,n=[],s=[],r=[],o=new Pe,a=new ai;for(let e=0;e<=t;e++){const i=e/t;n[e]=this.getTangentAt(i,new Pe)}s[0]=new Pe,r[0]=new Pe;let h=Number.MAX_VALUE;const l=Math.abs(n[0].x),c=Math.abs(n[0].y),u=Math.abs(n[0].z);l<=h&&(h=l,i.set(1,0,0)),c<=h&&(h=c,i.set(0,1,0)),u<=h&&i.set(0,0,1),o.crossVectors(n[0],i).normalize(),s[0].crossVectors(n[0],o),r[0].crossVectors(n[0],s[0]);for(let e=1;e<=t;e++){if(s[e]=s[e-1].clone(),r[e]=r[e-1].clone(),o.crossVectors(n[e-1],n[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(Yt(n[e-1].dot(n[e]),-1,1));s[e].applyMatrix4(a.makeRotationAxis(o,t))}r[e].crossVectors(n[e],s[e])}if(!0===e){let e=Math.acos(Yt(s[0].dot(s[t]),-1,1));e/=t,n[0].dot(o.crossVectors(s[0],s[t]))>0&&(e=-e);for(let i=1;i<=t;i++)s[i].applyMatrix4(a.makeRotationAxis(n[i],e*i)),r[i].crossVectors(n[i],s[i])}return{tangents:n,normals:s,binormals:r}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class qa extends mn{constructor(t=1,e=32,i=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},e=Math.max(3,e);const s=[],r=[],o=[],a=[],h=new Pe,l=new ne;r.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let s=0,c=3;s<=e;s++,c+=3){const u=i+s/e*n;h.x=t*Math.cos(u),h.y=t*Math.sin(u),r.push(h.x,h.y,h.z),o.push(0,0,1),l.x=(r[c]/t+1)/2,l.y=(r[c+1]/t+1)/2,a.push(l.x,l.y)}for(let t=1;t<=e;t++)s.push(t,t+1,0);this.setIndex(s),this.setAttribute("position",new on(r,3)),this.setAttribute("normal",new on(o,3)),this.setAttribute("uv",new on(a,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new qa(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class Ya extends mn{constructor(t=1,e=1,i=1,n=32,s=1,r=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:s,openEnded:r,thetaStart:o,thetaLength:a};const h=this;n=Math.floor(n),s=Math.floor(s);const l=[],c=[],u=[],d=[];let p=0;const m=[],f=i/2;let g=0;function v(i){const s=p,r=new ne,m=new Pe;let v=0;const y=!0===i?t:e,x=!0===i?1:-1;for(let t=1;t<=n;t++)c.push(0,f*x,0),u.push(0,x,0),d.push(.5,.5),p++;const _=p;for(let t=0;t<=n;t++){const e=t/n*a+o,i=Math.cos(e),s=Math.sin(e);m.x=y*s,m.y=f*x,m.z=y*i,c.push(m.x,m.y,m.z),u.push(0,x,0),r.x=.5*i+.5,r.y=.5*s*x+.5,d.push(r.x,r.y),p++}for(let t=0;t<n;t++){const e=s+t,n=_+t;!0===i?l.push(n,n+1,e):l.push(n+1,n,e),v+=3}h.addGroup(g,v,!0===i?1:2),g+=v}!function(){const r=new Pe,v=new Pe;let y=0;const x=(e-t)/i;for(let h=0;h<=s;h++){const l=[],g=h/s,y=g*(e-t)+t;for(let t=0;t<=n;t++){const e=t/n,s=e*a+o,h=Math.sin(s),m=Math.cos(s);v.x=y*h,v.y=-g*i+f,v.z=y*m,c.push(v.x,v.y,v.z),r.set(h,x,m).normalize(),u.push(r.x,r.y,r.z),d.push(e,1-g),l.push(p++)}m.push(l)}for(let t=0;t<n;t++)for(let e=0;e<s;e++){const i=m[e][t],n=m[e+1][t],s=m[e+1][t+1],r=m[e][t+1];l.push(i,n,r),l.push(n,s,r),y+=6}h.addGroup(g,y,0),g+=y}(),!1===r&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(l),this.setAttribute("position",new on(c,3)),this.setAttribute("normal",new on(u,3)),this.setAttribute("uv",new on(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ya(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Ka extends mn{constructor(t=[],e=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n};const s=[],r=[];function o(t,e,i,n){const s=n+1,r=[];for(let n=0;n<=s;n++){r[n]=[];const o=t.clone().lerp(i,n/s),a=e.clone().lerp(i,n/s),h=s-n;for(let t=0;t<=h;t++)r[n][t]=0===t&&n===s?o:o.clone().lerp(a,t/h)}for(let t=0;t<s;t++)for(let e=0;e<2*(s-t)-1;e++){const i=Math.floor(e/2);e%2==0?(a(r[t][i+1]),a(r[t+1][i]),a(r[t][i])):(a(r[t][i+1]),a(r[t+1][i+1]),a(r[t+1][i]))}}function a(t){s.push(t.x,t.y,t.z)}function h(e,i){const n=3*e;i.x=t[n+0],i.y=t[n+1],i.z=t[n+2]}function l(t,e,i,n){n<0&&1===t.x&&(r[e]=t.x-1),0===i.x&&0===i.z&&(r[e]=n/2/Math.PI+.5)}function c(t){return Math.atan2(t.z,-t.x)}!function(t){const i=new Pe,n=new Pe,s=new Pe;for(let r=0;r<e.length;r+=3)h(e[r+0],i),h(e[r+1],n),h(e[r+2],s),o(i,n,s,t)}(n),function(t){const e=new Pe;for(let i=0;i<s.length;i+=3)e.x=s[i+0],e.y=s[i+1],e.z=s[i+2],e.normalize().multiplyScalar(t),s[i+0]=e.x,s[i+1]=e.y,s[i+2]=e.z}(i),function(){const t=new Pe;for(let i=0;i<s.length;i+=3){t.x=s[i+0],t.y=s[i+1],t.z=s[i+2];const n=c(t)/2/Math.PI+.5,o=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);r.push(n,1-o)}var e;(function(){const t=new Pe,e=new Pe,i=new Pe,n=new Pe,o=new ne,a=new ne,h=new ne;for(let u=0,d=0;u<s.length;u+=9,d+=6){t.set(s[u+0],s[u+1],s[u+2]),e.set(s[u+3],s[u+4],s[u+5]),i.set(s[u+6],s[u+7],s[u+8]),o.set(r[d+0],r[d+1]),a.set(r[d+2],r[d+3]),h.set(r[d+4],r[d+5]),n.copy(t).add(e).add(i).divideScalar(3);const p=c(n);l(o,d+0,t,p),l(a,d+2,e,p),l(h,d+4,i,p)}})(),function(){for(let t=0;t<r.length;t+=6){const e=r[t+0],i=r[t+2],n=r[t+4],s=Math.max(e,i,n),o=Math.min(e,i,n);s>.9&&o<.1&&(e<.2&&(r[t+0]+=1),i<.2&&(r[t+2]+=1),n<.2&&(r[t+4]+=1))}}()}(),this.setAttribute("position",new on(s,3)),this.setAttribute("normal",new on(s.slice(),3)),this.setAttribute("uv",new on(r,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ka(t.vertices,t.indices,t.radius,t.details)}}const Za=function(t,e,i=2){const n=e&&e.length,s=n?e[0]*i:t.length;let r=Ja(t,0,s,i,!0);const o=[];if(!r||r.next===r.prev)return o;let a,h,l,c,u,d,p;if(n&&(r=function(t,e,i,n){const s=[];let r,o,a,h,l;for(r=0,o=e.length;r<o;r++)a=e[r]*n,h=r<o-1?e[r+1]*n:t.length,l=Ja(t,a,h,n,!1),l===l.next&&(l.steiner=!0),s.push(lh(l));for(s.sort(rh),r=0;r<s.length;r++)i=oh(s[r],i);return i}(t,e,r,i)),t.length>80*i){a=l=t[0],h=c=t[1];for(let e=i;e<s;e+=i)u=t[e],d=t[e+1],u<a&&(a=u),d<h&&(h=d),u>l&&(l=u),d>c&&(c=d);p=Math.max(l-a,c-h),p=0!==p?32767/p:0}return th(r,o,i,a,h,p,0),o};function Ja(t,e,i,n,s){let r,o;if(s===function(t,e,i,n){let s=0;for(let r=e,o=i-n;r<i;r+=n)s+=(t[o]-t[r])*(t[r+1]+t[o+1]),o=r;return s}(t,e,i,n)>0)for(r=e;r<i;r+=n)o=xh(r,t[r],t[r+1],o);else for(r=i-n;r>=e;r-=n)o=xh(r,t[r],t[r+1],o);return o&&ph(o,o.next)&&(_h(o),o=o.next),o}function Qa(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!ph(n,n.next)&&0!==dh(n.prev,n,n.next))n=n.next;else{if(_h(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function th(t,e,i,n,s,r,o){if(!t)return;!o&&r&&function(t,e,i,n){let s=t;do{0===s.z&&(s.z=hh(s.x,s.y,e,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,function(t){let e,i,n,s,r,o,a,h,l=1;do{for(i=t,t=null,r=null,o=0;i;){for(o++,n=i,a=0,e=0;e<l&&(a++,n=n.nextZ,n);e++);for(h=l;a>0||h>0&&n;)0!==a&&(0===h||!n||i.z<=n.z)?(s=i,i=i.nextZ,a--):(s=n,n=n.nextZ,h--),r?r.nextZ=s:t=s,s.prevZ=r,r=s;i=n}r.nextZ=null,l*=2}while(o>1)}(s)}(t,n,s,r);let a,h,l=t;for(;t.prev!==t.next;)if(a=t.prev,h=t.next,r?ih(t,n,s,r):eh(t))e.push(a.i/i|0),e.push(t.i/i|0),e.push(h.i/i|0),_h(t),t=h.next,l=h.next;else if((t=h)===l){o?1===o?th(t=nh(Qa(t),e,i),e,i,n,s,r,2):2===o&&sh(t,e,i,n,s,r):th(Qa(t),e,i,n,s,r,1);break}}function eh(t){const e=t.prev,i=t,n=t.next;if(dh(e,i,n)>=0)return!1;const s=e.x,r=i.x,o=n.x,a=e.y,h=i.y,l=n.y,c=s<r?s<o?s:o:r<o?r:o,u=a<h?a<l?a:l:h<l?h:l,d=s>r?s>o?s:o:r>o?r:o,p=a>h?a>l?a:l:h>l?h:l;let m=n.next;for(;m!==e;){if(m.x>=c&&m.x<=d&&m.y>=u&&m.y<=p&&ch(s,a,r,h,o,l,m.x,m.y)&&dh(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function ih(t,e,i,n){const s=t.prev,r=t,o=t.next;if(dh(s,r,o)>=0)return!1;const a=s.x,h=r.x,l=o.x,c=s.y,u=r.y,d=o.y,p=a<h?a<l?a:l:h<l?h:l,m=c<u?c<d?c:d:u<d?u:d,f=a>h?a>l?a:l:h>l?h:l,g=c>u?c>d?c:d:u>d?u:d,v=hh(p,m,e,i,n),y=hh(f,g,e,i,n);let x=t.prevZ,_=t.nextZ;for(;x&&x.z>=v&&_&&_.z<=y;){if(x.x>=p&&x.x<=f&&x.y>=m&&x.y<=g&&x!==s&&x!==o&&ch(a,c,h,u,l,d,x.x,x.y)&&dh(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,_.x>=p&&_.x<=f&&_.y>=m&&_.y<=g&&_!==s&&_!==o&&ch(a,c,h,u,l,d,_.x,_.y)&&dh(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;x&&x.z>=v;){if(x.x>=p&&x.x<=f&&x.y>=m&&x.y<=g&&x!==s&&x!==o&&ch(a,c,h,u,l,d,x.x,x.y)&&dh(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;_&&_.z<=y;){if(_.x>=p&&_.x<=f&&_.y>=m&&_.y<=g&&_!==s&&_!==o&&ch(a,c,h,u,l,d,_.x,_.y)&&dh(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function nh(t,e,i){let n=t;do{const s=n.prev,r=n.next.next;!ph(s,r)&&mh(s,n,n.next,r)&&vh(s,r)&&vh(r,s)&&(e.push(s.i/i|0),e.push(n.i/i|0),e.push(r.i/i|0),_h(n),_h(n.next),n=t=r),n=n.next}while(n!==t);return Qa(n)}function sh(t,e,i,n,s,r){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&uh(o,t)){let a=yh(o,t);return o=Qa(o,o.next),a=Qa(a,a.next),th(o,e,i,n,s,r,0),void th(a,e,i,n,s,r,0)}t=t.next}o=o.next}while(o!==t)}function rh(t,e){return t.x-e.x}function oh(t,e){const i=function(t,e){let i,n=e,s=-1/0;const r=t.x,o=t.y;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){const t=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>s&&(s=t,i=n.x<n.next.x?n:n.next,t===r))return i}n=n.next}while(n!==e);if(!i)return null;const a=i,h=i.x,l=i.y;let c,u=1/0;n=i;do{r>=n.x&&n.x>=h&&r!==n.x&&ch(o<l?r:s,o,h,l,o<l?s:r,o,n.x,n.y)&&(c=Math.abs(o-n.y)/(r-n.x),vh(n,t)&&(c<u||c===u&&(n.x>i.x||n.x===i.x&&ah(i,n)))&&(i=n,u=c)),n=n.next}while(n!==a);return i}(t,e);if(!i)return e;const n=yh(i,t);return Qa(n,n.next),Qa(i,i.next)}function ah(t,e){return dh(t.prev,t,e.prev)<0&&dh(e.next,t,t.next)<0}function hh(t,e,i,n,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function lh(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function ch(t,e,i,n,s,r,o,a){return(s-o)*(e-a)>=(t-o)*(r-a)&&(t-o)*(n-a)>=(i-o)*(e-a)&&(i-o)*(r-a)>=(s-o)*(n-a)}function uh(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&mh(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(vh(t,e)&&vh(e,t)&&function(t,e){let i=t,n=!1;const s=(t.x+e.x)/2,r=(t.y+e.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&s<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(dh(t.prev,t,e.prev)||dh(t,e.prev,e))||ph(t,e)&&dh(t.prev,t,t.next)>0&&dh(e.prev,e,e.next)>0)}function dh(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function ph(t,e){return t.x===e.x&&t.y===e.y}function mh(t,e,i,n){const s=gh(dh(t,e,i)),r=gh(dh(t,e,n)),o=gh(dh(i,n,t)),a=gh(dh(i,n,e));return s!==r&&o!==a||(!(0!==s||!fh(t,i,e))||(!(0!==r||!fh(t,n,e))||(!(0!==o||!fh(i,t,n))||!(0!==a||!fh(i,e,n)))))}function fh(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function gh(t){return t>0?1:t<0?-1:0}function vh(t,e){return dh(t.prev,t,t.next)<0?dh(t,e,t.next)>=0&&dh(t,t.prev,e)>=0:dh(t,e,t.prev)<0||dh(t,t.next,e)<0}function yh(t,e){const i=new bh(t.i,t.x,t.y),n=new bh(e.i,e.x,e.y),s=t.next,r=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function xh(t,e,i,n){const s=new bh(t,e,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function _h(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function bh(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class wh{static area(t){const e=t.length;let i=0;for(let n=e-1,s=0;s<e;n=s++)i+=t[n].x*t[s].y-t[s].x*t[n].y;return.5*i}static isClockWise(t){return wh.area(t)<0}static triangulateShape(t,e){const i=[],n=[],s=[];Mh(t),Sh(i,t);let r=t.length;e.forEach(Mh);for(let t=0;t<e.length;t++)n.push(r),r+=e[t].length,Sh(i,e[t]);const o=Za(i,n);for(let t=0;t<o.length;t+=3)s.push(o.slice(t,t+3));return s}}function Mh(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Sh(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class Th extends Ka{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Th(t.radius,t.detail)}}class Eh extends mn{constructor(t=1,e=.4,i=12,n=48,s=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:s},i=Math.floor(i),n=Math.floor(n);const r=[],o=[],a=[],h=[],l=new Pe,c=new Pe,u=new Pe;for(let r=0;r<=i;r++)for(let d=0;d<=n;d++){const p=d/n*s,m=r/i*Math.PI*2;c.x=(t+e*Math.cos(m))*Math.cos(p),c.y=(t+e*Math.cos(m))*Math.sin(p),c.z=e*Math.sin(m),o.push(c.x,c.y,c.z),l.x=t*Math.cos(p),l.y=t*Math.sin(p),u.subVectors(c,l).normalize(),a.push(u.x,u.y,u.z),h.push(d/n),h.push(r/i)}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*t+e-1,s=(n+1)*(t-1)+e-1,o=(n+1)*(t-1)+e,a=(n+1)*t+e;r.push(i,s,a),r.push(s,o,a)}this.setIndex(r),this.setAttribute("position",new on(o,3)),this.setAttribute("normal",new on(a,3)),this.setAttribute("uv",new on(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Eh(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Ah extends Ji{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Yi(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Ch extends Ah{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ne(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Yt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Yi(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Yi(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Yi(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class Ih extends Ji{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Yi(16777215),this.specular=new Yi(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=k,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Rh extends Ji{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Yi(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class Ph extends Ji{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Yi(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Yi(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ne(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=k,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}function kh(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function Dh(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Lh(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort((function(e,i){return t[e]-t[i]})),i}function Oh(t,e,i){const n=t.length,s=new t.constructor(n);for(let r=0,o=0;o!==n;++r){const n=i[r]*e;for(let i=0;i!==e;++i)s[o++]=t[n+i]}return s}function Nh(t,e,i,n){let s=1,r=t[0];for(;void 0!==r&&void 0===r[n];)r=t[s++];if(void 0===r)return;let o=r[n];if(void 0!==o)if(Array.isArray(o))do{o=r[n],void 0!==o&&(e.push(r.time),i.push.apply(i,o)),r=t[s++]}while(void 0!==r);else if(void 0!==o.toArray)do{o=r[n],void 0!==o&&(e.push(r.time),o.toArray(i,i.length)),r=t[s++]}while(void 0!==r);else do{o=r[n],void 0!==o&&(e.push(r.time),i.push(o)),r=t[s++]}while(void 0!==r)}class Bh{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],s=e[i-1];t:{e:{let r;i:{n:if(!(t<n)){for(let r=i+2;;){if(void 0===n){if(t<s)break n;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===r)break;if(s=n,n=e[++i],t<n)break e}r=e.length;break i}if(t>=s)break t;{const o=e[1];t<o&&(i=2,s=o);for(let r=i-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(i===r)break;if(n=s,s=e[--i-1],t>=s)break e}r=i,i=0}}for(;i<r;){const n=i+r>>>1;t<e[n]?r=n:i=n+1}if(n=e[i],s=e[i-1],void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,n)}return this.interpolate_(i,s,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=t*n;for(let t=0;t!==n;++t)e[t]=i[s+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class zh extends Bh{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Mt,endingEnd:Mt}}intervalChanged_(t,e,i){const n=this.parameterPositions;let s=t-2,r=t+1,o=n[s],a=n[r];if(void 0===o)switch(this.getSettings_().endingStart){case St:s=t,o=2*e-i;break;case Tt:s=n.length-2,o=e+n[s]-n[s+1];break;default:s=t,o=i}if(void 0===a)switch(this.getSettings_().endingEnd){case St:r=t,a=2*i-e;break;case Tt:r=1,a=i+n[1]-n[0];break;default:r=t-1,a=e}const h=.5*(i-e),l=this.valueSize;this._weightPrev=h/(e-o),this._weightNext=h/(a-i),this._offsetPrev=s*l,this._offsetNext=r*l}interpolate_(t,e,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=t*o,h=a-o,l=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-e)/(n-e),m=p*p,f=m*p,g=-u*f+2*u*m-u*p,v=(1+u)*f+(-1.5-2*u)*m+(-.5+u)*p+1,y=(-1-d)*f+(1.5+d)*m+.5*p,x=d*f-d*m;for(let t=0;t!==o;++t)s[t]=g*r[l+t]+v*r[h+t]+y*r[a+t]+x*r[c+t];return s}}class Uh extends Bh{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=t*o,h=a-o,l=(i-e)/(n-e),c=1-l;for(let t=0;t!==o;++t)s[t]=r[h+t]*c+r[a+t]*l;return s}}class Fh extends Bh{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class Gh{constructor(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=kh(e,this.TimeBufferType),this.values=kh(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:kh(t.times,Array),values:kh(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new Fh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Uh(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new zh(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case _t:e=this.InterpolantFactoryMethodDiscrete;break;case bt:e=this.InterpolantFactoryMethodLinear;break;case wt:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return _t;case this.InterpolantFactoryMethodLinear:return bt;case this.InterpolantFactoryMethodSmooth:return wt}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){const i=this.times,n=i.length;let s=0,r=n-1;for(;s!==n&&i[s]<t;)++s;for(;-1!==r&&i[r]>e;)--r;if(++r,0!==s||r!==n){s>=r&&(r=Math.max(r,1),s=r-1);const t=this.getValueSize();this.times=i.slice(s,r),this.values=this.values.slice(s*t,r*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(t=!1);const i=this.times,n=this.values,s=i.length;0===s&&(t=!1);let r=null;for(let e=0;e!==s;e++){const n=i[e];if("number"==typeof n&&isNaN(n)){t=!1;break}if(null!==r&&r>n){t=!1;break}r=n}if(void 0!==n&&Dh(n))for(let e=0,i=n.length;e!==i;++e){const i=n[e];if(isNaN(i)){t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),i=this.getValueSize(),n=this.getInterpolation()===wt,s=t.length-1;let r=1;for(let o=1;o<s;++o){let s=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(n)s=!0;else{const t=o*i,n=t-i,r=t+i;for(let o=0;o!==i;++o){const i=e[t+o];if(i!==e[n+o]||i!==e[r+o]){s=!0;break}}}if(s){if(o!==r){t[r]=t[o];const n=o*i,s=r*i;for(let t=0;t!==i;++t)e[s+t]=e[n+t]}++r}}if(s>0){t[r]=t[s];for(let t=s*i,n=r*i,o=0;o!==i;++o)e[n+o]=e[t+o];++r}return r!==t.length?(this.times=t.slice(0,r),this.values=e.slice(0,r*i)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}Gh.prototype.TimeBufferType=Float32Array,Gh.prototype.ValueBufferType=Float32Array,Gh.prototype.DefaultInterpolation=bt;class Hh extends Gh{}Hh.prototype.ValueTypeName="bool",Hh.prototype.ValueBufferType=Array,Hh.prototype.DefaultInterpolation=_t,Hh.prototype.InterpolantFactoryMethodLinear=void 0,Hh.prototype.InterpolantFactoryMethodSmooth=void 0;class Vh extends Gh{}Vh.prototype.ValueTypeName="color";class jh extends Gh{}jh.prototype.ValueTypeName="number";class Wh extends Bh{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=(i-e)/(n-e);let h=t*o;for(let t=h+o;h!==t;h+=4)Re.slerpFlat(s,0,r,h-o,r,h,a);return s}}class Xh extends Gh{InterpolantFactoryMethodLinear(t){return new Wh(this.times,this.values,this.getValueSize(),t)}}Xh.prototype.ValueTypeName="quaternion",Xh.prototype.DefaultInterpolation=bt,Xh.prototype.InterpolantFactoryMethodSmooth=void 0;class $h extends Gh{}$h.prototype.ValueTypeName="string",$h.prototype.ValueBufferType=Array,$h.prototype.DefaultInterpolation=_t,$h.prototype.InterpolantFactoryMethodLinear=void 0,$h.prototype.InterpolantFactoryMethodSmooth=void 0;class qh extends Gh{}qh.prototype.ValueTypeName="vector";class Yh{constructor(t,e=-1,i,n=2500){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=qt(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let t=0,s=i.length;t!==s;++t)e.push(Kh(i[t]).scale(n));const s=new this(t.name,t.duration,e,t.blendMode);return s.uuid=t.uuid,s}static toJSON(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,n=i.length;t!==n;++t)e.push(Gh.toJSON(i[t]));return n}static CreateFromMorphTargetSequence(t,e,i,n){const s=e.length,r=[];for(let t=0;t<s;t++){let o=[],a=[];o.push((t+s-1)%s,t,(t+1)%s),a.push(0,1,0);const h=Lh(o);o=Oh(o,1,h),a=Oh(a,1,h),n||0!==o[0]||(o.push(s),a.push(a[0])),r.push(new jh(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/i))}return new this(t,-1,r)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const n={},s=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],r=i.name.match(s);if(r&&r.length>1){const t=r[1];let e=n[t];e||(n[t]=e=[]),e.push(i)}}const r=[];for(const t in n)r.push(this.CreateFromMorphTargetSequence(t,n[t],e,i));return r}static parseAnimation(t,e){if(!t)return null;const i=function(t,e,i,n,s){if(0!==i.length){const r=[],o=[];Nh(i,r,o,n),0!==r.length&&s.push(new t(e,r,o))}},n=[],s=t.name||"default",r=t.fps||30,o=t.blendMode;let a=t.length||-1;const h=t.hierarchy||[];for(let t=0;t<h.length;t++){const s=h[t].keys;if(s&&0!==s.length)if(s[0].morphTargets){const t={};let e;for(e=0;e<s.length;e++)if(s[e].morphTargets)for(let i=0;i<s[e].morphTargets.length;i++)t[s[e].morphTargets[i]]=-1;for(const i in t){const t=[],r=[];for(let n=0;n!==s[e].morphTargets.length;++n){const n=s[e];t.push(n.time),r.push(n.morphTarget===i?1:0)}n.push(new jh(".morphTargetInfluence["+i+"]",t,r))}a=t.length*r}else{const r=".bones["+e[t].name+"]";i(qh,r+".position",s,"pos",n),i(Xh,r+".quaternion",s,"rot",n),i(qh,r+".scale",s,"scl",n)}}if(0===n.length)return null;return new this(s,a,n,o)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function Kh(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return jh;case"vector":case"vector2":case"vector3":case"vector4":return qh;case"color":return Vh;case"quaternion":return Xh;case"bool":case"boolean":return Hh;case"string":return $h}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],i=[];Nh(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const Zh={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class Jh{constructor(t,e,i){const n=this;let s,r=!1,o=0,a=0;const h=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){a++,!1===r&&void 0!==n.onStart&&n.onStart(t,o,a),r=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,a),o===a&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this},this.addHandler=function(t,e){return h.push(t,e),this},this.removeHandler=function(t){const e=h.indexOf(t);return-1!==e&&h.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=h.length;e<i;e+=2){const i=h[e],n=h[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}}const Qh=new Jh;class tl{constructor(t){this.manager=void 0!==t?t:Qh,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(n,s){i.load(t,n,e,s)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}tl.DEFAULT_MATERIAL_NAME="__DEFAULT";const el={};class il extends Error{constructor(t,e){super(t),this.response=e}}class nl extends tl{constructor(t){super(t)}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const s=Zh.get(t);if(void 0!==s)return this.manager.itemStart(t),setTimeout((()=>{e&&e(s),this.manager.itemEnd(t)}),0),s;if(void 0!==el[t])return void el[t].push({onLoad:e,onProgress:i,onError:n});el[t]=[],el[t].push({onLoad:e,onProgress:i,onError:n});const r=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(r).then((e=>{if(200===e.status||0===e.status){if(e.status,"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const i=el[t],n=e.body.getReader(),s=e.headers.get("Content-Length")||e.headers.get("X-File-Size"),r=s?parseInt(s):0,o=0!==r;let a=0;const h=new ReadableStream({start(t){!function e(){n.read().then((({done:n,value:s})=>{if(n)t.close();else{a+=s.byteLength;const n=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:r});for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onProgress&&e.onProgress(n)}t.enqueue(s),e()}}))}()}});return new Response(h)}throw new il(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,o)));case"json":return t.json();default:if(void 0===o)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(o),i=e&&e[1]?e[1].toLowerCase():void 0,n=new TextDecoder(i);return t.arrayBuffer().then((t=>n.decode(t)))}}})).then((e=>{Zh.add(t,e);const i=el[t];delete el[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onLoad&&n.onLoad(e)}})).catch((e=>{const i=el[t];if(void 0===i)throw this.manager.itemError(t),e;delete el[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class sl extends tl{constructor(t){super(t)}load(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,r=Zh.get(t);if(void 0!==r)return s.manager.itemStart(t),setTimeout((function(){e&&e(r),s.manager.itemEnd(t)}),0),r;const o=ae("img");function a(){l(),Zh.add(t,this),e&&e(this),s.manager.itemEnd(t)}function h(e){l(),n&&n(e),s.manager.itemError(t),s.manager.itemEnd(t)}function l(){o.removeEventListener("load",a,!1),o.removeEventListener("error",h,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",h,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(t),o.src=t,o}}class rl extends tl{constructor(t){super(t)}load(t,e,i,n){const s=new Se,r=new sl(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(t,(function(t){s.image=t,s.needsUpdate=!0,void 0!==e&&e(s)}),i,n),s}}class ol extends ki{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Yi(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}class al extends ol{constructor(t,e,i){super(t,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ki.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Yi(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const hl=new ai,ll=new Pe,cl=new Pe;class ul{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ne(512,512),this.map=null,this.mapPass=null,this.matrix=new ai,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Jn,this._frameExtents=new ne(1,1),this._viewportCount=1,this._viewports=[new Te(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;ll.setFromMatrixPosition(t.matrixWorld),e.position.copy(ll),cl.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(cl),e.updateMatrixWorld(),hl.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(hl),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(hl)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class dl extends ul{constructor(){super(new Gn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,i=2*$t*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=t.distance||e.far;i===e.fov&&n===e.aspect&&s===e.far||(e.fov=i,e.aspect=n,e.far=s,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class pl extends ol{constructor(t,e,i=0,n=Math.PI/3,s=0,r=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ki.DEFAULT_UP),this.updateMatrix(),this.target=new ki,this.distance=i,this.angle=n,this.penumbra=s,this.decay=r,this.map=null,this.shadow=new dl}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const ml=new ai,fl=new Pe,gl=new Pe;class vl extends ul{constructor(){super(new Gn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ne(4,2),this._viewportCount=6,this._viewports=[new Te(2,1,1,1),new Te(0,1,1,1),new Te(3,1,1,1),new Te(1,1,1,1),new Te(3,0,1,1),new Te(1,0,1,1)],this._cubeDirections=[new Pe(1,0,0),new Pe(-1,0,0),new Pe(0,0,1),new Pe(0,0,-1),new Pe(0,1,0),new Pe(0,-1,0)],this._cubeUps=[new Pe(0,1,0),new Pe(0,1,0),new Pe(0,1,0),new Pe(0,1,0),new Pe(0,0,1),new Pe(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,s=t.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),fl.setFromMatrixPosition(t.matrixWorld),i.position.copy(fl),gl.copy(i.position),gl.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(gl),i.updateMatrixWorld(),n.makeTranslation(-fl.x,-fl.y,-fl.z),ml.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ml)}}class yl extends ol{constructor(t,e,i=0,n=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new vl}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class xl extends ul{constructor(){super(new ds(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class _l extends ol{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ki.DEFAULT_UP),this.updateMatrix(),this.target=new ki,this.shadow=new xl}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class bl extends ol{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class wl{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Ml extends tl{constructor(t){super(t),this.isImageBitmapLoader=!0,this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,r=Zh.get(t);if(void 0!==r)return s.manager.itemStart(t),r.then?void r.then((i=>{e&&e(i),s.manager.itemEnd(t)})).catch((t=>{n&&n(t)})):(setTimeout((function(){e&&e(r),s.manager.itemEnd(t)}),0),r);const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader;const a=fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(s.options,{colorSpaceConversion:"none"}))})).then((function(i){return Zh.add(t,i),e&&e(i),s.manager.itemEnd(t),i})).catch((function(e){n&&n(e),Zh.remove(t),s.manager.itemError(t),s.manager.itemEnd(t)}));Zh.add(t,a),s.manager.itemStart(t)}}class Sl{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Tl(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=Tl();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function Tl(){return("undefined"==typeof performance?Date:performance).now()}class El{constructor(t,e,i){let n,s,r;switch(this.binding=t,this.valueSize=i,e){case"quaternion":n=this._slerp,s=this._slerpAdditive,r=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,r=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,s=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,s=t*n+n;let r=this.cumulativeWeight;if(0===r){for(let t=0;t!==n;++t)i[s+t]=i[t];r=e}else{r+=e;const t=e/r;this._mixBufferRegion(i,s,0,t,n)}this.cumulativeWeight=r}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,n=t*e+e,s=this.cumulativeWeight,r=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const t=e*this._origIndex;this._mixBufferRegion(i,n,t,1-s,e)}r>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let t=e,s=e+e;t!==s;++t)if(i[t]!==i[t+e]){o.setValue(i,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let t=i,s=n;t!==s;++t)e[t]=e[n+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,s){if(n>=.5)for(let n=0;n!==s;++n)t[e+n]=t[i+n]}_slerp(t,e,i,n){Re.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,s){const r=this._workIndex*s;Re.multiplyQuaternionsFlat(t,r,t,e,t,i),Re.slerpFlat(t,e,t,e,t,r,n)}_lerp(t,e,i,n,s){const r=1-n;for(let o=0;o!==s;++o){const s=e+o;t[s]=t[s]*r+t[i+o]*n}}_lerpAdditive(t,e,i,n,s){for(let r=0;r!==s;++r){const s=e+r;t[s]=t[s]+t[i+r]*n}}}const Al="\\[\\]\\.:\\/",Cl=new RegExp("["+Al+"]","g"),Il="[^"+Al+"]",Rl="[^"+Al.replace("\\.","")+"]",Pl=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Il)+/(WCOD+)?/.source.replace("WCOD",Rl)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Il)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Il)+"$"),kl=["material","materials","bones","map"];class Dl{constructor(t,e,i){this.path=e,this.parsedPath=i||Dl.parseTrackName(e),this.node=Dl.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new Dl.Composite(t,e,i):new Dl(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Cl,"")}static parseTrackName(t){const e=Pl.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=i.nodeName.substring(n+1);-1!==kl.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let n=0;n<t.length;n++){const s=t[n];if(s.name===e||s.uuid===e)return s;const r=i(s.children);if(r)return r}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let s=e.propertyIndex;if(t||(t=Dl.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return;if(i){let n=e.objectIndex;switch(i){case"materials":if(!t.material)return;if(!t.material.materials)return;t=t.material.materials;break;case"bones":if(!t.skeleton)return;t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return;if(!t.material.map)return;t=t.material.map;break;default:if(void 0===t[i])return;t=t[i]}if(void 0!==n){if(void 0===t[n])return;t=t[n]}}const r=t[n];if(void 0===r){e.nodeName;return}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===n){if(!t.geometry)return;if(!t.geometry.morphAttributes)return;void 0!==t.morphTargetDictionary[s]&&(s=t.morphTargetDictionary[s])}a=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=s}else void 0!==r.fromArray&&void 0!==r.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(a=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Dl.Composite=class{constructor(t,e,i){const n=i||Dl.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=i.length;n!==s;++n)i[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},Dl.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Dl.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Dl.prototype.GetterByBindingType=[Dl.prototype._getValue_direct,Dl.prototype._getValue_array,Dl.prototype._getValue_arrayElement,Dl.prototype._getValue_toArray],Dl.prototype.SetterByBindingTypeAndVersioning=[[Dl.prototype._setValue_direct,Dl.prototype._setValue_direct_setNeedsUpdate,Dl.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Dl.prototype._setValue_array,Dl.prototype._setValue_array_setNeedsUpdate,Dl.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Dl.prototype._setValue_arrayElement,Dl.prototype._setValue_arrayElement_setNeedsUpdate,Dl.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Dl.prototype._setValue_fromArray,Dl.prototype._setValue_fromArray_setNeedsUpdate,Dl.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Ll{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const s=e.tracks,r=s.length,o=new Array(r),a={endingStart:Mt,endingEnd:Mt};for(let t=0;t!==r;++t){const e=s[t].createInterpolant(null);o[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=xt,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const i=this._clip.duration,n=t._clip.duration,s=n/i,r=i/n;t.warp(1,s,e),this.warp(r,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,s=n.time,r=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,h=o.sampleValues;return a[0]=s,a[1]=s+i,h[0]=t/r,h[1]=e/r,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled)return void this._updateWeight(t);const s=this._startTime;if(null!==s){const n=(t-s)*i;n<0||0===i?e=0:(this._startTime=null,e=i*n)}e*=this._updateTimeScale(t);const r=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(2501===this.blendMode)for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(r),e[i].accumulateAdditive(o);else for(let i=0,s=t.length;i!==s;++i)t[i].evaluate(r),e[i].accumulate(n,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,s=this._loopCount;const r=2202===i;if(0===t)return-1===s?n:r&&1==(1&s)?e-n:n;if(i===yt){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===s&&(t>=0?(s=0,this._setEndings(!0,0===this.repetitions,r)):this._setEndings(0===this.repetitions,!0,r)),n>=e||n<0){const i=Math.floor(n/e);n-=e*i,s+=Math.abs(i);const o=this.repetitions-s;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,r)}else this._setEndings(!1,!1,r);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(r&&1==(1&s))return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=St,n.endingEnd=St):(n.endingStart=t?this.zeroSlopeAtStart?St:Mt:Tt,n.endingEnd=e?this.zeroSlopeAtEnd?St:Mt:Tt)}_scheduleFading(t,e,i){const n=this._mixer,s=n.time;let r=this._weightInterpolant;null===r&&(r=n._lendControlInterpolant(),this._weightInterpolant=r);const o=r.parameterPositions,a=r.sampleValues;return o[0]=s,a[0]=e,o[1]=s+t,a[1]=i,this}}const Ol=new Float32Array(1);class Nl extends Vt{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,s=n.length,r=t._propertyBindings,o=t._interpolants,a=i.uuid,h=this._bindingsByRootAndName;let l=h[a];void 0===l&&(l={},h[a]=l);for(let t=0;t!==s;++t){const s=n[t],h=s.name;let c=l[h];if(void 0!==c)++c.referenceCount,r[t]=c;else{if(c=r[t],void 0!==c){null===c._cacheIndex&&(++c.referenceCount,this._addInactiveBinding(c,a,h));continue}const n=e&&e._propertyBindings[t].binding.parsedPath;c=new El(Dl.create(i,h,n),s.ValueTypeName,s.getValueSize()),++c.referenceCount,this._addInactiveBinding(c,a,h),r[t]=c}o[t].resultBuffer=c.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,s=this._actionsByClip;let r=s[e];if(void 0===r)r={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,s[e]=r;else{const e=r.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),r.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const s=t._clip.uuid,r=this._actionsByClip,o=r[s],a=o.knownActions,h=a[a.length-1],l=t._byClipCacheIndex;h._byClipCacheIndex=l,a[l]=h,a.pop(),t._byClipCacheIndex=null;delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete r[s],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,s=this._bindings;let r=n[e];void 0===r&&(r={},n[e]=r),r[i]=t,t._cacheIndex=s.length,s.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,s=i.path,r=this._bindingsByRootAndName,o=r[n],a=e[e.length-1],h=t._cacheIndex;a._cacheIndex=h,e[h]=a,e.pop(),delete o[s],0===Object.keys(o).length&&delete r[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&(i=new Uh(new Float32Array(2),new Float32Array(2),1,Ol),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,s=e[n];t.__cacheIndex=n,e[n]=t,s.__cacheIndex=i,e[i]=s}clipAction(t,e,i){const n=e||this._root,s=n.uuid;let r="string"==typeof t?Yh.findByName(n,t):t;const o=null!==r?r.uuid:t,a=this._actionsByClip[o];let h=null;if(void 0===i&&(i=null!==r?r.blendMode:Et),void 0!==a){const t=a.actionByRoot[s];if(void 0!==t&&t.blendMode===i)return t;h=a.knownActions[0],null===r&&(r=h._clip)}if(null===r)return null;const l=new Ll(this,r,e,i);return this._bindAction(l,h),this._addInactiveAction(l,o,s),l}existingAction(t,e){const i=e||this._root,n=i.uuid,s="string"==typeof t?Yh.findByName(i,t):t,r=s?s.uuid:t,o=this._actionsByClip[r];return void 0!==o&&o.actionByRoot[n]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,s=Math.sign(t),r=this._accuIndex^=1;for(let o=0;o!==i;++o){e[o]._update(n,t,s,r)}const o=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)o[t].apply(r);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,s=n[i];if(void 0!==s){const t=s.knownActions;for(let i=0,n=t.length;i!==n;++i){const n=t[i];this._deactivateAction(n);const s=n._cacheIndex,r=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,r._cacheIndex=s,e[s]=r,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const n=i[t].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[e];if(void 0!==n)for(const t in n){const e=n[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class Bl{constructor(t,e,i=0,n=1/0){this.ray=new oi(t,e),this.near=i,this.far=n,this.camera=null,this.layers=new yi,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera&&(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e)}intersectObject(t,e=!0,i=[]){return Ul(t,this,i,e),i.sort(zl),i}intersectObjects(t,e=!0,i=[]){for(let n=0,s=t.length;n<s;n++)Ul(t[n],this,i,e);return i.sort(zl),i}}function zl(t,e){return t.distance-e.distance}function Ul(t,e,i,n){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===n){const n=t.children;for(let t=0,s=n.length;t<s;t++)Ul(n[t],e,i,!0)}}class Fl{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(Yt(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Gl extends Ba{constructor(t=10,e=10,i=4473924,n=8947848){i=new Yi(i),n=new Yi(n);const s=e/2,r=t/e,o=t/2,a=[],h=[];for(let t=0,l=0,c=-o;t<=e;t++,c+=r){a.push(-o,0,c,o,0,c),a.push(c,0,-o,c,0,o);const e=t===s?i:n;e.toArray(h,l),l+=3,e.toArray(h,l),l+=3,e.toArray(h,l),l+=3,e.toArray(h,l),l+=3}const l=new mn;l.setAttribute("position",new on(a,3)),l.setAttribute("color",new on(h,3));super(l,new Ca({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Hl=new Le;class Vl extends Ba{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),s=new mn;s.setIndex(new nn(i,1)),s.setAttribute("position",new nn(n,3)),super(s,new Ca({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==this.object&&Hl.setFromObject(this.object),Hl.isEmpty())return;const e=Hl.min,i=Hl.max,n=this.geometry.attributes.position,s=n.array;s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=e.x,s[4]=i.y,s[5]=i.z,s[6]=e.x,s[7]=e.y,s[8]=i.z,s[9]=i.x,s[10]=e.y,s[11]=i.z,s[12]=i.x,s[13]=i.y,s[14]=e.z,s[15]=e.x,s[16]=i.y,s[17]=e.z,s[18]=e.x,s[19]=e.y,s[20]=e.z,s[21]=i.x,s[22]=e.y,s[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,e){return super.copy(t,e),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const jl=new Pe;let Wl,Xl;class $l extends ki{constructor(t=new Pe(0,0,1),e=new Pe(0,0,0),i=1,n=16776960,s=.2*i,r=.2*s){super(),this.type="ArrowHelper",void 0===Wl&&(Wl=new mn,Wl.setAttribute("position",new on([0,0,0,0,1,0],3)),Xl=new Ya(0,.5,1,5,1),Xl.translate(0,-.5,0)),this.position.copy(e),this.line=new La(Wl,new Ca({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new kn(Xl,new Qi({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,s,r)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{jl.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(jl,e)}}setLength(t,e=.2*t,i=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class ql extends Ba{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new mn;i.setAttribute("position",new on(e,3)),i.setAttribute("color",new on([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(i,new Ca({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,i){const n=new Yi,s=this.geometry.attributes.color.array;return n.set(t),n.toArray(s,0),n.toArray(s,3),n.set(e),n.toArray(s,6),n.toArray(s,9),n.set(i),n.toArray(s,12),n.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:y}})),"undefined"!=typeof window&&(window.__THREE__||(window.__THREE__=y));var Yl,Kl,Zl,Jl,Ql=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};!function(t){t[t.Body=0]="Body",t[t.Hands_L=1]="Hands_L",t[t.Hands_R=2]="Hands_R",t[t.Head=3]="Head",t[t.Legs=4]="Legs",t[t.Feet=5]="Feet"}(Yl||(Yl={})),function(t){t[t.Idle=0]="Idle",t[t.Walk=1]="Walk",t[t.Run=2]="Run",t[t.Jump=3]="Jump",t[t.Punch=4]="Punch",t[t.FightIdle=5]="FightIdle",t[t.Dying=6]="Dying",t[t.Shooting=7]="Shooting",t[t.Sword=8]="Sword",t[t.MagicH1=9]="MagicH1",t[t.MagicH2=10]="MagicH2",t[t.Dance0=11]="Dance0",t[t.Wartering=12]="Wartering",t[t.Hammering=13]="Hammering",t[t.PickFruit=14]="PickFruit",t[t.PickFruitTree=15]="PickFruitTree",t[t.PlantAPlant=16]="PlantAPlant",t[t.MonBiting=17]="MonBiting",t[t.MonScream=18]="MonScream",t[t.MonHurt=19]="MonHurt"}(Kl||(Kl={})),function(t){t[t.Male=0]="Male",t[t.Female=1]="Female",t[t.Tree=2]="Tree",t[t.DeadTree=3]="DeadTree",t[t.DeadTree2=4]="DeadTree2",t[t.Mushroom1=5]="Mushroom1",t[t.Mushroom2=6]="Mushroom2",t[t.Portal=7]="Portal",t[t.Test=8]="Test",t[t.Zombie=9]="Zombie",t[t.Minataur=10]="Minataur",t[t.BatPig=11]="BatPig",t[t.Bilby=12]="Bilby",t[t.BilbyMon=13]="BilbyMon",t[t.BirdMon=14]="BirdMon",t[t.CrabMon=15]="CrabMon",t[t.Gorillish=16]="Gorillish",t[t.PantherBlackWhite=17]="PantherBlackWhite",t[t.PantherBlue=18]="PantherBlue",t[t.PantherRed=19]="PantherRed",t[t.AnimalPack=20]="AnimalPack",t[t.WereWolf=21]="WereWolf",t[t.Golem=22]="Golem",t[t.BigGolem=23]="BigGolem",t[t.Snake=24]="Snake",t[t.Viking=25]="Viking",t[t.Builder=26]="Builder",t[t.ToadMage=27]="ToadMage",t[t.KittenMonk=28]="KittenMonk",t[t.Skeleton=29]="Skeleton",t[t.Bat=30]="Bat",t[t.Gun=31]="Gun",t[t.WarteringCan=32]="WarteringCan",t[t.Hammer=33]="Hammer",t[t.AppleTree=34]="AppleTree",t[t.Apple=35]="Apple",t[t.CoconutTree=36]="CoconutTree",t[t.Coconut=37]="Coconut",t[t.Tomato0=38]="Tomato0",t[t.Tomato1=39]="Tomato1",t[t.Tomato2=40]="Tomato2",t[t.Potato0=41]="Potato0",t[t.Potato1=42]="Potato1",t[t.Potato2=43]="Potato2",t[t.Carrot0=44]="Carrot0",t[t.Carrot1=45]="Carrot1",t[t.Carrot2=46]="Carrot2",t[t.Bed=47]="Bed",t[t.Bath=48]="Bath",t[t.Bookshelf=49]="Bookshelf",t[t.Closet=50]="Closet",t[t.Desk=51]="Desk",t[t.Kitchen=52]="Kitchen",t[t.KitTable=53]="KitTable",t[t.Oven=54]="Oven",t[t.Refrigerator=55]="Refrigerator",t[t.Sink=56]="Sink",t[t.Table=57]="Table",t[t.Toilet=58]="Toilet",t[t.TV=59]="TV",t[t.Stone=60]="Stone"}(Zl||(Zl={})),function(t){t[t.Gltf=0]="Gltf",t[t.GltfParser=1]="GltfParser",t[t.Fbx=2]="Fbx"}(Jl||(Jl={}));class tc{get Clips(){return this.clips}get Mixer(){return this.mixer}get BoxMesh(){return this.box}constructor(t,e,i,n){this.loader=t,this.loaderType=e,this.path=i,this.afterLoad=n,this.clips=new Map,this.models=new Map,this.mixers=new Map,this.boxMat=new Qi({color:16777215,wireframe:!0})}GetAnimationClip(t){return this.clips.get(t)}UniqModel(t){return Ql(this,void 0,void 0,(function*(){const e=this.models.get(t);if(null!=e)return[e,!0];const i=yield this.NewModel();return this.models.set(t,i),[i,!1]}))}LoadAnimation(t,e){return Ql(this,void 0,void 0,(function*(){const i=yield this.loader.FBXLoader.loadAsync(t);this.clips.set(e,i.animations[0])}))}GetMixer(t){const e=this.mixers.get(t);if(null!=e)return e;const i=this.models.get(t);if(null==i)return;const n=new Nl(i);return this.mixers.set(t,n),n}NewModel(){return Ql(this,void 0,void 0,(function*(){return this.loaderType==Jl.Gltf?yield new Promise((t=>Ql(this,void 0,void 0,(function*(){yield this.loader.Load.load(this.path,(e=>Ql(this,void 0,void 0,(function*(){this.meshs=e.scene,yield this.afterLoad(e),t(e.scene)}))))})))):this.loaderType==Jl.GltfParser?yield new Promise((t=>Ql(this,void 0,void 0,(function*(){yield this.afterLoad(t)})))):yield new Promise((t=>Ql(this,void 0,void 0,(function*(){yield this.loader.FBXLoader.load(this.path,(e=>Ql(this,void 0,void 0,(function*(){yield this.afterLoad(e),t(e)}))))}))))}))}CloneModel(){return Ql(this,void 0,void 0,(function*(){return null!=this.meshs?this.meshs.clone():yield this.NewModel()}))}GetBoxPos(t){const e=t.position,i=this.size?e.y+this.size.y/2:e.y;return new Pe(e.x,i,e.z)}}class ec{}ec.PlayerStatus=Symbol("changeplayerstatus"),ec.AppMode=Symbol("appmode"),ec.BrickMode=Symbol("brickmode"),ec.EditMode=Symbol("editmode"),ec.PlayMode=Symbol("playmode"),ec.WeaponMode=Symbol("weaponmode"),ec.LocatMode=Symbol("locatmode"),ec.FunitureMode=Symbol("funimode"),ec.CloseMode=Symbol("closemode"),ec.LongMode=Symbol("longmode"),ec.PortalMode=Symbol("portalmode"),ec.LegoMode=Symbol("legomode"),ec.StartPosition=new Pe(0,0,6),ec.DefaultPortalPosition=new Pe(21,0,17),ec.LegoFieldW=18,ec.LegoFieldH=24,ec.ModelPath={[Zl.Male]:"assets/male/male.gltf",[Zl.Female]:"assets/female/female.gltf"};const ic=ec;var nc,sc;!function(t){t[t.Start=0]="Start",t[t.Message=1]="Message",t[t.End=2]="End"}(nc||(nc={}));class rc{constructor(){this.curMode=qE.Long,this.eventEmitter=new v}OnKeyDownEvent(t){this.eventEmitter.emit("keydown",t)}RegisterKeyDownEvent(t){this.eventEmitter.addListener("keydown",t)}OnKeyUpEvent(t){this.eventEmitter.emit("keyup",t)}RegisterKeyUpEvent(t){this.eventEmitter.on("keyup",t)}OnInputEvent(t,e,i){this.eventEmitter.emit("input",t,e,i)}RegisterInputEvent(t){this.eventEmitter.on("input",t)}OnChangeCtrlObjEvent(t){this.eventEmitter.emit("ctrlobj",t)}RegisterChangeCtrlObjEvent(t){this.eventEmitter.on("ctrlobj",t)}OnChangeEquipmentEvent(t){this.eventEmitter.emit("equip",t)}RegisterChangeEquipmentEvent(t){this.eventEmitter.on("equip",t)}OnChangeBrickInfo(t){this.eventEmitter.emit("bsize",t)}RegisterBrickInfo(t){this.eventEmitter.on("bsize",t)}OnAttackEvent(t,e){this.eventEmitter.emit(t,e)}RegisterAttackEvent(t,e){this.eventEmitter.on(t,e)}OnSceneClearEvent(){this.eventEmitter.emit("clear")}RegisterSceneClearEvent(t){this.eventEmitter.on("clear",t)}OnSceneReloadEvent(){this.eventEmitter.emit("reload")}RegisterReloadEvent(t){this.eventEmitter.on("reload",t)}OnAppModeEvent(t,...e){this.eventEmitter.emit(ic.AppMode,this.curMode,nc.End,...e),this.eventEmitter.emit(ic.AppMode,t,nc.Start,...e),this.curMode=t}OnAppModeMessage(...t){this.eventEmitter.emit(ic.AppMode,this.curMode,nc.Message,t)}RegisterAppModeEvent(t){this.eventEmitter.on(ic.AppMode,t)}OnChangePlayerStatusEvent(t){this.eventEmitter.emit(ic.PlayerStatus,t)}RegisterChangePlayerStatusEvent(t){this.eventEmitter.on(ic.PlayerStatus,t)}}!function(t){t[t.None=0]="None",t[t.Up=1]="Up",t[t.Down=2]="Down",t[t.Left=3]="Left",t[t.Right=4]="Right",t[t.Action0=5]="Action0",t[t.Action1=6]="Action1",t[t.Action2=7]="Action2",t[t.Action3=8]="Action3",t[t.Action4=9]="Action4",t[t.Action5=10]="Action5",t[t.System0=11]="System0",t[t.Count=12]="Count"}(sc||(sc={}));class oc{get Type(){return sc.None}ExecuteKeyUp(){return new Pe(0,0,0)}ExecuteKeyDown(){return new Pe(0,0,0)}}class ac{get Type(){return sc.Action1}ExecuteKeyUp(){return new Pe(0,0,0)}ExecuteKeyDown(){return new Pe(0,0,0)}}class hc{get Type(){return sc.Action2}ExecuteKeyUp(){return new Pe(0,0,0)}ExecuteKeyDown(){return new Pe(0,0,0)}}class lc{get Type(){return sc.Action3}ExecuteKeyUp(){return new Pe(0,0,0)}ExecuteKeyDown(){return new Pe(0,0,0)}}class cc{get Type(){return sc.Action4}ExecuteKeyUp(){return new Pe(0,0,0)}ExecuteKeyDown(){return new Pe(0,0,0)}}class uc{get Type(){return sc.Action5}ExecuteKeyUp(){return new Pe(0,0,0)}ExecuteKeyDown(){return new Pe(0,0,0)}}class dc{get Type(){return sc.Action0}ExecuteKeyUp(){return new Pe(0,7,0)}ExecuteKeyDown(){return new Pe(0,7,0)}}class pc{get Type(){return sc.Up}ExecuteKeyUp(){return new Pe(0,0,-1)}ExecuteKeyDown(){return new Pe(0,0,-1)}}class mc{get Type(){return sc.Down}ExecuteKeyUp(){return new Pe(0,0,1)}ExecuteKeyDown(){return new Pe(0,0,1)}}class fc{get Type(){return sc.Left}ExecuteKeyUp(){return new Pe(-1,0,0)}ExecuteKeyDown(){return new Pe(-1,0,0)}}class gc{get Type(){return sc.Right}ExecuteKeyUp(){return new Pe(1,0,0)}ExecuteKeyDown(){return new Pe(1,0,0)}}class vc{get Type(){return sc.System0}ExecuteKeyUp(){return new Pe}ExecuteKeyDown(){return new Pe}}class yc extends zo{constructor(t,...e){super();const i=new bl(16777215,.3),n=new al(16777215,3355443);n.position.set(0,20,10),this.objs=e,this.models=e.map((t=>t.Meshs)),this.add(i,n,t,t.target,...this.models),this.meshs=this.models.filter((t=>t.isMesh))}play(){}dispose(){this.objs.forEach((t=>{const e=t.Meshs;e.isMesh&&(e.geometry.dispose(),e.material instanceof Array?e.material.map((t=>t.dispose())):e.material.dispose(),this.remove(e))}))}}class xc{get Velocity(){return this.velocity}set Velocity(t){this.velocity=t}get CenterPos(){return this.centerPos.copy(this.meshs.position).y+=this.Size.y/2,this.centerPos}get CannonPos(){return this.meshs.position}set CannonPos(t){this.meshs.position.copy(t)}set Quaternion(t){this.meshs.quaternion.copy(t)}get Size(){return this.asset.GetSize(this.meshs)}get Meshs(){return this.meshs}get Helper(){return null!=this.helper?this.helper:new Vl(this.meshs,new Yi(0,255,0))}get UUID(){return this.meshs.uuid}get Visible(){return this.vFlag}set Visible(t){this.vFlag==t&&this.meshs.visible==t||(this.meshs.visible=t,this.meshs.traverse((e=>{e instanceof kn&&(e.visible=t)})),null!=this.text&&(this.text.visible=t),this.vFlag=t)}get Asset(){return this.asset}get Box(){return this.asset.GetBox(this.meshs)}constructor(t){this.asset=t,this.meshs=new Po,this.vFlag=!0,this.velocity=0,this.centerPos=new Pe}}class _c extends kn{constructor(){super(...arguments),this.velocity=0,this.centerPos=new Pe}get Velocity(){return this.velocity}set Velocity(t){this.velocity=t}get Box(){return(new Le).setFromObject(this)}get CenterPos(){return this.centerPos.copy(this.position).y+=this.Size.y/2,this.centerPos}get CannonPos(){return this.position}set CannonPos(t){this.position.copy(t)}set Quaternion(t){this.quaternion.copy(t)}get Meshs(){return this}get UUID(){return this.uuid}get Size(){const t=(new Le).setFromObject(this);return this.size=t.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=Math.round(this.size.y),this.size.z=Math.ceil(this.size.z),this.size}set Visible(t){this.visible=t}}class bc extends _c{get BoxPos(){const t=this.CannonPos;return new Pe(t.x,t.y,t.z)}constructor(t){super(new qa(t,6),new Ah({color:16764006})),this.position.set(0,0,0),this.rotateX(-Math.PI/2),this.receiveShadow=!0}}class wc{constructor(...t){this.clock=new Sl,this.canvas=document.getElementById("avatar-bg"),this.width=window.innerWidth,this.height=window.innerHeight,this.objs=t}RegisterViewer(t){this.objs.push(t)}update(){const t=this.clock.getDelta();this.objs.forEach((e=>{e.update(t)}))}resize(){this.width=window.innerWidth,this.height=window.innerHeight,this.objs.forEach((t=>{t.resize(this.width,this.height)}))}get Canvas(){return this.canvas}get Width(){return this.width}get Height(){return this.height}}function Mc(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Sc(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var Tc,Ec,Ac,Cc,Ic,Rc,Pc,kc,Dc,Lc,Oc,Nc={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},Bc={duration:.5,overwrite:!1,delay:0},zc=1e8,Uc=1e-8,Fc=2*Math.PI,Gc=Fc/4,Hc=0,Vc=Math.sqrt,jc=Math.cos,Wc=Math.sin,Xc=function(t){return"string"==typeof t},$c=function(t){return"function"==typeof t},qc=function(t){return"number"==typeof t},Yc=function(t){return void 0===t},Kc=function(t){return"object"==typeof t},Zc=function(t){return!1!==t},Jc=function(){return"undefined"!=typeof window},Qc=function(t){return $c(t)||Xc(t)},tu="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},eu=Array.isArray,iu=/(?:-?\.?\d|\.)+/gi,nu=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,su=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,ru=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,ou=/[+-]=-?[.\d]+/,au=/[^,'"\[\]\s]+/gi,hu=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,lu={},cu={},uu=function(t){return(cu=Uu(t,lu))&&Fp},du=function(t,e){return!e&&void 0},pu=function(t,e){return t&&(lu[t]=e)&&cu&&(cu[t]=e)||lu},mu=function(){return 0},fu={suppressEvents:!0,isStart:!0,kill:!1},gu={suppressEvents:!0,kill:!1},vu={suppressEvents:!0},yu={},xu=[],_u={},bu={},wu={},Mu=30,Su=[],Tu="",Eu=function(t){var e,i,n=t[0];if(Kc(n)||$c(n)||(t=[t]),!(e=(n._gsap||{}).harness)){for(i=Su.length;i--&&!Su[i].targetTest(n););e=Su[i]}for(i=t.length;i--;)t[i]&&(t[i]._gsap||(t[i]._gsap=new tp(t[i],e)))||t.splice(i,1);return t},Au=function(t){return t._gsap||Eu(vd(t))[0]._gsap},Cu=function(t,e,i){return(i=t[e])&&$c(i)?t[e]():Yc(i)&&t.getAttribute&&t.getAttribute(e)||i},Iu=function(t,e){return(t=t.split(",")).forEach(e)||t},Ru=function(t){return Math.round(1e5*t)/1e5||0},Pu=function(t){return Math.round(1e7*t)/1e7||0},ku=function(t,e){var i=e.charAt(0),n=parseFloat(e.substr(2));return t=parseFloat(t),"+"===i?t+n:"-"===i?t-n:"*"===i?t*n:t/n},Du=function(t,e){for(var i=e.length,n=0;t.indexOf(e[n])<0&&++n<i;);return n<i},Lu=function(){var t,e,i=xu.length,n=xu.slice(0);for(_u={},xu.length=0,t=0;t<i;t++)(e=n[t])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},Ou=function(t,e,i,n){xu.length&&!Ec&&Lu(),t.render(e,i,n||Ec&&e<0&&(t._initted||t._startAt)),xu.length&&!Ec&&Lu()},Nu=function(t){var e=parseFloat(t);return(e||0===e)&&(t+"").match(au).length<2?e:Xc(t)?t.trim():t},Bu=function(t){return t},zu=function(t,e){for(var i in e)i in t||(t[i]=e[i]);return t},Uu=function(t,e){for(var i in e)t[i]=e[i];return t},Fu=function t(e,i){for(var n in i)"__proto__"!==n&&"constructor"!==n&&"prototype"!==n&&(e[n]=Kc(i[n])?t(e[n]||(e[n]={}),i[n]):i[n]);return e},Gu=function(t,e){var i,n={};for(i in t)i in e||(n[i]=t[i]);return n},Hu=function(t){var e,i=t.parent||Cc,n=t.keyframes?(e=eu(t.keyframes),function(t,i){for(var n in i)n in t||"duration"===n&&e||"ease"===n||(t[n]=i[n])}):zu;if(Zc(t.inherit))for(;i;)n(t,i.vars.defaults),i=i.parent||i._dp;return t},Vu=function(t,e,i,n,s){void 0===i&&(i="_first"),void 0===n&&(n="_last");var r,o=t[n];if(s)for(r=e[s];o&&o[s]>r;)o=o._prev;return o?(e._next=o._next,o._next=e):(e._next=t[i],t[i]=e),e._next?e._next._prev=e:t[n]=e,e._prev=o,e.parent=e._dp=t,e},ju=function(t,e,i,n){void 0===i&&(i="_first"),void 0===n&&(n="_last");var s=e._prev,r=e._next;s?s._next=r:t[i]===e&&(t[i]=r),r?r._prev=s:t[n]===e&&(t[n]=s),e._next=e._prev=e.parent=null},Wu=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove&&t.parent.remove(t),t._act=0},Xu=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var i=t;i;)i._dirty=1,i=i.parent;return t},$u=function(t,e,i,n){return t._startAt&&(Ec?t._startAt.revert(gu):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(e,!0,n))},qu=function t(e){return!e||e._ts&&t(e.parent)},Yu=function(t){return t._repeat?Ku(t._tTime,t=t.duration()+t._rDelay)*t:0},Ku=function(t,e){var i=Math.floor(t/=e);return t&&i===t?i-1:i},Zu=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},Ju=function(t){return t._end=Pu(t._start+(t._tDur/Math.abs(t._ts||t._rts||Uc)||0))},Qu=function(t,e){var i=t._dp;return i&&i.smoothChildTiming&&t._ts&&(t._start=Pu(i._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),Ju(t),i._dirty||Xu(i,t)),t},td=function(t,e){var i;if((e._time||!e._dur&&e._initted||e._start<t._time&&(e._dur||!e.add))&&(i=Zu(t.rawTime(),e),(!e._dur||dd(0,e.totalDuration(),i)-e._tTime>Uc)&&e.render(i,!0)),Xu(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(i=t;i._dp;)i.rawTime()>=0&&i.totalTime(i._tTime),i=i._dp;t._zTime=-1e-8}},ed=function(t,e,i,n){return e.parent&&Wu(e),e._start=Pu((qc(i)?i:i||t!==Cc?ld(t,i,e):t._time)+e._delay),e._end=Pu(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),Vu(t,e,"_first","_last",t._sort?"_start":0),rd(e)||(t._recent=e),n||td(t,e),t._ts<0&&Qu(t,t._tTime),t},id=function(t,e){return lu.ScrollTrigger?lu.ScrollTrigger.create(e,t):void 0},nd=function(t,e,i,n,s){return hp(t,e,s),t._initted?!i&&t._pt&&!Ec&&(t._dur&&!1!==t.vars.lazy||!t._dur&&t.vars.lazy)&&Dc!==Gd.frame?(xu.push(t),t._lazy=[s,n],1):void 0:1},sd=function t(e){var i=e.parent;return i&&i._ts&&i._initted&&!i._lock&&(i.rawTime()<0||t(i))},rd=function(t){var e=t.data;return"isFromStart"===e||"isStart"===e},od=function(t,e,i,n){var s=t._repeat,r=Pu(e)||0,o=t._tTime/t._tDur;return o&&!n&&(t._time*=r/t._dur),t._dur=r,t._tDur=s?s<0?1e10:Pu(r*(s+1)+t._rDelay*s):r,o>0&&!n&&Qu(t,t._tTime=t._tDur*o),t.parent&&Ju(t),i||Xu(t.parent,t),t},ad=function(t){return t instanceof ip?Xu(t):od(t,t._dur)},hd={_start:0,endTime:mu,totalDuration:mu},ld=function t(e,i,n){var s,r,o,a=e.labels,h=e._recent||hd,l=e.duration()>=zc?h.endTime(!1):e._dur;return Xc(i)&&(isNaN(i)||i in a)?(r=i.charAt(0),o="%"===i.substr(-1),s=i.indexOf("="),"<"===r||">"===r?(s>=0&&(i=i.replace(/=/,"")),("<"===r?h._start:h.endTime(h._repeat>=0))+(parseFloat(i.substr(1))||0)*(o?(s<0?h:n).totalDuration()/100:1)):s<0?(i in a||(a[i]=l),a[i]):(r=parseFloat(i.charAt(s-1)+i.substr(s+1)),o&&n&&(r=r/100*(eu(n)?n[0]:n).totalDuration()),s>1?t(e,i.substr(0,s-1),n)+r:l+r)):null==i?l:+i},cd=function(t,e,i){var n,s,r=qc(e[1]),o=(r?2:1)+(t<2?0:1),a=e[o];if(r&&(a.duration=e[1]),a.parent=i,t){for(n=a,s=i;s&&!("immediateRender"in n);)n=s.vars.defaults||{},s=Zc(s.vars.inherit)&&s.parent;a.immediateRender=Zc(n.immediateRender),t<2?a.runBackwards=1:a.startAt=e[o-1]}return new pp(e[0],a,e[o+1])},ud=function(t,e){return t||0===t?e(t):e},dd=function(t,e,i){return i<t?t:i>e?e:i},pd=function(t,e){return Xc(t)&&(e=hu.exec(t))?e[1]:""},md=[].slice,fd=function(t,e){return t&&Kc(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&Kc(t[0]))&&!t.nodeType&&t!==Ic},gd=function(t,e,i){return void 0===i&&(i=[]),t.forEach((function(t){var n;return Xc(t)&&!e||fd(t,1)?(n=i).push.apply(n,vd(t)):i.push(t)}))||i},vd=function(t,e,i){return Ac&&!e&&Ac.selector?Ac.selector(t):!Xc(t)||i||!Rc&&Hd()?eu(t)?gd(t,i):fd(t)?md.call(t,0):t?[t]:[]:md.call((e||Pc).querySelectorAll(t),0)},yd=function(t){return t=vd(t)[0]||du()||{},function(e){var i=t.current||t.nativeElement||t;return vd(e,i.querySelectorAll?i:i===t?du()||Pc.createElement("div"):t)}},xd=function(t){return t.sort((function(){return.5-Math.random()}))},_d=function(t){if($c(t))return t;var e=Kc(t)?t:{each:t},i=Yd(e.ease),n=e.from||0,s=parseFloat(e.base)||0,r={},o=n>0&&n<1,a=isNaN(n)||o,h=e.axis,l=n,c=n;return Xc(n)?l=c={center:.5,edges:.5,end:1}[n]||0:!o&&a&&(l=n[0],c=n[1]),function(t,o,u){var d,p,m,f,g,v,y,x,_,b=(u||e).length,w=r[b];if(!w){if(!(_="auto"===e.grid?0:(e.grid||[1,zc])[1])){for(y=-zc;y<(y=u[_++].getBoundingClientRect().left)&&_<b;);_<b&&_--}for(w=r[b]=[],d=a?Math.min(_,b)*l-.5:n%_,p=_===zc?0:a?b*c/_-.5:n/_|0,y=0,x=zc,v=0;v<b;v++)m=v%_-d,f=p-(v/_|0),w[v]=g=h?Math.abs("y"===h?f:m):Vc(m*m+f*f),g>y&&(y=g),g<x&&(x=g);"random"===n&&xd(w),w.max=y-x,w.min=x,w.v=b=(parseFloat(e.amount)||parseFloat(e.each)*(_>b?b-1:h?"y"===h?b/_:_:Math.max(_,b/_))||0)*("edges"===n?-1:1),w.b=b<0?s-b:s,w.u=pd(e.amount||e.each)||0,i=i&&b<0?$d(i):i}return b=(w[t]-w.min)/w.max||0,Pu(w.b+(i?i(b):b)*w.v)+w.u}},bd=function(t){var e=Math.pow(10,((t+"").split(".")[1]||"").length);return function(i){var n=Pu(Math.round(parseFloat(i)/t)*t*e);return(n-n%1)/e+(qc(i)?0:pd(i))}},wd=function(t,e){var i,n,s=eu(t);return!s&&Kc(t)&&(i=s=t.radius||zc,t.values?(t=vd(t.values),(n=!qc(t[0]))&&(i*=i)):t=bd(t.increment)),ud(e,s?$c(t)?function(e){return n=t(e),Math.abs(n-e)<=i?n:e}:function(e){for(var s,r,o=parseFloat(n?e.x:e),a=parseFloat(n?e.y:0),h=zc,l=0,c=t.length;c--;)(s=n?(s=t[c].x-o)*s+(r=t[c].y-a)*r:Math.abs(t[c]-o))<h&&(h=s,l=c);return l=!i||h<=i?t[l]:e,n||l===e||qc(e)?l:l+pd(e)}:bd(t))},Md=function(t,e,i,n){return ud(eu(t)?!e:!0===i?!!(i=0):!n,(function(){return eu(t)?t[~~(Math.random()*t.length)]:(i=i||1e-5)&&(n=i<1?Math.pow(10,(i+"").length-2):1)&&Math.floor(Math.round((t-i/2+Math.random()*(e-t+.99*i))/i)*i*n)/n}))},Sd=function(t,e,i){return ud(i,(function(i){return t[~~e(i)]}))},Td=function(t){for(var e,i,n,s,r=0,o="";~(e=t.indexOf("random(",r));)n=t.indexOf(")",e),s="["===t.charAt(e+7),i=t.substr(e+7,n-e-7).match(s?au:iu),o+=t.substr(r,e-r)+Md(s?i:+i[0],s?0:+i[1],+i[2]||1e-5),r=n+1;return o+t.substr(r,t.length-r)},Ed=function(t,e,i,n,s){var r=e-t,o=n-i;return ud(s,(function(e){return i+((e-t)/r*o||0)}))},Ad=function(t,e,i){var n,s,r,o=t.labels,a=zc;for(n in o)(s=o[n]-e)<0==!!i&&s&&a>(s=Math.abs(s))&&(r=n,a=s);return r},Cd=function(t,e,i){var n,s,r,o=t.vars,a=o[e],h=Ac,l=t._ctx;if(a)return n=o[e+"Params"],s=o.callbackScope||t,i&&xu.length&&Lu(),l&&(Ac=l),r=n?a.apply(s,n):a.call(s),Ac=h,r},Id=function(t){return Wu(t),t.scrollTrigger&&t.scrollTrigger.kill(!!Ec),t.progress()<1&&Cd(t,"onInterrupt"),t},Rd=[],Pd=function(t){if(t)if(t=!t.name&&t.default||t,Jc()||t.headless){var e=t.name,i=$c(t),n=e&&!i&&t.init?function(){this._props=[]}:t,s={init:mu,render:wp,add:op,kill:Sp,modifier:Mp,rawVars:0},r={targetTest:0,get:0,getSetter:yp,aliases:{},register:0};if(Hd(),t!==n){if(bu[e])return;zu(n,zu(Gu(t,s),r)),Uu(n.prototype,Uu(s,Gu(t,r))),bu[n.prop=e]=n,t.targetTest&&(Su.push(n),yu[e]=1),e=("css"===e?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}pu(e,n),t.register&&t.register(Fp,n,Ap)}else Rd.push(t)},kd=255,Dd={aqua:[0,kd,kd],lime:[0,kd,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,kd],navy:[0,0,128],white:[kd,kd,kd],olive:[128,128,0],yellow:[kd,kd,0],orange:[kd,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[kd,0,0],pink:[kd,192,203],cyan:[0,kd,kd],transparent:[kd,kd,kd,0]},Ld=function(t,e,i){return(6*(t+=t<0?1:t>1?-1:0)<1?e+(i-e)*t*6:t<.5?i:3*t<2?e+(i-e)*(2/3-t)*6:e)*kd+.5|0},Od=function(t,e,i){var n,s,r,o,a,h,l,c,u,d,p=t?qc(t)?[t>>16,t>>8&kd,t&kd]:0:Dd.black;if(!p){if(","===t.substr(-1)&&(t=t.substr(0,t.length-1)),Dd[t])p=Dd[t];else if("#"===t.charAt(0)){if(t.length<6&&(n=t.charAt(1),s=t.charAt(2),r=t.charAt(3),t="#"+n+n+s+s+r+r+(5===t.length?t.charAt(4)+t.charAt(4):"")),9===t.length)return[(p=parseInt(t.substr(1,6),16))>>16,p>>8&kd,p&kd,parseInt(t.substr(7),16)/255];p=[(t=parseInt(t.substr(1),16))>>16,t>>8&kd,t&kd]}else if("hsl"===t.substr(0,3))if(p=d=t.match(iu),e){if(~t.indexOf("="))return p=t.match(nu),i&&p.length<4&&(p[3]=1),p}else o=+p[0]%360/360,a=+p[1]/100,n=2*(h=+p[2]/100)-(s=h<=.5?h*(a+1):h+a-h*a),p.length>3&&(p[3]*=1),p[0]=Ld(o+1/3,n,s),p[1]=Ld(o,n,s),p[2]=Ld(o-1/3,n,s);else p=t.match(iu)||Dd.transparent;p=p.map(Number)}return e&&!d&&(n=p[0]/kd,s=p[1]/kd,r=p[2]/kd,h=((l=Math.max(n,s,r))+(c=Math.min(n,s,r)))/2,l===c?o=a=0:(u=l-c,a=h>.5?u/(2-l-c):u/(l+c),o=l===n?(s-r)/u+(s<r?6:0):l===s?(r-n)/u+2:(n-s)/u+4,o*=60),p[0]=~~(o+.5),p[1]=~~(100*a+.5),p[2]=~~(100*h+.5)),i&&p.length<4&&(p[3]=1),p},Nd=function(t){var e=[],i=[],n=-1;return t.split(zd).forEach((function(t){var s=t.match(su)||[];e.push.apply(e,s),i.push(n+=s.length+1)})),e.c=i,e},Bd=function(t,e,i){var n,s,r,o,a="",h=(t+a).match(zd),l=e?"hsla(":"rgba(",c=0;if(!h)return t;if(h=h.map((function(t){return(t=Od(t,e,1))&&l+(e?t[0]+","+t[1]+"%,"+t[2]+"%,"+t[3]:t.join(","))+")"})),i&&(r=Nd(t),(n=i.c).join(a)!==r.c.join(a)))for(o=(s=t.replace(zd,"1").split(su)).length-1;c<o;c++)a+=s[c]+(~n.indexOf(c)?h.shift()||l+"0,0,0,0)":(r.length?r:h.length?h:i).shift());if(!s)for(o=(s=t.split(zd)).length-1;c<o;c++)a+=s[c]+h[c];return a+s[o]},zd=function(){var t,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(t in Dd)e+="|"+t+"\\b";return new RegExp(e+")","gi")}(),Ud=/hsl[a]?\(/,Fd=function(t){var e,i=t.join(" ");if(zd.lastIndex=0,zd.test(i))return e=Ud.test(i),t[1]=Bd(t[1],e),t[0]=Bd(t[0],e,Nd(t[1])),!0},Gd=function(){var t,e,i,n,s,r,o=Date.now,a=500,h=33,l=o(),c=l,u=1e3/240,d=u,p=[],m=function i(m){var f,g,v,y,x=o()-c,_=!0===m;if((x>a||x<0)&&(l+=x-h),((f=(v=(c+=x)-l)-d)>0||_)&&(y=++n.frame,s=v-1e3*n.time,n.time=v/=1e3,d+=f+(f>=u?4:u-f),g=1),_||(t=e(i)),g)for(r=0;r<p.length;r++)p[r](v,s,y,m)};return n={time:0,frame:0,tick:function(){m(!0)},deltaRatio:function(t){return s/(1e3/(t||60))},wake:function(){kc&&(!Rc&&Jc()&&(Ic=Rc=window,Pc=Ic.document||{},lu.gsap=Fp,(Ic.gsapVersions||(Ic.gsapVersions=[])).push(Fp.version),uu(cu||Ic.GreenSockGlobals||!Ic.gsap&&Ic||{}),Rd.forEach(Pd)),i="undefined"!=typeof requestAnimationFrame&&requestAnimationFrame,t&&n.sleep(),e=i||function(t){return setTimeout(t,d-1e3*n.time+1|0)},Oc=1,m(2))},sleep:function(){(i?cancelAnimationFrame:clearTimeout)(t),Oc=0,e=mu},lagSmoothing:function(t,e){a=t||1/0,h=Math.min(e||33,a)},fps:function(t){u=1e3/(t||240),d=1e3*n.time+u},add:function(t,e,i){var s=e?function(e,i,r,o){t(e,i,r,o),n.remove(s)}:t;return n.remove(t),p[i?"unshift":"push"](s),Hd(),s},remove:function(t,e){~(e=p.indexOf(t))&&p.splice(e,1)&&r>=e&&r--},_listeners:p}}(),Hd=function(){return!Oc&&Gd.wake()},Vd={},jd=/^[\d.\-M][\d.\-,\s]/,Wd=/["']/g,Xd=function(t){for(var e,i,n,s={},r=t.substr(1,t.length-3).split(":"),o=r[0],a=1,h=r.length;a<h;a++)i=r[a],e=a!==h-1?i.lastIndexOf(","):i.length,n=i.substr(0,e),s[o]=isNaN(n)?n.replace(Wd,"").trim():+n,o=i.substr(e+1).trim();return s},$d=function(t){return function(e){return 1-t(1-e)}},qd=function t(e,i){for(var n,s=e._first;s;)s instanceof ip?t(s,i):!s.vars.yoyoEase||s._yoyo&&s._repeat||s._yoyo===i||(s.timeline?t(s.timeline,i):(n=s._ease,s._ease=s._yEase,s._yEase=n,s._yoyo=i)),s=s._next},Yd=function(t,e){return t&&($c(t)?t:Vd[t]||function(t){var e,i,n,s,r=(t+"").split("("),o=Vd[r[0]];return o&&r.length>1&&o.config?o.config.apply(null,~t.indexOf("{")?[Xd(r[1])]:(e=t,i=e.indexOf("(")+1,n=e.indexOf(")"),s=e.indexOf("(",i),e.substring(i,~s&&s<n?e.indexOf(")",n+1):n)).split(",").map(Nu)):Vd._CE&&jd.test(t)?Vd._CE("",t):o}(t))||e},Kd=function(t,e,i,n){void 0===i&&(i=function(t){return 1-e(1-t)}),void 0===n&&(n=function(t){return t<.5?e(2*t)/2:1-e(2*(1-t))/2});var s,r={easeIn:e,easeOut:i,easeInOut:n};return Iu(t,(function(t){for(var e in Vd[t]=lu[t]=r,Vd[s=t.toLowerCase()]=i,r)Vd[s+("easeIn"===e?".in":"easeOut"===e?".out":".inOut")]=Vd[t+"."+e]=r[e]})),r},Zd=function(t){return function(e){return e<.5?(1-t(1-2*e))/2:.5+t(2*(e-.5))/2}},Jd=function t(e,i,n){var s=i>=1?i:1,r=(n||(e?.3:.45))/(i<1?i:1),o=r/Fc*(Math.asin(1/s)||0),a=function(t){return 1===t?1:s*Math.pow(2,-10*t)*Wc((t-o)*r)+1},h="out"===e?a:"in"===e?function(t){return 1-a(1-t)}:Zd(a);return r=Fc/r,h.config=function(i,n){return t(e,i,n)},h},Qd=function t(e,i){void 0===i&&(i=1.70158);var n=function(t){return t?--t*t*((i+1)*t+i)+1:0},s="out"===e?n:"in"===e?function(t){return 1-n(1-t)}:Zd(n);return s.config=function(i){return t(e,i)},s};Iu("Linear,Quad,Cubic,Quart,Quint,Strong",(function(t,e){var i=e<5?e+1:e;Kd(t+",Power"+(i-1),e?function(t){return Math.pow(t,i)}:function(t){return t},(function(t){return 1-Math.pow(1-t,i)}),(function(t){return t<.5?Math.pow(2*t,i)/2:1-Math.pow(2*(1-t),i)/2}))})),Vd.Linear.easeNone=Vd.none=Vd.Linear.easeIn,Kd("Elastic",Jd("in"),Jd("out"),Jd()),function(t,e){var i=1/e,n=function(n){return n<i?t*n*n:n<.7272727272727273?t*Math.pow(n-1.5/e,2)+.75:n<.9090909090909092?t*(n-=2.25/e)*n+.9375:t*Math.pow(n-2.625/e,2)+.984375};Kd("Bounce",(function(t){return 1-n(1-t)}),n)}(7.5625,2.75),Kd("Expo",(function(t){return t?Math.pow(2,10*(t-1)):0})),Kd("Circ",(function(t){return-(Vc(1-t*t)-1)})),Kd("Sine",(function(t){return 1===t?1:1-jc(t*Gc)})),Kd("Back",Qd("in"),Qd("out"),Qd()),Vd.SteppedEase=Vd.steps=lu.SteppedEase={config:function(t,e){void 0===t&&(t=1);var i=1/t,n=t+(e?0:1),s=e?1:0;return function(t){return((n*dd(0,.99999999,t)|0)+s)*i}}},Bc.ease=Vd["quad.out"],Iu("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(t){return Tu+=t+","+t+"Params,"}));var tp=function(t,e){this.id=Hc++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:Cu,this.set=e?e.getSetter:yp},ep=function(){function t(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,od(this,+t.duration,1,1),this.data=t.data,Ac&&(this._ctx=Ac,Ac.data.push(this)),Oc||Gd.wake()}var e=t.prototype;return e.delay=function(t){return t||0===t?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(this._repeat>0?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){return arguments.length?(this._dirty=0,od(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(t,e){if(Hd(),!arguments.length)return this._tTime;var i=this._dp;if(i&&i.smoothChildTiming&&this._ts){for(Qu(this,t),!i._dp||i.parent||td(i,this);i&&i.parent;)i.parent._time!==i._start+(i._ts>=0?i._tTime/i._ts:(i.totalDuration()-i._tTime)/-i._ts)&&i.totalTime(i._tTime,!0),i=i.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&t<this._tDur||this._ts<0&&t>0||!this._tDur&&!t)&&ed(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!e||this._initted&&Math.abs(this._zTime)===Uc||!t&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=t),Ou(this,t,e)),this},e.time=function(t,e){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+Yu(this))%(this._dur+this._rDelay)||(t?this._dur:0),e):this._time},e.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>0?1:0},e.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+Yu(this),e):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(t,e){var i=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*i,e):this._repeat?Ku(this._tTime,i)+1:1},e.timeScale=function(t,e){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===t)return this;var i=this.parent&&this._ts?Zu(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||-1e-8===t?0:this._rts,this.totalTime(dd(-Math.abs(this._delay),this._tDur,i),!1!==e),Ju(this),function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t}(this)},e.paused=function(t){return arguments.length?(this._ps!==t&&(this._ps=t,t?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Hd(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==Uc&&(this._tTime-=Uc)))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var e=this.parent||this._dp;return e&&(e._sort||!this.parent)&&ed(e,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(Zc(t)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(t){var e=this.parent||this._dp;return e?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Zu(e.rawTime(t),this):this._tTime:this._tTime},e.revert=function(t){void 0===t&&(t=vu);var e=Ec;return Ec=t,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(t),this.totalTime(-.01,t.suppressEvents)),"nested"!==this.data&&!1!==t.kill&&this.kill(),Ec=e,this},e.globalTime=function(t){for(var e=this,i=arguments.length?t:e.rawTime();e;)i=e._start+i/(Math.abs(e._ts)||1),e=e._dp;return!this.parent&&this._sat?this._sat.globalTime(t):i},e.repeat=function(t){return arguments.length?(this._repeat=t===1/0?-2:t,ad(this)):-2===this._repeat?1/0:this._repeat},e.repeatDelay=function(t){if(arguments.length){var e=this._time;return this._rDelay=t,ad(this),e?this.time(e):this}return this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,e){return this.totalTime(ld(this,t),Zc(e))},e.restart=function(t,e){return this.play().totalTime(t?-this._delay:0,Zc(e))},e.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},e.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},e.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-1e-8:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},e.isActive=function(){var t,e=this.parent||this._dp,i=this._start;return!(e&&!(this._ts&&this._initted&&e.isActive()&&(t=e.rawTime(!0))>=i&&t<this.endTime(!0)-Uc))},e.eventCallback=function(t,e,i){var n=this.vars;return arguments.length>1?(e?(n[t]=e,i&&(n[t+"Params"]=i),"onUpdate"===t&&(this._onUpdate=e)):delete n[t],this):n[t]},e.then=function(t){var e=this;return new Promise((function(i){var n=$c(t)?t:Bu,s=function(){var t=e.then;e.then=null,$c(n)&&(n=n(e))&&(n.then||n===e)&&(e.then=t),i(n),e.then=t};e._initted&&1===e.totalProgress()&&e._ts>=0||!e._tTime&&e._ts<0?s():e._prom=s}))},e.kill=function(){Id(this)},t}();zu(ep.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var ip=function(t){function e(e,i){var n;return void 0===e&&(e={}),(n=t.call(this,e)||this).labels={},n.smoothChildTiming=!!e.smoothChildTiming,n.autoRemoveChildren=!!e.autoRemoveChildren,n._sort=Zc(e.sortChildren),Cc&&ed(e.parent||Cc,Mc(n),i),e.reversed&&n.reverse(),e.paused&&n.paused(!0),e.scrollTrigger&&id(Mc(n),e.scrollTrigger),n}Sc(e,t);var i=e.prototype;return i.to=function(t,e,i){return cd(0,arguments,this),this},i.from=function(t,e,i){return cd(1,arguments,this),this},i.fromTo=function(t,e,i,n){return cd(2,arguments,this),this},i.set=function(t,e,i){return e.duration=0,e.parent=this,Hu(e).repeatDelay||(e.repeat=0),e.immediateRender=!!e.immediateRender,new pp(t,e,ld(this,i),1),this},i.call=function(t,e,i){return ed(this,pp.delayedCall(0,t,e),i)},i.staggerTo=function(t,e,i,n,s,r,o){return i.duration=e,i.stagger=i.stagger||n,i.onComplete=r,i.onCompleteParams=o,i.parent=this,new pp(t,i,ld(this,s)),this},i.staggerFrom=function(t,e,i,n,s,r,o){return i.runBackwards=1,Hu(i).immediateRender=Zc(i.immediateRender),this.staggerTo(t,e,i,n,s,r,o)},i.staggerFromTo=function(t,e,i,n,s,r,o,a){return n.startAt=i,Hu(n).immediateRender=Zc(n.immediateRender),this.staggerTo(t,e,n,s,r,o,a)},i.render=function(t,e,i){var n,s,r,o,a,h,l,c,u,d,p,m,f=this._time,g=this._dirty?this.totalDuration():this._tDur,v=this._dur,y=t<=0?0:Pu(t),x=this._zTime<0!=t<0&&(this._initted||!v);if(this!==Cc&&y>g&&t>=0&&(y=g),y!==this._tTime||i||x){if(f!==this._time&&v&&(y+=this._time-f,t+=this._time-f),n=y,u=this._start,h=!(c=this._ts),x&&(v||(f=this._zTime),(t||!e)&&(this._zTime=t)),this._repeat){if(p=this._yoyo,a=v+this._rDelay,this._repeat<-1&&t<0)return this.totalTime(100*a+t,e,i);if(n=Pu(y%a),y===g?(o=this._repeat,n=v):((o=~~(y/a))&&o===y/a&&(n=v,o--),n>v&&(n=v)),d=Ku(this._tTime,a),!f&&this._tTime&&d!==o&&this._tTime-d*a-this._dur<=0&&(d=o),p&&1&o&&(n=v-n,m=1),o!==d&&!this._lock){var _=p&&1&d,b=_===(p&&1&o);if(o<d&&(_=!_),f=_?0:y%v?v:y,this._lock=1,this.render(f||(m?0:Pu(o*a)),e,!v)._lock=0,this._tTime=y,!e&&this.parent&&Cd(this,"onRepeat"),this.vars.repeatRefresh&&!m&&(this.invalidate()._lock=1),f&&f!==this._time||h!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(v=this._dur,g=this._tDur,b&&(this._lock=2,f=_?v:-1e-4,this.render(f,!0),this.vars.repeatRefresh&&!m&&this.invalidate()),this._lock=0,!this._ts&&!h)return this;qd(this,m)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(l=function(t,e,i){var n;if(i>e)for(n=t._first;n&&n._start<=i;){if("isPause"===n.data&&n._start>e)return n;n=n._next}else for(n=t._last;n&&n._start>=i;){if("isPause"===n.data&&n._start<e)return n;n=n._prev}}(this,Pu(f),Pu(n)),l&&(y-=n-(n=l._start))),this._tTime=y,this._time=n,this._act=!c,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=t,f=0),!f&&n&&!e&&!o&&(Cd(this,"onStart"),this._tTime!==y))return this;if(n>=f&&t>=0)for(s=this._first;s;){if(r=s._next,(s._act||n>=s._start)&&s._ts&&l!==s){if(s.parent!==this)return this.render(t,e,i);if(s.render(s._ts>0?(n-s._start)*s._ts:(s._dirty?s.totalDuration():s._tDur)+(n-s._start)*s._ts,e,i),n!==this._time||!this._ts&&!h){l=0,r&&(y+=this._zTime=-1e-8);break}}s=r}else{s=this._last;for(var w=t<0?t:n;s;){if(r=s._prev,(s._act||w<=s._end)&&s._ts&&l!==s){if(s.parent!==this)return this.render(t,e,i);if(s.render(s._ts>0?(w-s._start)*s._ts:(s._dirty?s.totalDuration():s._tDur)+(w-s._start)*s._ts,e,i||Ec&&(s._initted||s._startAt)),n!==this._time||!this._ts&&!h){l=0,r&&(y+=this._zTime=w?-1e-8:Uc);break}}s=r}}if(l&&!e&&(this.pause(),l.render(n>=f?0:-1e-8)._zTime=n>=f?1:-1,this._ts))return this._start=u,Ju(this),this.render(t,e,i);this._onUpdate&&!e&&Cd(this,"onUpdate",!0),(y===g&&this._tTime>=this.totalDuration()||!y&&f)&&(u!==this._start&&Math.abs(c)===Math.abs(this._ts)||this._lock||((t||!v)&&(y===g&&this._ts>0||!y&&this._ts<0)&&Wu(this,1),e||t<0&&!f||!y&&!f&&g||(Cd(this,y===g&&t>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(y<g&&this.timeScale()>0)&&this._prom())))}return this},i.add=function(t,e){var i=this;if(qc(e)||(e=ld(this,e,t)),!(t instanceof ep)){if(eu(t))return t.forEach((function(t){return i.add(t,e)})),this;if(Xc(t))return this.addLabel(t,e);if(!$c(t))return this;t=pp.delayedCall(0,t)}return this!==t?ed(this,t,e):this},i.getChildren=function(t,e,i,n){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===n&&(n=-zc);for(var s=[],r=this._first;r;)r._start>=n&&(r instanceof pp?e&&s.push(r):(i&&s.push(r),t&&s.push.apply(s,r.getChildren(!0,e,i)))),r=r._next;return s},i.getById=function(t){for(var e=this.getChildren(1,1,1),i=e.length;i--;)if(e[i].vars.id===t)return e[i]},i.remove=function(t){return Xc(t)?this.removeLabel(t):$c(t)?this.killTweensOf(t):(ju(this,t),t===this._recent&&(this._recent=this._last),Xu(this))},i.totalTime=function(e,i){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Pu(Gd.time-(this._ts>0?e/this._ts:(this.totalDuration()-e)/-this._ts))),t.prototype.totalTime.call(this,e,i),this._forcing=0,this):this._tTime},i.addLabel=function(t,e){return this.labels[t]=ld(this,e),this},i.removeLabel=function(t){return delete this.labels[t],this},i.addPause=function(t,e,i){var n=pp.delayedCall(0,e||mu,i);return n.data="isPause",this._hasPause=1,ed(this,n,ld(this,t))},i.removePause=function(t){var e=this._first;for(t=ld(this,t);e;)e._start===t&&"isPause"===e.data&&Wu(e),e=e._next},i.killTweensOf=function(t,e,i){for(var n=this.getTweensOf(t,i),s=n.length;s--;)np!==n[s]&&n[s].kill(t,e);return this},i.getTweensOf=function(t,e){for(var i,n=[],s=vd(t),r=this._first,o=qc(e);r;)r instanceof pp?Du(r._targets,s)&&(o?(!np||r._initted&&r._ts)&&r.globalTime(0)<=e&&r.globalTime(r.totalDuration())>e:!e||r.isActive())&&n.push(r):(i=r.getTweensOf(s,e)).length&&n.push.apply(n,i),r=r._next;return n},i.tweenTo=function(t,e){e=e||{};var i,n=this,s=ld(n,t),r=e,o=r.startAt,a=r.onStart,h=r.onStartParams,l=r.immediateRender,c=pp.to(n,zu({ease:e.ease||"none",lazy:!1,immediateRender:!1,time:s,overwrite:"auto",duration:e.duration||Math.abs((s-(o&&"time"in o?o.time:n._time))/n.timeScale())||Uc,onStart:function(){if(n.pause(),!i){var t=e.duration||Math.abs((s-(o&&"time"in o?o.time:n._time))/n.timeScale());c._dur!==t&&od(c,t,0,1).render(c._time,!0,!0),i=1}a&&a.apply(c,h||[])}},e));return l?c.render(0):c},i.tweenFromTo=function(t,e,i){return this.tweenTo(e,zu({startAt:{time:ld(this,t)}},i))},i.recent=function(){return this._recent},i.nextLabel=function(t){return void 0===t&&(t=this._time),Ad(this,ld(this,t))},i.previousLabel=function(t){return void 0===t&&(t=this._time),Ad(this,ld(this,t),1)},i.currentLabel=function(t){return arguments.length?this.seek(t,!0):this.previousLabel(this._time+Uc)},i.shiftChildren=function(t,e,i){void 0===i&&(i=0);for(var n,s=this._first,r=this.labels;s;)s._start>=i&&(s._start+=t,s._end+=t),s=s._next;if(e)for(n in r)r[n]>=i&&(r[n]+=t);return Xu(this)},i.invalidate=function(e){var i=this._first;for(this._lock=0;i;)i.invalidate(e),i=i._next;return t.prototype.invalidate.call(this,e)},i.clear=function(t){void 0===t&&(t=!0);for(var e,i=this._first;i;)e=i._next,this.remove(i),i=e;return this._dp&&(this._time=this._tTime=this._pTime=0),t&&(this.labels={}),Xu(this)},i.totalDuration=function(t){var e,i,n,s=0,r=this,o=r._last,a=zc;if(arguments.length)return r.timeScale((r._repeat<0?r.duration():r.totalDuration())/(r.reversed()?-t:t));if(r._dirty){for(n=r.parent;o;)e=o._prev,o._dirty&&o.totalDuration(),(i=o._start)>a&&r._sort&&o._ts&&!r._lock?(r._lock=1,ed(r,o,i-o._delay,1)._lock=0):a=i,i<0&&o._ts&&(s-=i,(!n&&!r._dp||n&&n.smoothChildTiming)&&(r._start+=i/r._ts,r._time-=i,r._tTime-=i),r.shiftChildren(-i,!1,-Infinity),a=0),o._end>s&&o._ts&&(s=o._end),o=e;od(r,r===Cc&&r._time>s?r._time:s,1,1),r._dirty=0}return r._tDur},e.updateRoot=function(t){if(Cc._ts&&(Ou(Cc,Zu(t,Cc)),Dc=Gd.frame),Gd.frame>=Mu){Mu+=Nc.autoSleep||120;var e=Cc._first;if((!e||!e._ts)&&Nc.autoSleep&&Gd._listeners.length<2){for(;e&&!e._ts;)e=e._next;e||Gd.sleep()}}},e}(ep);zu(ip.prototype,{_lock:0,_hasPause:0,_forcing:0});var np,sp,rp=function(t,e,i,n,s,r,o){var a,h,l,c,u,d,p,m,f=new Ap(this._pt,t,e,0,1,bp,null,s),g=0,v=0;for(f.b=i,f.e=n,i+="",(p=~(n+="").indexOf("random("))&&(n=Td(n)),r&&(r(m=[i,n],t,e),i=m[0],n=m[1]),h=i.match(ru)||[];a=ru.exec(n);)c=a[0],u=n.substring(g,a.index),l?l=(l+1)%5:"rgba("===u.substr(-5)&&(l=1),c!==h[v++]&&(d=parseFloat(h[v-1])||0,f._pt={_next:f._pt,p:u||1===v?u:",",s:d,c:"="===c.charAt(1)?ku(d,c)-d:parseFloat(c)-d,m:l&&l<4?Math.round:0},g=ru.lastIndex);return f.c=g<n.length?n.substring(g,n.length):"",f.fp=o,(ou.test(n)||p)&&(f.e=0),this._pt=f,f},op=function(t,e,i,n,s,r,o,a,h,l){$c(n)&&(n=n(s||0,t,r));var c,u=t[e],d="get"!==i?i:$c(u)?h?t[e.indexOf("set")||!$c(t["get"+e.substr(3)])?e:"get"+e.substr(3)](h):t[e]():u,p=$c(u)?h?gp:fp:mp;if(Xc(n)&&(~n.indexOf("random(")&&(n=Td(n)),"="===n.charAt(1)&&((c=ku(d,n)+(pd(d)||0))||0===c)&&(n=c)),!l||d!==n||sp)return isNaN(d*n)||""===n?rp.call(this,t,e,d,n,p,a||Nc.stringFilter,h):(c=new Ap(this._pt,t,e,+d||0,n-(d||0),"boolean"==typeof u?_p:xp,0,p),h&&(c.fp=h),o&&c.modifier(o,this,t),this._pt=c)},ap=function(t,e,i,n,s,r){var o,a,h,l;if(bu[t]&&!1!==(o=new bu[t]).init(s,o.rawVars?e[t]:function(t,e,i,n,s){if($c(t)&&(t=cp(t,s,e,i,n)),!Kc(t)||t.style&&t.nodeType||eu(t)||tu(t))return Xc(t)?cp(t,s,e,i,n):t;var r,o={};for(r in t)o[r]=cp(t[r],s,e,i,n);return o}(e[t],n,s,r,i),i,n,r)&&(i._pt=a=new Ap(i._pt,s,t,0,1,o.render,o,0,o.priority),i!==Lc))for(h=i._ptLookup[i._targets.indexOf(s)],l=o._props.length;l--;)h[o._props[l]]=a;return o},hp=function t(e,i,n){var s,r,o,a,h,l,c,u,d,p,m,f,g,v=e.vars,y=v.ease,x=v.startAt,_=v.immediateRender,b=v.lazy,w=v.onUpdate,M=v.runBackwards,S=v.yoyoEase,T=v.keyframes,E=v.autoRevert,A=e._dur,C=e._startAt,I=e._targets,R=e.parent,P=R&&"nested"===R.data?R.vars.targets:I,k="auto"===e._overwrite&&!Tc,D=e.timeline;if(D&&(!T||!y)&&(y="none"),e._ease=Yd(y,Bc.ease),e._yEase=S?$d(Yd(!0===S?y:S,Bc.ease)):0,S&&e._yoyo&&!e._repeat&&(S=e._yEase,e._yEase=e._ease,e._ease=S),e._from=!D&&!!v.runBackwards,!D||T&&!v.stagger){if(f=(u=I[0]?Au(I[0]).harness:0)&&v[u.prop],s=Gu(v,yu),C&&(C._zTime<0&&C.progress(1),i<0&&M&&_&&!E?C.render(-1,!0):C.revert(M&&A?gu:fu),C._lazy=0),x){if(Wu(e._startAt=pp.set(I,zu({data:"isStart",overwrite:!1,parent:R,immediateRender:!0,lazy:!C&&Zc(b),startAt:null,delay:0,onUpdate:w&&function(){return Cd(e,"onUpdate")},stagger:0},x))),e._startAt._dp=0,e._startAt._sat=e,i<0&&(Ec||!_&&!E)&&e._startAt.revert(gu),_&&A&&i<=0&&n<=0)return void(i&&(e._zTime=i))}else if(M&&A&&!C)if(i&&(_=!1),o=zu({overwrite:!1,data:"isFromStart",lazy:_&&!C&&Zc(b),immediateRender:_,stagger:0,parent:R},s),f&&(o[u.prop]=f),Wu(e._startAt=pp.set(I,o)),e._startAt._dp=0,e._startAt._sat=e,i<0&&(Ec?e._startAt.revert(gu):e._startAt.render(-1,!0)),e._zTime=i,_){if(!i)return}else t(e._startAt,Uc,Uc);for(e._pt=e._ptCache=0,b=A&&Zc(b)||b&&!A,r=0;r<I.length;r++){if(c=(h=I[r])._gsap||Eu(I)[r]._gsap,e._ptLookup[r]=p={},_u[c.id]&&xu.length&&Lu(),m=P===I?r:P.indexOf(h),u&&!1!==(d=new u).init(h,f||s,e,m,P)&&(e._pt=a=new Ap(e._pt,h,d.name,0,1,d.render,d,0,d.priority),d._props.forEach((function(t){p[t]=a})),d.priority&&(l=1)),!u||f)for(o in s)bu[o]&&(d=ap(o,s,e,m,h,P))?d.priority&&(l=1):p[o]=a=op.call(e,h,o,"get",s[o],m,P,0,v.stringFilter);e._op&&e._op[r]&&e.kill(h,e._op[r]),k&&e._pt&&(np=e,Cc.killTweensOf(h,p,e.globalTime(i)),g=!e.parent,np=0),e._pt&&b&&(_u[c.id]=1)}l&&Ep(e),e._onInit&&e._onInit(e)}e._onUpdate=w,e._initted=(!e._op||e._pt)&&!g,T&&i<=0&&D.render(zc,!0,!0)},lp=function(t,e,i,n){var s,r,o=e.ease||n||"power1.inOut";if(eu(e))r=i[t]||(i[t]=[]),e.forEach((function(t,i){return r.push({t:i/(e.length-1)*100,v:t,e:o})}));else for(s in e)r=i[s]||(i[s]=[]),"ease"===s||r.push({t:parseFloat(t),v:e[s],e:o})},cp=function(t,e,i,n,s){return $c(t)?t.call(e,i,n,s):Xc(t)&&~t.indexOf("random(")?Td(t):t},up=Tu+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",dp={};Iu(up+",id,stagger,delay,duration,paused,scrollTrigger",(function(t){return dp[t]=1}));var pp=function(t){function e(e,i,n,s){var r;"number"==typeof i&&(n.duration=i,i=n,n=null);var o,a,h,l,c,u,d,p,m=(r=t.call(this,s?i:Hu(i))||this).vars,f=m.duration,g=m.delay,v=m.immediateRender,y=m.stagger,x=m.overwrite,_=m.keyframes,b=m.defaults,w=m.scrollTrigger,M=m.yoyoEase,S=i.parent||Cc,T=(eu(e)||tu(e)?qc(e[0]):"length"in i)?[e]:vd(e);if(r._targets=T.length?Eu(T):du(0,!Nc.nullTargetWarn)||[],r._ptLookup=[],r._overwrite=x,_||y||Qc(f)||Qc(g)){if(i=r.vars,(o=r.timeline=new ip({data:"nested",defaults:b||{},targets:S&&"nested"===S.data?S.vars.targets:T})).kill(),o.parent=o._dp=Mc(r),o._start=0,y||Qc(f)||Qc(g)){if(l=T.length,d=y&&_d(y),Kc(y))for(c in y)~up.indexOf(c)&&(p||(p={}),p[c]=y[c]);for(a=0;a<l;a++)(h=Gu(i,dp)).stagger=0,M&&(h.yoyoEase=M),p&&Uu(h,p),u=T[a],h.duration=+cp(f,Mc(r),a,u,T),h.delay=(+cp(g,Mc(r),a,u,T)||0)-r._delay,!y&&1===l&&h.delay&&(r._delay=g=h.delay,r._start+=g,h.delay=0),o.to(u,h,d?d(a,u,T):0),o._ease=Vd.none;o.duration()?f=g=0:r.timeline=0}else if(_){Hu(zu(o.vars.defaults,{ease:"none"})),o._ease=Yd(_.ease||i.ease||"none");var E,A,C,I=0;if(eu(_))_.forEach((function(t){return o.to(T,t,">")})),o.duration();else{for(c in h={},_)"ease"===c||"easeEach"===c||lp(c,_[c],h,_.easeEach);for(c in h)for(E=h[c].sort((function(t,e){return t.t-e.t})),I=0,a=0;a<E.length;a++)(C={ease:(A=E[a]).e,duration:(A.t-(a?E[a-1].t:0))/100*f})[c]=A.v,o.to(T,C,I),I+=C.duration;o.duration()<f&&o.to({},{duration:f-o.duration()})}}f||r.duration(f=o.duration())}else r.timeline=0;return!0!==x||Tc||(np=Mc(r),Cc.killTweensOf(T),np=0),ed(S,Mc(r),n),i.reversed&&r.reverse(),i.paused&&r.paused(!0),(v||!f&&!_&&r._start===Pu(S._time)&&Zc(v)&&qu(Mc(r))&&"nested"!==S.data)&&(r._tTime=-1e-8,r.render(Math.max(0,-g)||0)),w&&id(Mc(r),w),r}Sc(e,t);var i=e.prototype;return i.render=function(t,e,i){var n,s,r,o,a,h,l,c,u,d=this._time,p=this._tDur,m=this._dur,f=t<0,g=t>p-Uc&&!f?p:t<Uc?0:t;if(m){if(g!==this._tTime||!t||i||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==f){if(n=g,c=this.timeline,this._repeat){if(o=m+this._rDelay,this._repeat<-1&&f)return this.totalTime(100*o+t,e,i);if(n=Pu(g%o),g===p?(r=this._repeat,n=m):((r=~~(g/o))&&r===Pu(g/o)&&(n=m,r--),n>m&&(n=m)),(h=this._yoyo&&1&r)&&(u=this._yEase,n=m-n),a=Ku(this._tTime,o),n===d&&!i&&this._initted&&r===a)return this._tTime=g,this;r!==a&&(c&&this._yEase&&qd(c,h),this.vars.repeatRefresh&&!h&&!this._lock&&this._time!==o&&this._initted&&(this._lock=i=1,this.render(Pu(o*r),!0).invalidate()._lock=0))}if(!this._initted){if(nd(this,f?t:n,i,e,g))return this._tTime=0,this;if(!(d===this._time||i&&this.vars.repeatRefresh&&r!==a))return this;if(m!==this._dur)return this.render(t,e,i)}if(this._tTime=g,this._time=n,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=l=(u||this._ease)(n/m),this._from&&(this.ratio=l=1-l),n&&!d&&!e&&!r&&(Cd(this,"onStart"),this._tTime!==g))return this;for(s=this._pt;s;)s.r(l,s.d),s=s._next;c&&c.render(t<0?t:c._dur*c._ease(n/this._dur),e,i)||this._startAt&&(this._zTime=t),this._onUpdate&&!e&&(f&&$u(this,t,0,i),Cd(this,"onUpdate")),this._repeat&&r!==a&&this.vars.onRepeat&&!e&&this.parent&&Cd(this,"onRepeat"),g!==this._tDur&&g||this._tTime!==g||(f&&!this._onUpdate&&$u(this,t,0,!0),(t||!m)&&(g===this._tDur&&this._ts>0||!g&&this._ts<0)&&Wu(this,1),e||f&&!d||!(g||d||h)||(Cd(this,g===p?"onComplete":"onReverseComplete",!0),this._prom&&!(g<p&&this.timeScale()>0)&&this._prom()))}}else!function(t,e,i,n){var s,r,o,a=t.ratio,h=e<0||!e&&(!t._start&&sd(t)&&(t._initted||!rd(t))||(t._ts<0||t._dp._ts<0)&&!rd(t))?0:1,l=t._rDelay,c=0;if(l&&t._repeat&&(c=dd(0,t._tDur,e),r=Ku(c,l),t._yoyo&&1&r&&(h=1-h),r!==Ku(t._tTime,l)&&(a=1-h,t.vars.repeatRefresh&&t._initted&&t.invalidate())),h!==a||Ec||n||t._zTime===Uc||!e&&t._zTime){if(!t._initted&&nd(t,e,n,i,c))return;for(o=t._zTime,t._zTime=e||(i?Uc:0),i||(i=e&&!o),t.ratio=h,t._from&&(h=1-h),t._time=0,t._tTime=c,s=t._pt;s;)s.r(h,s.d),s=s._next;e<0&&$u(t,e,0,!0),t._onUpdate&&!i&&Cd(t,"onUpdate"),c&&t._repeat&&!i&&t.parent&&Cd(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===h&&(h&&Wu(t,1),i||Ec||(Cd(t,h?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)}(this,t,e,i);return this},i.targets=function(){return this._targets},i.invalidate=function(e){return(!e||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(e),t.prototype.invalidate.call(this,e)},i.resetTo=function(t,e,i,n,s){Oc||Gd.wake(),this._ts||this.play();var r=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||hp(this,r),function(t,e,i,n,s,r,o,a){var h,l,c,u,d=(t._pt&&t._ptCache||(t._ptCache={}))[e];if(!d)for(d=t._ptCache[e]=[],c=t._ptLookup,u=t._targets.length;u--;){if((h=c[u][e])&&h.d&&h.d._pt)for(h=h.d._pt;h&&h.p!==e&&h.fp!==e;)h=h._next;if(!h)return sp=1,t.vars[e]="+=0",hp(t,o),sp=0,a?du():1;d.push(h)}for(u=d.length;u--;)(h=(l=d[u])._pt||l).s=!n&&0!==n||s?h.s+(n||0)+r*h.c:n,h.c=i-h.s,l.e&&(l.e=Ru(i)+pd(l.e)),l.b&&(l.b=h.s+pd(l.b))}(this,t,e,i,n,this._ease(r/this._dur),r,s)?this.resetTo(t,e,i,n,1):(Qu(this,0),this.parent||Vu(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},i.kill=function(t,e){if(void 0===e&&(e="all"),!(t||e&&"all"!==e))return this._lazy=this._pt=0,this.parent?Id(this):this;if(this.timeline){var i=this.timeline.totalDuration();return this.timeline.killTweensOf(t,e,np&&!0!==np.vars.overwrite)._first||Id(this),this.parent&&i!==this.timeline.totalDuration()&&od(this,this._dur*this.timeline._tDur/i,0,1),this}var n,s,r,o,a,h,l,c=this._targets,u=t?vd(t):c,d=this._ptLookup,p=this._pt;if((!e||"all"===e)&&function(t,e){for(var i=t.length,n=i===e.length;n&&i--&&t[i]===e[i];);return i<0}(c,u))return"all"===e&&(this._pt=0),Id(this);for(n=this._op=this._op||[],"all"!==e&&(Xc(e)&&(a={},Iu(e,(function(t){return a[t]=1})),e=a),e=function(t,e){var i,n,s,r,o=t[0]?Au(t[0]).harness:0,a=o&&o.aliases;if(!a)return e;for(n in i=Uu({},e),a)if(n in i)for(s=(r=a[n].split(",")).length;s--;)i[r[s]]=i[n];return i}(c,e)),l=c.length;l--;)if(~u.indexOf(c[l]))for(a in s=d[l],"all"===e?(n[l]=e,o=s,r={}):(r=n[l]=n[l]||{},o=e),o)(h=s&&s[a])&&("kill"in h.d&&!0!==h.d.kill(a)||ju(this,h,"_pt"),delete s[a]),"all"!==r&&(r[a]=1);return this._initted&&!this._pt&&p&&Id(this),this},e.to=function(t,i){return new e(t,i,arguments[2])},e.from=function(t,e){return cd(1,arguments)},e.delayedCall=function(t,i,n,s){return new e(i,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:t,onComplete:i,onReverseComplete:i,onCompleteParams:n,onReverseCompleteParams:n,callbackScope:s})},e.fromTo=function(t,e,i){return cd(2,arguments)},e.set=function(t,i){return i.duration=0,i.repeatDelay||(i.repeat=0),new e(t,i)},e.killTweensOf=function(t,e,i){return Cc.killTweensOf(t,e,i)},e}(ep);zu(pp.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),Iu("staggerTo,staggerFrom,staggerFromTo",(function(t){pp[t]=function(){var e=new ip,i=md.call(arguments,0);return i.splice("staggerFromTo"===t?5:4,0,0),e[t].apply(e,i)}}));var mp=function(t,e,i){return t[e]=i},fp=function(t,e,i){return t[e](i)},gp=function(t,e,i,n){return t[e](n.fp,i)},vp=function(t,e,i){return t.setAttribute(e,i)},yp=function(t,e){return $c(t[e])?fp:Yc(t[e])&&t.setAttribute?vp:mp},xp=function(t,e){return e.set(e.t,e.p,Math.round(1e6*(e.s+e.c*t))/1e6,e)},_p=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},bp=function(t,e){var i=e._pt,n="";if(!t&&e.b)n=e.b;else if(1===t&&e.e)n=e.e;else{for(;i;)n=i.p+(i.m?i.m(i.s+i.c*t):Math.round(1e4*(i.s+i.c*t))/1e4)+n,i=i._next;n+=e.c}e.set(e.t,e.p,n,e)},wp=function(t,e){for(var i=e._pt;i;)i.r(t,i.d),i=i._next},Mp=function(t,e,i,n){for(var s,r=this._pt;r;)s=r._next,r.p===n&&r.modifier(t,e,i),r=s},Sp=function(t){for(var e,i,n=this._pt;n;)i=n._next,n.p===t&&!n.op||n.op===t?ju(this,n,"_pt"):n.dep||(e=1),n=i;return!e},Tp=function(t,e,i,n){n.mSet(t,e,n.m.call(n.tween,i,n.mt),n)},Ep=function(t){for(var e,i,n,s,r=t._pt;r;){for(e=r._next,i=n;i&&i.pr>r.pr;)i=i._next;(r._prev=i?i._prev:s)?r._prev._next=r:n=r,(r._next=i)?i._prev=r:s=r,r=e}t._pt=n},Ap=function(){function t(t,e,i,n,s,r,o,a,h){this.t=e,this.s=n,this.c=s,this.p=i,this.r=r||xp,this.d=o||this,this.set=a||mp,this.pr=h||0,this._next=t,t&&(t._prev=this)}return t.prototype.modifier=function(t,e,i){this.mSet=this.mSet||this.set,this.set=Tp,this.m=t,this.mt=i,this.tween=e},t}();Iu(Tu+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(t){return yu[t]=1})),lu.TweenMax=lu.TweenLite=pp,lu.TimelineLite=lu.TimelineMax=ip,Cc=new ip({sortChildren:!1,defaults:Bc,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),Nc.stringFilter=Fd;var Cp=[],Ip={},Rp=[],Pp=0,kp=0,Dp=function(t){return(Ip[t]||Rp).map((function(t){return t()}))},Lp=function(){var t=Date.now(),e=[];t-Pp>2&&(Dp("matchMediaInit"),Cp.forEach((function(t){var i,n,s,r,o=t.queries,a=t.conditions;for(n in o)(i=Ic.matchMedia(o[n]).matches)&&(s=1),i!==a[n]&&(a[n]=i,r=1);r&&(t.revert(),s&&e.push(t))})),Dp("matchMediaRevert"),e.forEach((function(t){return t.onMatch(t,(function(e){return t.add(null,e)}))})),Pp=t,Dp("matchMedia"))},Op=function(){function t(t,e){this.selector=e&&yd(e),this.data=[],this._r=[],this.isReverted=!1,this.id=kp++,t&&this.add(t)}var e=t.prototype;return e.add=function(t,e,i){$c(t)&&(i=e,e=t,t=$c);var n=this,s=function(){var t,s=Ac,r=n.selector;return s&&s!==n&&s.data.push(n),i&&(n.selector=yd(i)),Ac=n,t=e.apply(n,arguments),$c(t)&&n._r.push(t),Ac=s,n.selector=r,n.isReverted=!1,t};return n.last=s,t===$c?s(n,(function(t){return n.add(null,t)})):t?n[t]=s:s},e.ignore=function(t){var e=Ac;Ac=null,t(this),Ac=e},e.getTweens=function(){var e=[];return this.data.forEach((function(i){return i instanceof t?e.push.apply(e,i.getTweens()):i instanceof pp&&!(i.parent&&"nested"===i.parent.data)&&e.push(i)})),e},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(t,e){var i=this;if(t?function(){for(var e,n=i.getTweens(),s=i.data.length;s--;)"isFlip"===(e=i.data[s]).data&&(e.revert(),e.getChildren(!0,!0,!1).forEach((function(t){return n.splice(n.indexOf(t),1)})));for(n.map((function(t){return{g:t._dur||t._delay||t._sat&&!t._sat.vars.immediateRender?t.globalTime(0):-1/0,t}})).sort((function(t,e){return e.g-t.g||-1/0})).forEach((function(e){return e.t.revert(t)})),s=i.data.length;s--;)(e=i.data[s])instanceof ip?"nested"!==e.data&&(e.scrollTrigger&&e.scrollTrigger.revert(),e.kill()):!(e instanceof pp)&&e.revert&&e.revert(t);i._r.forEach((function(e){return e(t,i)})),i.isReverted=!0}():this.data.forEach((function(t){return t.kill&&t.kill()})),this.clear(),e)for(var n=Cp.length;n--;)Cp[n].id===this.id&&Cp.splice(n,1)},e.revert=function(t){this.kill(t||{})},t}(),Np=function(){function t(t){this.contexts=[],this.scope=t,Ac&&Ac.data.push(this)}var e=t.prototype;return e.add=function(t,e,i){Kc(t)||(t={matches:t});var n,s,r,o=new Op(0,i||this.scope),a=o.conditions={};for(s in Ac&&!o.selector&&(o.selector=Ac.selector),this.contexts.push(o),e=o.add("onMatch",e),o.queries=t,t)"all"===s?r=1:(n=Ic.matchMedia(t[s]))&&(Cp.indexOf(o)<0&&Cp.push(o),(a[s]=n.matches)&&(r=1),n.addListener?n.addListener(Lp):n.addEventListener("change",Lp));return r&&e(o,(function(t){return o.add(null,t)})),this},e.revert=function(t){this.kill(t||{})},e.kill=function(t){this.contexts.forEach((function(e){return e.kill(t,!0)}))},t}(),Bp={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];e.forEach((function(t){return Pd(t)}))},timeline:function(t){return new ip(t)},getTweensOf:function(t,e){return Cc.getTweensOf(t,e)},getProperty:function(t,e,i,n){Xc(t)&&(t=vd(t)[0]);var s=Au(t||{}).get,r=i?Bu:Nu;return"native"===i&&(i=""),t?e?r((bu[e]&&bu[e].get||s)(t,e,i,n)):function(e,i,n){return r((bu[e]&&bu[e].get||s)(t,e,i,n))}:t},quickSetter:function(t,e,i){if((t=vd(t)).length>1){var n=t.map((function(t){return Fp.quickSetter(t,e,i)})),s=n.length;return function(t){for(var e=s;e--;)n[e](t)}}t=t[0]||{};var r=bu[e],o=Au(t),a=o.harness&&(o.harness.aliases||{})[e]||e,h=r?function(e){var n=new r;Lc._pt=0,n.init(t,i?e+i:e,Lc,0,[t]),n.render(1,n),Lc._pt&&wp(1,Lc)}:o.set(t,a);return r?h:function(e){return h(t,a,i?e+i:e,o,1)}},quickTo:function(t,e,i){var n,s=Fp.to(t,Uu(((n={})[e]="+=0.1",n.paused=!0,n),i||{})),r=function(t,i,n){return s.resetTo(e,t,i,n)};return r.tween=s,r},isTweening:function(t){return Cc.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=Yd(t.ease,Bc.ease)),Fu(Bc,t||{})},config:function(t){return Fu(Nc,t||{})},registerEffect:function(t){var e=t.name,i=t.effect,n=t.plugins,s=t.defaults,r=t.extendTimeline;(n||"").split(",").forEach((function(t){return t&&!bu[t]&&!lu[t]&&du()})),wu[e]=function(t,e,n){return i(vd(t),zu(e||{},s),n)},r&&(ip.prototype[e]=function(t,i,n){return this.add(wu[e](t,Kc(i)?i:(n=i)&&{},this),n)})},registerEase:function(t,e){Vd[t]=Yd(e)},parseEase:function(t,e){return arguments.length?Yd(t,e):Vd},getById:function(t){return Cc.getById(t)},exportRoot:function(t,e){void 0===t&&(t={});var i,n,s=new ip(t);for(s.smoothChildTiming=Zc(t.smoothChildTiming),Cc.remove(s),s._dp=0,s._time=s._tTime=Cc._time,i=Cc._first;i;)n=i._next,!e&&!i._dur&&i instanceof pp&&i.vars.onComplete===i._targets[0]||ed(s,i,i._start-i._delay),i=n;return ed(Cc,s,0),s},context:function(t,e){return t?new Op(t,e):Ac},matchMedia:function(t){return new Np(t)},matchMediaRefresh:function(){return Cp.forEach((function(t){var e,i,n=t.conditions;for(i in n)n[i]&&(n[i]=!1,e=1);e&&t.revert()}))||Lp()},addEventListener:function(t,e){var i=Ip[t]||(Ip[t]=[]);~i.indexOf(e)||i.push(e)},removeEventListener:function(t,e){var i=Ip[t],n=i&&i.indexOf(e);n>=0&&i.splice(n,1)},utils:{wrap:function t(e,i,n){var s=i-e;return eu(e)?Sd(e,t(0,e.length),i):ud(n,(function(t){return(s+(t-e)%s)%s+e}))},wrapYoyo:function t(e,i,n){var s=i-e,r=2*s;return eu(e)?Sd(e,t(0,e.length-1),i):ud(n,(function(t){return e+((t=(r+(t-e)%r)%r||0)>s?r-t:t)}))},distribute:_d,random:Md,snap:wd,normalize:function(t,e,i){return Ed(t,e,0,1,i)},getUnit:pd,clamp:function(t,e,i){return ud(i,(function(i){return dd(t,e,i)}))},splitColor:Od,toArray:vd,selector:yd,mapRange:Ed,pipe:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return function(t){return e.reduce((function(t,e){return e(t)}),t)}},unitize:function(t,e){return function(i){return t(parseFloat(i))+(e||pd(i))}},interpolate:function t(e,i,n,s){var r=isNaN(e+i)?0:function(t){return(1-t)*e+t*i};if(!r){var o,a,h,l,c,u=Xc(e),d={};if(!0===n&&(s=1)&&(n=null),u)e={p:e},i={p:i};else if(eu(e)&&!eu(i)){for(h=[],l=e.length,c=l-2,a=1;a<l;a++)h.push(t(e[a-1],e[a]));l--,r=function(t){t*=l;var e=Math.min(c,~~t);return h[e](t-e)},n=i}else s||(e=Uu(eu(e)?[]:{},e));if(!h){for(o in i)op.call(d,e,o,"get",i[o]);r=function(t){return wp(t,d)||(u?e.p:e)}}}return ud(n,r)},shuffle:xd},install:uu,effects:wu,ticker:Gd,updateRoot:ip.updateRoot,plugins:bu,globalTimeline:Cc,core:{PropTween:Ap,globals:pu,Tween:pp,Timeline:ip,Animation:ep,getCache:Au,_removeLinkedListItem:ju,reverting:function(){return Ec},context:function(t){return t&&Ac&&(Ac.data.push(t),t._ctx=Ac),Ac},suppressOverwrites:function(t){return Tc=t}}};Iu("to,from,fromTo,delayedCall,set,killTweensOf",(function(t){return Bp[t]=pp[t]})),Gd.add(ip.updateRoot),Lc=Bp.to({},{duration:0});var zp=function(t,e){for(var i=t._pt;i&&i.p!==e&&i.op!==e&&i.fp!==e;)i=i._next;return i},Up=function(t,e){return{name:t,rawVars:1,init:function(t,i,n){n._onInit=function(t){var n,s;if(Xc(i)&&(n={},Iu(i,(function(t){return n[t]=1})),i=n),e){for(s in n={},i)n[s]=e(i[s]);i=n}!function(t,e){var i,n,s,r=t._targets;for(i in e)for(n=r.length;n--;)(s=t._ptLookup[n][i])&&(s=s.d)&&(s._pt&&(s=zp(s,i)),s&&s.modifier&&s.modifier(e[i],t,r[n],i))}(t,i)}}}},Fp=Bp.registerPlugin({name:"attr",init:function(t,e,i,n,s){var r,o,a;for(r in this.tween=i,e)a=t.getAttribute(r)||"",(o=this.add(t,"setAttribute",(a||0)+"",e[r],n,s,0,0,r)).op=r,o.b=a,this._props.push(r)},render:function(t,e){for(var i=e._pt;i;)Ec?i.set(i.t,i.p,i.b,i):i.r(t,i.d),i=i._next}},{name:"endArray",init:function(t,e){for(var i=e.length;i--;)this.add(t,i,t[i]||0,e[i],0,0,0,0,0,1)}},Up("roundProps",bd),Up("modifiers"),Up("snap",wd))||Bp;pp.version=ip.version=Fp.version="3.12.5",kc=1,Jc()&&Hd();Vd.Power0,Vd.Power1,Vd.Power2,Vd.Power3,Vd.Power4,Vd.Linear,Vd.Quad,Vd.Cubic,Vd.Quart,Vd.Quint,Vd.Strong,Vd.Elastic,Vd.Back,Vd.SteppedEase,Vd.Bounce,Vd.Sine,Vd.Expo,Vd.Circ;var Gp,Hp,Vp,jp,Wp,Xp,$p,qp,Yp={},Kp=180/Math.PI,Zp=Math.PI/180,Jp=Math.atan2,Qp=/([A-Z])/g,tm=/(left|right|width|margin|padding|x)/i,em=/[\s,\(]\S/,im={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},nm=function(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},sm=function(t,e){return e.set(e.t,e.p,1===t?e.e:Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},rm=function(t,e){return e.set(e.t,e.p,t?Math.round(1e4*(e.s+e.c*t))/1e4+e.u:e.b,e)},om=function(t,e){var i=e.s+e.c*t;e.set(e.t,e.p,~~(i+(i<0?-.5:.5))+e.u,e)},am=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},hm=function(t,e){return e.set(e.t,e.p,1!==t?e.b:e.e,e)},lm=function(t,e,i){return t.style[e]=i},cm=function(t,e,i){return t.style.setProperty(e,i)},um=function(t,e,i){return t._gsap[e]=i},dm=function(t,e,i){return t._gsap.scaleX=t._gsap.scaleY=i},pm=function(t,e,i,n,s){var r=t._gsap;r.scaleX=r.scaleY=i,r.renderTransform(s,r)},mm=function(t,e,i,n,s){var r=t._gsap;r[e]=i,r.renderTransform(s,r)},fm="transform",gm=fm+"Origin",vm=function t(e,i){var n=this,s=this.target,r=s.style,o=s._gsap;if(e in Yp&&r){if(this.tfm=this.tfm||{},"transform"===e)return im.transform.split(",").forEach((function(e){return t.call(n,e,i)}));if(~(e=im[e]||e).indexOf(",")?e.split(",").forEach((function(t){return n.tfm[t]=Om(s,t)})):this.tfm[e]=o.x?o[e]:Om(s,e),e===gm&&(this.tfm.zOrigin=o.zOrigin),this.props.indexOf(fm)>=0)return;o.svg&&(this.svgo=s.getAttribute("data-svg-origin"),this.props.push(gm,i,"")),e=fm}(r||i)&&this.props.push(e,i,r[e])},ym=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},xm=function(){var t,e,i=this.props,n=this.target,s=n.style,r=n._gsap;for(t=0;t<i.length;t+=3)i[t+1]?n[i[t]]=i[t+2]:i[t+2]?s[i[t]]=i[t+2]:s.removeProperty("--"===i[t].substr(0,2)?i[t]:i[t].replace(Qp,"-$1").toLowerCase());if(this.tfm){for(e in this.tfm)r[e]=this.tfm[e];r.svg&&(r.renderTransform(),n.setAttribute("data-svg-origin",this.svgo||"")),(t=$p())&&t.isStart||s[fm]||(ym(s),r.zOrigin&&s[gm]&&(s[gm]+=" "+r.zOrigin+"px",r.zOrigin=0,r.renderTransform()),r.uncache=1)}},_m=function(t,e){var i={target:t,props:[],revert:xm,save:vm};return t._gsap||Fp.core.getCache(t),e&&e.split(",").forEach((function(t){return i.save(t)})),i},bm=function(t,e){var i=Hp.createElementNS?Hp.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):Hp.createElement(t);return i&&i.style?i:Hp.createElement(t)},wm=function t(e,i,n){var s=getComputedStyle(e);return s[i]||s.getPropertyValue(i.replace(Qp,"-$1").toLowerCase())||s.getPropertyValue(i)||!n&&t(e,Sm(i)||i,1)||""},Mm="O,Moz,ms,Ms,Webkit".split(","),Sm=function(t,e,i){var n=(e||Wp).style,s=5;if(t in n&&!i)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);s--&&!(Mm[s]+t in n););return s<0?null:(3===s?"ms":s>=0?Mm[s]:"")+t},Tm=function(){"undefined"!=typeof window&&window.document&&(Gp=window,Hp=Gp.document,Vp=Hp.documentElement,Wp=bm("div")||{style:{}},bm("div"),fm=Sm(fm),gm=fm+"Origin",Wp.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",qp=!!Sm("perspective"),$p=Fp.core.reverting,jp=1)},Em=function t(e){var i,n=bm("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),s=this.parentNode,r=this.nextSibling,o=this.style.cssText;if(Vp.appendChild(n),n.appendChild(this),this.style.display="block",e)try{i=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=t}catch(t){}else this._gsapBBox&&(i=this._gsapBBox());return s&&(r?s.insertBefore(this,r):s.appendChild(this)),Vp.removeChild(n),this.style.cssText=o,i},Am=function(t,e){for(var i=e.length;i--;)if(t.hasAttribute(e[i]))return t.getAttribute(e[i])},Cm=function(t){var e;try{e=t.getBBox()}catch(i){e=Em.call(t,!0)}return e&&(e.width||e.height)||t.getBBox===Em||(e=Em.call(t,!0)),!e||e.width||e.x||e.y?e:{x:+Am(t,["x","cx","x1"])||0,y:+Am(t,["y","cy","y1"])||0,width:0,height:0}},Im=function(t){return!(!t.getCTM||t.parentNode&&!t.ownerSVGElement||!Cm(t))},Rm=function(t,e){if(e){var i,n=t.style;e in Yp&&e!==gm&&(e=fm),n.removeProperty?("ms"!==(i=e.substr(0,2))&&"webkit"!==e.substr(0,6)||(e="-"+e),n.removeProperty("--"===i?e:e.replace(Qp,"-$1").toLowerCase())):n.removeAttribute(e)}},Pm=function(t,e,i,n,s,r){var o=new Ap(t._pt,e,i,0,1,r?hm:am);return t._pt=o,o.b=n,o.e=s,t._props.push(i),o},km={deg:1,rad:1,turn:1},Dm={grid:1,flex:1},Lm=function t(e,i,n,s){var r,o,a,h,l=parseFloat(n)||0,c=(n+"").trim().substr((l+"").length)||"px",u=Wp.style,d=tm.test(i),p="svg"===e.tagName.toLowerCase(),m=(p?"client":"offset")+(d?"Width":"Height"),f=100,g="px"===s,v="%"===s;if(s===c||!l||km[s]||km[c])return l;if("px"!==c&&!g&&(l=t(e,i,n,"px")),h=e.getCTM&&Im(e),(v||"%"===c)&&(Yp[i]||~i.indexOf("adius")))return r=h?e.getBBox()[d?"width":"height"]:e[m],Ru(v?l/r*f:l/100*r);if(u[d?"width":"height"]=f+(g?c:s),o=~i.indexOf("adius")||"em"===s&&e.appendChild&&!p?e:e.parentNode,h&&(o=(e.ownerSVGElement||{}).parentNode),o&&o!==Hp&&o.appendChild||(o=Hp.body),(a=o._gsap)&&v&&a.width&&d&&a.time===Gd.time&&!a.uncache)return Ru(l/a.width*f);if(!v||"height"!==i&&"width"!==i)(v||"%"===c)&&!Dm[wm(o,"display")]&&(u.position=wm(e,"position")),o===e&&(u.position="static"),o.appendChild(Wp),r=Wp[m],o.removeChild(Wp),u.position="absolute";else{var y=e.style[i];e.style[i]=f+s,r=e[m],y?e.style[i]=y:Rm(e,i)}return d&&v&&((a=Au(o)).time=Gd.time,a.width=o[m]),Ru(g?r*l/f:r&&l?f/r*l:0)},Om=function(t,e,i,n){var s;return jp||Tm(),e in im&&"transform"!==e&&~(e=im[e]).indexOf(",")&&(e=e.split(",")[0]),Yp[e]&&"transform"!==e?(s=$m(t,n),s="transformOrigin"!==e?s[e]:s.svg?s.origin:qm(wm(t,gm))+" "+s.zOrigin+"px"):(!(s=t.style[e])||"auto"===s||n||~(s+"").indexOf("calc("))&&(s=Fm[e]&&Fm[e](t,e,i)||wm(t,e)||Cu(t,e)||("opacity"===e?1:0)),i&&!~(s+"").trim().indexOf(" ")?Lm(t,e,s,i)+i:s},Nm=function(t,e,i,n){if(!i||"none"===i){var s=Sm(e,t,1),r=s&&wm(t,s,1);r&&r!==i?(e=s,i=r):"borderColor"===e&&(i=wm(t,"borderTopColor"))}var o,a,h,l,c,u,d,p,m,f,g,v=new Ap(this._pt,t.style,e,0,1,bp),y=0,x=0;if(v.b=i,v.e=n,i+="","auto"===(n+="")&&(u=t.style[e],t.style[e]=n,n=wm(t,e)||n,u?t.style[e]=u:Rm(t,e)),Fd(o=[i,n]),n=o[1],h=(i=o[0]).match(su)||[],(n.match(su)||[]).length){for(;a=su.exec(n);)d=a[0],m=n.substring(y,a.index),c?c=(c+1)%5:"rgba("!==m.substr(-5)&&"hsla("!==m.substr(-5)||(c=1),d!==(u=h[x++]||"")&&(l=parseFloat(u)||0,g=u.substr((l+"").length),"="===d.charAt(1)&&(d=ku(l,d)+g),p=parseFloat(d),f=d.substr((p+"").length),y=su.lastIndex-f.length,f||(f=f||Nc.units[e]||g,y===n.length&&(n+=f,v.e+=f)),g!==f&&(l=Lm(t,e,u,f)||0),v._pt={_next:v._pt,p:m||1===x?m:",",s:l,c:p-l,m:c&&c<4||"zIndex"===e?Math.round:0});v.c=y<n.length?n.substring(y,n.length):""}else v.r="display"===e&&"none"===n?hm:am;return ou.test(n)&&(v.e=0),this._pt=v,v},Bm={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},zm=function(t){var e=t.split(" "),i=e[0],n=e[1]||"50%";return"top"!==i&&"bottom"!==i&&"left"!==n&&"right"!==n||(t=i,i=n,n=t),e[0]=Bm[i]||i,e[1]=Bm[n]||n,e.join(" ")},Um=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var i,n,s,r=e.t,o=r.style,a=e.u,h=r._gsap;if("all"===a||!0===a)o.cssText="",n=1;else for(s=(a=a.split(",")).length;--s>-1;)i=a[s],Yp[i]&&(n=1,i="transformOrigin"===i?gm:fm),Rm(r,i);n&&(Rm(r,fm),h&&(h.svg&&r.removeAttribute("transform"),$m(r,1),h.uncache=1,ym(o)))}},Fm={clearProps:function(t,e,i,n,s){if("isFromStart"!==s.data){var r=t._pt=new Ap(t._pt,e,i,0,0,Um);return r.u=n,r.pr=-10,r.tween=s,t._props.push(i),1}}},Gm=[1,0,0,1,0,0],Hm={},Vm=function(t){return"matrix(1, 0, 0, 1, 0, 0)"===t||"none"===t||!t},jm=function(t){var e=wm(t,fm);return Vm(e)?Gm:e.substr(7).match(nu).map(Ru)},Wm=function(t,e){var i,n,s,r,o=t._gsap||Au(t),a=t.style,h=jm(t);return o.svg&&t.getAttribute("transform")?"1,0,0,1,0,0"===(h=[(s=t.transform.baseVal.consolidate().matrix).a,s.b,s.c,s.d,s.e,s.f]).join(",")?Gm:h:(h!==Gm||t.offsetParent||t===Vp||o.svg||(s=a.display,a.display="block",(i=t.parentNode)&&t.offsetParent||(r=1,n=t.nextElementSibling,Vp.appendChild(t)),h=jm(t),s?a.display=s:Rm(t,"display"),r&&(n?i.insertBefore(t,n):i?i.appendChild(t):Vp.removeChild(t))),e&&h.length>6?[h[0],h[1],h[4],h[5],h[12],h[13]]:h)},Xm=function(t,e,i,n,s,r){var o,a,h,l=t._gsap,c=s||Wm(t,!0),u=l.xOrigin||0,d=l.yOrigin||0,p=l.xOffset||0,m=l.yOffset||0,f=c[0],g=c[1],v=c[2],y=c[3],x=c[4],_=c[5],b=e.split(" "),w=parseFloat(b[0])||0,M=parseFloat(b[1])||0;i?c!==Gm&&(a=f*y-g*v)&&(h=w*(-g/a)+M*(f/a)-(f*_-g*x)/a,w=w*(y/a)+M*(-v/a)+(v*_-y*x)/a,M=h):(w=(o=Cm(t)).x+(~b[0].indexOf("%")?w/100*o.width:w),M=o.y+(~(b[1]||b[0]).indexOf("%")?M/100*o.height:M)),n||!1!==n&&l.smooth?(x=w-u,_=M-d,l.xOffset=p+(x*f+_*v)-x,l.yOffset=m+(x*g+_*y)-_):l.xOffset=l.yOffset=0,l.xOrigin=w,l.yOrigin=M,l.smooth=!!n,l.origin=e,l.originIsAbsolute=!!i,t.style[gm]="0px 0px",r&&(Pm(r,l,"xOrigin",u,w),Pm(r,l,"yOrigin",d,M),Pm(r,l,"xOffset",p,l.xOffset),Pm(r,l,"yOffset",m,l.yOffset)),t.setAttribute("data-svg-origin",w+" "+M)},$m=function(t,e){var i=t._gsap||new tp(t);if("x"in i&&!e&&!i.uncache)return i;var n,s,r,o,a,h,l,c,u,d,p,m,f,g,v,y,x,_,b,w,M,S,T,E,A,C,I,R,P,k,D,L,O=t.style,N=i.scaleX<0,B="px",z="deg",U=getComputedStyle(t),F=wm(t,gm)||"0";return n=s=r=h=l=c=u=d=p=0,o=a=1,i.svg=!(!t.getCTM||!Im(t)),U.translate&&("none"===U.translate&&"none"===U.scale&&"none"===U.rotate||(O[fm]=("none"!==U.translate?"translate3d("+(U.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==U.rotate?"rotate("+U.rotate+") ":"")+("none"!==U.scale?"scale("+U.scale.split(" ").join(",")+") ":"")+("none"!==U[fm]?U[fm]:"")),O.scale=O.rotate=O.translate="none"),g=Wm(t,i.svg),i.svg&&(i.uncache?(A=t.getBBox(),F=i.xOrigin-A.x+"px "+(i.yOrigin-A.y)+"px",E=""):E=!e&&t.getAttribute("data-svg-origin"),Xm(t,E||F,!!E||i.originIsAbsolute,!1!==i.smooth,g)),m=i.xOrigin||0,f=i.yOrigin||0,g!==Gm&&(_=g[0],b=g[1],w=g[2],M=g[3],n=S=g[4],s=T=g[5],6===g.length?(o=Math.sqrt(_*_+b*b),a=Math.sqrt(M*M+w*w),h=_||b?Jp(b,_)*Kp:0,(u=w||M?Jp(w,M)*Kp+h:0)&&(a*=Math.abs(Math.cos(u*Zp))),i.svg&&(n-=m-(m*_+f*w),s-=f-(m*b+f*M))):(L=g[6],k=g[7],I=g[8],R=g[9],P=g[10],D=g[11],n=g[12],s=g[13],r=g[14],l=(v=Jp(L,P))*Kp,v&&(E=S*(y=Math.cos(-v))+I*(x=Math.sin(-v)),A=T*y+R*x,C=L*y+P*x,I=S*-x+I*y,R=T*-x+R*y,P=L*-x+P*y,D=k*-x+D*y,S=E,T=A,L=C),c=(v=Jp(-w,P))*Kp,v&&(y=Math.cos(-v),D=M*(x=Math.sin(-v))+D*y,_=E=_*y-I*x,b=A=b*y-R*x,w=C=w*y-P*x),h=(v=Jp(b,_))*Kp,v&&(E=_*(y=Math.cos(v))+b*(x=Math.sin(v)),A=S*y+T*x,b=b*y-_*x,T=T*y-S*x,_=E,S=A),l&&Math.abs(l)+Math.abs(h)>359.9&&(l=h=0,c=180-c),o=Ru(Math.sqrt(_*_+b*b+w*w)),a=Ru(Math.sqrt(T*T+L*L)),v=Jp(S,T),u=Math.abs(v)>2e-4?v*Kp:0,p=D?1/(D<0?-D:D):0),i.svg&&(E=t.getAttribute("transform"),i.forceCSS=t.setAttribute("transform","")||!Vm(wm(t,fm)),E&&t.setAttribute("transform",E))),Math.abs(u)>90&&Math.abs(u)<270&&(N?(o*=-1,u+=h<=0?180:-180,h+=h<=0?180:-180):(a*=-1,u+=u<=0?180:-180)),e=e||i.uncache,i.x=n-((i.xPercent=n&&(!e&&i.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-n)?-50:0)))?t.offsetWidth*i.xPercent/100:0)+B,i.y=s-((i.yPercent=s&&(!e&&i.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-s)?-50:0)))?t.offsetHeight*i.yPercent/100:0)+B,i.z=r+B,i.scaleX=Ru(o),i.scaleY=Ru(a),i.rotation=Ru(h)+z,i.rotationX=Ru(l)+z,i.rotationY=Ru(c)+z,i.skewX=u+z,i.skewY=d+z,i.transformPerspective=p+B,(i.zOrigin=parseFloat(F.split(" ")[2])||!e&&i.zOrigin||0)&&(O[gm]=qm(F)),i.xOffset=i.yOffset=0,i.force3D=Nc.force3D,i.renderTransform=i.svg?ef:qp?tf:Km,i.uncache=0,i},qm=function(t){return(t=t.split(" "))[0]+" "+t[1]},Ym=function(t,e,i){var n=pd(e);return Ru(parseFloat(e)+parseFloat(Lm(t,"x",i+"px",n)))+n},Km=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,tf(t,e)},Zm="0deg",Jm="0px",Qm=") ",tf=function(t,e){var i=e||this,n=i.xPercent,s=i.yPercent,r=i.x,o=i.y,a=i.z,h=i.rotation,l=i.rotationY,c=i.rotationX,u=i.skewX,d=i.skewY,p=i.scaleX,m=i.scaleY,f=i.transformPerspective,g=i.force3D,v=i.target,y=i.zOrigin,x="",_="auto"===g&&t&&1!==t||!0===g;if(y&&(c!==Zm||l!==Zm)){var b,w=parseFloat(l)*Zp,M=Math.sin(w),S=Math.cos(w);w=parseFloat(c)*Zp,b=Math.cos(w),r=Ym(v,r,M*b*-y),o=Ym(v,o,-Math.sin(w)*-y),a=Ym(v,a,S*b*-y+y)}f!==Jm&&(x+="perspective("+f+Qm),(n||s)&&(x+="translate("+n+"%, "+s+"%) "),(_||r!==Jm||o!==Jm||a!==Jm)&&(x+=a!==Jm||_?"translate3d("+r+", "+o+", "+a+") ":"translate("+r+", "+o+Qm),h!==Zm&&(x+="rotate("+h+Qm),l!==Zm&&(x+="rotateY("+l+Qm),c!==Zm&&(x+="rotateX("+c+Qm),u===Zm&&d===Zm||(x+="skew("+u+", "+d+Qm),1===p&&1===m||(x+="scale("+p+", "+m+Qm),v.style[fm]=x||"translate(0, 0)"},ef=function(t,e){var i,n,s,r,o,a=e||this,h=a.xPercent,l=a.yPercent,c=a.x,u=a.y,d=a.rotation,p=a.skewX,m=a.skewY,f=a.scaleX,g=a.scaleY,v=a.target,y=a.xOrigin,x=a.yOrigin,_=a.xOffset,b=a.yOffset,w=a.forceCSS,M=parseFloat(c),S=parseFloat(u);d=parseFloat(d),p=parseFloat(p),(m=parseFloat(m))&&(p+=m=parseFloat(m),d+=m),d||p?(d*=Zp,p*=Zp,i=Math.cos(d)*f,n=Math.sin(d)*f,s=Math.sin(d-p)*-g,r=Math.cos(d-p)*g,p&&(m*=Zp,o=Math.tan(p-m),s*=o=Math.sqrt(1+o*o),r*=o,m&&(o=Math.tan(m),i*=o=Math.sqrt(1+o*o),n*=o)),i=Ru(i),n=Ru(n),s=Ru(s),r=Ru(r)):(i=f,r=g,n=s=0),(M&&!~(c+"").indexOf("px")||S&&!~(u+"").indexOf("px"))&&(M=Lm(v,"x",c,"px"),S=Lm(v,"y",u,"px")),(y||x||_||b)&&(M=Ru(M+y-(y*i+x*s)+_),S=Ru(S+x-(y*n+x*r)+b)),(h||l)&&(o=v.getBBox(),M=Ru(M+h/100*o.width),S=Ru(S+l/100*o.height)),o="matrix("+i+","+n+","+s+","+r+","+M+","+S+")",v.setAttribute("transform",o),w&&(v.style[fm]=o)},nf=function(t,e,i,n,s){var r,o,a=360,h=Xc(s),l=parseFloat(s)*(h&&~s.indexOf("rad")?Kp:1)-n,c=n+l+"deg";return h&&("short"===(r=s.split("_")[1])&&(l%=a)!==l%180&&(l+=l<0?a:-360),"cw"===r&&l<0?l=(l+36e9)%a-~~(l/a)*a:"ccw"===r&&l>0&&(l=(l-36e9)%a-~~(l/a)*a)),t._pt=o=new Ap(t._pt,e,i,n,l,sm),o.e=c,o.u="deg",t._props.push(i),o},sf=function(t,e){for(var i in e)t[i]=e[i];return t},rf=function(t,e,i){var n,s,r,o,a,h,l,c=sf({},i._gsap),u=i.style;for(s in c.svg?(r=i.getAttribute("transform"),i.setAttribute("transform",""),u[fm]=e,n=$m(i,1),Rm(i,fm),i.setAttribute("transform",r)):(r=getComputedStyle(i)[fm],u[fm]=e,n=$m(i,1),u[fm]=r),Yp)(r=c[s])!==(o=n[s])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(s)<0&&(a=pd(r)!==(l=pd(o))?Lm(i,s,r,l):parseFloat(r),h=parseFloat(o),t._pt=new Ap(t._pt,n,s,a,h-a,nm),t._pt.u=l||0,t._props.push(s));sf(n,c)};Iu("padding,margin,Width,Radius",(function(t,e){var i="Top",n="Right",s="Bottom",r="Left",o=(e<3?[i,n,s,r]:[i+r,i+n,s+n,s+r]).map((function(i){return e<2?t+i:"border"+i+t}));Fm[e>1?"border"+t:t]=function(t,e,i,n,s){var r,a;if(arguments.length<4)return r=o.map((function(e){return Om(t,e,i)})),5===(a=r.join(" ")).split(r[0]).length?r[0]:a;r=(n+"").split(" "),a={},o.forEach((function(t,e){return a[t]=r[e]=r[e]||r[(e-1)/2|0]})),t.init(e,a,s)}}));var of,af,hf,lf={name:"css",register:Tm,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,i,n,s){var r,o,a,h,l,c,u,d,p,m,f,g,v,y,x,_,b=this._props,w=t.style,M=i.vars.startAt;for(u in jp||Tm(),this.styles=this.styles||_m(t),_=this.styles.props,this.tween=i,e)if("autoRound"!==u&&(o=e[u],!bu[u]||!ap(u,e,i,n,t,s)))if(l=typeof o,c=Fm[u],"function"===l&&(l=typeof(o=o.call(i,n,t,s))),"string"===l&&~o.indexOf("random(")&&(o=Td(o)),c)c(this,t,u,o,i)&&(x=1);else if("--"===u.substr(0,2))r=(getComputedStyle(t).getPropertyValue(u)+"").trim(),o+="",zd.lastIndex=0,zd.test(r)||(d=pd(r),p=pd(o)),p?d!==p&&(r=Lm(t,u,r,p)+p):d&&(o+=d),this.add(w,"setProperty",r,o,n,s,0,0,u),b.push(u),_.push(u,0,w[u]);else if("undefined"!==l){if(M&&u in M?(r="function"==typeof M[u]?M[u].call(i,n,t,s):M[u],Xc(r)&&~r.indexOf("random(")&&(r=Td(r)),pd(r+"")||"auto"===r||(r+=Nc.units[u]||pd(Om(t,u))||""),"="===(r+"").charAt(1)&&(r=Om(t,u))):r=Om(t,u),h=parseFloat(r),(m="string"===l&&"="===o.charAt(1)&&o.substr(0,2))&&(o=o.substr(2)),a=parseFloat(o),u in im&&("autoAlpha"===u&&(1===h&&"hidden"===Om(t,"visibility")&&a&&(h=0),_.push("visibility",0,w.visibility),Pm(this,w,"visibility",h?"inherit":"hidden",a?"inherit":"hidden",!a)),"scale"!==u&&"transform"!==u&&~(u=im[u]).indexOf(",")&&(u=u.split(",")[0])),f=u in Yp)if(this.styles.save(u),g||((v=t._gsap).renderTransform&&!e.parseTransform||$m(t,e.parseTransform),y=!1!==e.smoothOrigin&&v.smooth,(g=this._pt=new Ap(this._pt,w,fm,0,1,v.renderTransform,v,0,-1)).dep=1),"scale"===u)this._pt=new Ap(this._pt,v,"scaleY",v.scaleY,(m?ku(v.scaleY,m+a):a)-v.scaleY||0,nm),this._pt.u=0,b.push("scaleY",u),u+="X";else{if("transformOrigin"===u){_.push(gm,0,w[gm]),o=zm(o),v.svg?Xm(t,o,0,y,0,this):((p=parseFloat(o.split(" ")[2])||0)!==v.zOrigin&&Pm(this,v,"zOrigin",v.zOrigin,p),Pm(this,w,u,qm(r),qm(o)));continue}if("svgOrigin"===u){Xm(t,o,1,y,0,this);continue}if(u in Hm){nf(this,v,u,h,m?ku(h,m+o):o);continue}if("smoothOrigin"===u){Pm(this,v,"smooth",v.smooth,o);continue}if("force3D"===u){v[u]=o;continue}if("transform"===u){rf(this,o,t);continue}}else u in w||(u=Sm(u)||u);if(f||(a||0===a)&&(h||0===h)&&!em.test(o)&&u in w)a||(a=0),(d=(r+"").substr((h+"").length))!==(p=pd(o)||(u in Nc.units?Nc.units[u]:d))&&(h=Lm(t,u,r,p)),this._pt=new Ap(this._pt,f?v:w,u,h,(m?ku(h,m+a):a)-h,f||"px"!==p&&"zIndex"!==u||!1===e.autoRound?nm:om),this._pt.u=p||0,d!==p&&"%"!==p&&(this._pt.b=r,this._pt.r=rm);else if(u in w)Nm.call(this,t,u,r,m?m+o:o);else if(u in t)this.add(t,u,r||t[u],m?m+o:o,n,s);else if("parseTransform"!==u)continue;f||(u in w?_.push(u,0,w[u]):_.push(u,1,r||t[u])),b.push(u)}x&&Ep(this)},render:function(t,e){if(e.tween._time||!$p())for(var i=e._pt;i;)i.r(t,i.d),i=i._next;else e.styles.revert()},get:Om,aliases:im,getSetter:function(t,e,i){var n=im[e];return n&&n.indexOf(",")<0&&(e=n),e in Yp&&e!==gm&&(t._gsap.x||Om(t,"x"))?i&&Xp===i?"scale"===e?dm:um:(Xp=i||{})&&("scale"===e?pm:mm):t.style&&!Yc(t.style[e])?lm:~e.indexOf("-")?cm:yp(t,e)},core:{_removeProperty:Rm,_getMatrix:Wm}};Fp.utils.checkPrefix=Sm,Fp.core.getStyleSaver=_m,hf=Iu((of="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(af="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(t){Yp[t]=1})),Iu(af,(function(t){Nc.units[t]="deg",Hm[t]=1})),im[hf[13]]=of+","+af,Iu("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(t){var e=t.split(":");im[e[1]]=hf[e[0]]})),Iu("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(t){Nc.units[t]="px"})),Fp.registerPlugin(lf);var cf=Fp.registerPlugin(lf)||Fp;cf.core.Tween;const uf={type:"change"},df={type:"start"},pf={type:"end"},mf=new oi,ff=new Yn,gf=Math.cos(70*ie.DEG2RAD);class vf extends Vt{constructor(t,e){super(),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new Pe,this.cursor=new Pe,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:x,MIDDLE:_,RIGHT:b},this.touches={ONE:w,TWO:S},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(t){t.addEventListener("keydown",Q),this._domElementKeyEvents=t},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Q),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(uf),i.update(),s=n.NONE},this.update=function(){const e=new Pe,c=(new Re).setFromUnitVectors(t.up,new Pe(0,1,0)),u=c.clone().invert(),d=new Pe,p=new Re,m=new Pe,f=2*Math.PI;return function(g=null){const v=i.object.position;e.copy(v).sub(i.target),e.applyQuaternion(c),o.setFromVector3(e),i.autoRotate&&s===n.NONE&&k(function(t){return null!==t?2*Math.PI/60*i.autoRotateSpeed*t:2*Math.PI/60/60*i.autoRotateSpeed}(g)),i.enableDamping?(o.theta+=a.theta*i.dampingFactor,o.phi+=a.phi*i.dampingFactor):(o.theta+=a.theta,o.phi+=a.phi);let y=i.minAzimuthAngle,x=i.maxAzimuthAngle;isFinite(y)&&isFinite(x)&&(y<-Math.PI?y+=f:y>Math.PI&&(y-=f),x<-Math.PI?x+=f:x>Math.PI&&(x-=f),o.theta=y<=x?Math.max(y,Math.min(x,o.theta)):o.theta>(y+x)/2?Math.max(y,o.theta):Math.min(x,o.theta)),o.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,o.phi)),o.makeSafe(),!0===i.enableDamping?i.target.addScaledVector(l,i.dampingFactor):i.target.add(l),i.target.sub(i.cursor),i.target.clampLength(i.minTargetRadius,i.maxTargetRadius),i.target.add(i.cursor),i.zoomToCursor&&C||i.object.isOrthographicCamera?o.radius=F(o.radius):o.radius=F(o.radius*h),e.setFromSpherical(o),e.applyQuaternion(u),v.copy(i.target).add(e),i.object.lookAt(i.target),!0===i.enableDamping?(a.theta*=1-i.dampingFactor,a.phi*=1-i.dampingFactor,l.multiplyScalar(1-i.dampingFactor)):(a.set(0,0,0),l.set(0,0,0));let _=!1;if(i.zoomToCursor&&C){let n=null;if(i.object.isPerspectiveCamera){const t=e.length();n=F(t*h);const s=t-n;i.object.position.addScaledVector(E,s),i.object.updateMatrixWorld()}else if(i.object.isOrthographicCamera){const t=new Pe(A.x,A.y,0);t.unproject(i.object),i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/h)),i.object.updateProjectionMatrix(),_=!0;const s=new Pe(A.x,A.y,0);s.unproject(i.object),i.object.position.sub(s).add(t),i.object.updateMatrixWorld(),n=e.length()}else i.zoomToCursor=!1;null!==n&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(n).add(i.object.position):(mf.origin.copy(i.object.position),mf.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(mf.direction))<gf?t.lookAt(i.target):(ff.setFromNormalAndCoplanarPoint(i.object.up,i.target),mf.intersectPlane(ff,i.target))))}else i.object.isOrthographicCamera&&(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/h)),i.object.updateProjectionMatrix(),_=!0);return h=1,C=!1,!!(_||d.distanceToSquared(i.object.position)>r||8*(1-p.dot(i.object.quaternion))>r||m.distanceToSquared(i.target)>0)&&(i.dispatchEvent(uf),d.copy(i.object.position),p.copy(i.object.quaternion),m.copy(i.target),!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",tt),i.domElement.removeEventListener("pointerdown",Y),i.domElement.removeEventListener("pointercancel",Z),i.domElement.removeEventListener("wheel",J),i.domElement.removeEventListener("pointermove",K),i.domElement.removeEventListener("pointerup",Z),null!==i._domElementKeyEvents&&(i._domElementKeyEvents.removeEventListener("keydown",Q),i._domElementKeyEvents=null)};const i=this,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=n.NONE;const r=1e-6,o=new Fl,a=new Fl;let h=1;const l=new Pe,c=new ne,u=new ne,d=new ne,p=new ne,m=new ne,f=new ne,g=new ne,v=new ne,y=new ne,E=new Pe,A=new ne;let C=!1;const I=[],R={};function P(t){const e=Math.abs(t)/(100*(0|window.devicePixelRatio));return Math.pow(.95,i.zoomSpeed*e)}function k(t){a.theta-=t}function D(t){a.phi-=t}const L=function(){const t=new Pe;return function(e,i){t.setFromMatrixColumn(i,0),t.multiplyScalar(-e),l.add(t)}}(),O=function(){const t=new Pe;return function(e,n){!0===i.screenSpacePanning?t.setFromMatrixColumn(n,1):(t.setFromMatrixColumn(n,0),t.crossVectors(i.object.up,t)),t.multiplyScalar(e),l.add(t)}}(),N=function(){const t=new Pe;return function(e,n){const s=i.domElement;if(i.object.isPerspectiveCamera){const r=i.object.position;t.copy(r).sub(i.target);let o=t.length();o*=Math.tan(i.object.fov/2*Math.PI/180),L(2*e*o/s.clientHeight,i.object.matrix),O(2*n*o/s.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(L(e*(i.object.right-i.object.left)/i.object.zoom/s.clientWidth,i.object.matrix),O(n*(i.object.top-i.object.bottom)/i.object.zoom/s.clientHeight,i.object.matrix)):i.enablePan=!1}}();function B(t){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?h/=t:i.enableZoom=!1}function z(t){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?h*=t:i.enableZoom=!1}function U(t,e){if(!i.zoomToCursor)return;C=!0;const n=i.domElement.getBoundingClientRect(),s=t-n.left,r=e-n.top,o=n.width,a=n.height;A.x=s/o*2-1,A.y=-r/a*2+1,E.set(A.x,A.y,1).unproject(i.object).sub(i.object.position).normalize()}function F(t){return Math.max(i.minDistance,Math.min(i.maxDistance,t))}function G(t){c.set(t.clientX,t.clientY)}function H(t){p.set(t.clientX,t.clientY)}function V(t){if(1===I.length)c.set(t.pageX,t.pageY);else{const e=it(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);c.set(i,n)}}function j(t){if(1===I.length)p.set(t.pageX,t.pageY);else{const e=it(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);p.set(i,n)}}function W(t){const e=it(t),i=t.pageX-e.x,n=t.pageY-e.y,s=Math.sqrt(i*i+n*n);g.set(0,s)}function X(t){if(1==I.length)u.set(t.pageX,t.pageY);else{const e=it(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);u.set(i,n)}d.subVectors(u,c).multiplyScalar(i.rotateSpeed);const e=i.domElement;k(2*Math.PI*d.x/e.clientHeight),D(2*Math.PI*d.y/e.clientHeight),c.copy(u)}function $(t){if(1===I.length)m.set(t.pageX,t.pageY);else{const e=it(t),i=.5*(t.pageX+e.x),n=.5*(t.pageY+e.y);m.set(i,n)}f.subVectors(m,p).multiplyScalar(i.panSpeed),N(f.x,f.y),p.copy(m)}function q(t){const e=it(t),n=t.pageX-e.x,s=t.pageY-e.y,r=Math.sqrt(n*n+s*s);v.set(0,r),y.set(0,Math.pow(v.y/g.y,i.zoomSpeed)),B(y.y),g.copy(v);U(.5*(t.pageX+e.x),.5*(t.pageY+e.y))}function Y(t){!1!==i.enabled&&(0===I.length&&(i.domElement.setPointerCapture(t.pointerId),i.domElement.addEventListener("pointermove",K),i.domElement.addEventListener("pointerup",Z)),function(t){I.push(t.pointerId)}(t),"touch"===t.pointerType?function(t){switch(et(t),I.length){case 1:switch(i.touches.ONE){case w:if(!1===i.enableRotate)return;V(t),s=n.TOUCH_ROTATE;break;case M:if(!1===i.enablePan)return;j(t),s=n.TOUCH_PAN;break;default:s=n.NONE}break;case 2:switch(i.touches.TWO){case S:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(t){i.enableZoom&&W(t),i.enablePan&&j(t)}(t),s=n.TOUCH_DOLLY_PAN;break;case T:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(t){i.enableZoom&&W(t),i.enableRotate&&V(t)}(t),s=n.TOUCH_DOLLY_ROTATE;break;default:s=n.NONE}break;default:s=n.NONE}s!==n.NONE&&i.dispatchEvent(df)}(t):function(t){let e;switch(t.button){case 0:e=i.mouseButtons.LEFT;break;case 1:e=i.mouseButtons.MIDDLE;break;case 2:e=i.mouseButtons.RIGHT;break;default:e=-1}switch(e){case _:if(!1===i.enableZoom)return;!function(t){U(t.clientX,t.clientX),g.set(t.clientX,t.clientY)}(t),s=n.DOLLY;break;case x:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===i.enablePan)return;H(t),s=n.PAN}else{if(!1===i.enableRotate)return;G(t),s=n.ROTATE}break;case b:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===i.enableRotate)return;G(t),s=n.ROTATE}else{if(!1===i.enablePan)return;H(t),s=n.PAN}break;default:s=n.NONE}s!==n.NONE&&i.dispatchEvent(df)}(t))}function K(t){!1!==i.enabled&&("touch"===t.pointerType?function(t){switch(et(t),s){case n.TOUCH_ROTATE:if(!1===i.enableRotate)return;X(t),i.update();break;case n.TOUCH_PAN:if(!1===i.enablePan)return;$(t),i.update();break;case n.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(t){i.enableZoom&&q(t),i.enablePan&&$(t)}(t),i.update();break;case n.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(t){i.enableZoom&&q(t),i.enableRotate&&X(t)}(t),i.update();break;default:s=n.NONE}}(t):function(t){switch(s){case n.ROTATE:if(!1===i.enableRotate)return;!function(t){u.set(t.clientX,t.clientY),d.subVectors(u,c).multiplyScalar(i.rotateSpeed);const e=i.domElement;k(2*Math.PI*d.x/e.clientHeight),D(2*Math.PI*d.y/e.clientHeight),c.copy(u),i.update()}(t);break;case n.DOLLY:if(!1===i.enableZoom)return;!function(t){v.set(t.clientX,t.clientY),y.subVectors(v,g),y.y>0?B(P(y.y)):y.y<0&&z(P(y.y)),g.copy(v),i.update()}(t);break;case n.PAN:if(!1===i.enablePan)return;!function(t){m.set(t.clientX,t.clientY),f.subVectors(m,p).multiplyScalar(i.panSpeed),N(f.x,f.y),p.copy(m),i.update()}(t)}}(t))}function Z(t){!function(t){delete R[t.pointerId];for(let e=0;e<I.length;e++)if(I[e]==t.pointerId)return void I.splice(e,1)}(t),0===I.length&&(i.domElement.releasePointerCapture(t.pointerId),i.domElement.removeEventListener("pointermove",K),i.domElement.removeEventListener("pointerup",Z)),i.dispatchEvent(pf),s=n.NONE}function J(t){!1!==i.enabled&&!1!==i.enableZoom&&s===n.NONE&&(t.preventDefault(),i.dispatchEvent(df),function(t){U(t.clientX,t.clientY),t.deltaY<0?z(P(t.deltaY)):t.deltaY>0&&B(P(t.deltaY)),i.update()}(t),i.dispatchEvent(pf))}function Q(t){!1!==i.enabled&&!1!==i.enablePan&&function(t){let e=!1;switch(t.code){case i.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?D(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):N(0,i.keyPanSpeed),e=!0;break;case i.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?D(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):N(0,-i.keyPanSpeed),e=!0;break;case i.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?k(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):N(i.keyPanSpeed,0),e=!0;break;case i.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?k(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):N(-i.keyPanSpeed,0),e=!0}e&&(t.preventDefault(),i.update())}(t)}function tt(t){!1!==i.enabled&&t.preventDefault()}function et(t){let e=R[t.pointerId];void 0===e&&(e=new ne,R[t.pointerId]=e),e.set(t.pageX,t.pageY)}function it(t){const e=t.pointerId===I[0]?I[1]:I[0];return R[e]}i.domElement.addEventListener("contextmenu",tt),i.domElement.addEventListener("pointerdown",Y),i.domElement.addEventListener("pointercancel",Z),i.domElement.addEventListener("wheel",J,{passive:!1}),this.update()}}var yf;!function(t){t[t.Close=0]="Close",t[t.Long=1]="Long",t[t.Target=2]="Target",t[t.Edit=3]="Edit",t[t.Play=4]="Play",t[t.PlayDone=5]="PlayDone"}(yf||(yf={}));class xf extends Gn{constructor(t,e,i,n,s,r,o,a,h,l){super(75,t.Width/t.Height,.1,800),this.player=e,this.npcs=i,this.brick=n,this.legos=s,this.nonlegos=r,this.portal=o,this.farmer=a,this.carp=h,this.eventCtrl=l,this.debugMode=!1,t.RegisterViewer(this),this.controls=new vf(this,t.Canvas),this.longPos=new Pe(16,24,79),this.shortPos=new Pe(0,0,0),this.bakRotation=(new vi).copy(this.rotation.set(-.27,0,.03)),this.viewMode=yf.Long,this.position.set(this.longPos.x,this.longPos.y,this.longPos.z),this.eventCtrl.RegisterAppModeEvent(((t,e,i)=>{var n,s;switch(t){case qE.Portal:e==nc.Start&&(this.viewMode=yf.Target,this.controls.enabled=!1,this.target=this.portal.Meshs,this.focusAt(this.portal.CannonPos,new Pe(0,30,30)));break;case qE.Furniture:if(e==nc.Start){if(this.viewMode=yf.Target,this.controls.enabled=!1,this.target=null===(n=this.carp.target)||void 0===n?void 0:n.Meshs,!this.target)break;this.focusAt(this.target.position)}break;case qE.Farmer:if(e==nc.Start){if(this.viewMode=yf.Target,this.controls.enabled=!1,this.target=null===(s=this.farmer.target)||void 0===s?void 0:s.Meshs,!this.target)break;this.focusAt(this.target.position)}break;case qE.NonLego:e==nc.Start&&(this.viewMode=yf.Target,this.controls.enabled=!1,this.target=this.nonlegos.GetBrickGuide(this.player.CenterPos),null!=this.animate&&this.animate.kill(),this.focusAt(this.target.position));break;case qE.LegoDelete:case qE.Lego:e==nc.Start&&(this.viewMode=yf.Target,this.controls.enabled=!1,this.target=this.legos.GetBrickGuide(this.player.CenterPos),null!=this.animate&&this.animate.kill(),this.focusAt(this.target.position));break;case qE.Brick:e==nc.Start&&(this.viewMode=yf.Target,this.controls.enabled=!1,this.target=this.brick.GetBrickGuide(this.player.CenterPos),null!=this.animate&&this.animate.kill(),this.focusAt(this.target.position));break;case qE.EditPlay:e==nc.Start&&(this.viewMode=yf.Target,this.controls.enabled=!1,this.target=this.player.Meshs,null!=this.animate&&this.animate.kill(),this.focusAt(this.target.position));break;case qE.Play:if(e==nc.Start){this.viewMode=yf.Play,this.controls.enabled=!1,null!=this.animate&&this.animate.kill(),this.rotation.set(this.bakRotation.x,this.bakRotation.y,this.bakRotation.z),this.rotation.x=-Math.PI/4;const t=this.player.CannonPos;this.animate=cf.to(this.position,{x:t.x,y:t.y+13,z:t.z+13,duration:2,ease:"power1.inOut",onComplete:()=>{this.position.set(t.x,t.y,t.z),this.shortPos.set(0,13,13),this.lookAt(t.x,t.y,t.z),this.viewMode=yf.PlayDone}})}break;case qE.Close:if(e==nc.Start){if(this.viewMode=yf.Close,this.controls.enabled=!1,this.owner=this.npcs.Owner,null==this.owner)return;null!=this.animate&&this.animate.kill(),this.focusAt(this.owner.CannonPos)}break;case qE.Long:i&&i[0]?this.controls.enabled=!0:this.controls.enabled=!1,e==nc.Start&&(this.viewMode=yf.Long,null!=this.animate&&this.animate.kill(),this.rotation.set(this.bakRotation.x,this.bakRotation.y,this.bakRotation.z),this.rotation.x=-Math.PI/4,this.position.set(this.longPos.x,this.longPos.y,this.longPos.z),this.animate=cf.to(this.longPos,{x:16,y:4,z:36,duration:4,ease:"power1.inOut",onUpdate:()=>{this.rotation.set(this.bakRotation.x,this.bakRotation.y,this.bakRotation.z),this.position.set(this.longPos.x,this.longPos.y,this.longPos.z)}}))}}))}resize(t,e){this.aspect=t/e,this.updateProjectionMatrix()}focusAt(t,e){this.rotation.copy(this.bakRotation),this.rotation.x=-Math.PI/4,this.position.copy(t),this.lookAt(t),e?this.shortPos.copy(e):this.shortPos.set(0,13,13)}update(){var t,e;switch(this.viewMode){case yf.Edit:case yf.Target:{const e=null===(t=this.target)||void 0===t?void 0:t.position;if(null==e)return;if(this.debugMode)return this.controls.enabled=!0,void this.controls.update();this.controls.enabled=!1,this.rotation.x=-Math.PI/4,this.position.set(e.x+this.shortPos.x,e.y+this.shortPos.y,e.z+this.shortPos.z);break}case yf.Close:{const t=null===(e=this.owner)||void 0===e?void 0:e.CannonPos;if(null==t)return;this.rotation.x=-Math.PI/4,this.position.set(t.x+this.shortPos.x,t.y+this.shortPos.y,t.z+this.shortPos.z);break}case yf.Long:this.controls.enabled&&this.controls.update();break;case yf.Play:break;case yf.PlayDone:const i=this.player.CannonPos;this.rotation.x=-Math.PI/4,this.position.set(i.x+this.shortPos.x,i.y+this.shortPos.y,i.z+this.shortPos.z)}}}class _f{constructor(t,e={}){this.enabled=!0;const i=void 0!==e.defaultThickness?e.defaultThickness:.003,n=(new Yi).fromArray(void 0!==e.defaultColor?e.defaultColor:[0,0,0]),s=void 0!==e.defaultAlpha?e.defaultAlpha:1,r=void 0!==e.defaultKeepAlive&&e.defaultKeepAlive,o={},a={},h={},l={outlineThickness:{value:i},outlineColor:{value:n},outlineAlpha:{value:s}},c=["#include <common>","#include <uv_pars_vertex>","#include <displacementmap_pars_vertex>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","uniform float outlineThickness;","vec4 calculateOutline( vec4 pos, vec3 normal, vec4 skinned ) {","\tfloat thickness = outlineThickness;","\tconst float ratio = 1.0;","\tvec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + normal, 1.0 );","\tvec4 norm = normalize( pos - pos2 );","\treturn pos + norm * thickness * pos.w * ratio;","}","void main() {","\t#include <uv_vertex>","\t#include <beginnormal_vertex>","\t#include <morphnormal_vertex>","\t#include <skinbase_vertex>","\t#include <skinnormal_vertex>","\t#include <begin_vertex>","\t#include <morphtarget_vertex>","\t#include <skinning_vertex>","\t#include <displacementmap_vertex>","\t#include <project_vertex>","\tvec3 outlineNormal = - objectNormal;","\tgl_Position = calculateOutline( gl_Position, outlineNormal, vec4( transformed, 1.0 ) );","\t#include <logdepthbuf_vertex>","\t#include <clipping_planes_vertex>","\t#include <fog_vertex>","}"].join("\n"),u=["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>","uniform vec3 outlineColor;","uniform float outlineAlpha;","void main() {","\t#include <clipping_planes_fragment>","\t#include <logdepthbuf_fragment>","\tgl_FragColor = vec4( outlineColor, outlineAlpha );","\t#include <tonemapping_fragment>","\t#include <colorspace_fragment>","\t#include <fog_fragment>","\t#include <premultiplied_alpha_fragment>","}"].join("\n");function d(t){const e=function(t){let e=o[t.uuid];return void 0===e&&(e={material:new Un({type:"OutlineEffect",uniforms:zn.merge([ns.fog,ns.displacementmap,l]),vertexShader:c,fragmentShader:u,side:R}),used:!0,keepAlive:r,count:0},o[t.uuid]=e),e.used=!0,e.material}(t);return a[e.uuid]=t,function(t,e){if("invisible"===t.name)return;const i=e.userData.outlineParameters;t.fog=e.fog,t.toneMapped=e.toneMapped,t.premultipliedAlpha=e.premultipliedAlpha,t.displacementMap=e.displacementMap,void 0!==i?(!1===e.visible?t.visible=!1:t.visible=void 0===i.visible||i.visible,t.transparent=void 0!==i.alpha&&i.alpha<1||e.transparent,void 0!==i.keepAlive&&(o[e.uuid].keepAlive=i.keepAlive)):(t.transparent=e.transparent,t.visible=e.visible);!0!==e.wireframe&&!1!==e.depthTest||(t.visible=!1);e.clippingPlanes&&(t.clipping=!0,t.clippingPlanes=e.clippingPlanes,t.clipIntersection=e.clipIntersection,t.clipShadows=e.clipShadows);t.version=e.version}(e,t),e}function p(t){const e=t.geometry,i=void 0!==e&&void 0!==e.attributes.normal;return!0===t.isMesh&&void 0!==t.material&&!0===i}function m(t){if(!1!==p(t)){if(Array.isArray(t.material))for(let e=0,i=t.material.length;e<i;e++)t.material[e]=d(t.material[e]);else t.material=d(t.material);h[t.uuid]=t.onBeforeRender,t.onBeforeRender=g}}function f(t){if(!1!==p(t)){if(Array.isArray(t.material))for(let e=0,i=t.material.length;e<i;e++)t.material[e]=a[t.material[e].uuid];else t.material=a[t.material.uuid];t.onBeforeRender=h[t.uuid]}}function g(t,e,i,n,s){const r=a[s.uuid];void 0!==r&&function(t,e){const i=e.userData.outlineParameters;t.uniforms.outlineAlpha.value=e.opacity,void 0!==i&&(void 0!==i.thickness&&(t.uniforms.outlineThickness.value=i.thickness),void 0!==i.color&&t.uniforms.outlineColor.value.fromArray(i.color),void 0!==i.alpha&&(t.uniforms.outlineAlpha.value=i.alpha));e.displacementMap&&(t.uniforms.displacementMap.value=e.displacementMap,t.uniforms.displacementScale.value=e.displacementScale,t.uniforms.displacementBias.value=e.displacementBias)}(s,r)}this.render=function(e,i){if(!1===this.enabled)return void t.render(e,i);const n=t.autoClear;t.autoClear=this.autoClear,t.render(e,i),t.autoClear=n,this.renderOutline(e,i)},this.renderOutline=function(e,i){const n=t.autoClear,s=e.matrixWorldAutoUpdate,r=e.background,l=t.shadowMap.enabled;e.matrixWorldAutoUpdate=!1,e.background=null,t.autoClear=!1,t.shadowMap.enabled=!1,e.traverse(m),t.render(e,i),e.traverse(f),function(){let t;t=Object.keys(a);for(let e=0,i=t.length;e<i;e++)a[t[e]]=void 0;t=Object.keys(h);for(let e=0,i=t.length;e<i;e++)h[t[e]]=void 0;t=Object.keys(o);for(let e=0,i=t.length;e<i;e++){const i=t[e];!1===o[i].used?(o[i].count++,!1===o[i].keepAlive&&o[i].count>60&&delete o[i]):(o[i].used=!1,o[i].count=0)}}(),e.matrixWorldAutoUpdate=s,e.background=r,t.autoClear=n,t.shadowMap.enabled=l},this.autoClear=t.autoClear,this.domElement=t.domElement,this.shadowMap=t.shadowMap,this.clear=function(e,i,n){t.clear(e,i,n)},this.getPixelRatio=function(){return t.getPixelRatio()},this.setPixelRatio=function(e){t.setPixelRatio(e)},this.getSize=function(e){return t.getSize(e)},this.setSize=function(e,i,n){t.setSize(e,i,n)},this.setViewport=function(e,i,n,s){t.setViewport(e,i,n,s)},this.setScissor=function(e,i,n,s){t.setScissor(e,i,n,s)},this.setScissorTest=function(e){t.setScissorTest(e)},this.setRenderTarget=function(e){t.setRenderTarget(e)}}}class bf extends Bo{constructor(t,e,i){super({antialias:!0,canvas:i.Canvas}),this.camera=t,this.scene=e,this.effect=new _f(this),this.bloomLayer=new yi,this.vertexShaderCode="\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }\n    ",this.fragmentShaderCode="\n        uniform sampler2D baseTexture;\n        uniform sampler2D bloomTexture;\n        varying vec2 vUv;\n        void main() {\n            gl_FragColor = (texture2D(baseTexture, vUv) + vec4(1.0) * texture2D(bloomTexture, vUv));\n        }\n    ",fe.enabled=!0,this.outputColorSpace=It,this.shadowMap.enabled=!0,this.shadowMap.type=A,this.setClearColor(6737151,1),this.setSize(i.Width,i.Height),this.setPixelRatio(Math.min(window.devicePixelRatio,2)),i.RegisterViewer(this)}setScene(t){this.scene=t}resize(t,e){this.setSize(t,e),this.setPixelRatio(Math.min(window.devicePixelRatio,2))}update(){this.render(this.scene,this.camera)}}class wf extends _l{constructor(){super(16777215,2);const t=ic.StartPosition;this.position.set(t.x+7,500,t.z+30),this.target.position.set(t.x,3,t.z),this.castShadow=!0,this.shadow.radius=1e3,this.shadow.mapSize.width=4096,this.shadow.mapSize.height=4096,this.shadow.camera.near=.1,this.shadow.camera.far=1e3,this.shadow.camera.left=100,this.shadow.camera.right=-100,this.shadow.camera.top=100,this.shadow.camera.bottom=-100}resize(){}update(){}}class Mf{get Mesh(){return this.points}constructor(t,e,i){this.material=new Ua({size:.1,vertexColors:!0,transparent:!0,opacity:1,depthTest:!1}),this.geometry=new mn,this.count=30,this.delta=[],this.velocity=5+Math.random(),this.processFlag=!1,this.v=.1;const n=[],s=[],r=new Yi;r.setRGB(t,e,i);for(let t=0;t<this.count;t++){const e=new Pe(0,0,0),i=Math.random()*Math.PI*2,o=2*Math.random();e.x=this.velocity*Math.sin(i)*Math.cos(o),e.y=this.velocity*Math.sin(i)*Math.sin(o),e.z=this.velocity*Math.cos(i)*5,this.delta.push(e),n.push(0,0,0,t),s.push(r.r,r.g,r.b,t)}this.geometry.setAttribute("position",new on(n,4)),this.geometry.setAttribute("color",new on(s,4)),this.points=new ja(this.geometry,this.material),this.points.visible=!1,this.points.geometry.attributes.color.needsUpdate=!0}Start(){const t=this.points.geometry.attributes.position;this.material.opacity=1,this.v=.001;for(let e=0;e<this.delta.length;e++)t.setX(e,0),t.setY(e,0),t.setZ(e,1);this.points.visible=!0,this.processFlag=!0}Complet(){this.points.visible=!1,this.processFlag=!1}Update(t){if(this.material.opacity<=0||!this.processFlag)return;const e=this.points.geometry.attributes.position;for(let i=0;i<this.delta.length;i++){const n=e.getX(i),s=e.getY(i),r=e.getZ(i);e.setX(i,n+this.delta[i].x*t),e.setY(i,s+this.delta[i].y*t),e.setZ(i,r-Math.abs(this.delta[i].z*this.v)*t)}this.v+=.1,this.material.opacity-=2*t,this.material.opacity<=0&&this.Complet(),e.needsUpdate=!0}}const Sf="bold 14pt sans-serif";class Tf extends ia{get Mesh(){return this}constructor(t,e){const i=document.createElement("canvas");let n=i.getContext("2d");if(null==n)return;n.font=Sf;const s=n.measureText(t),r=s.width,o=s.fontBoundingBoxAscent+s.fontBoundingBoxDescent;if(i.width=r,i.height=o,n=i.getContext("2d"),null==n)return;n.font=Sf,n.fillStyle=e,n.shadowOffsetX=3,n.shadowOffsetY=3,n.shadowBlur=2,n.textAlign="center",n.textBaseline="middle",n.fillText(t,r/2,o/2,r);const a=new Xa(n.canvas);super(new Ho({map:a,color:16777215,fog:!1})),this.processFlag=!1,this.v=1e-4,this.scale.set(1,1,1),this.position.y=3.3,this.position.z=2,this.params_=t,this.visible_=!0,this.visible=!1}Destroy(){this.traverse((t=>{if(t instanceof kn){if(t.material){let e=t.material;t.material instanceof Array||(e=[t.material]);for(let t of e)t.dispose()}t.geometry&&t.geometry.dispose()}})),this.parent&&this.parent.remove(this)}InitComponent(){}OnDeath_(){this.Destroy()}Start(t,e){this.visible=!0,this.SetText(t,e),this.position.set(ie.randFloatSpread(1),3.3,2),this.material.opacity=1,this.v=1e-4}Complete(){this.visible=!1}Update(t){this.position.y+=.5*t,this.v+=.001,this.material.opacity-=this.v,this.material.opacity<0&&this.Complete()}SetText(t,e){if(!this.visible_)return;const i=document.createElement("canvas");if(this.material.dispose(),this.params_=t,null==i)return;const n=i.getContext("2d");if(null==n)return;n.font=Sf;const s=n.measureText(t),r=s.width,o=s.fontBoundingBoxAscent+s.fontBoundingBoxDescent;i.width=r+10,i.height=o;const a=i.getContext("2d");if(null==a)return;a.font=Sf,a.shadowOffsetX=1,a.shadowOffsetY=1,a.shadowColor="rgba(0, 0, 0, 1)",a.shadowBlur=0,a.fillStyle=e,a.textAlign="center",a.textBaseline="middle",a.fillText(t,r/2,o/2,r);const h=new Xa(a.canvas);this.material=new Ho({map:h,color:16777215,fog:!1,transparent:!0,depthTest:!1})}}var Ef,Af=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};!function(t){t[t.Idle=0]="Idle",t[t.Run=1]="Run",t[t.Jump=2]="Jump",t[t.Punch=3]="Punch",t[t.Sword=4]="Sword",t[t.Gun=5]="Gun",t[t.Bow=6]="Bow",t[t.Wand=7]="Wand",t[t.Fight=8]="Fight",t[t.Dance=9]="Dance",t[t.MagicH1=10]="MagicH1",t[t.MagicH2=11]="MagicH2",t[t.Dying=12]="Dying",t[t.Clim=13]="Clim",t[t.Swim=14]="Swim",t[t.Downfall=15]="Downfall",t[t.PickFruit=16]="PickFruit",t[t.PickFruitTree=17]="PickFruitTree",t[t.PlantAPlant=18]="PlantAPlant",t[t.Hammering=19]="Hammering",t[t.Watering=20]="Watering",t[t.Building=21]="Building"}(Ef||(Ef={}));class Cf extends xc{get BoxPos(){return this.asset.GetBoxPos(this.meshs)}set Model(t){this.playerModel=t}get Model(){return this.playerModel}get ActionType(){return this.currentActionType}constructor(t,e,i,n,s){super(t.MaleAsset),this.loader=t,this.eventCtrl=e,this.portal=i,this.store=n,this.game=s,this.currentActionType=Ef.Idle,this.playerModel=Zl.Male,this.bindMesh=[],this.damageEffect=new Mf(this.CannonPos.x,this.CannonPos.y,this.CannonPos.z),this.txtStatus=new Tf("0","#ff0000"),this.clipMap=new Map,this.clock=new Sl,this.meshs=new Po,this.store.RegisterPlayer(this,this),this.eventCtrl.RegisterAppModeEvent(((t,e)=>{if(t!=qE.Play&&t!=qE.EditPlay&&t!=qE.Weapon)this.Visible=!1;else switch(e){case nc.Start:this.eventCtrl.OnChangeCtrlObjEvent(this),this.Init(t),this.Visible=!0;break;case nc.End:this.Uninit(),this.Visible=!1}})),this.eventCtrl.RegisterChangeEquipmentEvent((t=>{this.ReloadBindingItem(t,Yl.Head),this.ReloadBindingItem(t,Yl.Hands_L),this.ReloadBindingItem(t,Yl.Hands_R)}))}ReloadBindingItem(t,e){const i=this.asset.GetBodyMeshId(e);if(null==i)return;const n=this.meshs.getObjectByName(i);if(!n)return;const s=this.bindMesh[e];s&&(s.visible=!1,this.bindMesh.splice(this.bindMesh.indexOf(s),1));const r=t.GetBindItem(e);if(r&&null!=r.Mesh){const t=n.getObjectById(r.Mesh.id);t?t.visible=!0:n.add(r.Mesh),this.bindMesh[e]=r.Mesh}}Uninit(){this.store.Owner=this.CannonPos}Init(t){var e;let i=(new Pe).copy(this.portal.CannonPos);i.x-=4,i.z+=4,t==qE.EditPlay?i=null!==(e=this.store.Owner)&&void 0!==e?e:i:t==qE.Weapon&&(i=this.meshs.position),i.y=this.meshs.position.y,this.meshs.position.copy(i)}Viliageload(){return Af(this,void 0,void 0,(function*(){yield this.Reload()}))}Reload(){return Af(this,void 0,void 0,(function*(){const t=this.store.PlayerModel;if(this.playerModel==t)return;const e=ic.StartPosition;this.game.remove(this.Meshs),yield this.Loader(this.loader.GetAssets(t),e,"player"),this.game.add(this.Meshs)}))}Loader(t,e,i){return Af(this,void 0,void 0,(function*(){this.playerModel=t.Id,this.asset=t;const[n,s]=yield t.UniqModel(i);this.meshs=n,this.meshs.position.copy(e),this.mixer=this.asset.GetMixer(i),this.clipMap.set(Ef.Idle,this.asset.GetAnimationClip(Kl.Idle)),this.clipMap.set(Ef.Run,this.asset.GetAnimationClip(Kl.Run)),this.clipMap.set(Ef.Jump,this.asset.GetAnimationClip(Kl.Jump)),this.clipMap.set(Ef.Punch,this.asset.GetAnimationClip(Kl.Punch)),this.clipMap.set(Ef.Sword,this.asset.GetAnimationClip(Kl.Sword)),this.clipMap.set(Ef.Fight,this.asset.GetAnimationClip(Kl.FightIdle)),this.clipMap.set(Ef.Dance,this.asset.GetAnimationClip(Kl.Dance0)),this.clipMap.set(Ef.MagicH1,this.asset.GetAnimationClip(Kl.MagicH1)),this.clipMap.set(Ef.MagicH2,this.asset.GetAnimationClip(Kl.MagicH2)),this.clipMap.set(Ef.Dying,this.asset.GetAnimationClip(Kl.Dying)),this.clipMap.set(Ef.PickFruit,this.asset.GetAnimationClip(Kl.PickFruit)),this.clipMap.set(Ef.PickFruitTree,this.asset.GetAnimationClip(Kl.PickFruitTree)),this.clipMap.set(Ef.PlantAPlant,this.asset.GetAnimationClip(Kl.PlantAPlant)),this.clipMap.set(Ef.Watering,this.asset.GetAnimationClip(Kl.Wartering)),this.clipMap.set(Ef.Hammering,this.asset.GetAnimationClip(Kl.Hammering)),this.clipMap.set(Ef.Building,this.asset.GetAnimationClip(Kl.Hammering)),this.changeAnimate(this.clipMap.get(this.currentActionType)),this.meshs.add(this.damageEffect.Mesh),this.damageEffect.Mesh.visible=!1,this.meshs.add(this.txtStatus),this.txtStatus.visible=!1,this.Visible=!1}))}changeAnimate(t,e){var i,n;if(null==t||this.currentClip==t)return;let s=.2;null===(i=this.currentAni)||void 0===i||i.fadeOut(.2);const r=null===(n=this.mixer)||void 0===n?void 0:n.clipAction(t);null!=r&&(t==this.clipMap.get(Ef.Jump)||t==this.clipMap.get(Ef.Dying)?(s=0,r.clampWhenFinished=!0,r.setLoop(yt,1)):r.setLoop(xt,1e4),null!=e&&(r.timeScale=t.duration/e),r.reset().fadeIn(s).play(),this.currentAni=r,this.currentClip=t)}ChangeAction(t,e){this.currentActionType=t,this.changeAnimate(this.clipMap.get(t),e)}DamageEffect(t){this.damageEffect.Start(),this.txtStatus.Start(t.toString(),"#fff")}HealEffect(t){this.txtStatus.Start("+"+t,"#00ff00")}Update(){var t;const e=this.clock.getDelta();this.damageEffect.Update(e),this.txtStatus.Update(e),null===(t=this.mixer)||void 0===t||t.update(e)}}function If(t,e){if(0===e)return t;if(2===e||1===e){let i=t.getIndex();if(null===i){const e=[],n=t.getAttribute("position");if(void 0===n)return t;for(let t=0;t<n.count;t++)e.push(t);t.setIndex(e),i=t.getIndex()}const n=i.count-2,s=[];if(2===e)for(let t=1;t<=n;t++)s.push(i.getX(0)),s.push(i.getX(t)),s.push(i.getX(t+1));else for(let t=0;t<n;t++)t%2==0?(s.push(i.getX(t)),s.push(i.getX(t+1)),s.push(i.getX(t+2))):(s.push(i.getX(t+2)),s.push(i.getX(t+1)),s.push(i.getX(t)));s.length;const r=t.clone();return r.setIndex(s),r.clearGroups(),r}return t}class Rf extends tl{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new Nf(t)})),this.register((function(t){return new Wf(t)})),this.register((function(t){return new Xf(t)})),this.register((function(t){return new $f(t)})),this.register((function(t){return new zf(t)})),this.register((function(t){return new Uf(t)})),this.register((function(t){return new Ff(t)})),this.register((function(t){return new Gf(t)})),this.register((function(t){return new Of(t)})),this.register((function(t){return new Hf(t)})),this.register((function(t){return new Bf(t)})),this.register((function(t){return new jf(t)})),this.register((function(t){return new Vf(t)})),this.register((function(t){return new Df(t)})),this.register((function(t){return new qf(t)})),this.register((function(t){return new Yf(t)}))}load(t,e,i,n){const s=this;let r;if(""!==this.resourcePath)r=this.resourcePath;else if(""!==this.path){const e=wl.extractUrlBase(t);r=wl.resolveURL(e,this.path)}else r=wl.extractUrlBase(t);this.manager.itemStart(t);const o=function(e){n&&n(e),s.manager.itemError(t),s.manager.itemEnd(t)},a=new nl(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(i){try{s.parse(i,r,(function(i){e(i),s.manager.itemEnd(t)}),o)}catch(t){o(t)}}),i,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,n){let s;const r={},o={},a=new TextDecoder;if("string"==typeof t)s=JSON.parse(t);else if(t instanceof ArrayBuffer){if(a.decode(new Uint8Array(t,0,4))===Kf){try{r[kf.KHR_BINARY_GLTF]=new Qf(t)}catch(t){return void(n&&n(t))}s=JSON.parse(r[kf.KHR_BINARY_GLTF].content)}else s=JSON.parse(a.decode(t))}else s=t;if(void 0===s.asset||s.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const h=new Sg(s,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let t=0;t<this.pluginCallbacks.length;t++){const e=this.pluginCallbacks[t](h);e.name,o[e.name]=e,r[e.name]=!0}if(s.extensionsUsed)for(let t=0;t<s.extensionsUsed.length;++t){const e=s.extensionsUsed[t],i=s.extensionsRequired||[];switch(e){case kf.KHR_MATERIALS_UNLIT:r[e]=new Lf;break;case kf.KHR_DRACO_MESH_COMPRESSION:r[e]=new tg(s,this.dracoLoader);break;case kf.KHR_TEXTURE_TRANSFORM:r[e]=new eg;break;case kf.KHR_MESH_QUANTIZATION:r[e]=new ig;break;default:i.indexOf(e)>=0&&o[e]}}h.setExtensions(r),h.setPlugins(o),h.parse(i,n)}parseAsync(t,e){const i=this;return new Promise((function(n,s){i.parse(t,e,n,s)}))}}function Pf(){let t={};return{get:function(e){return t[e]},add:function(e,i){t[e]=i},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const kf={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Df{constructor(t){this.parser=t,this.name=kf.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let i=0,n=e.length;i<n;i++){const n=e[i];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&t._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(t){const e=this.parser,i="light:"+t;let n=e.cache.get(i);if(n)return n;const s=e.json,r=((s.extensions&&s.extensions[this.name]||{}).lights||[])[t];let o;const a=new Yi(16777215);void 0!==r.color&&a.setRGB(r.color[0],r.color[1],r.color[2],Rt);const h=void 0!==r.range?r.range:0;switch(r.type){case"directional":o=new _l(a),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new yl(a),o.distance=h;break;case"spot":o=new pl(a),o.distance=h,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,o.angle=r.spot.outerConeAngle,o.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return o.position.set(0,0,0),o.decay=2,yg(o,r),void 0!==r.intensity&&(o.intensity=r.intensity),o.name=e.createUniqueName(r.name||"light_"+t),n=Promise.resolve(o),e.cache.add(i,n),n}getDependency(t,e){if("light"===t)return this._loadLight(e)}createNodeAttachment(t){const e=this,i=this.parser,n=i.json.nodes[t],s=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===s?null:this._loadLight(s).then((function(t){return i._getNodeRef(e.cache,s,t)}))}}class Lf{constructor(){this.name=kf.KHR_MATERIALS_UNLIT}getMaterialType(){return Qi}extendParams(t,e,i){const n=[];t.color=new Yi(1,1,1),t.opacity=1;const s=e.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;t.color.setRGB(e[0],e[1],e[2],Rt),t.opacity=e[3]}void 0!==s.baseColorTexture&&n.push(i.assignTexture(t,"map",s.baseColorTexture,It))}return Promise.all(n)}}class Of{constructor(t){this.parser=t,this.name=kf.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name].emissiveStrength;return void 0!==n&&(e.emissiveIntensity=n),Promise.resolve()}}class Nf{constructor(t){this.parser=t,this.name=kf.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Ch:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];if(void 0!==r.clearcoatFactor&&(e.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&s.push(i.assignTexture(e,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(e.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&s.push(i.assignTexture(e,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(s.push(i.assignTexture(e,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const t=r.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new ne(t,t)}return Promise.all(s)}}class Bf{constructor(t){this.parser=t,this.name=kf.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Ch:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return void 0!==r.iridescenceFactor&&(e.iridescence=r.iridescenceFactor),void 0!==r.iridescenceTexture&&s.push(i.assignTexture(e,"iridescenceMap",r.iridescenceTexture)),void 0!==r.iridescenceIor&&(e.iridescenceIOR=r.iridescenceIor),void 0===e.iridescenceThicknessRange&&(e.iridescenceThicknessRange=[100,400]),void 0!==r.iridescenceThicknessMinimum&&(e.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),void 0!==r.iridescenceThicknessMaximum&&(e.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),void 0!==r.iridescenceThicknessTexture&&s.push(i.assignTexture(e,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(s)}}class zf{constructor(t){this.parser=t,this.name=kf.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Ch:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[];e.sheenColor=new Yi(0,0,0),e.sheenRoughness=0,e.sheen=1;const r=n.extensions[this.name];if(void 0!==r.sheenColorFactor){const t=r.sheenColorFactor;e.sheenColor.setRGB(t[0],t[1],t[2],Rt)}return void 0!==r.sheenRoughnessFactor&&(e.sheenRoughness=r.sheenRoughnessFactor),void 0!==r.sheenColorTexture&&s.push(i.assignTexture(e,"sheenColorMap",r.sheenColorTexture,It)),void 0!==r.sheenRoughnessTexture&&s.push(i.assignTexture(e,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(s)}}class Uf{constructor(t){this.parser=t,this.name=kf.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Ch:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return void 0!==r.transmissionFactor&&(e.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&s.push(i.assignTexture(e,"transmissionMap",r.transmissionTexture)),Promise.all(s)}}class Ff{constructor(t){this.parser=t,this.name=kf.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Ch:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];e.thickness=void 0!==r.thicknessFactor?r.thicknessFactor:0,void 0!==r.thicknessTexture&&s.push(i.assignTexture(e,"thicknessMap",r.thicknessTexture)),e.attenuationDistance=r.attenuationDistance||1/0;const o=r.attenuationColor||[1,1,1];return e.attenuationColor=(new Yi).setRGB(o[0],o[1],o[2],Rt),Promise.all(s)}}class Gf{constructor(t){this.parser=t,this.name=kf.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Ch:null}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return e.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class Hf{constructor(t){this.parser=t,this.name=kf.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Ch:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];e.specularIntensity=void 0!==r.specularFactor?r.specularFactor:1,void 0!==r.specularTexture&&s.push(i.assignTexture(e,"specularIntensityMap",r.specularTexture));const o=r.specularColorFactor||[1,1,1];return e.specularColor=(new Yi).setRGB(o[0],o[1],o[2],Rt),void 0!==r.specularColorTexture&&s.push(i.assignTexture(e,"specularColorMap",r.specularColorTexture,It)),Promise.all(s)}}class Vf{constructor(t){this.parser=t,this.name=kf.EXT_MATERIALS_BUMP}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Ch:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return e.bumpScale=void 0!==r.bumpFactor?r.bumpFactor:1,void 0!==r.bumpTexture&&s.push(i.assignTexture(e,"bumpMap",r.bumpTexture)),Promise.all(s)}}class jf{constructor(t){this.parser=t,this.name=kf.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Ch:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return void 0!==r.anisotropyStrength&&(e.anisotropy=r.anisotropyStrength),void 0!==r.anisotropyRotation&&(e.anisotropyRotation=r.anisotropyRotation),void 0!==r.anisotropyTexture&&s.push(i.assignTexture(e,"anisotropyMap",r.anisotropyTexture)),Promise.all(s)}}class Wf{constructor(t){this.parser=t,this.name=kf.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,i=e.json,n=i.textures[t];if(!n.extensions||!n.extensions[this.name])return null;const s=n.extensions[this.name],r=e.options.ktx2Loader;if(!r){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,s.source,r)}}class Xf{constructor(t){this.parser=t,this.name=kf.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,n=i.json,s=n.textures[t];if(!s.extensions||!s.extensions[e])return null;const r=s.extensions[e],o=n.images[r.source];let a=i.textureLoader;if(o.uri){const t=i.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then((function(s){if(s)return i.loadTextureImage(t,r.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class $f{constructor(t){this.parser=t,this.name=kf.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,n=i.json,s=n.textures[t];if(!s.extensions||!s.extensions[e])return null;const r=s.extensions[e],o=n.images[r.source];let a=i.textureLoader;if(o.uri){const t=i.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then((function(s){if(s)return i.loadTextureImage(t,r.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class qf{constructor(t){this.name=kf.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const t=i.extensions[this.name],n=this.parser.getDependency("buffer",t.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then((function(e){const i=t.byteOffset||0,n=t.byteLength||0,r=t.count,o=t.byteStride,a=new Uint8Array(e,i,n);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(r,o,a,t.mode,t.filter).then((function(t){return t.buffer})):s.ready.then((function(){const e=new ArrayBuffer(r*o);return s.decodeGltfBuffer(new Uint8Array(e),r,o,a,t.mode,t.filter),e}))}))}return null}}class Yf{constructor(t){this.name=kf.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const e=this.parser.json,i=e.nodes[t];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;const n=e.meshes[i.mesh];for(const t of n.primitives)if(t.mode!==og.TRIANGLES&&t.mode!==og.TRIANGLE_STRIP&&t.mode!==og.TRIANGLE_FAN&&void 0!==t.mode)return null;const s=i.extensions[this.name].attributes,r=[],o={};for(const t in s)r.push(this.parser.getDependency("accessor",s[t]).then((e=>(o[t]=e,o[t]))));return r.length<1?null:(r.push(this.parser.createNodeMesh(t)),Promise.all(r).then((t=>{const e=t.pop(),i=e.isGroup?e.children:[e],n=t[0].count,s=[];for(const t of i){const e=new ai,i=new Pe,r=new Re,a=new Pe(1,1,1),h=new Aa(t.geometry,t.material,n);for(let t=0;t<n;t++)o.TRANSLATION&&i.fromBufferAttribute(o.TRANSLATION,t),o.ROTATION&&r.fromBufferAttribute(o.ROTATION,t),o.SCALE&&a.fromBufferAttribute(o.SCALE,t),h.setMatrixAt(t,e.compose(i,r,a));for(const e in o)if("_COLOR_0"===e){const t=o[e];h.instanceColor=new xa(t.array,t.itemSize,t.normalized)}else"TRANSLATION"!==e&&"ROTATION"!==e&&"SCALE"!==e&&t.geometry.setAttribute(e,o[e]);ki.prototype.copy.call(h,t),this.parser.assignFinalMaterial(h),s.push(h)}return e.isGroup?(e.clear(),e.add(...s),e):s[0]})))}}const Kf="glTF",Zf=1313821514,Jf=5130562;class Qf{constructor(t){this.name=kf.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Kf)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,s=new DataView(t,12);let r=0;for(;r<n;){const e=s.getUint32(r,!0);r+=4;const n=s.getUint32(r,!0);if(r+=4,n===Zf){const n=new Uint8Array(t,12+r,e);this.content=i.decode(n)}else if(n===Jf){const i=12+r;this.body=t.slice(i,i+e)}r+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class tg{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=kf.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const i=this.json,n=this.dracoLoader,s=t.extensions[this.name].bufferView,r=t.extensions[this.name].attributes,o={},a={},h={};for(const t in r){const e=ug[t]||t.toLowerCase();o[e]=r[t]}for(const e in t.attributes){const n=ug[e]||e.toLowerCase();if(void 0!==r[e]){const s=i.accessors[t.attributes[e]],r=ag[s.componentType];h[n]=r.name,a[n]=!0===s.normalized}}return e.getDependency("bufferView",s).then((function(t){return new Promise((function(e,i){n.decodeDracoFile(t,(function(t){for(const e in t.attributes){const i=t.attributes[e],n=a[e];void 0!==n&&(i.normalized=n)}e(t)}),o,h,Rt,i)}))}))}}class eg{constructor(){this.name=kf.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&e.texCoord!==t.channel||void 0!==e.offset||void 0!==e.rotation||void 0!==e.scale?(t=t.clone(),void 0!==e.texCoord&&(t.channel=e.texCoord),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0,t):t}}class ig{constructor(){this.name=kf.KHR_MESH_QUANTIZATION}}class ng extends Bh{constructor(t,e,i,n){super(t,e,i,n)}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=t*n*3+n;for(let t=0;t!==n;t++)e[t]=i[s+t];return e}interpolate_(t,e,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=2*o,h=3*o,l=n-e,c=(i-e)/l,u=c*c,d=u*c,p=t*h,m=p-h,f=-2*d+3*u,g=d-u,v=1-f,y=g-u+c;for(let t=0;t!==o;t++){const e=r[m+t+o],i=r[m+t+a]*l,n=r[p+t+o],h=r[p+t]*l;s[t]=v*e+y*i+f*n+g*h}return s}}const sg=new Re;class rg extends ng{interpolate_(t,e,i,n){const s=super.interpolate_(t,e,i,n);return sg.fromArray(s).normalize().toArray(s),s}}const og={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},ag={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},hg={9728:Z,9729:tt,9984:J,9985:et,9986:Q,9987:it},lg={33071:Y,33648:K,10497:q},cg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ug={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},dg={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},pg={CUBICSPLINE:void 0,LINEAR:bt,STEP:_t},mg="OPAQUE",fg="MASK",gg="BLEND";function vg(t,e,i){for(const n in i.extensions)void 0===t[n]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=i.extensions[n])}function yg(t,e){void 0!==e.extras&&"object"==typeof e.extras&&Object.assign(t.userData,e.extras)}function xg(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let i=0,n=e.weights.length;i<n;i++)t.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length){t.morphTargetDictionary={};for(let e=0,n=i.length;e<n;e++)t.morphTargetDictionary[i[e]]=e}}}function _g(t){let e;const i=t.extensions&&t.extensions[kf.KHR_DRACO_MESH_COMPRESSION];if(e=i?"draco:"+i.bufferView+":"+i.indices+":"+bg(i.attributes):t.indices+":"+bg(t.attributes)+":"+t.mode,void 0!==t.targets)for(let i=0,n=t.targets.length;i<n;i++)e+=":"+bg(t.targets[i]);return e}function bg(t){let e="";const i=Object.keys(t).sort();for(let n=0,s=i.length;n<s;n++)e+=i[n]+":"+t[i[n]]+";";return e}function wg(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const Mg=new ai;class Sg{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new Pf,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=!1,s=-1;"undefined"!=typeof navigator&&(i=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=navigator.userAgent.indexOf("Firefox")>-1,s=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||i||n&&s<98?this.textureLoader=new rl(this.options.manager):this.textureLoader=new Ml(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new nl(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const i=this,n=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])})).then((function(e){const r={scene:e[0][n.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:n.asset,parser:i,userData:{}};return vg(s,r,n),yg(r,n),Promise.all(i._invokeAll((function(t){return t.afterRoot&&t.afterRoot(r)}))).then((function(){t(r)}))})).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let i=0,n=e.length;i<n;i++){const n=e[i].joints;for(let e=0,i=n.length;e<i;e++)t[n[e]].isBone=!0}for(let e=0,n=t.length;e<n;e++){const n=t[e];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(i[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;const n=i.clone(),s=(t,e)=>{const i=this.associations.get(t);null!=i&&this.associations.set(e,i);for(const[i,n]of t.children.entries())s(n,e.children[i])};return s(i,n),n.name+="_instance_"+t.uses[e]++,n}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const n=t(e[i]);if(n)return n}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let n=0;n<e.length;n++){const s=t(e[n]);s&&i.push(s)}return i}getDependency(t,e){const i=t+":"+e;let n=this.cache.get(i);if(!n){switch(t){case"scene":n=this.loadScene(e);break;case"node":n=this._invokeOne((function(t){return t.loadNode&&t.loadNode(e)}));break;case"mesh":n=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":n=this.loadAccessor(e);break;case"bufferView":n=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":n=this.loadBuffer(e);break;case"material":n=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":n=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":n=this.loadSkin(e);break;case"animation":n=this._invokeOne((function(t){return t.loadAnimation&&t.loadAnimation(e)}));break;case"camera":n=this.loadCamera(e);break;default:if(n=this._invokeOne((function(i){return i!=this&&i.getDependency&&i.getDependency(t,e)})),!n)throw new Error("Unknown type: "+t)}this.cache.add(i,n)}return n}getDependencies(t){let e=this.cache.get(t);if(!e){const i=this,n=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(n.map((function(e,n){return i.getDependency(t,n)}))),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],i=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[kf.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(t,s){i.load(wl.resolveURL(e.uri,n.path),t,void 0,(function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){const i=e.byteLength||0,n=e.byteOffset||0;return t.slice(n,n+i)}))}loadAccessor(t){const e=this,i=this.json,n=this.json.accessors[t];if(void 0===n.bufferView&&void 0===n.sparse){const t=cg[n.type],e=ag[n.componentType],i=!0===n.normalized,s=new e(n.count*t);return Promise.resolve(new nn(s,t,i))}const s=[];return void 0!==n.bufferView?s.push(this.getDependency("bufferView",n.bufferView)):s.push(null),void 0!==n.sparse&&(s.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(s).then((function(t){const s=t[0],r=cg[n.type],o=ag[n.componentType],a=o.BYTES_PER_ELEMENT,h=a*r,l=n.byteOffset||0,c=void 0!==n.bufferView?i.bufferViews[n.bufferView].byteStride:void 0,u=!0===n.normalized;let d,p;if(c&&c!==h){const t=Math.floor(l/c),i="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+t+":"+n.count;let h=e.cache.get(i);h||(d=new o(s,t*c,n.count*c/a),h=new Uo(d,c/a),e.cache.add(i,h)),p=new Go(h,r,l%c/a,u)}else d=null===s?new o(n.count*r):new o(s,l,n.count*r),p=new nn(d,r,u);if(void 0!==n.sparse){const e=cg.SCALAR,i=ag[n.sparse.indices.componentType],a=n.sparse.indices.byteOffset||0,h=n.sparse.values.byteOffset||0,l=new i(t[1],a,n.sparse.count*e),c=new o(t[2],h,n.sparse.count*r);null!==s&&(p=new nn(p.array.slice(),p.itemSize,p.normalized));for(let t=0,e=l.length;t<e;t++){const e=l[t];if(p.setX(e,c[t*r]),r>=2&&p.setY(e,c[t*r+1]),r>=3&&p.setZ(e,c[t*r+2]),r>=4&&p.setW(e,c[t*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(t){const e=this.json,i=this.options,n=e.textures[t].source,s=e.images[n];let r=this.textureLoader;if(s.uri){const t=i.manager.getHandler(s.uri);null!==t&&(r=t)}return this.loadTextureImage(t,n,r)}loadTextureImage(t,e,i){const n=this,s=this.json,r=s.textures[t],o=s.images[e],a=(o.uri||o.bufferView)+":"+r.sampler;if(this.textureCache[a])return this.textureCache[a];const h=this.loadImageSource(e,i).then((function(e){e.flipY=!1,e.name=r.name||o.name||"",""===e.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(e.name=o.uri);const i=(s.samplers||{})[r.sampler]||{};return e.magFilter=hg[i.magFilter]||tt,e.minFilter=hg[i.minFilter]||it,e.wrapS=lg[i.wrapS]||q,e.wrapT=lg[i.wrapT]||q,n.associations.set(e,{textures:t}),e})).catch((function(){return null}));return this.textureCache[a]=h,h}loadImageSource(t,e){const i=this,n=this.json,s=this.options;if(void 0!==this.sourceCache[t])return this.sourceCache[t].then((t=>t.clone()));const r=n.images[t],o=self.URL||self.webkitURL;let a=r.uri||"",h=!1;if(void 0!==r.bufferView)a=i.getDependency("bufferView",r.bufferView).then((function(t){h=!0;const e=new Blob([t],{type:r.mimeType});return a=o.createObjectURL(e),a}));else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const l=Promise.resolve(a).then((function(t){return new Promise((function(i,n){let r=i;!0===e.isImageBitmapLoader&&(r=function(t){const e=new Se(t);e.needsUpdate=!0,i(e)}),e.load(wl.resolveURL(t,s.path),r,void 0,n)}))})).then((function(t){var e;return!0===h&&o.revokeObjectURL(a),t.userData.mimeType=r.mimeType||((e=r.uri).search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"),t})).catch((function(t){throw t}));return this.sourceCache[t]=l,l}assignTexture(t,e,i,n){const s=this;return this.getDependency("texture",i.index).then((function(r){if(!r)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((r=r.clone()).channel=i.texCoord),s.extensions[kf.KHR_TEXTURE_TRANSFORM]){const t=void 0!==i.extensions?i.extensions[kf.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=s.associations.get(r);r=s.extensions[kf.KHR_TEXTURE_TRANSFORM].extendTexture(r,t),s.associations.set(r,e)}}return void 0!==n&&(r.colorSpace=n),t[e]=r,r}))}assignFinalMaterial(t){const e=t.geometry;let i=t.material;const n=void 0===e.attributes.tangent,s=void 0!==e.attributes.color,r=void 0===e.attributes.normal;if(t.isPoints){const t="PointsMaterial:"+i.uuid;let e=this.cache.get(t);e||(e=new Ua,Ji.prototype.copy.call(e,i),e.color.copy(i.color),e.map=i.map,e.sizeAttenuation=!1,this.cache.add(t,e)),i=e}else if(t.isLine){const t="LineBasicMaterial:"+i.uuid;let e=this.cache.get(t);e||(e=new Ca,Ji.prototype.copy.call(e,i),e.color.copy(i.color),e.map=i.map,this.cache.add(t,e)),i=e}if(n||s||r){let t="ClonedMaterial:"+i.uuid+":";n&&(t+="derivative-tangents:"),s&&(t+="vertex-colors:"),r&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=i.clone(),s&&(e.vertexColors=!0),r&&(e.flatShading=!0),n&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(i))),i=e}t.material=i}getMaterialType(){return Ah}loadMaterial(t){const e=this,i=this.json,n=this.extensions,s=i.materials[t];let r;const o={},a=[];if((s.extensions||{})[kf.KHR_MATERIALS_UNLIT]){const t=n[kf.KHR_MATERIALS_UNLIT];r=t.getMaterialType(),a.push(t.extendParams(o,s,e))}else{const i=s.pbrMetallicRoughness||{};if(o.color=new Yi(1,1,1),o.opacity=1,Array.isArray(i.baseColorFactor)){const t=i.baseColorFactor;o.color.setRGB(t[0],t[1],t[2],Rt),o.opacity=t[3]}void 0!==i.baseColorTexture&&a.push(e.assignTexture(o,"map",i.baseColorTexture,It)),o.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,o.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(a.push(e.assignTexture(o,"metalnessMap",i.metallicRoughnessTexture)),a.push(e.assignTexture(o,"roughnessMap",i.metallicRoughnessTexture))),r=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),a.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,o)}))))}!0===s.doubleSided&&(o.side=2);const h=s.alphaMode||mg;if(h===gg?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,h===fg&&(o.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&r!==Qi&&(a.push(e.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new ne(1,1),void 0!==s.normalTexture.scale)){const t=s.normalTexture.scale;o.normalScale.set(t,t)}if(void 0!==s.occlusionTexture&&r!==Qi&&(a.push(e.assignTexture(o,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(o.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&r!==Qi){const t=s.emissiveFactor;o.emissive=(new Yi).setRGB(t[0],t[1],t[2],Rt)}return void 0!==s.emissiveTexture&&r!==Qi&&a.push(e.assignTexture(o,"emissiveMap",s.emissiveTexture,It)),Promise.all(a).then((function(){const i=new r(o);return s.name&&(i.name=s.name),yg(i,s),e.associations.set(i,{materials:t}),s.extensions&&vg(n,i,s),i}))}createUniqueName(t){const e=Dl.sanitizeNodeName(t||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(t){const e=this,i=this.extensions,n=this.primitiveCache;function s(t){return i[kf.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(i){return Tg(i,t,e)}))}const r=[];for(let i=0,o=t.length;i<o;i++){const o=t[i],a=_g(o),h=n[a];if(h)r.push(h.promise);else{let t;t=o.extensions&&o.extensions[kf.KHR_DRACO_MESH_COMPRESSION]?s(o):Tg(new mn,o,e),n[a]={primitive:o,promise:t},r.push(t)}}return Promise.all(r)}loadMesh(t){const e=this,i=this.json,n=this.extensions,s=i.meshes[t],r=s.primitives,o=[];for(let t=0,e=r.length;t<e;t++){const e=void 0===r[t].material?(void 0===(a=this.cache).DefaultMaterial&&(a.DefaultMaterial=new Ah({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:I})),a.DefaultMaterial):this.getDependency("material",r[t].material);o.push(e)}var a;return o.push(e.loadGeometries(r)),Promise.all(o).then((function(i){const o=i.slice(0,i.length-1),a=i[i.length-1],h=[];for(let i=0,l=a.length;i<l;i++){const l=a[i],c=r[i];let u;const d=o[i];if(c.mode===og.TRIANGLES||c.mode===og.TRIANGLE_STRIP||c.mode===og.TRIANGLE_FAN||void 0===c.mode)u=!0===s.isSkinnedMesh?new pa(l,d):new kn(l,d),!0===u.isSkinnedMesh&&u.normalizeSkinWeights(),c.mode===og.TRIANGLE_STRIP?u.geometry=If(u.geometry,1):c.mode===og.TRIANGLE_FAN&&(u.geometry=If(u.geometry,2));else if(c.mode===og.LINES)u=new Ba(l,d);else if(c.mode===og.LINE_STRIP)u=new La(l,d);else if(c.mode===og.LINE_LOOP)u=new za(l,d);else{if(c.mode!==og.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+c.mode);u=new ja(l,d)}Object.keys(u.geometry.morphAttributes).length>0&&xg(u,s),u.name=e.createUniqueName(s.name||"mesh_"+t),yg(u,s),c.extensions&&vg(n,u,c),e.assignFinalMaterial(u),h.push(u)}for(let i=0,n=h.length;i<n;i++)e.associations.set(h[i],{meshes:t,primitives:i});if(1===h.length)return s.extensions&&vg(n,h[0],s),h[0];const l=new Po;s.extensions&&vg(n,l,s),e.associations.set(l,{meshes:t});for(let t=0,e=h.length;t<e;t++)l.add(h[t]);return l}))}loadCamera(t){let e;const i=this.json.cameras[t],n=i[i.type];if(n)return"perspective"===i.type?e=new Gn(ie.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===i.type&&(e=new ds(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),yg(e,i),Promise.resolve(e)}loadSkin(t){const e=this.json.skins[t],i=[];for(let t=0,n=e.joints.length;t<n;t++)i.push(this._loadNodeShallow(e.joints[t]));return void 0!==e.inverseBindMatrices?i.push(this.getDependency("accessor",e.inverseBindMatrices)):i.push(null),Promise.all(i).then((function(t){const e=t.pop(),i=t,n=[],s=[];for(let t=0,r=i.length;t<r;t++){const r=i[t];if(r){n.push(r);const i=new ai;null!==e&&i.fromArray(e.array,16*t),s.push(i)}}return new ya(n,s)}))}loadAnimation(t){const e=this.json,i=this,n=e.animations[t],s=n.name?n.name:"animation_"+t,r=[],o=[],a=[],h=[],l=[];for(let t=0,e=n.channels.length;t<e;t++){const e=n.channels[t],i=n.samplers[e.sampler],s=e.target,c=s.node,u=void 0!==n.parameters?n.parameters[i.input]:i.input,d=void 0!==n.parameters?n.parameters[i.output]:i.output;void 0!==s.node&&(r.push(this.getDependency("node",c)),o.push(this.getDependency("accessor",u)),a.push(this.getDependency("accessor",d)),h.push(i),l.push(s))}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(a),Promise.all(h),Promise.all(l)]).then((function(t){const e=t[0],n=t[1],r=t[2],o=t[3],a=t[4],h=[];for(let t=0,s=e.length;t<s;t++){const s=e[t],l=n[t],c=r[t],u=o[t],d=a[t];if(void 0===s)continue;s.updateMatrix&&s.updateMatrix();const p=i._createAnimationTracks(s,l,c,u,d);if(p)for(let t=0;t<p.length;t++)h.push(p[t])}return new Yh(s,void 0,h)}))}createNodeMesh(t){const e=this.json,i=this,n=e.nodes[t];return void 0===n.mesh?null:i.getDependency("mesh",n.mesh).then((function(t){const e=i._getNodeRef(i.meshCache,n.mesh,t);return void 0!==n.weights&&e.traverse((function(t){if(t.isMesh)for(let e=0,i=n.weights.length;e<i;e++)t.morphTargetInfluences[e]=n.weights[e]})),e}))}loadNode(t){const e=this,i=this.json.nodes[t],n=e._loadNodeShallow(t),s=[],r=i.children||[];for(let t=0,i=r.length;t<i;t++)s.push(e.getDependency("node",r[t]));const o=void 0===i.skin?Promise.resolve(null):e.getDependency("skin",i.skin);return Promise.all([n,Promise.all(s),o]).then((function(t){const e=t[0],i=t[1],n=t[2];null!==n&&e.traverse((function(t){t.isSkinnedMesh&&t.bind(n,Mg)}));for(let t=0,n=i.length;t<n;t++)e.add(i[t]);return e}))}_loadNodeShallow(t){const e=this.json,i=this.extensions,n=this;if(void 0!==this.nodeCache[t])return this.nodeCache[t];const s=e.nodes[t],r=s.name?n.createUniqueName(s.name):"",o=[],a=n._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return a&&o.push(a),void 0!==s.camera&&o.push(n.getDependency("camera",s.camera).then((function(t){return n._getNodeRef(n.cameraCache,s.camera,t)}))),n._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){o.push(t)})),this.nodeCache[t]=Promise.all(o).then((function(e){let o;if(o=!0===s.isBone?new ma:e.length>1?new Po:1===e.length?e[0]:new ki,o!==e[0])for(let t=0,i=e.length;t<i;t++)o.add(e[t]);if(s.name&&(o.userData.name=s.name,o.name=r),yg(o,s),s.extensions&&vg(i,o,s),void 0!==s.matrix){const t=new ai;t.fromArray(s.matrix),o.applyMatrix4(t)}else void 0!==s.translation&&o.position.fromArray(s.translation),void 0!==s.rotation&&o.quaternion.fromArray(s.rotation),void 0!==s.scale&&o.scale.fromArray(s.scale);return n.associations.has(o)||n.associations.set(o,{}),n.associations.get(o).nodes=t,o})),this.nodeCache[t]}loadScene(t){const e=this.extensions,i=this.json.scenes[t],n=this,s=new Po;i.name&&(s.name=n.createUniqueName(i.name)),yg(s,i),i.extensions&&vg(e,s,i);const r=i.nodes||[],o=[];for(let t=0,e=r.length;t<e;t++)o.push(n.getDependency("node",r[t]));return Promise.all(o).then((function(t){for(let e=0,i=t.length;e<i;e++)s.add(t[e]);return n.associations=(t=>{const e=new Map;for(const[t,i]of n.associations)(t instanceof Ji||t instanceof Se)&&e.set(t,i);return t.traverse((t=>{const i=n.associations.get(t);null!=i&&e.set(t,i)})),e})(s),s}))}_createAnimationTracks(t,e,i,n,s){const r=[],o=t.name?t.name:t.uuid,a=[];let h;switch(dg[s.path]===dg.weights?t.traverse((function(t){t.morphTargetInfluences&&a.push(t.name?t.name:t.uuid)})):a.push(o),dg[s.path]){case dg.weights:h=jh;break;case dg.rotation:h=Xh;break;case dg.position:case dg.scale:h=qh;break;default:if(1===i.itemSize)h=jh;else h=qh}const l=void 0!==n.interpolation?pg[n.interpolation]:bt,c=this._getArrayFromAccessor(i);for(let t=0,i=a.length;t<i;t++){const i=new h(a[t]+"."+dg[s.path],e.array,c,l);"CUBICSPLINE"===n.interpolation&&this._createCubicSplineTrackInterpolant(i),r.push(i)}return r}_getArrayFromAccessor(t){let e=t.array;if(t.normalized){const t=wg(e.constructor),i=new Float32Array(e.length);for(let n=0,s=e.length;n<s;n++)i[n]=e[n]*t;e=i}return e}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(t){return new(this instanceof Xh?rg:ng)(this.times,this.values,this.getValueSize()/3,t)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Tg(t,e,i){const n=e.attributes,s=[];function r(e,n){return i.getDependency("accessor",e).then((function(e){t.setAttribute(n,e)}))}for(const e in n){const i=ug[e]||e.toLowerCase();i in t.attributes||s.push(r(n[e],i))}if(void 0!==e.indices&&!t.index){const n=i.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));s.push(n)}return fe.workingColorSpace,yg(t,e),function(t,e,i){const n=e.attributes,s=new Le;if(void 0===n.POSITION)return;{const t=i.json.accessors[n.POSITION],e=t.min,r=t.max;if(void 0===e||void 0===r)return;if(s.set(new Pe(e[0],e[1],e[2]),new Pe(r[0],r[1],r[2])),t.normalized){const e=wg(ag[t.componentType]);s.min.multiplyScalar(e),s.max.multiplyScalar(e)}}const r=e.targets;if(void 0!==r){const t=new Pe,e=new Pe;for(let n=0,s=r.length;n<s;n++){const s=r[n];if(void 0!==s.POSITION){const n=i.json.accessors[s.POSITION],r=n.min,o=n.max;if(void 0!==r&&void 0!==o){if(e.setX(Math.max(Math.abs(r[0]),Math.abs(o[0]))),e.setY(Math.max(Math.abs(r[1]),Math.abs(o[1]))),e.setZ(Math.max(Math.abs(r[2]),Math.abs(o[2]))),n.normalized){const t=wg(ag[n.componentType]);e.multiplyScalar(t)}t.max(e)}}}s.expandByVector(t)}t.boundingBox=s;const o=new Je;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,t.boundingSphere=o}(t,e,i),Promise.all(s).then((function(){return void 0!==e.targets?function(t,e,i){let n=!1,s=!1,r=!1;for(let t=0,i=e.length;t<i;t++){const i=e[t];if(void 0!==i.POSITION&&(n=!0),void 0!==i.NORMAL&&(s=!0),void 0!==i.COLOR_0&&(r=!0),n&&s&&r)break}if(!n&&!s&&!r)return Promise.resolve(t);const o=[],a=[],h=[];for(let l=0,c=e.length;l<c;l++){const c=e[l];if(n){const e=void 0!==c.POSITION?i.getDependency("accessor",c.POSITION):t.attributes.position;o.push(e)}if(s){const e=void 0!==c.NORMAL?i.getDependency("accessor",c.NORMAL):t.attributes.normal;a.push(e)}if(r){const e=void 0!==c.COLOR_0?i.getDependency("accessor",c.COLOR_0):t.attributes.color;h.push(e)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(h)]).then((function(e){const i=e[0],o=e[1],a=e[2];return n&&(t.morphAttributes.position=i),s&&(t.morphAttributes.normal=o),r&&(t.morphAttributes.color=a),t.morphTargetsRelative=!0,t}))}(t,e.targets,i):t}))}var Eg=function(t){return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))};try{URL.revokeObjectURL(Eg(""))}catch(t){Eg=function(t){return"data:application/javascript;charset=UTF-8,"+encodeURI(t)},function(t){return new Worker(t,{type:"module"})}}var Ag=Uint8Array,Cg=Uint16Array,Ig=Uint32Array,Rg=new Ag([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Pg=new Ag([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),kg=new Ag([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Dg=function(t,e){for(var i=new Cg(31),n=0;n<31;++n)i[n]=e+=1<<t[n-1];var s=new Ig(i[30]);for(n=1;n<30;++n)for(var r=i[n];r<i[n+1];++r)s[r]=r-i[n]<<5|n;return[i,s]},Lg=Dg(Rg,2),Og=Lg[0],Ng=Lg[1];Og[28]=258,Ng[258]=28;for(var Bg=Dg(Pg,0),zg=Bg[0],Ug=(Bg[1],new Cg(32768)),Fg=0;Fg<32768;++Fg){var Gg=(43690&Fg)>>>1|(21845&Fg)<<1;Gg=(61680&(Gg=(52428&Gg)>>>2|(13107&Gg)<<2))>>>4|(3855&Gg)<<4,Ug[Fg]=((65280&Gg)>>>8|(255&Gg)<<8)>>>1}var Hg=function(t,e,i){for(var n=t.length,s=0,r=new Cg(e);s<n;++s)++r[t[s]-1];var o,a=new Cg(e);for(s=0;s<e;++s)a[s]=a[s-1]+r[s-1]<<1;if(i){o=new Cg(1<<e);var h=15-e;for(s=0;s<n;++s)if(t[s])for(var l=s<<4|t[s],c=e-t[s],u=a[t[s]-1]++<<c,d=u|(1<<c)-1;u<=d;++u)o[Ug[u]>>>h]=l}else for(o=new Cg(n),s=0;s<n;++s)t[s]&&(o[s]=Ug[a[t[s]-1]++]>>>15-t[s]);return o},Vg=new Ag(288);for(Fg=0;Fg<144;++Fg)Vg[Fg]=8;for(Fg=144;Fg<256;++Fg)Vg[Fg]=9;for(Fg=256;Fg<280;++Fg)Vg[Fg]=7;for(Fg=280;Fg<288;++Fg)Vg[Fg]=8;var jg=new Ag(32);for(Fg=0;Fg<32;++Fg)jg[Fg]=5;var Wg=Hg(Vg,9,1),Xg=Hg(jg,5,1),$g=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},qg=function(t,e,i){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(7&e)&i},Yg=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},Kg=function(t){return(t/8|0)+(7&t&&1)},Zg=function(t,e,i){(null==e||e<0)&&(e=0),(null==i||i>t.length)&&(i=t.length);var n=new(t instanceof Cg?Cg:t instanceof Ig?Ig:Ag)(i-e);return n.set(t.subarray(e,i)),n},Jg=function(t,e,i){var n=t.length;if(!n||i&&!i.l&&n<5)return e||new Ag(0);var s=!e||i,r=!i||i.i;i||(i={}),e||(e=new Ag(3*n));var o=function(t){var i=e.length;if(t>i){var n=new Ag(Math.max(2*i,t));n.set(e),e=n}},a=i.f||0,h=i.p||0,l=i.b||0,c=i.l,u=i.d,d=i.m,p=i.n,m=8*n;do{if(!c){i.f=a=qg(t,h,1);var f=qg(t,h+1,3);if(h+=3,!f){var g=t[(A=Kg(h)+4)-4]|t[A-3]<<8,v=A+g;if(v>n){if(r)throw"unexpected EOF";break}s&&o(l+g),e.set(t.subarray(A,v),l),i.b=l+=g,i.p=h=8*v;continue}if(1==f)c=Wg,u=Xg,d=9,p=5;else{if(2!=f)throw"invalid block type";var y=qg(t,h,31)+257,x=qg(t,h+10,15)+4,_=y+qg(t,h+5,31)+1;h+=14;for(var b=new Ag(_),w=new Ag(19),M=0;M<x;++M)w[kg[M]]=qg(t,h+3*M,7);h+=3*x;var S=$g(w),T=(1<<S)-1,E=Hg(w,S,1);for(M=0;M<_;){var A,C=E[qg(t,h,T)];if(h+=15&C,(A=C>>>4)<16)b[M++]=A;else{var I=0,R=0;for(16==A?(R=3+qg(t,h,3),h+=2,I=b[M-1]):17==A?(R=3+qg(t,h,7),h+=3):18==A&&(R=11+qg(t,h,127),h+=7);R--;)b[M++]=I}}var P=b.subarray(0,y),k=b.subarray(y);d=$g(P),p=$g(k),c=Hg(P,d,1),u=Hg(k,p,1)}if(h>m){if(r)throw"unexpected EOF";break}}s&&o(l+131072);for(var D=(1<<d)-1,L=(1<<p)-1,O=h;;O=h){var N=(I=c[Yg(t,h)&D])>>>4;if((h+=15&I)>m){if(r)throw"unexpected EOF";break}if(!I)throw"invalid length/literal";if(N<256)e[l++]=N;else{if(256==N){O=h,c=null;break}var B=N-254;if(N>264){var z=Rg[M=N-257];B=qg(t,h,(1<<z)-1)+Og[M],h+=z}var U=u[Yg(t,h)&L],F=U>>>4;if(!U)throw"invalid distance";h+=15&U;k=zg[F];if(F>3){z=Pg[F];k+=Yg(t,h)&(1<<z)-1,h+=z}if(h>m){if(r)throw"unexpected EOF";break}s&&o(l+131072);for(var G=l+B;l<G;l+=4)e[l]=e[l-k],e[l+1]=e[l+1-k],e[l+2]=e[l+2-k],e[l+3]=e[l+3-k];l=G}}i.l=c,i.p=O,i.b=l,c&&(a=1,i.m=d,i.d=u,i.n=p)}while(!a);return l==e.length?e:Zg(e,0,l)},Qg=new Ag(0),tv=function(t){if(8!=(15&t[0])||t[0]>>>4>7||(t[0]<<8|t[1])%31)throw"invalid zlib data";if(32&t[1])throw"invalid zlib data: preset dictionaries not supported"};function ev(t,e){return Jg((tv(t),t.subarray(2,-4)),e)}var iv="undefined"!=typeof TextDecoder&&new TextDecoder;try{iv.decode(Qg,{stream:!0}),1}catch(t){}function nv(t,e,i){const n=i.length-t-1;if(e>=i[n])return n-1;if(e<=i[t])return t;let s=t,r=n,o=Math.floor((s+r)/2);for(;e<i[o]||e>=i[o+1];)e<i[o]?r=o:s=o,o=Math.floor((s+r)/2);return o}function sv(t,e,i,n){const s=[],r=[],o=[];s[0]=1;for(let a=1;a<=i;++a){r[a]=e-n[t+1-a],o[a]=n[t+a]-e;let i=0;for(let t=0;t<a;++t){const e=o[t+1],n=r[a-t],h=s[t]/(e+n);s[t]=i+e*h,i=n*h}s[a]=i}return s}function rv(t,e){let i=1;for(let e=2;e<=t;++e)i*=e;let n=1;for(let t=2;t<=e;++t)n*=t;for(let i=2;i<=t-e;++i)n*=i;return i/n}function ov(t,e,i,n,s){const r=function(t,e,i,n,s){const r=s<t?s:t,o=[],a=nv(t,n,e),h=function(t,e,i,n,s){const r=[];for(let t=0;t<=i;++t)r[t]=0;const o=[];for(let t=0;t<=n;++t)o[t]=r.slice(0);const a=[];for(let t=0;t<=i;++t)a[t]=r.slice(0);a[0][0]=1;const h=r.slice(0),l=r.slice(0);for(let n=1;n<=i;++n){h[n]=e-s[t+1-n],l[n]=s[t+n]-e;let i=0;for(let t=0;t<n;++t){const e=l[t+1],s=h[n-t];a[n][t]=e+s;const r=a[t][n-1]/a[n][t];a[t][n]=i+e*r,i=s*r}a[n][n]=i}for(let t=0;t<=i;++t)o[0][t]=a[t][i];for(let t=0;t<=i;++t){let e=0,s=1;const h=[];for(let t=0;t<=i;++t)h[t]=r.slice(0);h[0][0]=1;for(let r=1;r<=n;++r){let n=0;const l=t-r,c=i-r;t>=r&&(h[s][0]=h[e][0]/a[c+1][l],n=h[s][0]*a[l][c]);const u=t-1<=c?r-1:i-t;for(let t=l>=-1?1:-l;t<=u;++t)h[s][t]=(h[e][t]-h[e][t-1])/a[c+1][l+t],n+=h[s][t]*a[l+t][c];t<=c&&(h[s][r]=-h[e][r-1]/a[c+1][t],n+=h[s][r]*a[t][c]),o[r][t]=n;const d=e;e=s,s=d}}let c=i;for(let t=1;t<=n;++t){for(let e=0;e<=i;++e)o[t][e]*=c;c*=i-t}return o}(a,n,t,r,e),l=[];for(let t=0;t<i.length;++t){const e=i[t].clone(),n=e.w;e.x*=n,e.y*=n,e.z*=n,l[t]=e}for(let e=0;e<=r;++e){const i=l[a-t].clone().multiplyScalar(h[e][0]);for(let n=1;n<=t;++n)i.add(l[a-t+n].clone().multiplyScalar(h[e][n]));o[e]=i}for(let t=r+1;t<=s+1;++t)o[t]=new Te(0,0,0);return o}(t,e,i,n,s);return function(t){const e=t.length,i=[],n=[];for(let s=0;s<e;++s){const e=t[s];i[s]=new Pe(e.x,e.y,e.z),n[s]=e.w}const s=[];for(let t=0;t<e;++t){const e=i[t].clone();for(let i=1;i<=t;++i)e.sub(s[t-i].clone().multiplyScalar(rv(t,i)*n[i]));s[t]=e.divideScalar(n[0])}return s}(r)}class av extends $a{constructor(t,e,i,n,s){super(),this.degree=t,this.knots=e,this.controlPoints=[],this.startKnot=n||0,this.endKnot=s||this.knots.length-1;for(let t=0;t<i.length;++t){const e=i[t];this.controlPoints[t]=new Te(e.x,e.y,e.z,e.w)}}getPoint(t,e=new Pe){const i=e,n=this.knots[this.startKnot]+t*(this.knots[this.endKnot]-this.knots[this.startKnot]),s=function(t,e,i,n){const s=nv(t,n,e),r=sv(s,n,t,e),o=new Te(0,0,0,0);for(let e=0;e<=t;++e){const n=i[s-t+e],a=r[e],h=n.w*a;o.x+=n.x*h,o.y+=n.y*h,o.z+=n.z*h,o.w+=n.w*a}return o}(this.degree,this.knots,this.controlPoints,n);return 1!==s.w&&s.divideScalar(s.w),i.set(s.x,s.y,s.z)}getTangent(t,e=new Pe){const i=e,n=this.knots[0]+t*(this.knots[this.knots.length-1]-this.knots[0]),s=ov(this.degree,this.knots,this.controlPoints,n,1);return i.copy(s[1]).normalize(),i}}let hv,lv,cv;class uv extends tl{constructor(t){super(t)}load(t,e,i,n){const s=this,r=""===s.path?wl.extractUrlBase(t):s.path,o=new nl(this.manager);o.setPath(s.path),o.setResponseType("arraybuffer"),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(t,(function(i){try{e(s.parse(i,r))}catch(e){n&&n(e),s.manager.itemError(t)}}),i,n)}parse(t,e){if(function(t){const e="Kaydara FBX Binary  \0";return t.byteLength>=e.length&&e===Cv(t,0,e.length)}(t))hv=(new gv).parse(t);else{const e=Cv(t);if(!function(t){const e=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let i=0;function n(e){const n=t[e-1];return t=t.slice(i+e),i++,n}for(let t=0;t<e.length;++t){if(n(1)===e[t])return!1}return!0}(e))throw new Error("THREE.FBXLoader: Unknown format.");if(xv(e)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+xv(e));hv=(new fv).parse(e)}const i=new rl(this.manager).setPath(this.resourcePath||e).setCrossOrigin(this.crossOrigin);return new dv(i,this.manager).parse(hv)}}class dv{constructor(t,e){this.textureLoader=t,this.manager=e}parse(){lv=this.parseConnections();const t=this.parseImages(),e=this.parseTextures(t),i=this.parseMaterials(e),n=this.parseDeformers(),s=(new pv).parse(n);return this.parseScene(n,s,i),cv}parseConnections(){const t=new Map;if("Connections"in hv){hv.Connections.connections.forEach((function(e){const i=e[0],n=e[1],s=e[2];t.has(i)||t.set(i,{parents:[],children:[]});const r={ID:n,relationship:s};t.get(i).parents.push(r),t.has(n)||t.set(n,{parents:[],children:[]});const o={ID:i,relationship:s};t.get(n).children.push(o)}))}return t}parseImages(){const t={},e={};if("Video"in hv.Objects){const i=hv.Objects.Video;for(const n in i){const s=i[n];if(t[parseInt(n)]=s.RelativeFilename||s.Filename,"Content"in s){const t=s.Content instanceof ArrayBuffer&&s.Content.byteLength>0,r="string"==typeof s.Content&&""!==s.Content;if(t||r){const t=this.parseImage(i[n]);e[s.RelativeFilename||s.Filename]=t}}}}for(const i in t){const n=t[i];void 0!==e[n]?t[i]=e[n]:t[i]=t[i].split("\\").pop()}return t}parseImage(t){const e=t.Content,i=t.RelativeFilename||t.Filename;let n;switch(i.slice(i.lastIndexOf(".")+1).toLowerCase()){case"bmp":n="image/bmp";break;case"jpg":case"jpeg":n="image/jpeg";break;case"png":n="image/png";break;case"tif":n="image/tiff";break;case"tga":this.manager.getHandler(".tga"),n="image/tga";break;default:return}if("string"==typeof e)return"data:"+n+";base64,"+e;{const t=new Uint8Array(e);return window.URL.createObjectURL(new Blob([t],{type:n}))}}parseTextures(t){const e=new Map;if("Texture"in hv.Objects){const i=hv.Objects.Texture;for(const n in i){const s=this.parseTexture(i[n],t);e.set(parseInt(n),s)}}return e}parseTexture(t,e){const i=this.loadTexture(t,e);i.ID=t.id,i.name=t.attrName;const n=t.WrapModeU,s=t.WrapModeV,r=void 0!==n?n.value:0,o=void 0!==s?s.value:0;if(i.wrapS=0===r?q:Y,i.wrapT=0===o?q:Y,"Scaling"in t){const e=t.Scaling.value;i.repeat.x=e[0],i.repeat.y=e[1]}if("Translation"in t){const e=t.Translation.value;i.offset.x=e[0],i.offset.y=e[1]}return i}loadTexture(t,e){let i;const n=this.textureLoader.path,s=lv.get(t.id).children;let r;void 0!==s&&s.length>0&&void 0!==e[s[0].ID]&&(i=e[s[0].ID],0!==i.indexOf("blob:")&&0!==i.indexOf("data:")||this.textureLoader.setPath(void 0));const o=t.FileName.slice(-3).toLowerCase();if("tga"===o){const t=this.manager.getHandler(".tga");null===t?r=new Se:(t.setPath(this.textureLoader.path),r=t.load(i))}else if("dds"===o){const t=this.manager.getHandler(".dds");null===t?r=new Se:(t.setPath(this.textureLoader.path),r=t.load(i))}else r="psd"===o?new Se:this.textureLoader.load(i);return this.textureLoader.setPath(n),r}parseMaterials(t){const e=new Map;if("Material"in hv.Objects){const i=hv.Objects.Material;for(const n in i){const s=this.parseMaterial(i[n],t);null!==s&&e.set(parseInt(n),s)}}return e}parseMaterial(t,e){const i=t.id,n=t.attrName;let s=t.ShadingModel;if("object"==typeof s&&(s=s.value),!lv.has(i))return null;const r=this.parseParameters(t,e,i);let o;switch(s.toLowerCase()){case"phong":default:o=new Ih;break;case"lambert":o=new Ph}return o.setValues(r),o.name=n,o}parseParameters(t,e,i){const n={};t.BumpFactor&&(n.bumpScale=t.BumpFactor.value),t.Diffuse?n.color=(new Yi).fromArray(t.Diffuse.value).convertSRGBToLinear():!t.DiffuseColor||"Color"!==t.DiffuseColor.type&&"ColorRGB"!==t.DiffuseColor.type||(n.color=(new Yi).fromArray(t.DiffuseColor.value).convertSRGBToLinear()),t.DisplacementFactor&&(n.displacementScale=t.DisplacementFactor.value),t.Emissive?n.emissive=(new Yi).fromArray(t.Emissive.value).convertSRGBToLinear():!t.EmissiveColor||"Color"!==t.EmissiveColor.type&&"ColorRGB"!==t.EmissiveColor.type||(n.emissive=(new Yi).fromArray(t.EmissiveColor.value).convertSRGBToLinear()),t.EmissiveFactor&&(n.emissiveIntensity=parseFloat(t.EmissiveFactor.value)),t.Opacity&&(n.opacity=parseFloat(t.Opacity.value)),n.opacity<1&&(n.transparent=!0),t.ReflectionFactor&&(n.reflectivity=t.ReflectionFactor.value),t.Shininess&&(n.shininess=t.Shininess.value),t.Specular?n.specular=(new Yi).fromArray(t.Specular.value).convertSRGBToLinear():t.SpecularColor&&"Color"===t.SpecularColor.type&&(n.specular=(new Yi).fromArray(t.SpecularColor.value).convertSRGBToLinear());const s=this;return lv.get(i).children.forEach((function(t){switch(t.relationship){case"Bump":n.bumpMap=s.getTexture(e,t.ID);break;case"Maya|TEX_ao_map":n.aoMap=s.getTexture(e,t.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":n.map=s.getTexture(e,t.ID),void 0!==n.map&&(n.map.colorSpace=It);break;case"DisplacementColor":n.displacementMap=s.getTexture(e,t.ID);break;case"EmissiveColor":n.emissiveMap=s.getTexture(e,t.ID),void 0!==n.emissiveMap&&(n.emissiveMap.colorSpace=It);break;case"NormalMap":case"Maya|TEX_normal_map":n.normalMap=s.getTexture(e,t.ID);break;case"ReflectionColor":n.envMap=s.getTexture(e,t.ID),void 0!==n.envMap&&(n.envMap.mapping=W,n.envMap.colorSpace=It);break;case"SpecularColor":n.specularMap=s.getTexture(e,t.ID),void 0!==n.specularMap&&(n.specularMap.colorSpace=It);break;case"TransparentColor":case"TransparencyFactor":n.alphaMap=s.getTexture(e,t.ID),n.transparent=!0}})),n}getTexture(t,e){return"LayeredTexture"in hv.Objects&&e in hv.Objects.LayeredTexture&&(e=lv.get(e).children[0].ID),t.get(e)}parseDeformers(){const t={},e={};if("Deformer"in hv.Objects){const i=hv.Objects.Deformer;for(const n in i){const s=i[n],r=lv.get(parseInt(n));if("Skin"===s.attrType){const e=this.parseSkeleton(r,i);e.ID=n,r.parents.length,e.geometryID=r.parents[0].ID,t[n]=e}else if("BlendShape"===s.attrType){const t={id:n};t.rawTargets=this.parseMorphTargets(r,i),t.id=n,r.parents.length,e[n]=t}}}return{skeletons:t,morphTargets:e}}parseSkeleton(t,e){const i=[];return t.children.forEach((function(t){const n=e[t.ID];if("Cluster"!==n.attrType)return;const s={ID:t.ID,indices:[],weights:[],transformLink:(new ai).fromArray(n.TransformLink.a)};"Indexes"in n&&(s.indices=n.Indexes.a,s.weights=n.Weights.a),i.push(s)})),{rawBones:i,bones:[]}}parseMorphTargets(t,e){const i=[];for(let n=0;n<t.children.length;n++){const s=t.children[n],r=e[s.ID],o={name:r.attrName,initialWeight:r.DeformPercent,id:r.id,fullWeights:r.FullWeights.a};if("BlendShapeChannel"!==r.attrType)return;o.geoID=lv.get(parseInt(s.ID)).children.filter((function(t){return void 0===t.relationship}))[0].ID,i.push(o)}return i}parseScene(t,e,i){cv=new Po;const n=this.parseModels(t.skeletons,e,i),s=hv.Objects.Model,r=this;n.forEach((function(t){const e=s[t.ID];r.setLookAtProperties(t,e);lv.get(t.ID).parents.forEach((function(e){const i=n.get(e.ID);void 0!==i&&i.add(t)})),null===t.parent&&cv.add(t)})),this.bindSkeleton(t.skeletons,e,n),this.addGlobalSceneSettings(),cv.traverse((function(t){if(t.userData.transformData){t.parent&&(t.userData.transformData.parentMatrix=t.parent.matrix,t.userData.transformData.parentMatrixWorld=t.parent.matrixWorld);const e=Tv(t.userData.transformData);t.applyMatrix4(e),t.updateWorldMatrix()}}));const o=(new mv).parse();1===cv.children.length&&cv.children[0].isGroup&&(cv.children[0].animations=o,cv=cv.children[0]),cv.animations=o}parseModels(t,e,i){const n=new Map,s=hv.Objects.Model;for(const r in s){const o=parseInt(r),a=s[r],h=lv.get(o);let l=this.buildSkeleton(h,t,o,a.attrName);if(!l){switch(a.attrType){case"Camera":l=this.createCamera(h);break;case"Light":l=this.createLight(h);break;case"Mesh":l=this.createMesh(h,e,i);break;case"NurbsCurve":l=this.createCurve(h,e);break;case"LimbNode":case"Root":l=new ma;break;default:l=new Po}l.name=a.attrName?Dl.sanitizeNodeName(a.attrName):"",l.userData.originalName=a.attrName,l.ID=o}this.getTransformData(l,a),n.set(o,l)}return n}buildSkeleton(t,e,i,n){let s=null;return t.parents.forEach((function(t){for(const r in e){const o=e[r];o.rawBones.forEach((function(e,r){if(e.ID===t.ID){const t=s;s=new ma,s.matrixWorld.copy(e.transformLink),s.name=n?Dl.sanitizeNodeName(n):"",s.userData.originalName=n,s.ID=i,o.bones[r]=s,null!==t&&s.add(t)}}))}})),s}createCamera(t){let e,i;if(t.children.forEach((function(t){const e=hv.Objects.NodeAttribute[t.ID];void 0!==e&&(i=e)})),void 0===i)e=new ki;else{let t=0;void 0!==i.CameraProjectionType&&1===i.CameraProjectionType.value&&(t=1);let n=1;void 0!==i.NearPlane&&(n=i.NearPlane.value/1e3);let s=1e3;void 0!==i.FarPlane&&(s=i.FarPlane.value/1e3);let r=window.innerWidth,o=window.innerHeight;void 0!==i.AspectWidth&&void 0!==i.AspectHeight&&(r=i.AspectWidth.value,o=i.AspectHeight.value);const a=r/o;let h=45;void 0!==i.FieldOfView&&(h=i.FieldOfView.value);const l=i.FocalLength?i.FocalLength.value:null;switch(t){case 0:e=new Gn(h,a,n,s),null!==l&&e.setFocalLength(l);break;case 1:e=new ds(-r/2,r/2,o/2,-o/2,n,s);break;default:e=new ki}}return e}createLight(t){let e,i;if(t.children.forEach((function(t){const e=hv.Objects.NodeAttribute[t.ID];void 0!==e&&(i=e)})),void 0===i)e=new ki;else{let t;t=void 0===i.LightType?0:i.LightType.value;let n=16777215;void 0!==i.Color&&(n=(new Yi).fromArray(i.Color.value).convertSRGBToLinear());let s=void 0===i.Intensity?1:i.Intensity.value/100;void 0!==i.CastLightOnObject&&0===i.CastLightOnObject.value&&(s=0);let r=0;void 0!==i.FarAttenuationEnd&&(r=void 0!==i.EnableFarAttenuation&&0===i.EnableFarAttenuation.value?0:i.FarAttenuationEnd.value);const o=1;switch(t){case 0:e=new yl(n,s,r,o);break;case 1:e=new _l(n,s);break;case 2:let t=Math.PI/3;void 0!==i.InnerAngle&&(t=ie.degToRad(i.InnerAngle.value));let a=0;void 0!==i.OuterAngle&&(a=ie.degToRad(i.OuterAngle.value),a=Math.max(a,1)),e=new pl(n,s,r,t,a,o);break;default:e=new yl(n,s)}void 0!==i.CastShadows&&1===i.CastShadows.value&&(e.castShadow=!0)}return e}createMesh(t,e,i){let n,s=null,r=null;const o=[];return t.children.forEach((function(t){e.has(t.ID)&&(s=e.get(t.ID)),i.has(t.ID)&&o.push(i.get(t.ID))})),o.length>1?r=o:o.length>0?r=o[0]:(r=new Ih({name:tl.DEFAULT_MATERIAL_NAME,color:13421772}),o.push(r)),"color"in s.attributes&&o.forEach((function(t){t.vertexColors=!0})),s.FBX_Deformer?(n=new pa(s,r),n.normalizeSkinWeights()):n=new kn(s,r),n}createCurve(t,e){const i=t.children.reduce((function(t,i){return e.has(i.ID)&&(t=e.get(i.ID)),t}),null),n=new Ca({name:tl.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new La(i,n)}getTransformData(t,e){const i={};"InheritType"in e&&(i.inheritType=parseInt(e.InheritType.value)),i.eulerOrder="RotationOrder"in e?Ev(e.RotationOrder.value):"ZYX","Lcl_Translation"in e&&(i.translation=e.Lcl_Translation.value),"PreRotation"in e&&(i.preRotation=e.PreRotation.value),"Lcl_Rotation"in e&&(i.rotation=e.Lcl_Rotation.value),"PostRotation"in e&&(i.postRotation=e.PostRotation.value),"Lcl_Scaling"in e&&(i.scale=e.Lcl_Scaling.value),"ScalingOffset"in e&&(i.scalingOffset=e.ScalingOffset.value),"ScalingPivot"in e&&(i.scalingPivot=e.ScalingPivot.value),"RotationOffset"in e&&(i.rotationOffset=e.RotationOffset.value),"RotationPivot"in e&&(i.rotationPivot=e.RotationPivot.value),t.userData.transformData=i}setLookAtProperties(t,e){if("LookAtProperty"in e){lv.get(t.ID).children.forEach((function(e){if("LookAtProperty"===e.relationship){const i=hv.Objects.Model[e.ID];if("Lcl_Translation"in i){const e=i.Lcl_Translation.value;void 0!==t.target?(t.target.position.fromArray(e),cv.add(t.target)):t.lookAt((new Pe).fromArray(e))}}}))}}bindSkeleton(t,e,i){const n=this.parsePoseNodes();for(const s in t){const r=t[s];lv.get(parseInt(r.ID)).parents.forEach((function(t){if(e.has(t.ID)){const e=t.ID;lv.get(e).parents.forEach((function(t){if(i.has(t.ID)){i.get(t.ID).bind(new ya(r.bones),n[t.ID])}}))}}))}}parsePoseNodes(){const t={};if("Pose"in hv.Objects){const e=hv.Objects.Pose;for(const i in e)if("BindPose"===e[i].attrType&&e[i].NbPoseNodes>0){const n=e[i].PoseNode;Array.isArray(n)?n.forEach((function(e){t[e.Node]=(new ai).fromArray(e.Matrix.a)})):t[n.Node]=(new ai).fromArray(n.Matrix.a)}}return t}addGlobalSceneSettings(){if("GlobalSettings"in hv){if("AmbientColor"in hv.GlobalSettings){const t=hv.GlobalSettings.AmbientColor.value,e=t[0],i=t[1],n=t[2];if(0!==e||0!==i||0!==n){const t=new Yi(e,i,n).convertSRGBToLinear();cv.add(new bl(t,1))}}"UnitScaleFactor"in hv.GlobalSettings&&(cv.userData.unitScaleFactor=hv.GlobalSettings.UnitScaleFactor.value)}}}class pv{constructor(){this.negativeMaterialIndices=!1}parse(t){const e=new Map;if("Geometry"in hv.Objects){const i=hv.Objects.Geometry;for(const n in i){const s=lv.get(parseInt(n)),r=this.parseGeometry(s,i[n],t);e.set(parseInt(n),r)}}return this.negativeMaterialIndices,e}parseGeometry(t,e,i){switch(e.attrType){case"Mesh":return this.parseMeshGeometry(t,e,i);case"NurbsCurve":return this.parseNurbsGeometry(e)}}parseMeshGeometry(t,e,i){const n=i.skeletons,s=[],r=t.parents.map((function(t){return hv.Objects.Model[t.ID]}));if(0===r.length)return;const o=t.children.reduce((function(t,e){return void 0!==n[e.ID]&&(t=n[e.ID]),t}),null);t.children.forEach((function(t){void 0!==i.morphTargets[t.ID]&&s.push(i.morphTargets[t.ID])}));const a=r[0],h={};"RotationOrder"in a&&(h.eulerOrder=Ev(a.RotationOrder.value)),"InheritType"in a&&(h.inheritType=parseInt(a.InheritType.value)),"GeometricTranslation"in a&&(h.translation=a.GeometricTranslation.value),"GeometricRotation"in a&&(h.rotation=a.GeometricRotation.value),"GeometricScaling"in a&&(h.scale=a.GeometricScaling.value);const l=Tv(h);return this.genGeometry(e,o,s,l)}genGeometry(t,e,i,n){const s=new mn;t.attrName&&(s.name=t.attrName);const r=this.parseGeoNode(t,e),o=this.genBuffers(r),a=new on(o.vertex,3);if(a.applyMatrix4(n),s.setAttribute("position",a),o.colors.length>0&&s.setAttribute("color",new on(o.colors,3)),e&&(s.setAttribute("skinIndex",new sn(o.weightsIndices,4)),s.setAttribute("skinWeight",new on(o.vertexWeights,4)),s.FBX_Deformer=e),o.normal.length>0){const t=(new se).getNormalMatrix(n),e=new on(o.normal,3);e.applyNormalMatrix(t),s.setAttribute("normal",e)}if(o.uvs.forEach((function(t,e){const i=0===e?"uv":`uv${e}`;s.setAttribute(i,new on(o.uvs[e],2))})),r.material&&"AllSame"!==r.material.mappingType){let t=o.materialIndex[0],e=0;if(o.materialIndex.forEach((function(i,n){i!==t&&(s.addGroup(e,n-e,t),t=i,e=n)})),s.groups.length>0){const e=s.groups[s.groups.length-1],i=e.start+e.count;i!==o.materialIndex.length&&s.addGroup(i,o.materialIndex.length-i,t)}0===s.groups.length&&s.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(s,t,i,n),s}parseGeoNode(t,e){const i={};if(i.vertexPositions=void 0!==t.Vertices?t.Vertices.a:[],i.vertexIndices=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],t.LayerElementColor&&(i.color=this.parseVertexColors(t.LayerElementColor[0])),t.LayerElementMaterial&&(i.material=this.parseMaterialIndices(t.LayerElementMaterial[0])),t.LayerElementNormal&&(i.normal=this.parseNormals(t.LayerElementNormal[0])),t.LayerElementUV){i.uv=[];let e=0;for(;t.LayerElementUV[e];)t.LayerElementUV[e].UV&&i.uv.push(this.parseUVs(t.LayerElementUV[e])),e++}return i.weightTable={},null!==e&&(i.skeleton=e,e.rawBones.forEach((function(t,e){t.indices.forEach((function(n,s){void 0===i.weightTable[n]&&(i.weightTable[n]=[]),i.weightTable[n].push({id:e,weight:t.weights[s]})}))}))),i}genBuffers(t){const e={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let i=0,n=0,s=!1,r=[],o=[],a=[],h=[],l=[],c=[];const u=this;return t.vertexIndices.forEach((function(d,p){let m,f=!1;d<0&&(d^=-1,f=!0);let g=[],v=[];if(r.push(3*d,3*d+1,3*d+2),t.color){const e=wv(p,i,d,t.color);a.push(e[0],e[1],e[2])}if(t.skeleton){if(void 0!==t.weightTable[d]&&t.weightTable[d].forEach((function(t){v.push(t.weight),g.push(t.id)})),v.length>4){s||(s=!0);const t=[0,0,0,0],e=[0,0,0,0];v.forEach((function(i,n){let s=i,r=g[n];e.forEach((function(e,i,n){if(s>e){n[i]=s,s=e;const o=t[i];t[i]=r,r=o}}))})),g=t,v=e}for(;v.length<4;)v.push(0),g.push(0);for(let t=0;t<4;++t)l.push(v[t]),c.push(g[t])}if(t.normal){const e=wv(p,i,d,t.normal);o.push(e[0],e[1],e[2])}t.material&&"AllSame"!==t.material.mappingType&&(m=wv(p,i,d,t.material)[0],m<0&&(u.negativeMaterialIndices=!0,m=0)),t.uv&&t.uv.forEach((function(t,e){const n=wv(p,i,d,t);void 0===h[e]&&(h[e]=[]),h[e].push(n[0]),h[e].push(n[1])})),n++,f&&(u.genFace(e,t,r,m,o,a,h,l,c,n),i++,n=0,r=[],o=[],a=[],h=[],l=[],c=[])})),e}getNormalNewell(t){const e=new Pe(0,0,0);for(let i=0;i<t.length;i++){const n=t[i],s=t[(i+1)%t.length];e.x+=(n.y-s.y)*(n.z+s.z),e.y+=(n.z-s.z)*(n.x+s.x),e.z+=(n.x-s.x)*(n.y+s.y)}return e.normalize(),e}getNormalTangentAndBitangent(t){const e=this.getNormalNewell(t),i=(Math.abs(e.z)>.5?new Pe(0,1,0):new Pe(0,0,1)).cross(e).normalize(),n=e.clone().cross(i).normalize();return{normal:e,tangent:i,bitangent:n}}flattenVertex(t,e,i){return new ne(t.dot(e),t.dot(i))}genFace(t,e,i,n,s,r,o,a,h,l){let c;if(l>3){const t=[];for(let n=0;n<i.length;n+=3)t.push(new Pe(e.vertexPositions[i[n]],e.vertexPositions[i[n+1]],e.vertexPositions[i[n+2]]));const{tangent:n,bitangent:s}=this.getNormalTangentAndBitangent(t),r=[];for(const e of t)r.push(this.flattenVertex(e,n,s));c=wh.triangulateShape(r,[])}else c=[[0,1,2]];for(const[l,u,d]of c)t.vertex.push(e.vertexPositions[i[3*l]]),t.vertex.push(e.vertexPositions[i[3*l+1]]),t.vertex.push(e.vertexPositions[i[3*l+2]]),t.vertex.push(e.vertexPositions[i[3*u]]),t.vertex.push(e.vertexPositions[i[3*u+1]]),t.vertex.push(e.vertexPositions[i[3*u+2]]),t.vertex.push(e.vertexPositions[i[3*d]]),t.vertex.push(e.vertexPositions[i[3*d+1]]),t.vertex.push(e.vertexPositions[i[3*d+2]]),e.skeleton&&(t.vertexWeights.push(a[4*l]),t.vertexWeights.push(a[4*l+1]),t.vertexWeights.push(a[4*l+2]),t.vertexWeights.push(a[4*l+3]),t.vertexWeights.push(a[4*u]),t.vertexWeights.push(a[4*u+1]),t.vertexWeights.push(a[4*u+2]),t.vertexWeights.push(a[4*u+3]),t.vertexWeights.push(a[4*d]),t.vertexWeights.push(a[4*d+1]),t.vertexWeights.push(a[4*d+2]),t.vertexWeights.push(a[4*d+3]),t.weightsIndices.push(h[4*l]),t.weightsIndices.push(h[4*l+1]),t.weightsIndices.push(h[4*l+2]),t.weightsIndices.push(h[4*l+3]),t.weightsIndices.push(h[4*u]),t.weightsIndices.push(h[4*u+1]),t.weightsIndices.push(h[4*u+2]),t.weightsIndices.push(h[4*u+3]),t.weightsIndices.push(h[4*d]),t.weightsIndices.push(h[4*d+1]),t.weightsIndices.push(h[4*d+2]),t.weightsIndices.push(h[4*d+3])),e.color&&(t.colors.push(r[3*l]),t.colors.push(r[3*l+1]),t.colors.push(r[3*l+2]),t.colors.push(r[3*u]),t.colors.push(r[3*u+1]),t.colors.push(r[3*u+2]),t.colors.push(r[3*d]),t.colors.push(r[3*d+1]),t.colors.push(r[3*d+2])),e.material&&"AllSame"!==e.material.mappingType&&(t.materialIndex.push(n),t.materialIndex.push(n),t.materialIndex.push(n)),e.normal&&(t.normal.push(s[3*l]),t.normal.push(s[3*l+1]),t.normal.push(s[3*l+2]),t.normal.push(s[3*u]),t.normal.push(s[3*u+1]),t.normal.push(s[3*u+2]),t.normal.push(s[3*d]),t.normal.push(s[3*d+1]),t.normal.push(s[3*d+2])),e.uv&&e.uv.forEach((function(e,i){void 0===t.uvs[i]&&(t.uvs[i]=[]),t.uvs[i].push(o[i][2*l]),t.uvs[i].push(o[i][2*l+1]),t.uvs[i].push(o[i][2*u]),t.uvs[i].push(o[i][2*u+1]),t.uvs[i].push(o[i][2*d]),t.uvs[i].push(o[i][2*d+1])}))}addMorphTargets(t,e,i,n){if(0===i.length)return;t.morphTargetsRelative=!0,t.morphAttributes.position=[];const s=this;i.forEach((function(i){i.rawTargets.forEach((function(i){const r=hv.Objects.Geometry[i.geoID];void 0!==r&&s.genMorphGeometry(t,e,r,n,i.name)}))}))}genMorphGeometry(t,e,i,n,s){const r=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],o=void 0!==i.Vertices?i.Vertices.a:[],a=void 0!==i.Indexes?i.Indexes.a:[],h=3*t.attributes.position.count,l=new Float32Array(h);for(let t=0;t<a.length;t++){const e=3*a[t];l[e]=o[3*t],l[e+1]=o[3*t+1],l[e+2]=o[3*t+2]}const c={vertexIndices:r,vertexPositions:l},u=this.genBuffers(c),d=new on(u.vertex,3);d.name=s||i.attrName,d.applyMatrix4(n),t.morphAttributes.position.push(d)}parseNormals(t){const e=t.MappingInformationType,i=t.ReferenceInformationType,n=t.Normals.a;let s=[];return"IndexToDirect"===i&&("NormalIndex"in t?s=t.NormalIndex.a:"NormalsIndex"in t&&(s=t.NormalsIndex.a)),{dataSize:3,buffer:n,indices:s,mappingType:e,referenceType:i}}parseUVs(t){const e=t.MappingInformationType,i=t.ReferenceInformationType,n=t.UV.a;let s=[];return"IndexToDirect"===i&&(s=t.UVIndex.a),{dataSize:2,buffer:n,indices:s,mappingType:e,referenceType:i}}parseVertexColors(t){const e=t.MappingInformationType,i=t.ReferenceInformationType,n=t.Colors.a;let s=[];"IndexToDirect"===i&&(s=t.ColorIndex.a);for(let t=0,e=new Yi;t<n.length;t+=4)e.fromArray(n,t).convertSRGBToLinear().toArray(n,t);return{dataSize:4,buffer:n,indices:s,mappingType:e,referenceType:i}}parseMaterialIndices(t){const e=t.MappingInformationType,i=t.ReferenceInformationType;if("NoMappingInformation"===e)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:i};const n=t.Materials.a,s=[];for(let t=0;t<n.length;++t)s.push(t);return{dataSize:1,buffer:n,indices:s,mappingType:e,referenceType:i}}parseNurbsGeometry(t){const e=parseInt(t.Order);if(isNaN(e))return new mn;const i=e-1,n=t.KnotVector.a,s=[],r=t.Points.a;for(let t=0,e=r.length;t<e;t+=4)s.push((new Te).fromArray(r,t));let o,a;if("Closed"===t.Form)s.push(s[0]);else if("Periodic"===t.Form){o=i,a=n.length-1-o;for(let t=0;t<i;++t)s.push(s[t])}const h=new av(i,n,s,o,a).getPoints(12*s.length);return(new mn).setFromPoints(h)}}class mv{parse(){const t=[],e=this.parseClips();if(void 0!==e)for(const i in e){const n=e[i],s=this.addClip(n);t.push(s)}return t}parseClips(){if(void 0===hv.Objects.AnimationCurve)return;const t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);const e=this.parseAnimationLayers(t);return this.parseAnimStacks(e)}parseAnimationCurveNodes(){const t=hv.Objects.AnimationCurveNode,e=new Map;for(const i in t){const n=t[i];if(null!==n.attrName.match(/S|R|T|DeformPercent/)){const t={id:n.id,attr:n.attrName,curves:{}};e.set(t.id,t)}}return e}parseAnimationCurves(t){const e=hv.Objects.AnimationCurve;for(const i in e){const n={id:e[i].id,times:e[i].KeyTime.a.map(_v),values:e[i].KeyValueFloat.a},s=lv.get(n.id);if(void 0!==s){const e=s.parents[0].ID,i=s.parents[0].relationship;i.match(/X/)?t.get(e).curves.x=n:i.match(/Y/)?t.get(e).curves.y=n:i.match(/Z/)?t.get(e).curves.z=n:i.match(/DeformPercent/)&&t.has(e)&&(t.get(e).curves.morph=n)}}}parseAnimationLayers(t){const e=hv.Objects.AnimationLayer,i=new Map;for(const n in e){const e=[],s=lv.get(parseInt(n));if(void 0!==s){s.children.forEach((function(i,n){if(t.has(i.ID)){const s=t.get(i.ID);if(void 0!==s.curves.x||void 0!==s.curves.y||void 0!==s.curves.z){if(void 0===e[n]){const t=lv.get(i.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID;if(void 0!==t){const i=hv.Objects.Model[t.toString()];if(void 0===i)return;const s={modelName:i.attrName?Dl.sanitizeNodeName(i.attrName):"",ID:i.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};cv.traverse((function(t){t.ID===i.id&&(s.transform=t.matrix,t.userData.transformData&&(s.eulerOrder=t.userData.transformData.eulerOrder))})),s.transform||(s.transform=new ai),"PreRotation"in i&&(s.preRotation=i.PreRotation.value),"PostRotation"in i&&(s.postRotation=i.PostRotation.value),e[n]=s}}e[n]&&(e[n][s.attr]=s)}else if(void 0!==s.curves.morph){if(void 0===e[n]){const t=lv.get(i.ID).parents.filter((function(t){return void 0!==t.relationship}))[0].ID,s=lv.get(t).parents[0].ID,r=lv.get(s).parents[0].ID,o=lv.get(r).parents[0].ID,a=hv.Objects.Model[o],h={modelName:a.attrName?Dl.sanitizeNodeName(a.attrName):"",morphName:hv.Objects.Deformer[t].attrName};e[n]=h}e[n][s.attr]=s}}})),i.set(parseInt(n),e)}}return i}parseAnimStacks(t){const e=hv.Objects.AnimationStack,i={};for(const n in e){const s=lv.get(parseInt(n)).children;s.length;const r=t.get(s[0].ID);i[n]={name:e[n].attrName,layer:r}}return i}addClip(t){let e=[];const i=this;return t.layer.forEach((function(t){e=e.concat(i.generateTracks(t))})),new Yh(t.name,-1,e)}generateTracks(t){const e=[];let i=new Pe,n=new Pe;if(t.transform&&t.transform.decompose(i,new Re,n),i=i.toArray(),n=n.toArray(),void 0!==t.T&&Object.keys(t.T.curves).length>0){const n=this.generateVectorTrack(t.modelName,t.T.curves,i,"position");void 0!==n&&e.push(n)}if(void 0!==t.R&&Object.keys(t.R.curves).length>0){const i=this.generateRotationTrack(t.modelName,t.R.curves,t.preRotation,t.postRotation,t.eulerOrder);void 0!==i&&e.push(i)}if(void 0!==t.S&&Object.keys(t.S.curves).length>0){const i=this.generateVectorTrack(t.modelName,t.S.curves,n,"scale");void 0!==i&&e.push(i)}if(void 0!==t.DeformPercent){const i=this.generateMorphTrack(t);void 0!==i&&e.push(i)}return e}generateVectorTrack(t,e,i,n){const s=this.getTimesForAllAxes(e),r=this.getKeyframeTrackValues(s,e,i);return new qh(t+"."+n,s,r)}generateRotationTrack(t,e,i,n,s){let r,o;if(void 0!==e.x&&void 0!==e.y&&void 0!==e.z){const t=this.interpolateRotations(e.x,e.y,e.z,s);r=t[0],o=t[1]}void 0!==i&&((i=i.map(ie.degToRad)).push(s),i=(new vi).fromArray(i),i=(new Re).setFromEuler(i)),void 0!==n&&((n=n.map(ie.degToRad)).push(s),n=(new vi).fromArray(n),n=(new Re).setFromEuler(n).invert());const a=new Re,h=new vi,l=[];if(!o||!r)return new Xh(t+".quaternion",[],[]);for(let t=0;t<o.length;t+=3){if(h.set(o[t],o[t+1],o[t+2],s),a.setFromEuler(h),void 0!==i&&a.premultiply(i),void 0!==n&&a.multiply(n),t>2){(new Re).fromArray(l,(t-3)/3*4).dot(a)<0&&a.set(-a.x,-a.y,-a.z,-a.w)}a.toArray(l,t/3*4)}return new Xh(t+".quaternion",r,l)}generateMorphTrack(t){const e=t.DeformPercent.curves.morph,i=e.values.map((function(t){return t/100})),n=cv.getObjectByName(t.modelName).morphTargetDictionary[t.morphName];return new jh(t.modelName+".morphTargetInfluences["+n+"]",e.times,i)}getTimesForAllAxes(t){let e=[];if(void 0!==t.x&&(e=e.concat(t.x.times)),void 0!==t.y&&(e=e.concat(t.y.times)),void 0!==t.z&&(e=e.concat(t.z.times)),e=e.sort((function(t,e){return t-e})),e.length>1){let t=1,i=e[0];for(let n=1;n<e.length;n++){const s=e[n];s!==i&&(e[t]=s,i=s,t++)}e=e.slice(0,t)}return e}getKeyframeTrackValues(t,e,i){const n=i,s=[];let r=-1,o=-1,a=-1;return t.forEach((function(t){if(e.x&&(r=e.x.times.indexOf(t)),e.y&&(o=e.y.times.indexOf(t)),e.z&&(a=e.z.times.indexOf(t)),-1!==r){const t=e.x.values[r];s.push(t),n[0]=t}else s.push(n[0]);if(-1!==o){const t=e.y.values[o];s.push(t),n[1]=t}else s.push(n[1]);if(-1!==a){const t=e.z.values[a];s.push(t),n[2]=t}else s.push(n[2])})),s}interpolateRotations(t,e,i,n){const s=[],r=[];s.push(t.times[0]),r.push(ie.degToRad(t.values[0])),r.push(ie.degToRad(e.values[0])),r.push(ie.degToRad(i.values[0]));for(let o=1;o<t.values.length;o++){const a=[t.values[o-1],e.values[o-1],i.values[o-1]];if(isNaN(a[0])||isNaN(a[1])||isNaN(a[2]))continue;const h=a.map(ie.degToRad),l=[t.values[o],e.values[o],i.values[o]];if(isNaN(l[0])||isNaN(l[1])||isNaN(l[2]))continue;const c=l.map(ie.degToRad),u=[l[0]-a[0],l[1]-a[1],l[2]-a[2]],d=[Math.abs(u[0]),Math.abs(u[1]),Math.abs(u[2])];if(d[0]>=180||d[1]>=180||d[2]>=180){const e=Math.max(...d)/180,i=new vi(...h,n),a=new vi(...c,n),l=(new Re).setFromEuler(i),u=(new Re).setFromEuler(a);l.dot(u)&&u.set(-u.x,-u.y,-u.z,-u.w);const p=t.times[o-1],m=t.times[o]-p,f=new Re,g=new vi;for(let t=0;t<1;t+=1/e)f.copy(l.clone().slerp(u.clone(),t)),s.push(p+t*m),g.setFromQuaternion(f,n),r.push(g.x),r.push(g.y),r.push(g.z)}else s.push(t.times[o]),r.push(ie.degToRad(t.values[o])),r.push(ie.degToRad(e.values[o])),r.push(ie.degToRad(i.values[o]))}return[s,r]}}class fv{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(t){this.nodeStack.push(t),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(t,e){this.currentProp=t,this.currentPropName=e}parse(t){this.currentIndent=0,this.allNodes=new yv,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const e=this,i=t.split(/[\r\n]+/);return i.forEach((function(t,n){const s=t.match(/^[\s\t]*;/),r=t.match(/^[\s\t]*$/);if(s||r)return;const o=t.match("^\\t{"+e.currentIndent+"}(\\w+):(.*){",""),a=t.match("^\\t{"+e.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),h=t.match("^\\t{"+(e.currentIndent-1)+"}}");o?e.parseNodeBegin(t,o):a?e.parseNodeProperty(t,a,i[++n]):h?e.popStack():t.match(/^[^\s\t}]/)&&e.parseNodePropertyContinued(t)})),this.allNodes}parseNodeBegin(t,e){const i=e[1].trim().replace(/^"/,"").replace(/"$/,""),n=e[2].split(",").map((function(t){return t.trim().replace(/^"/,"").replace(/"$/,"")})),s={name:i},r=this.parseNodeAttr(n),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(i,s):i in o?("PoseNode"===i?o.PoseNode.push(s):void 0!==o[i].id&&(o[i]={},o[i][o[i].id]=o[i]),""!==r.id&&(o[i][r.id]=s)):"number"==typeof r.id?(o[i]={},o[i][r.id]=s):"Properties70"!==i&&(o[i]="PoseNode"===i?[s]:s),"number"==typeof r.id&&(s.id=r.id),""!==r.name&&(s.attrName=r.name),""!==r.type&&(s.attrType=r.type),this.pushStack(s)}parseNodeAttr(t){let e=t[0];""!==t[0]&&(e=parseInt(t[0]),isNaN(e)&&(e=t[0]));let i="",n="";return t.length>1&&(i=t[1].replace(/^(\w+)::/,""),n=t[2]),{id:e,name:i,type:n}}parseNodeProperty(t,e,i){let n=e[1].replace(/^"/,"").replace(/"$/,"").trim(),s=e[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===s&&(s=i.replace(/"/g,"").replace(/,$/,"").trim());const r=this.getCurrentNode();if("Properties70"!==r.name){if("C"===n){const t=s.split(",").slice(1),e=parseInt(t[0]),i=parseInt(t[1]);let o=s.split(",").slice(3);o=o.map((function(t){return t.trim().replace(/^"/,"")})),n="connections",s=[e,i],function(t,e){for(let i=0,n=t.length,s=e.length;i<s;i++,n++)t[n]=e[i]}(s,o),void 0===r[n]&&(r[n]=[])}"Node"===n&&(r.id=s),n in r&&Array.isArray(r[n])?r[n].push(s):"a"!==n?r[n]=s:r.a=s,this.setCurrentProp(r,n),"a"===n&&","!==s.slice(-1)&&(r.a=Av(s))}else this.parseNodeSpecialProperty(t,n,s)}parseNodePropertyContinued(t){const e=this.getCurrentNode();e.a+=t,","!==t.slice(-1)&&(e.a=Av(e.a))}parseNodeSpecialProperty(t,e,i){const n=i.split('",').map((function(t){return t.trim().replace(/^\"/,"").replace(/\s/,"_")})),s=n[0],r=n[1],o=n[2],a=n[3];let h=n[4];switch(r){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":h=parseFloat(h);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":h=Av(h)}this.getPrevNode()[s]={type:r,type2:o,flag:a,value:h},this.setCurrentProp(this.getPrevNode(),s)}}class gv{parse(t){const e=new vv(t);e.skip(23);const i=e.getUint32();if(i<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+i);const n=new yv;for(;!this.endOfContent(e);){const t=this.parseNode(e,i);null!==t&&n.add(t.name,t)}return n}endOfContent(t){return t.size()%16==0?(t.getOffset()+160+16&-16)>=t.size():t.getOffset()+160+16>=t.size()}parseNode(t,e){const i={},n=e>=7500?t.getUint64():t.getUint32(),s=e>=7500?t.getUint64():t.getUint32();e>=7500?t.getUint64():t.getUint32();const r=t.getUint8(),o=t.getString(r);if(0===n)return null;const a=[];for(let e=0;e<s;e++)a.push(this.parseProperty(t));const h=a.length>0?a[0]:"",l=a.length>1?a[1]:"",c=a.length>2?a[2]:"";for(i.singleProperty=1===s&&t.getOffset()===n;n>t.getOffset();){const n=this.parseNode(t,e);null!==n&&this.parseSubNode(o,i,n)}return i.propertyList=a,"number"==typeof h&&(i.id=h),""!==l&&(i.attrName=l),""!==c&&(i.attrType=c),""!==o&&(i.name=o),i}parseSubNode(t,e,i){if(!0===i.singleProperty){const t=i.propertyList[0];Array.isArray(t)?(e[i.name]=i,i.a=t):e[i.name]=t}else if("Connections"===t&&"C"===i.name){const t=[];i.propertyList.forEach((function(e,i){0!==i&&t.push(e)})),void 0===e.connections&&(e.connections=[]),e.connections.push(t)}else if("Properties70"===i.name){Object.keys(i).forEach((function(t){e[t]=i[t]}))}else if("Properties70"===t&&"P"===i.name){let t=i.propertyList[0],n=i.propertyList[1];const s=i.propertyList[2],r=i.propertyList[3];let o;0===t.indexOf("Lcl ")&&(t=t.replace("Lcl ","Lcl_")),0===n.indexOf("Lcl ")&&(n=n.replace("Lcl ","Lcl_")),o="Color"===n||"ColorRGB"===n||"Vector"===n||"Vector3D"===n||0===n.indexOf("Lcl_")?[i.propertyList[4],i.propertyList[5],i.propertyList[6]]:i.propertyList[4],e[t]={type:n,type2:s,flag:r,value:o}}else void 0===e[i.name]?"number"==typeof i.id?(e[i.name]={},e[i.name][i.id]=i):e[i.name]=i:"PoseNode"===i.name?(Array.isArray(e[i.name])||(e[i.name]=[e[i.name]]),e[i.name].push(i)):void 0===e[i.name][i.id]&&(e[i.name][i.id]=i)}parseProperty(t){const e=t.getString(1);let i;switch(e){case"C":return t.getBoolean();case"D":return t.getFloat64();case"F":return t.getFloat32();case"I":return t.getInt32();case"L":return t.getInt64();case"R":return i=t.getUint32(),t.getArrayBuffer(i);case"S":return i=t.getUint32(),t.getString(i);case"Y":return t.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const n=t.getUint32(),s=t.getUint32(),r=t.getUint32();if(0===s)switch(e){case"b":case"c":return t.getBooleanArray(n);case"d":return t.getFloat64Array(n);case"f":return t.getFloat32Array(n);case"i":return t.getInt32Array(n);case"l":return t.getInt64Array(n)}const o=ev(new Uint8Array(t.getArrayBuffer(r))),a=new vv(o.buffer);switch(e){case"b":case"c":return a.getBooleanArray(n);case"d":return a.getFloat64Array(n);case"f":return a.getFloat32Array(n);case"i":return a.getInt32Array(n);case"l":return a.getInt64Array(n)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+e)}}}class vv{constructor(t,e){this.dv=new DataView(t),this.offset=0,this.littleEndian=void 0===e||e,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(t){this.offset+=t}getBoolean(){return 1==(1&this.getUint8())}getBooleanArray(t){const e=[];for(let i=0;i<t;i++)e.push(this.getBoolean());return e}getUint8(){const t=this.dv.getUint8(this.offset);return this.offset+=1,t}getInt16(){const t=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}getInt32(){const t=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}getInt32Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getInt32());return e}getUint32(){const t=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}getInt64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),2147483648&e?(e=4294967295&~e,t=4294967295&~t,4294967295===t&&(e=e+1&4294967295),t=t+1&4294967295,-(4294967296*e+t)):4294967296*e+t}getInt64Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getInt64());return e}getUint64(){let t,e;return this.littleEndian?(t=this.getUint32(),e=this.getUint32()):(e=this.getUint32(),t=this.getUint32()),4294967296*e+t}getFloat32(){const t=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}getFloat32Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getFloat32());return e}getFloat64(){const t=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}getFloat64Array(t){const e=[];for(let i=0;i<t;i++)e.push(this.getFloat64());return e}getArrayBuffer(t){const e=this.dv.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}getString(t){const e=this.offset;let i=new Uint8Array(this.dv.buffer,e,t);this.skip(t);const n=i.indexOf(0);return n>=0&&(i=new Uint8Array(this.dv.buffer,e,n)),this._textDecoder.decode(i)}}class yv{add(t,e){this[t]=e}}function xv(t){const e=t.match(/FBXVersion: (\d+)/);if(e){return parseInt(e[1])}throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function _v(t){return t/46186158e3}const bv=[];function wv(t,e,i,n){let s;switch(n.mappingType){case"ByPolygonVertex":s=t;break;case"ByPolygon":s=e;break;case"ByVertice":s=i;break;case"AllSame":s=n.indices[0]}"IndexToDirect"===n.referenceType&&(s=n.indices[s]);const r=s*n.dataSize,o=r+n.dataSize;return function(t,e,i,n){for(let s=i,r=0;s<n;s++,r++)t[r]=e[s];return t}(bv,n.buffer,r,o)}const Mv=new vi,Sv=new Pe;function Tv(t){const e=new ai,i=new ai,n=new ai,s=new ai,r=new ai,o=new ai,a=new ai,h=new ai,l=new ai,c=new ai,u=new ai,d=new ai,p=t.inheritType?t.inheritType:0;if(t.translation&&e.setPosition(Sv.fromArray(t.translation)),t.preRotation){const e=t.preRotation.map(ie.degToRad);e.push(t.eulerOrder||vi.DEFAULT_ORDER),i.makeRotationFromEuler(Mv.fromArray(e))}if(t.rotation){const e=t.rotation.map(ie.degToRad);e.push(t.eulerOrder||vi.DEFAULT_ORDER),n.makeRotationFromEuler(Mv.fromArray(e))}if(t.postRotation){const e=t.postRotation.map(ie.degToRad);e.push(t.eulerOrder||vi.DEFAULT_ORDER),s.makeRotationFromEuler(Mv.fromArray(e)),s.invert()}t.scale&&r.scale(Sv.fromArray(t.scale)),t.scalingOffset&&a.setPosition(Sv.fromArray(t.scalingOffset)),t.scalingPivot&&o.setPosition(Sv.fromArray(t.scalingPivot)),t.rotationOffset&&h.setPosition(Sv.fromArray(t.rotationOffset)),t.rotationPivot&&l.setPosition(Sv.fromArray(t.rotationPivot)),t.parentMatrixWorld&&(u.copy(t.parentMatrix),c.copy(t.parentMatrixWorld));const m=i.clone().multiply(n).multiply(s),f=new ai;f.extractRotation(c);const g=new ai;g.copyPosition(c);const v=g.clone().invert().multiply(c),y=f.clone().invert().multiply(v),x=r,_=new ai;if(0===p)_.copy(f).multiply(m).multiply(y).multiply(x);else if(1===p)_.copy(f).multiply(y).multiply(m).multiply(x);else{const t=(new ai).scale((new Pe).setFromMatrixScale(u)).clone().invert(),e=y.clone().multiply(t);_.copy(f).multiply(m).multiply(e).multiply(x)}const b=l.clone().invert(),w=o.clone().invert();let M=e.clone().multiply(h).multiply(l).multiply(i).multiply(n).multiply(s).multiply(b).multiply(a).multiply(o).multiply(r).multiply(w);const S=(new ai).copyPosition(M),T=c.clone().multiply(S);return d.copyPosition(T),M=d.clone().multiply(_),M.premultiply(c.invert()),M}function Ev(t){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(t=t||0)?e[0]:e[t]}function Av(t){return t.split(",").map((function(t){return parseFloat(t)}))}function Cv(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=t.byteLength),(new TextDecoder).decode(new Uint8Array(t,e,i))}class Iv extends tc{get Id(){return Zl.DeadTree}constructor(t){super(t,Jl.Gltf,"assets/custom_island/tree2.glb",(t=>{this.meshs=t.scene,this.meshs.castShadow=!1,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!1,t.receiveShadow=!0}))}))}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size}GetBodyMeshId(){return"mixamorigRightHand"}}var Rv=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class Pv extends tc{get Id(){return Zl.Male}constructor(t){super(t,Jl.Gltf,"assets/male/male.gltf",(t=>Rv(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!1,t.isMesh&&(t.material=new Rh({map:t.material.map}))})),this.meshs.children[0].position.y=0,this.clips.set(Kl.Idle,t.animations[0]),this.clips.set(Kl.Run,t.animations[1]),this.clips.set(Kl.Jump,t.animations[2]),this.clips.set(Kl.Punch,t.animations[3]),this.clips.set(Kl.FightIdle,t.animations[4]),this.clips.set(Kl.Dance0,t.animations[5]),yield this.LoadAnimation("assets/male/Shooting.fbx",Kl.Shooting),yield this.LoadAnimation("assets/male/Standing 1H Magic Attack 01.fbx",Kl.MagicH1),yield this.LoadAnimation("assets/male/Standing 2H Magic Attack 01.fbx",Kl.MagicH2),yield this.LoadAnimation("assets/male/Standing 2H Magic Attack 01_.fbx",Kl.MagicH2),yield this.LoadAnimation("assets/male/Sword And Shield Slash.fbx",Kl.Sword),yield this.LoadAnimation("assets/male/Gunplay.fbx",Kl.Shooting),yield this.LoadAnimation("assets/male/Dying Backwards.fbx",Kl.Dying),yield this.LoadAnimation("assets/male/Bouncing Fight Idle.fbx",Kl.FightIdle),yield this.LoadAnimation("assets/female/PlantAPlant.fbx",Kl.PlantAPlant),yield this.LoadAnimation("assets/female/PickFruit.fbx",Kl.PickFruit),yield this.LoadAnimation("assets/female/PickFruit_tree.fbx",Kl.PickFruitTree),yield this.LoadAnimation("assets/female/StandingMeleeAttackDownward.fbx",Kl.Hammering),yield this.LoadAnimation("assets/female/Watering.fbx",Kl.Wartering)}))))}CreateVectorGui(t,e,i,n){t.add(e,"x",-100,100,n).listen().name(i+"X"),t.add(e,"y",-100,100,n).listen().name(i+"Y"),t.add(e,"z",-100,100,n).listen().name(i+"Z")}GetBodyMeshId(t){switch(t){case Yl.Hands_R:return"mixamorigRightHand";case Yl.Hands_L:return"mixamorigLeftHand"}}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size.y*=4,this.size}}var kv=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class Dv extends tc{get Id(){return Zl.Female}constructor(t){super(t,Jl.Gltf,"assets/female/female2.gltf",(t=>kv(this,void 0,void 0,(function*(){this.Gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!1,t.isMesh&&(t.material=new Rh({map:t.material.map}))})),this.mixer=new Nl(t.scene),this.clips.set(Kl.Idle,t.animations.find((t=>"Idle"==t.name))),this.clips.set(Kl.Run,t.animations.find((t=>"Running"==t.name))),this.clips.set(Kl.Jump,t.animations.find((t=>"JumpingUp"==t.name))),this.clips.set(Kl.Punch,t.animations.find((t=>"PunchCombo"==t.name))),this.clips.set(Kl.FightIdle,t.animations.find((t=>"BouncingFightIdle"==t.name))),this.clips.set(Kl.Dying,t.animations.find((t=>"Dying"==t.name))),this.clips.set(Kl.Sword,t.animations.find((t=>"Sword"==t.name))),this.clips.set(Kl.Shooting,t.animations.find((t=>"Gunplay"==t.name))),this.clips.set(Kl.MagicH1,t.animations.find((t=>"1HMagic"==t.name))),this.clips.set(Kl.MagicH2,t.animations.find((t=>"2HMagic_1"==t.name))),this.clips.set(Kl.PickFruit,t.animations.find((t=>"PickFruit"==t.name))),this.clips.set(Kl.PickFruitTree,t.animations.find((t=>"PickFruit_tree"==t.name))),this.clips.set(Kl.PlantAPlant,t.animations.find((t=>"PlantAPlant"==t.name))),this.clips.set(Kl.Hammering,t.animations.find((t=>"StandingMeleeAttackDownward"==t.name))),this.clips.set(Kl.Wartering,t.animations.find((t=>"Watering"==t.name))),this.meshs.children[0].children[0].position.y=0}))))}CreateVectorGui(t,e,i,n){t.add(e,"x",-100,100,n).listen().name(i+"X"),t.add(e,"y",-100,100,n).listen().name(i+"Y"),t.add(e,"z",-100,100,n).listen().name(i+"Z")}GetBodyMeshId(t){switch(t){case Yl.Hands_R:return"mixamorigRightHand";case Yl.Hands_L:return"mixamorigLeftHand"}}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size.x/=3,this.size.z/=3,this.size}}class Lv extends tc{get Id(){return this.id}constructor(t,e){super(t,Jl.Gltf,"assets/custom_island/mushroom"+e+".glb",(t=>{this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}))})),this.id=Zl.Mushroom1,this.id=1==e?Zl.Mushroom1:Zl.Mushroom2}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size}GetBodyMeshId(){return"mixamorigRightHand"}}class Ov extends tc{get Id(){return Zl.Tree}constructor(t){super(t,Jl.Gltf,"assets/custom_island/tree.glb",(t=>{this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}))}))}GetBodyMeshId(){return""}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size}GetBoxPos(t){const e=t.position,i=this.GetSize(t);return new Pe(e.x,e.y+i.y/2,e.z)}}class Nv extends tc{get Id(){return Zl.Tree}constructor(t){super(t,Jl.Gltf,"assets/plant/dead_tree.glb",(t=>{this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));const e=.005;this.meshs.scale.set(e,e,e)}))}GetBodyMeshId(){return""}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size}GetBoxPos(t){const e=t.position,i=this.GetSize(t);return new Pe(e.x,e.y+i.y/2,e.z)}}class Bv extends tc{get Id(){return Zl.Portal}constructor(t){super(t,Jl.Gltf,"assets/custom_island/sand_portal.glb",(t=>{this.meshs=t.scene,this.meshs.scale.set(2.5,2.5,2.5),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0})),this.meshs.children[0].position.y+=.8}))}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size}GetBodyMeshId(){return"mixamorigRightHand"}}var zv=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class Uv extends tc{get Id(){return Zl.Female}constructor(t){super(t,Jl.Fbx,"assets/female/female.fbx",(e=>zv(this,void 0,void 0,(function*(){this.meshs=e,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0;const i=new rl;this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0,t instanceof kn&&i.load("assets/female/Image_0.png",(e=>{t.material.map=e,t.material.needsupdate=!0}))})),this.mixer=new Nl(e),yield t.FBXLoader.load("assets/female/Idle.fbx",(t=>{this.clips.set(Kl.Idle,t.animations[0]),this.clips.set(Kl.Run,t.animations[0]),this.clips.set(Kl.Jump,t.animations[0]),this.clips.set(Kl.Punch,t.animations[0]),this.clips.set(Kl.FightIdle,t.animations[0]),this.clips.set(Kl.Dance0,t.animations[0])}))}))))}GetBodyMeshId(t){return""}GetBox(t){return null==this.meshs&&(this.meshs=t),(new Le).setFromObject(this.meshs)}GetSize(t){const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size}}var Fv=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class Gv extends tc{get Id(){return Zl.Zombie}constructor(t){super(t,Jl.Gltf,"assets/monster/zombie.gltf",(t=>Fv(this,void 0,void 0,(function*(){this.Gltf=t,this.meshs=t.scene,this.meshs.name="zombie",this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!1,t.isMesh&&(t.material=new Rh({map:t.material.map}))}));const e=.024;this.meshs.children[0].scale.set(e,e,e),this.meshs.children[0].position.set(0,0,0),this.mixer=new Nl(t.scene),this.clips.set(Kl.Idle,t.animations.find((t=>"ZombieIdle"==t.name))),this.clips.set(Kl.Run,t.animations.find((t=>"Walking"==t.name))),this.clips.set(Kl.Punch,t.animations.find((t=>"ZombieAttack"==t.name))),this.clips.set(Kl.MonBiting,t.animations.find((t=>"ZombieBiting"==t.name))),this.clips.set(Kl.Dying,t.animations.find((t=>"ZombieDying"==t.name))),this.clips.set(Kl.MonScream,t.animations.find((t=>"ZombieScream"==t.name)))}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.set(e.x,e.y,e.z),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y*=1.1,this.size.z=Math.ceil(this.size.z),this.size}}var Hv=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class Vv extends tc{get Id(){return Zl.Male}constructor(t){super(t,Jl.Gltf,"assets/weapon/bat.glb",(t=>Hv(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0;this.meshs.scale.set(.3,.3,.3),this.meshs.position.set(.1,.2,-.1),this.meshs.rotation.set(3,-.5,-1.8)}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size}}var jv=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class Wv extends tc{get Id(){return Zl.Male}constructor(t){super(t,Jl.Gltf,"assets/weapon/gun.glb",(t=>jv(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0;const e=.05;this.meshs.scale.set(e,e,e),this.meshs.position.set(.2,.8,.2),this.meshs.rotation.set(3.5,-.1,-1.6)}))))}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size}GetBodyMeshId(){return"mixamorigRightHand"}}var Xv=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class $v extends tc{get Id(){return Zl.Minataur}constructor(t){super(t,Jl.Gltf,"assets/monster/minataur_low_poly.glb",(t=>Xv(this,void 0,void 0,(function*(){this.Gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));const e=.02;this.meshs.scale.set(e,e,e),this.meshs.children[0].position.z-=70,this.mixer=new Nl(t.scene),this.clips.set(Kl.Idle,t.animations.find((t=>"Armature|idle"==t.name))),this.clips.set(Kl.Run,t.animations.find((t=>"Armature|Walk"==t.name))),this.clips.set(Kl.Punch,t.animations.find((t=>"Armature|Attack"==t.name))),this.clips.set(Kl.MonBiting,t.animations.find((t=>"Armature|Attack Double"==t.name))),this.clips.set(Kl.Dying,t.animations.find((t=>"Armature|Death"==t.name))),this.clips.set(Kl.MonScream,t.animations.find((t=>"Armature|Jump"==t.name)))}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.set(e.x,e.y,e.z),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x)/2,this.size.y=Math.ceil(this.size.y)/2,this.size.z=Math.ceil(this.size.z)/2,this.size}}var qv=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class Yv extends tc{get Id(){return Zl.CrabMon}constructor(t){super(t,Jl.Gltf,"assets/monster/crab_monster_animated.glb",(t=>qv(this,void 0,void 0,(function*(){this.Gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.scale.set(1,1,1),this.mixer=new Nl(t.scene),this.clips.set(Kl.Idle,t.animations.find((t=>"idle"==t.name))),this.clips.set(Kl.Run,t.animations.find((t=>"walk"==t.name))),this.clips.set(Kl.Punch,t.animations.find((t=>"attack"==t.name))),this.clips.set(Kl.Dying,t.animations.find((t=>"death"==t.name))),this.clips.set(Kl.MonHurt,t.animations.find((t=>"hurt"==t.name)))}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.set(e.x,e.y,e.z),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=3.5,this.size.z=Math.ceil(this.size.z),this.size}}class Kv extends tc{get Id(){return this.id}constructor(t){super(t,Jl.Gltf,"assets/rocks/stylized_lowpoly_rock.glb",(t=>{this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}))})),this.id=Zl.Stone}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x-2),this.size.y=Math.ceil(this.size.y-3),this.size.z=Math.ceil(this.size.z-1),this.size}GetBodyMeshId(){return"mixamorigRightHand"}}var Zv=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class Jv extends tc{get Id(){return Zl.WarteringCan}constructor(t){super(t,Jl.Gltf,"assets/stub/watering_can.glb",(t=>Zv(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0;this.meshs.scale.set(35,35,35),this.meshs.position.set(-.1,1.3,-.1),this.meshs.rotation.set(0,5.1,3.1)}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size}}class Qv extends tc{get Id(){return Zl.Hammer}constructor(t){super(t,Jl.Gltf,"assets/weapon/hammer.glb",(t=>Zv(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0;this.meshs.scale.set(1,1,1),this.meshs.position.set(0,0,0),this.meshs.rotation.set(0,0,0)}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),new Ah)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size}}class ty extends tc{get Id(){return this.id}constructor(t){super(t,Jl.Gltf,"assets/furniture/closet.glb",(t=>{this.meshs=new Po,this.meshs.add(t.scene),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.children[0].rotateY(Math.PI),this.meshs.children[0].scale.set(.8-.1,.8-.1,.8)})),this.id=Zl.Closet}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=Math.ceil(this.size.y)-.5,this.size.z=Math.ceil(this.size.z)-1,this.size}GetBodyMeshId(){return"mixamorigRightHand"}}class ey extends tc{get Id(){return this.id}constructor(t){super(t,Jl.Gltf,"assets/furniture/desk.glb",(t=>{this.meshs=new Po,this.meshs.add(t.scene),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.children[0].rotateY(Math.PI),this.meshs.children[0].scale.set(.8,.8,.8)})),this.id=Zl.Desk}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x)-1.5,this.size.y=Math.ceil(this.size.y),this.size.z=Math.ceil(this.size.z),this.size}GetBodyMeshId(){return"mixamorigRightHand"}}class iy extends tc{get Id(){return this.id}constructor(t){super(t,Jl.Gltf,"assets/furniture/bed.glb",(t=>{this.meshs=new Po,this.meshs.add(t.scene),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.children[0].rotateY(Math.PI),this.meshs.children[0].scale.set(.96,.8,.8)})),this.id=Zl.Bed}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=4,this.size.y=Math.ceil(this.size.y),this.size.z=Math.ceil(this.size.z),this.size}GetBodyMeshId(){return"mixamorigRightHand"}}var ny=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class sy extends tc{get Id(){return Zl.AppleTree}constructor(t){super(t,Jl.Gltf,"assets/plant/low-ploy_tree.glb",(t=>ny(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0;this.meshs.scale.set(1,1,1),this.meshs.position.set(0,0,0),this.meshs.rotateY(-Math.PI/2)}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size}}class ry extends tc{get Id(){return Zl.CoconutTree}constructor(t){super(t,Jl.Gltf,"assets/plant/coconut_tree.glb",(t=>ny(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0;this.meshs.scale.set(1.2,1.2,1.2),this.meshs.position.set(0,0,0),this.meshs.rotation.set(0,0,0)}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size}}var oy=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class ay extends tc{get Id(){return Zl.BatPig}constructor(t){super(t,Jl.Gltf,"assets/monster/bat_pig.glb",(t=>oy(this,void 0,void 0,(function*(){this.Gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));const e=.01;this.meshs.scale.set(e,e,e),this.mixer=new Nl(t.scene),this.clips.set(Kl.Idle,t.animations.find((t=>"Armature|Idle"==t.name))),this.clips.set(Kl.Run,t.animations.find((t=>"Armature|Walk"==t.name))),this.clips.set(Kl.Punch,t.animations.find((t=>"Armature|Desh"==t.name))),this.clips.set(Kl.MonBiting,t.animations.find((t=>"Armature|Shoot"==t.name))),this.clips.set(Kl.MonScream,t.animations.find((t=>"Pig Enemy|Desh"==t.name)))}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.set(e.x,e.y,e.z),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(this.meshs);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size}}var hy=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class ly extends tc{get Id(){return Zl.BirdMon}constructor(t){super(t,Jl.Gltf,"assets/monster/bird_monster_animated.glb",(t=>hy(this,void 0,void 0,(function*(){this.Gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.scale.set(1,1,1),this.meshs.children[0].rotateZ(Math.PI),this.mixer=new Nl(t.scene),this.clips.set(Kl.Idle,t.animations.find((t=>"idle"==t.name))),this.clips.set(Kl.Run,t.animations.find((t=>"run"==t.name))),this.clips.set(Kl.Punch,t.animations.find((t=>"attack"==t.name))),this.clips.set(Kl.Dying,t.animations.find((t=>"death"==t.name)))}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.set(e.x,e.y,e.z),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=2.5*Math.ceil(this.size.y),this.size.z=Math.ceil(this.size.z),this.size}}var cy=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class uy extends tc{get Id(){return Zl.Bilby}constructor(t){super(t,Jl.Gltf,"assets/monster/bilby_animated.glb",(t=>cy(this,void 0,void 0,(function*(){this.Gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.scale.set(2,2,2),this.mixer=new Nl(t.scene),this.clips.set(Kl.Idle,t.animations.find((t=>"Bilby_idleSit"==t.name))),this.clips.set(Kl.Run,t.animations.find((t=>"Bilby_run"==t.name))),this.clips.set(Kl.Punch,t.animations.find((t=>"Bilby_atk1_bite"==t.name))),this.clips.set(Kl.MonBiting,t.animations.find((t=>"Bilby_atk2_tail"==t.name))),this.clips.set(Kl.Jump,t.animations.find((t=>"Bilby_jump"==t.name))),this.clips.set(Kl.MonScream,t.animations.find((t=>"Bilby_smell"==t.name)))}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.set(e.x,e.y,e.z),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=1,this.size.z=Math.ceil(this.size.z),this.size}}var dy=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class py extends tc{get Id(){return Zl.WereWolf}constructor(t){super(t,Jl.Gltf,"assets/monster/werewolf.glb",(t=>dy(this,void 0,void 0,(function*(){this.Gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.scale.set(1,1,1),this.mixer=new Nl(t.scene),this.clips.set(Kl.Idle,t.animations.find((t=>"Idle"==t.name))),this.clips.set(Kl.Run,t.animations.find((t=>"Run"==t.name))),this.clips.set(Kl.Punch,t.animations.find((t=>"Attack"==t.name)))}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.set(e.x,e.y,e.z),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size}}var my=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class fy extends tc{get Id(){return Zl.Golem}constructor(t){super(t,Jl.Gltf,"assets/monster/golem.glb",(t=>my(this,void 0,void 0,(function*(){this.Gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.scale.set(2,2,2),this.mixer=new Nl(t.scene),this.clips.set(Kl.Idle,t.animations.find((t=>"root|Idle"==t.name))),this.clips.set(Kl.Run,t.animations.find((t=>"root|Walk"==t.name))),this.clips.set(Kl.Punch,t.animations.find((t=>"root|Attack"==t.name))),this.clips.set(Kl.Dying,t.animations.find((t=>"root|Death_2"==t.name))),this.clips.set(Kl.MonHurt,t.animations.find((t=>"root|Damage"==t.name)))}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.set(e.x,e.y,e.z),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=3*Math.ceil(this.size.x),this.size.y=5*Math.ceil(this.size.y),this.size.z=2*Math.ceil(this.size.z),this.size}}class gy extends tc{get Id(){return Zl.BigGolem}constructor(t){super(t,Jl.Gltf,"assets/monster/big_golem.glb",(t=>my(this,void 0,void 0,(function*(){this.Gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0})),this.meshs.scale.set(this.scale,this.scale,this.scale),this.mixer=new Nl(t.scene),this.clips.set(Kl.Idle,t.animations.find((t=>"metarig|0_Idle"==t.name))),this.clips.set(Kl.Run,t.animations.find((t=>"metarig|1_Walk"==t.name))),this.clips.set(Kl.Punch,t.animations.find((t=>"metarig|3_Attack"==t.name))),this.clips.set(Kl.Dying,t.animations.find((t=>"metarig|5_Die"==t.name))),this.GetSize(this.meshs),this.meshs.children[0].position.y=190})))),this.scale=.02}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.set(e.x,e.y,e.z),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(this.meshs);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x)/6,this.size.y=Math.ceil(this.size.y)/2.5,this.size.z=Math.ceil(this.size.z)/6,this.size}}var vy=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class yy extends tc{get Id(){return Zl.Snake}constructor(t){super(t,Jl.Gltf,"assets/monster/snake.glb",(t=>vy(this,void 0,void 0,(function*(){this.Gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.scale.set(1,1,1),this.mixer=new Nl(t.scene),this.clips.set(Kl.Idle,t.animations.find((t=>"idle"==t.name))),this.clips.set(Kl.Walk,t.animations.find((t=>"Walk"==t.name))),this.clips.set(Kl.Run,t.animations.find((t=>"Run"==t.name))),this.clips.set(Kl.Punch,t.animations.find((t=>"Angry"==t.name)))}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.set(e.x,e.y,e.z),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size}}var xy=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class _y extends tc{get Id(){return Zl.Viking}constructor(t){super(t,Jl.Gltf,"assets/monster/viking.glb",(t=>xy(this,void 0,void 0,(function*(){this.Gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.scale.set(2,2,2),this.mixer=new Nl(t.scene),this.clips.set(Kl.Idle,t.animations.find((t=>"Idle1"==t.name))),this.clips.set(Kl.Run,t.animations.find((t=>"Run"==t.name))),this.clips.set(Kl.Punch,t.animations.find((t=>"Attak"==t.name)))}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.set(e.x,e.y,e.z),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=2.5*Math.ceil(this.size.x),this.size.y=3.5*Math.ceil(this.size.y),this.size.z=2*Math.ceil(this.size.z),this.size}}var by=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class wy extends tc{get Id(){return Zl.Viking}constructor(t){super(t,Jl.Gltf,"assets/monster/casual_builder.glb",(t=>by(this,void 0,void 0,(function*(){this.Gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.scale.set(1,1,1),this.mixer=new Nl(t.scene),this.clips.set(Kl.Idle,t.animations.find((t=>"idle"==t.name))),this.clips.set(Kl.Run,t.animations.find((t=>"run"==t.name))),this.clips.set(Kl.Punch,t.animations.find((t=>"joy1"==t.name))),this.clips.set(Kl.Dying,t.animations.find((t=>"sit_idle"==t.name)))}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.set(e.x,e.y,e.z),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=.8*Math.ceil(this.size.x),this.size.y=2*Math.ceil(this.size.y),this.size.z=Math.ceil(this.size.z),this.size}}class My{constructor(){this._listeners={}}addEventListener(t,e){const i=this._listeners;return void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e),this}removeEventListener(t,e){if(void 0===this._listeners)return this;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}return this}dispatchEvent(t){if(void 0===this._listeners)return this;const e=this._listeners[t.type];if(void 0!==e){const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t)}return this}dispose(){for(const t in this._listeners)delete this._listeners[t]}}class Sy extends My{constructor(t,e,i,n={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=t,this._parent=e,this._child=i,this._attributes=n,!e.isOnGraph(i))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(t){return this._child=t,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class Ty extends My{constructor(...t){super(...t),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(t){return Array.from(this._childEdges.get(t)||this._emptySet)}listParents(t){return this.listParentEdges(t).map((t=>t.getParent()))}listChildEdges(t){return Array.from(this._parentEdges.get(t)||this._emptySet)}listChildren(t){return this.listChildEdges(t).map((t=>t.getChild()))}disconnectParents(t,e){let i=this.listParentEdges(t);return e&&(i=i.filter((t=>e(t.getParent())))),i.forEach((t=>t.dispose())),this}createEdge(t,e,i,n){return this._registerEdge(new Sy(t,e,i,n))}_registerEdge(t){this._edges.add(t);const e=t.getParent();this._parentEdges.has(e)||this._parentEdges.set(e,new Set),this._parentEdges.get(e).add(t);const i=t.getChild();return this._childEdges.has(i)||this._childEdges.set(i,new Set),this._childEdges.get(i).add(t),t.addEventListener("dispose",(()=>this._removeEdge(t))),t}_removeEdge(t){return this._edges.delete(t),this._parentEdges.get(t.getParent()).delete(t),this._childEdges.get(t.getChild()).delete(t),this}}function Ey(){return Ey=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},Ey.apply(this,arguments)}function Ay(t){return t instanceof Sy}function Cy(t){return Array.isArray(t)&&t[0]instanceof Sy}function Iy(t){return!!(function(t){return Boolean(t)&&Object.getPrototypeOf(t)===Object.prototype}(t)&&function(t){for(const e in t)return t[e]}(t)instanceof Sy)}const Ry=Symbol("attributes"),Py=Symbol("immutableKeys");class ky extends My{constructor(t){super(),this._disposed=!1,this.graph=void 0,this[Ry]=void 0,this[Py]=void 0,this.graph=t,this[Py]=new Set,this[Ry]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const t=this.getDefaults(),e={};for(const i in t){const n=t[i];if(n instanceof ky){const t=this.graph.createEdge(i,this,n);t.addEventListener("dispose",(()=>n.dispose())),this[Py].add(i),e[i]=t}else e[i]=n}return e}isOnGraph(t){return this.graph===t.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach((t=>t.dispose())),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(t,e){for(const i in this[Ry]){const n=this[Ry][i];if(Ay(n)){const s=n;s.getChild()===t&&this.setRef(i,e,s.getAttributes())}else if(Cy(n)){const s=n.find((e=>e.getChild()===t));if(s){const n=s.getAttributes();this.removeRef(i,t).addRef(i,e,n)}}else if(Iy(n)){const s=n;for(const n in s){const r=s[n];r.getChild()===t&&this.setRefMap(i,n,e,r.getAttributes())}}}return this}get(t){return this[Ry][t]}set(t,e){return this[Ry][t]=e,this.dispatchEvent({type:"change",attribute:t})}getRef(t){const e=this[Ry][t];return e?e.getChild():null}setRef(t,e,i){if(this[Py].has(t))throw new Error(`Cannot overwrite immutable attribute, "${t}".`);const n=this[Ry][t];if(n&&n.dispose(),!e)return this;const s=this.graph.createEdge(t,this,e,i);return s.addEventListener("dispose",(()=>{delete this[Ry][t],this.dispatchEvent({type:"change",attribute:t})})),this[Ry][t]=s,this.dispatchEvent({type:"change",attribute:t})}listRefs(t){return this[Ry][t].map((t=>t.getChild()))}addRef(t,e,i){const n=this.graph.createEdge(t,this,e,i),s=this[Ry][t];return s.push(n),n.addEventListener("dispose",(()=>{let e;for(;-1!==(e=s.indexOf(n));)s.splice(e,1);this.dispatchEvent({type:"change",attribute:t})})),this.dispatchEvent({type:"change",attribute:t})}removeRef(t,e){return this[Ry][t].filter((t=>t.getChild()===e)).forEach((t=>t.dispose())),this}listRefMapKeys(t){return Object.keys(this[Ry][t])}listRefMapValues(t){return Object.values(this[Ry][t]).map((t=>t.getChild()))}getRefMap(t,e){const i=this[Ry][t];return i[e]?i[e].getChild():null}setRefMap(t,e,i,n){const s=this[Ry][t],r=s[e];if(r&&r.dispose(),!i)return this;n=Object.assign(n||{},{key:e});const o=this.graph.createEdge(t,this,i,Ey({},n,{key:e}));return o.addEventListener("dispose",(()=>{delete s[e],this.dispatchEvent({type:"change",attribute:t,key:e})})),s[e]=o,this.dispatchEvent({type:"change",attribute:t,key:e})}dispatchEvent(t){return super.dispatchEvent(Ey({},t,{target:this})),this.graph.dispatchEvent(Ey({},t,{target:this,type:`node:${t.type}`})),this}}const Dy="v3.10.1",Ly="@glb.bin";var Oy,Ny,By,zy,Uy;!function(t){t.ACCESSOR="Accessor",t.ANIMATION="Animation",t.ANIMATION_CHANNEL="AnimationChannel",t.ANIMATION_SAMPLER="AnimationSampler",t.BUFFER="Buffer",t.CAMERA="Camera",t.MATERIAL="Material",t.MESH="Mesh",t.PRIMITIVE="Primitive",t.PRIMITIVE_TARGET="PrimitiveTarget",t.NODE="Node",t.ROOT="Root",t.SCENE="Scene",t.SKIN="Skin",t.TEXTURE="Texture",t.TEXTURE_INFO="TextureInfo"}(Oy||(Oy={})),function(t){t.INTERLEAVED="interleaved",t.SEPARATE="separate"}(Ny||(Ny={})),function(t){t.ARRAY_BUFFER="ARRAY_BUFFER",t.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",t.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",t.OTHER="OTHER",t.SPARSE="SPARSE"}(By||(By={})),function(t){t[t.R=4096]="R",t[t.G=256]="G",t[t.B=16]="B",t[t.A=1]="A"}(zy||(zy={})),function(t){t.GLTF="GLTF",t.GLB="GLB"}(Uy||(Uy={}));const Fy={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var Gy,Hy="undefined"!=typeof Float32Array?Float32Array:Array;function Vy(t){return Math.hypot(t[0],t[1],t[2])}function jy(t,e,i){var n=e[0],s=e[1],r=e[2],o=i[3]*n+i[7]*s+i[11]*r+i[15];return t[0]=(i[0]*n+i[4]*s+i[8]*r+i[12])/(o=o||1),t[1]=(i[1]*n+i[5]*s+i[9]*r+i[13])/o,t[2]=(i[2]*n+i[6]*s+i[10]*r+i[14])/o,t}function Wy(t){const e={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},i=t.propertyType===Oy.NODE?[t]:t.listChildren();for(const t of i)t.traverse((t=>{const i=t.getMesh();if(!i)return;const n=Xy(i,t.getWorldMatrix());$y(n.min,e),$y(n.max,e)}));return e}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),Gy=new Hy(3),Hy!=Float32Array&&(Gy[0]=0,Gy[1]=0,Gy[2]=0);function Xy(t,e){const i={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const n of t.listPrimitives()){const t=n.getAttribute("POSITION");if(!t)continue;let s=[0,0,0],r=[0,0,0];for(let n=0;n<t.getCount();n++)s=t.getElement(n,s),r=jy(r,s,e),$y(r,i)}return i}function $y(t,e){for(let i=0;i<3;i++)e.min[i]=Math.min(t[i],e.min[i]),e.max[i]=Math.max(t[i],e.max[i])}class qy{static createBufferFromDataURI(t){if("undefined"==typeof Buffer){const e=atob(t.split(",")[1]),i=new Uint8Array(e.length);for(let t=0;t<e.length;t++)i[t]=e.charCodeAt(t);return i}{const e=t.split(",")[1],i=t.indexOf("base64")>=0;return Buffer.from(e,i?"base64":"utf8")}}static encodeText(t){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(t):Buffer.from(t)}static decodeText(t){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(t):Buffer.from(t).toString("utf8")}static concat(t){let e=0;for(const i of t)e+=i.byteLength;const i=new Uint8Array(e);let n=0;for(const e of t)i.set(e,n),n+=e.byteLength;return i}static pad(t,e=0){const i=this.padNumber(t.byteLength);if(i===t.byteLength)return t;const n=new Uint8Array(i);if(n.set(t),0!==e)for(let s=t.byteLength;s<i;s++)n[s]=e;return n}static padNumber(t){return 4*Math.ceil(t/4)}static equals(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;let i=t.byteLength;for(;i--;)if(t[i]!==e[i])return!1;return!0}static toView(t,e=0,i=1/0){return new Uint8Array(t.buffer,t.byteOffset+e,Math.min(t.byteLength,i))}static assertView(t){if(t&&!ArrayBuffer.isView(t))throw new Error(`Method requires Uint8Array parameter; received "${typeof t}".`);return t}}class Yy{static hexToFactor(t,e){t=Math.floor(t);const i=e;return i[0]=(t>>16&255)/255,i[1]=(t>>8&255)/255,i[2]=(255&t)/255,this.convertSRGBToLinear(e,e)}static factorToHex(t){const e=[...t],[i,n,s]=this.convertLinearToSRGB(t,e);return 255*i<<16^255*n<<8^255*s<<0}static convertSRGBToLinear(t,e){const i=t,n=e;for(let t=0;t<3;t++)n[t]=i[t]<.04045?.0773993808*i[t]:Math.pow(.9478672986*i[t]+.0521327014,2.4);return e}static convertLinearToSRGB(t,e){const i=t,n=e;for(let t=0;t<3;t++)n[t]=i[t]<.0031308?12.92*i[t]:1.055*Math.pow(i[t],.41666)-.055;return e}}class Ky{match(t){return t.length>=8&&137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]}getSize(t){const e=new DataView(t.buffer,t.byteOffset);return qy.decodeText(t.slice(12,16))===Ky.PNG_FRIED_CHUNK_NAME?[e.getUint32(32,!1),e.getUint32(36,!1)]:[e.getUint32(16,!1),e.getUint32(20,!1)]}getChannels(t){return 4}}Ky.PNG_FRIED_CHUNK_NAME="CgBI";class Zy{static registerFormat(t,e){this.impls[t]=e}static getMimeType(t){for(const e in this.impls)if(this.impls[e].match(t))return e;return null}static getSize(t,e){return this.impls[e]?this.impls[e].getSize(t):null}static getChannels(t,e){return this.impls[e]?this.impls[e].getChannels(t):null}static getVRAMByteLength(t,e){if(!this.impls[e])return null;if(this.impls[e].getVRAMByteLength)return this.impls[e].getVRAMByteLength(t);let i=0;const n=this.getSize(t,e);if(!n)return null;for(;n[0]>1||n[1]>1;)i+=n[0]*n[1]*4,n[0]=Math.max(Math.floor(n[0]/2),1),n[1]=Math.max(Math.floor(n[1]/2),1);return i+=4,i}static mimeTypeToExtension(t){return"image/jpeg"===t?"jpg":t.split("/").pop()}static extensionToMimeType(t){return"jpg"===t?"image/jpeg":t?`image/${t}`:""}}function Jy(t,e){if(e>t.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(255!==t.getUint8(e))throw new TypeError("Invalid JPG, marker table corrupted");return t}Zy.impls={"image/jpeg":new class{match(t){return t.length>=3&&255===t[0]&&216===t[1]&&255===t[2]}getSize(t){let e,i,n=new DataView(t.buffer,t.byteOffset+4);for(;n.byteLength;){if(e=n.getUint16(0,!1),Jy(n,e),i=n.getUint8(e+1),192===i||193===i||194===i)return[n.getUint16(e+7,!1),n.getUint16(e+5,!1)];n=new DataView(t.buffer,n.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(t){return 3}},"image/png":new Ky};class Qy{static basename(t){const e=t.split(/[\\/]/).pop();return e.substring(0,e.lastIndexOf("."))}static extension(t){if(t.startsWith("data:image/")){const e=t.match(/data:(image\/\w+)/)[1];return Zy.mimeTypeToExtension(e)}return t.startsWith("data:model/gltf+json")?"gltf":t.startsWith("data:model/gltf-binary")?"glb":t.startsWith("data:application/")?"bin":t.split(/[\\/]/).pop().split(/[.]/).pop()}}function tx(t){return"[object Object]"===Object.prototype.toString.call(t)}function ex(t){if(!1===tx(t))return!1;const e=t.constructor;if(void 0===e)return!0;const i=e.prototype;return!1!==tx(i)&&!1!==Object.prototype.hasOwnProperty.call(i,"isPrototypeOf")}var ix,nx;!function(t){t[t.SILENT=4]="SILENT",t[t.ERROR=3]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=1]="INFO",t[t.DEBUG=0]="DEBUG"}(nx||(nx={}));class sx{constructor(t){this.verbosity=void 0,this.verbosity=t}debug(t){this.verbosity,sx.Verbosity.DEBUG}info(t){this.verbosity,sx.Verbosity.INFO}warn(t){this.verbosity,sx.Verbosity.WARN}error(t){this.verbosity,sx.Verbosity.ERROR}}function rx(t,e,i){var n=e[0],s=e[1],r=e[2],o=e[3],a=e[4],h=e[5],l=e[6],c=e[7],u=e[8],d=e[9],p=e[10],m=e[11],f=e[12],g=e[13],v=e[14],y=e[15],x=i[0],_=i[1],b=i[2],w=i[3];return t[0]=x*n+_*a+b*u+w*f,t[1]=x*s+_*h+b*d+w*g,t[2]=x*r+_*l+b*p+w*v,t[3]=x*o+_*c+b*m+w*y,t[4]=(x=i[4])*n+(_=i[5])*a+(b=i[6])*u+(w=i[7])*f,t[5]=x*s+_*h+b*d+w*g,t[6]=x*r+_*l+b*p+w*v,t[7]=x*o+_*c+b*m+w*y,t[8]=(x=i[8])*n+(_=i[9])*a+(b=i[10])*u+(w=i[11])*f,t[9]=x*s+_*h+b*d+w*g,t[10]=x*r+_*l+b*p+w*v,t[11]=x*o+_*c+b*m+w*y,t[12]=(x=i[12])*n+(_=i[13])*a+(b=i[14])*u+(w=i[15])*f,t[13]=x*s+_*h+b*d+w*g,t[14]=x*r+_*l+b*p+w*v,t[15]=x*o+_*c+b*m+w*y,t}ix=sx,sx.Verbosity=nx,sx.DEFAULT_INSTANCE=new ix(ix.Verbosity.INFO);class ox{static identity(t){return t}static eq(t,e,i=1e-5){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(Math.abs(t[n]-e[n])>i)return!1;return!0}static decodeNormalizedInt(t,e){switch(e){case 5126:return t;case 5123:return t/65535;case 5121:return t/255;case 5122:return Math.max(t/32767,-1);case 5120:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(t,e){return ox.decodeNormalizedInt(t,e)}static encodeNormalizedInt(t,e){switch(e){case 5126:return t;case 5123:return Math.round(65535*t);case 5121:return Math.round(255*t);case 5122:return Math.round(32767*t);case 5120:return Math.round(127*t);default:throw new Error("Invalid component type.")}}static normalize(t,e){return ox.encodeNormalizedInt(t,e)}static decompose(t,e,i,n){let s=Vy([t[0],t[1],t[2]]);const r=Vy([t[4],t[5],t[6]]),o=Vy([t[8],t[9],t[10]]);var a,h,l,c,u,d,p,m,f,g,v,y,x,_,b,w,M;((h=(a=t)[0])*(p=a[5])-(l=a[1])*(d=a[4]))*((y=a[10])*(M=a[15])-(x=a[11])*(w=a[14]))-(h*(m=a[6])-(c=a[2])*d)*((v=a[9])*M-x*(b=a[13]))+(h*(f=a[7])-(u=a[3])*d)*(v*w-y*b)+(l*m-c*p)*((g=a[8])*M-x*(_=a[12]))-(l*f-u*p)*(g*w-y*_)+(c*f-u*m)*(g*b-v*_)<0&&(s=-s),e[0]=t[12],e[1]=t[13],e[2]=t[14];const S=t.slice(),T=1/s,E=1/r,A=1/o;S[0]*=T,S[1]*=T,S[2]*=T,S[4]*=E,S[5]*=E,S[6]*=E,S[8]*=A,S[9]*=A,S[10]*=A,function(t,e){var i=new Hy(3);!function(t,e){var i=e[4],n=e[5],s=e[6],r=e[8],o=e[9],a=e[10];t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,n,s),t[2]=Math.hypot(r,o,a)}(i,e);var n=1/i[0],s=1/i[1],r=1/i[2],o=e[0]*n,a=e[1]*s,h=e[2]*r,l=e[4]*n,c=e[5]*s,u=e[6]*r,d=e[8]*n,p=e[9]*s,m=e[10]*r,f=o+c+m,g=0;f>0?(g=2*Math.sqrt(f+1),t[3]=.25*g,t[0]=(u-p)/g,t[1]=(d-h)/g,t[2]=(a-l)/g):o>c&&o>m?(g=2*Math.sqrt(1+o-c-m),t[3]=(u-p)/g,t[0]=.25*g,t[1]=(a+l)/g,t[2]=(d+h)/g):c>m?(g=2*Math.sqrt(1+c-o-m),t[3]=(d-h)/g,t[0]=(a+l)/g,t[1]=.25*g,t[2]=(u+p)/g):(g=2*Math.sqrt(1+m-o-c),t[3]=(a-l)/g,t[0]=(d+h)/g,t[1]=(u+p)/g,t[2]=.25*g)}(i,S),n[0]=s,n[1]=r,n[2]=o}static compose(t,e,i,n){const s=n,r=e[0],o=e[1],a=e[2],h=e[3],l=r+r,c=o+o,u=a+a,d=r*l,p=r*c,m=r*u,f=o*c,g=o*u,v=a*u,y=h*l,x=h*c,_=h*u,b=i[0],w=i[1],M=i[2];return s[0]=(1-(f+v))*b,s[1]=(p+_)*b,s[2]=(m-x)*b,s[3]=0,s[4]=(p-_)*w,s[5]=(1-(d+v))*w,s[6]=(g+y)*w,s[7]=0,s[8]=(m+x)*M,s[9]=(g-y)*M,s[10]=(1-(d+f))*M,s[11]=0,s[12]=t[0],s[13]=t[1],s[14]=t[2],s[15]=1,s}}function ax(t,e){if(!!t!=!!e)return!1;const i=t.getChild(),n=e.getChild();return i===n||i.equals(n)}function hx(t,e){if(!!t!=!!e)return!1;if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++){const n=t[i],s=e[i];if(n.getChild()!==s.getChild()&&!n.getChild().equals(s.getChild()))return!1}return!0}function lx(t,e){if(!!t!=!!e)return!1;const i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(const i in t){const n=t[i],s=e[i];if(!!n!=!!s)return!1;const r=n.getChild(),o=s.getChild();if(r!==o&&!r.equals(o))return!1}return!0}function cx(t,e){if(t===e)return!0;if(!!t!=!!e||!t||!e)return!1;if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function ux(t,e){if(t===e)return!0;if(!!t!=!!e)return!1;if(!ex(t)||!ex(e))return t===e;const i=t,n=e;let s,r=0,o=0;for(s in i)r++;for(s in n)o++;if(r!==o)return!1;for(s in i){const t=i[s],e=n[s];if(dx(t)&&dx(e)){if(!cx(t,e))return!1}else if(ex(t)&&ex(e)){if(!ux(t,e))return!1}else if(t!==e)return!1}return!0}function dx(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const px=new Set,mx=function(){let t="";for(let e=0;e<6;e++)t+="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ".charAt(Math.floor(42*Math.random()));return t},fx="https://null.example";class gx{static dirname(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substring(0,e+1)}static basename(t){return Qy.basename(new URL(t,fx).pathname)}static extension(t){return Qy.extension(new URL(t,fx).pathname)}static resolve(t,e){if(!this.isRelativePath(e))return e;const i=t.split("/"),n=e.split("/");i.pop();for(let t=0;t<n.length;t++)"."!==n[t]&&(".."===n[t]?i.pop():i.push(n[t]));return i.join("/")}static isAbsoluteURL(t){return this.PROTOCOL_REGEXP.test(t)}static isRelativePath(t){return!/^(?:[a-zA-Z]+:)?\//.test(t)}}gx.DEFAULT_INIT={},gx.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const vx=t=>t,yx=new Set;class xx extends ky{constructor(t,e=""){super(t),this[Ry].name=e,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(t,e){return Array.isArray(e)&&(e=e.slice()),super.set(t,e)}getName(){return this.get("name")}setName(t){return this.set("name",t)}getExtras(){return this.get("extras")}setExtras(t){return this.set("extras",t)}clone(){return new(0,this.constructor)(this.graph).copy(this,vx)}copy(t,e=vx){for(const t in this[Ry]){const e=this[Ry][t];if(e instanceof Sy)this[Py].has(t)||e.dispose();else if(Cy(e))for(const t of e)t.dispose();else if(Iy(e))for(const t in e)e[t].dispose()}for(const i in t[Ry]){const n=this[Ry][i],s=t[Ry][i];if(s instanceof Sy)this[Py].has(i)?n.getChild().copy(e(s.getChild()),e):this.setRef(i,e(s.getChild()),s.getAttributes());else if(Cy(s))for(const t of s)this.addRef(i,e(t.getChild()),t.getAttributes());else if(Iy(s))for(const t in s){const n=s[t];this.setRefMap(i,t,e(n.getChild()),n.getAttributes())}else this[Ry][i]=ex(s)?JSON.parse(JSON.stringify(s)):Array.isArray(s)||s instanceof ArrayBuffer||ArrayBuffer.isView(s)?s.slice():s}return this}equals(t,e=yx){if(this===t)return!0;if(this.propertyType!==t.propertyType)return!1;for(const i in this[Ry]){if(e.has(i))continue;const n=this[Ry][i],s=t[Ry][i];if(Ay(n)||Ay(s)){if(!ax(n,s))return!1}else if(Cy(n)||Cy(s)){if(!hx(n,s))return!1}else if(Iy(n)||Iy(s)){if(!lx(n,s))return!1}else if(ex(n)||ex(s)){if(!ux(n,s))return!1}else if(dx(n)||dx(s)){if(!cx(n,s))return!1}else if(n!==s)return!1}return!0}detach(){return this.graph.disconnectParents(this,(t=>"Root"!==t.propertyType)),this}listParents(){return this.graph.listParents(this)}}class _x extends xx{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(t){return this.getRefMap("extensions",t)}setExtension(t,e){return e&&e.t(this),this.setRefMap("extensions",t,e)}listExtensions(){return this.listRefMapValues("extensions")}}class bx extends _x{constructor(...t){super(...t),this.i=ox.identity,this.o=ox.identity}init(){this.propertyType=Oy.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:bx.Type.SCALAR,componentType:bx.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(t,e=vx){return super.copy(t,e),this.i=t.i,this.o=t.o,this}static getElementSize(t){switch(t){case bx.Type.SCALAR:return 1;case bx.Type.VEC2:return 2;case bx.Type.VEC3:return 3;case bx.Type.VEC4:case bx.Type.MAT2:return 4;case bx.Type.MAT3:return 9;case bx.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+t)}}static getComponentSize(t){switch(t){case bx.ComponentType.BYTE:case bx.ComponentType.UNSIGNED_BYTE:return 1;case bx.ComponentType.SHORT:case bx.ComponentType.UNSIGNED_SHORT:return 2;case bx.ComponentType.UNSIGNED_INT:case bx.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+t)}}getMinNormalized(t){const e=this.getElementSize();this.getMin(t);for(let i=0;i<e;i++)t[i]=this.o(t[i]);return t}getMin(t){const e=this.get("array"),i=this.getCount(),n=this.getElementSize();for(let e=0;e<n;e++)t[e]=1/0;for(let s=0;s<i*n;s+=n)for(let i=0;i<n;i++){const n=e[s+i];Number.isFinite(n)&&(t[i]=Math.min(t[i],n))}return t}getMaxNormalized(t){const e=this.getElementSize();this.getMax(t);for(let i=0;i<e;i++)t[i]=this.o(t[i]);return t}getMax(t){const e=this.get("array"),i=this.getCount(),n=this.getElementSize();for(let e=0;e<n;e++)t[e]=-1/0;for(let s=0;s<i*n;s+=n)for(let i=0;i<n;i++){const n=e[s+i];Number.isFinite(n)&&(t[i]=Math.max(t[i],n))}return t}getCount(){const t=this.get("array");return t?t.length/this.getElementSize():0}getType(){return this.get("type")}setType(t){return this.set("type",t)}getElementSize(){return bx.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(t){return this.set("normalized",t),t?(this.o=t=>ox.decodeNormalizedInt(t,this.get("componentType")),this.i=t=>ox.encodeNormalizedInt(t,this.get("componentType"))):(this.o=ox.identity,this.i=ox.identity),this}getScalar(t){const e=this.getElementSize();return this.o(this.get("array")[t*e])}setScalar(t,e){return this.get("array")[t*this.getElementSize()]=this.i(e),this}getElement(t,e){const i=this.getElementSize(),n=this.get("array");for(let s=0;s<i;s++)e[s]=this.o(n[t*i+s]);return e}setElement(t,e){const i=this.getElementSize(),n=this.get("array");for(let s=0;s<i;s++)n[t*i+s]=this.i(e[s]);return this}getSparse(){return this.get("sparse")}setSparse(t){return this.set("sparse",t)}getBuffer(){return this.getRef("buffer")}setBuffer(t){return this.setRef("buffer",t)}getArray(){return this.get("array")}setArray(t){return this.set("componentType",t?function(t){switch(t.constructor){case Float32Array:return bx.ComponentType.FLOAT;case Uint32Array:return bx.ComponentType.UNSIGNED_INT;case Uint16Array:return bx.ComponentType.UNSIGNED_SHORT;case Uint8Array:return bx.ComponentType.UNSIGNED_BYTE;case Int16Array:return bx.ComponentType.SHORT;case Int8Array:return bx.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(t):bx.ComponentType.FLOAT),this.set("array",t),this}getByteLength(){const t=this.get("array");return t?t.byteLength:0}}bx.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},bx.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class wx extends _x{init(){this.propertyType=Oy.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(t){return this.addRef("channels",t)}removeChannel(t){return this.removeRef("channels",t)}listChannels(){return this.listRefs("channels")}addSampler(t){return this.addRef("samplers",t)}removeSampler(t){return this.removeRef("samplers",t)}listSamplers(){return this.listRefs("samplers")}}class Mx extends _x{init(){this.propertyType=Oy.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(t){return this.set("targetPath",t)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(t){return this.setRef("targetNode",t)}getSampler(){return this.getRef("sampler")}setSampler(t){return this.setRef("sampler",t)}}Mx.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class Sx extends _x{init(){this.propertyType=Oy.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:Sx.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(t){return this.set("interpolation",t)}getInput(){return this.getRef("input")}setInput(t){return this.setRef("input",t,{usage:By.OTHER})}getOutput(){return this.getRef("output")}setOutput(t){return this.setRef("output",t,{usage:By.OTHER})}}Sx.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class Tx extends _x{init(){this.propertyType=Oy.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(t){return this.set("uri",t)}}class Ex extends _x{init(){this.propertyType=Oy.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Ex.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(t){return this.set("type",t)}getZNear(){return this.get("znear")}setZNear(t){return this.set("znear",t)}getZFar(){return this.get("zfar")}setZFar(t){return this.set("zfar",t)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(t){return this.set("aspectRatio",t)}getYFov(){return this.get("yfov")}setYFov(t){return this.set("yfov",t)}getXMag(){return this.get("xmag")}setXMag(t){return this.set("xmag",t)}getYMag(){return this.get("ymag")}setYMag(t){return this.set("ymag",t)}}Ex.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class Ax extends xx{t(t){if(!this.parentTypes.includes(t.propertyType))throw new Error(`Parent "${t.propertyType}" invalid for child "${this.propertyType}".`)}}Ax.EXTENSION_NAME=void 0;class Cx extends _x{init(){this.propertyType=Oy.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:Cx.WrapMode.REPEAT,wrapT:Cx.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(t){return this.set("texCoord",t)}getMagFilter(){return this.get("magFilter")}setMagFilter(t){return this.set("magFilter",t)}getMinFilter(){return this.get("minFilter")}setMinFilter(t){return this.set("minFilter",t)}getWrapS(){return this.get("wrapS")}setWrapS(t){return this.set("wrapS",t)}getWrapT(){return this.get("wrapT")}setWrapT(t){return this.set("wrapT",t)}}Cx.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Cx.MagFilter={NEAREST:9728,LINEAR:9729},Cx.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:Ix,G:Rx,B:Px,A:kx}=zy;class Dx extends _x{init(){this.propertyType=Oy.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Dx.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Cx(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Cx(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Cx(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Cx(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Cx(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(t){return this.set("doubleSided",t)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(t){const e=this.get("baseColorFactor").slice();return e[3]=t,this.set("baseColorFactor",e)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(t){return this.set("alphaMode",t)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(t){return this.set("alphaCutoff",t)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(t){return this.set("baseColorFactor",t)}getBaseColorHex(){return Yy.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(t){const e=this.get("baseColorFactor").slice();return this.set("baseColorFactor",Yy.hexToFactor(t,e))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(t){return this.setRef("baseColorTexture",t,{channels:Ix|Rx|Px|kx,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(t){return this.set("emissiveFactor",t)}getEmissiveHex(){return Yy.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(t){const e=this.get("emissiveFactor").slice();return this.set("emissiveFactor",Yy.hexToFactor(t,e))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(t){return this.setRef("emissiveTexture",t,{channels:Ix|Rx|Px,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(t){return this.set("normalScale",t)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(t){return this.setRef("normalTexture",t,{channels:Ix|Rx|Px})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(t){return this.set("occlusionStrength",t)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(t){return this.setRef("occlusionTexture",t,{channels:Ix})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(t){return this.set("roughnessFactor",t)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(t){return this.set("metallicFactor",t)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(t){return this.setRef("metallicRoughnessTexture",t,{channels:Rx|Px})}}Dx.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class Lx extends _x{init(){this.propertyType=Oy.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(t){return this.addRef("primitives",t)}removePrimitive(t){return this.removeRef("primitives",t)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(t){return this.set("weights",t)}}class Ox extends _x{constructor(...t){super(...t),this.u=null,this.h=new Set}init(){this.propertyType=Oy.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(t,e=vx){if(e===vx)throw new Error("Node cannot be copied.");return super.copy(t,e)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(t){return this.set("translation",t)}setRotation(t){return this.set("rotation",t)}setScale(t){return this.set("scale",t)}getMatrix(){return ox.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(t){const e=this.get("translation").slice(),i=this.get("rotation").slice(),n=this.get("scale").slice();return ox.decompose(t,e,i,n),this.set("translation",e).set("rotation",i).set("scale",n)}getWorldTranslation(){const t=[0,0,0];return ox.decompose(this.getWorldMatrix(),t,[0,0,0,1],[1,1,1]),t}getWorldRotation(){const t=[0,0,0,1];return ox.decompose(this.getWorldMatrix(),[0,0,0],t,[1,1,1]),t}getWorldScale(){const t=[1,1,1];return ox.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],t),t}getWorldMatrix(){const t=[];for(let e=this;null!=e;e=e.u)t.push(e);let e;const i=t.pop().getMatrix();for(;e=t.pop();)rx(i,i,e.getMatrix());return i}addChild(t){if(t.u&&t.u.removeChild(t),t.h.size)for(const e of t.h)e.removeChild(t);this.addRef("children",t),t.u=this;const e=this[Ry].children;return e[e.length-1].addEventListener("dispose",(()=>t.u=null)),this}removeChild(t){return this.removeRef("children",t)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find((t=>t.propertyType===Oy.SCENE))||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(t){return this.setRef("mesh",t)}getCamera(){return this.getRef("camera")}setCamera(t){return this.setRef("camera",t)}getSkin(){return this.getRef("skin")}setSkin(t){return this.setRef("skin",t)}getWeights(){return this.get("weights")}setWeights(t){return this.set("weights",t)}traverse(t){t(this);for(const e of this.listChildren())e.traverse(t);return this}}class Nx extends _x{init(){this.propertyType=Oy.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:Nx.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(t){return this.setRef("indices",t,{usage:By.ELEMENT_ARRAY_BUFFER})}getAttribute(t){return this.getRefMap("attributes",t)}setAttribute(t,e){return this.setRefMap("attributes",t,e,{usage:By.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(t){return this.setRef("material",t)}getMode(){return this.get("mode")}setMode(t){return this.set("mode",t)}listTargets(){return this.listRefs("targets")}addTarget(t){return this.addRef("targets",t)}removeTarget(t){return this.removeRef("targets",t)}}Nx.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class Bx extends xx{init(){this.propertyType=Oy.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(t){return this.getRefMap("attributes",t)}setAttribute(t,e){return this.setRefMap("attributes",t,e,{usage:By.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function zx(){return zx=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},zx.apply(this,arguments)}class Ux extends _x{init(){this.propertyType=Oy.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(t,e=vx){if(e===vx)throw new Error("Scene cannot be copied.");return super.copy(t,e)}addChild(t){t.u&&t.u.removeChild(t),this.addRef("children",t),t.h.add(this);const e=this[Ry].children;return e[e.length-1].addEventListener("dispose",(()=>t.h.delete(this))),this}removeChild(t){return this.removeRef("children",t)}listChildren(){return this.listRefs("children")}traverse(t){for(const e of this.listChildren())e.traverse(t);return this}}class Fx extends _x{init(){this.propertyType=Oy.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(t){return this.setRef("skeleton",t)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(t){return this.setRef("inverseBindMatrices",t,{usage:By.INVERSE_BIND_MATRICES})}addJoint(t){return this.addRef("joints",t)}removeJoint(t){return this.removeRef("joints",t)}listJoints(){return this.listRefs("joints")}}class Gx extends _x{init(){this.propertyType=Oy.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||Zy.extensionToMimeType(Qy.extension(this.get("uri")))}setMimeType(t){return this.set("mimeType",t)}getURI(){return this.get("uri")}setURI(t){this.set("uri",t);const e=Zy.extensionToMimeType(Qy.extension(t));return e&&this.set("mimeType",e),this}getImage(){return this.get("image")}setImage(t){return this.set("image",qy.assertView(t))}getSize(){const t=this.get("image");return t?Zy.getSize(t,this.getMimeType()):null}}class Hx extends _x{init(){this.propertyType=Oy.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${Dy}`,version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(t){super(t),this.l=new Set,t.addEventListener("node:create",(t=>{this.g(t.target)}))}clone(){throw new Error("Root cannot be cloned.")}copy(t,e=vx){if(e===vx)throw new Error("Root cannot be copied.");this.set("asset",zx({},t.get("asset"))),this.setName(t.getName()),this.setExtras(zx({},t.getExtras())),this.setDefaultScene(t.getDefaultScene()?e(t.getDefaultScene()):null);for(const i of t.listRefMapKeys("extensions")){const n=t.getExtension(i);this.setExtension(i,e(n))}return this}g(t){return t instanceof Ux?this.addRef("scenes",t):t instanceof Ox?this.addRef("nodes",t):t instanceof Ex?this.addRef("cameras",t):t instanceof Fx?this.addRef("skins",t):t instanceof Lx?this.addRef("meshes",t):t instanceof Dx?this.addRef("materials",t):t instanceof Gx?this.addRef("textures",t):t instanceof wx?this.addRef("animations",t):t instanceof bx?this.addRef("accessors",t):t instanceof Tx&&this.addRef("buffers",t),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.l)}listExtensionsRequired(){return this.listExtensionsUsed().filter((t=>t.isRequired()))}p(t){return this.l.add(t),this}m(t){return this.l.delete(t),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(t){return this.setRef("defaultScene",t)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class Vx{static fromGraph(t){return Vx.v.get(t)||null}constructor(){this.T=new Ty,this.S=new Hx(this.T),this.M=sx.DEFAULT_INSTANCE,Vx.v.set(this.T,this)}getRoot(){return this.S}getGraph(){return this.T}getLogger(){return this.M}setLogger(t){return this.M=t,this}clone(){return(new Vx).setLogger(this.M).merge(this)}merge(t){for(const e of t.getRoot().listExtensionsUsed()){const t=this.createExtension(e.constructor);e.isRequired()&&t.setRequired(!0)}const e=new Set,i=new Map;e.add(t.S),i.set(t.S,this.S);for(const n of t.T.listEdges())for(const t of[n.getParent(),n.getChild()]){if(e.has(t))continue;let n;n=t.propertyType===Oy.TEXTURE_INFO?t:new(0,t.constructor)(this.T),i.set(t,n),e.add(t)}const n=t=>{const e=i.get(t);if(!e)throw new Error("Could resolve property.");return e};for(const t of e){const e=i.get(t);if(!e)throw new Error("Could resolve property.");e.propertyType!==Oy.TEXTURE_INFO&&e.copy(t,n)}return this}async transform(...t){const e=t.map((t=>t.name));for(const i of t)await i(this,{stack:e});return this}createExtension(t){const e=t.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find((t=>t.extensionName===e))||new t(this)}createScene(t=""){return new Ux(this.T,t)}createNode(t=""){return new Ox(this.T,t)}createCamera(t=""){return new Ex(this.T,t)}createSkin(t=""){return new Fx(this.T,t)}createMesh(t=""){return new Lx(this.T,t)}createPrimitive(){return new Nx(this.T)}createPrimitiveTarget(t=""){return new Bx(this.T,t)}createMaterial(t=""){return new Dx(this.T,t)}createTexture(t=""){return new Gx(this.T,t)}createAnimation(t=""){return new wx(this.T,t)}createAnimationChannel(t=""){return new Mx(this.T,t)}createAnimationSampler(t=""){return new Sx(this.T,t)}createAccessor(t="",e=null){return e||(e=this.getRoot().listBuffers()[0]),new bx(this.T,t).setBuffer(e)}createBuffer(t=""){return new Tx(this.T,t)}}Vx.v=new WeakMap;class jx{constructor(t){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.I=void 0,this.document=t,t.getRoot().p(this),this.I=t=>{const e=t,i=e.target;i instanceof Ax&&i.extensionName===this.extensionName&&("node:create"===e.type&&this.N(i),"node:dispose"===e.type&&this.O(i))};const e=t.getGraph();e.addEventListener("node:create",this.I),e.addEventListener("node:dispose",this.I)}dispose(){this.document.getRoot().m(this);const t=this.document.getGraph();t.removeEventListener("node:create",this.I),t.removeEventListener("node:dispose",this.I);for(const t of this.properties)t.dispose()}static register(){}isRequired(){return this.required}setRequired(t){return this.required=t,this}listProperties(){return Array.from(this.properties)}N(t){return this.properties.add(t),this}O(t){return this.properties.delete(t),this}install(t,e){return this}preread(t,e){return this}prewrite(t,e){return this}}jx.EXTENSION_NAME=void 0;class Wx{constructor(t){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=t}setTextureInfo(t,e){this.textureInfos.set(t,e),void 0!==e.texCoord&&t.setTexCoord(e.texCoord),void 0!==e.extras&&t.setExtras(e.extras);const i=this.jsonDoc.json.textures[e.index];if(void 0===i.sampler)return;const n=this.jsonDoc.json.samplers[i.sampler];void 0!==n.magFilter&&t.setMagFilter(n.magFilter),void 0!==n.minFilter&&t.setMinFilter(n.minFilter),void 0!==n.wrapS&&t.setWrapS(n.wrapS),void 0!==n.wrapT&&t.setWrapT(n.wrapT)}}const Xx={logger:sx.DEFAULT_INSTANCE,extensions:[],dependencies:{}};class $x{static read(t,e=Xx){const i=zx({},Xx,e),{json:n}=t,s=(new Vx).setLogger(i.logger);this.validate(t,i);const r=new Wx(t),o=n.asset,a=s.getRoot().getAsset();o.copyright&&(a.copyright=o.copyright),o.extras&&(a.extras=o.extras),void 0!==n.extras&&s.getRoot().setExtras(zx({},n.extras));const h=n.extensionsUsed||[],l=n.extensionsRequired||[];for(const t of i.extensions)if(h.includes(t.EXTENSION_NAME)){const e=s.createExtension(t).setRequired(l.includes(t.EXTENSION_NAME));for(const t of e.readDependencies)e.install(t,i.dependencies[t])}const c=n.buffers||[];s.getRoot().listExtensionsUsed().filter((t=>t.prereadTypes.includes(Oy.BUFFER))).forEach((t=>t.preread(r,Oy.BUFFER))),r.buffers=c.map((t=>{const e=s.createBuffer(t.name);return t.extras&&e.setExtras(t.extras),t.uri&&0!==t.uri.indexOf("__")&&e.setURI(t.uri),e})),r.bufferViewBuffers=(n.bufferViews||[]).map(((e,i)=>{if(!r.bufferViews[i]){const n=t.json.buffers[e.buffer];r.bufferViews[i]=qy.toView(n.uri?t.resources[n.uri]:t.resources[Ly],e.byteOffset||0,e.byteLength)}return r.buffers[e.buffer]}));const u=n.accessors||[];r.accessors=u.map((t=>{const e=s.createAccessor(t.name,r.bufferViewBuffers[t.bufferView]).setType(t.type);return t.extras&&e.setExtras(t.extras),void 0!==t.normalized&&e.setNormalized(t.normalized),void 0===t.bufferView||e.setArray(qx(t,r)),e}));const d=n.images||[],p=n.textures||[];s.getRoot().listExtensionsUsed().filter((t=>t.prereadTypes.includes(Oy.TEXTURE))).forEach((t=>t.preread(r,Oy.TEXTURE))),r.textures=d.map((e=>{const i=s.createTexture(e.name);if(e.extras&&i.setExtras(e.extras),void 0!==e.bufferView){const s=n.bufferViews[e.bufferView],r=t.json.buffers[s.buffer],o=s.byteOffset||0,a=(r.uri?t.resources[r.uri]:t.resources[Ly]).slice(o,o+s.byteLength);i.setImage(a)}else void 0!==e.uri&&(i.setImage(t.resources[e.uri]),0!==e.uri.indexOf("__")&&i.setURI(e.uri));if(void 0!==e.mimeType)i.setMimeType(e.mimeType);else if(e.uri){const t=Qy.extension(e.uri);i.setMimeType(Zy.extensionToMimeType(t))}return i})),r.materials=(n.materials||[]).map((t=>{const e=s.createMaterial(t.name);t.extras&&e.setExtras(t.extras),void 0!==t.alphaMode&&e.setAlphaMode(t.alphaMode),void 0!==t.alphaCutoff&&e.setAlphaCutoff(t.alphaCutoff),void 0!==t.doubleSided&&e.setDoubleSided(t.doubleSided);const i=t.pbrMetallicRoughness||{};if(void 0!==i.baseColorFactor&&e.setBaseColorFactor(i.baseColorFactor),void 0!==t.emissiveFactor&&e.setEmissiveFactor(t.emissiveFactor),void 0!==i.metallicFactor&&e.setMetallicFactor(i.metallicFactor),void 0!==i.roughnessFactor&&e.setRoughnessFactor(i.roughnessFactor),void 0!==i.baseColorTexture){const t=i.baseColorTexture;e.setBaseColorTexture(r.textures[p[t.index].source]),r.setTextureInfo(e.getBaseColorTextureInfo(),t)}if(void 0!==t.emissiveTexture){const i=t.emissiveTexture;e.setEmissiveTexture(r.textures[p[i.index].source]),r.setTextureInfo(e.getEmissiveTextureInfo(),i)}if(void 0!==t.normalTexture){const i=t.normalTexture;e.setNormalTexture(r.textures[p[i.index].source]),r.setTextureInfo(e.getNormalTextureInfo(),i),void 0!==t.normalTexture.scale&&e.setNormalScale(t.normalTexture.scale)}if(void 0!==t.occlusionTexture){const i=t.occlusionTexture;e.setOcclusionTexture(r.textures[p[i.index].source]),r.setTextureInfo(e.getOcclusionTextureInfo(),i),void 0!==t.occlusionTexture.strength&&e.setOcclusionStrength(t.occlusionTexture.strength)}if(void 0!==i.metallicRoughnessTexture){const t=i.metallicRoughnessTexture;e.setMetallicRoughnessTexture(r.textures[p[t.index].source]),r.setTextureInfo(e.getMetallicRoughnessTextureInfo(),t)}return e}));const m=n.meshes||[];s.getRoot().listExtensionsUsed().filter((t=>t.prereadTypes.includes(Oy.PRIMITIVE))).forEach((t=>t.preread(r,Oy.PRIMITIVE))),r.meshes=m.map((t=>{const e=s.createMesh(t.name);return t.extras&&e.setExtras(t.extras),void 0!==t.weights&&e.setWeights(t.weights),(t.primitives||[]).forEach((i=>{const n=s.createPrimitive();i.extras&&n.setExtras(i.extras),void 0!==i.material&&n.setMaterial(r.materials[i.material]),void 0!==i.mode&&n.setMode(i.mode);for(const[t,e]of Object.entries(i.attributes||{}))n.setAttribute(t,r.accessors[e]);void 0!==i.indices&&n.setIndices(r.accessors[i.indices]);const o=t.extras&&t.extras.targetNames||[];(i.targets||[]).forEach(((t,e)=>{const i=o[e]||e.toString(),a=s.createPrimitiveTarget(i);for(const[e,i]of Object.entries(t))a.setAttribute(e,r.accessors[i]);n.addTarget(a)})),e.addPrimitive(n)})),e})),r.cameras=(n.cameras||[]).map((t=>{const e=s.createCamera(t.name).setType(t.type);if(t.extras&&e.setExtras(t.extras),t.type===Ex.Type.PERSPECTIVE){const i=t.perspective;e.setYFov(i.yfov),e.setZNear(i.znear),void 0!==i.zfar&&e.setZFar(i.zfar),void 0!==i.aspectRatio&&e.setAspectRatio(i.aspectRatio)}else{const i=t.orthographic;e.setZNear(i.znear).setZFar(i.zfar).setXMag(i.xmag).setYMag(i.ymag)}return e}));const f=n.nodes||[];s.getRoot().listExtensionsUsed().filter((t=>t.prereadTypes.includes(Oy.NODE))).forEach((t=>t.preread(r,Oy.NODE))),r.nodes=f.map((t=>{const e=s.createNode(t.name);if(t.extras&&e.setExtras(t.extras),void 0!==t.translation&&e.setTranslation(t.translation),void 0!==t.rotation&&e.setRotation(t.rotation),void 0!==t.scale&&e.setScale(t.scale),void 0!==t.matrix){const i=[0,0,0],n=[0,0,0,1],s=[1,1,1];ox.decompose(t.matrix,i,n,s),e.setTranslation(i),e.setRotation(n),e.setScale(s)}return void 0!==t.weights&&e.setWeights(t.weights),e})),r.skins=(n.skins||[]).map((t=>{const e=s.createSkin(t.name);t.extras&&e.setExtras(t.extras),void 0!==t.inverseBindMatrices&&e.setInverseBindMatrices(r.accessors[t.inverseBindMatrices]),void 0!==t.skeleton&&e.setSkeleton(r.nodes[t.skeleton]);for(const i of t.joints)e.addJoint(r.nodes[i]);return e})),f.map(((t,e)=>{const i=r.nodes[e];(t.children||[]).forEach((t=>i.addChild(r.nodes[t]))),void 0!==t.mesh&&i.setMesh(r.meshes[t.mesh]),void 0!==t.camera&&i.setCamera(r.cameras[t.camera]),void 0!==t.skin&&i.setSkin(r.skins[t.skin])})),r.animations=(n.animations||[]).map((t=>{const e=s.createAnimation(t.name);t.extras&&e.setExtras(t.extras);const i=(t.samplers||[]).map((t=>{const i=s.createAnimationSampler().setInput(r.accessors[t.input]).setOutput(r.accessors[t.output]).setInterpolation(t.interpolation||Sx.Interpolation.LINEAR);return t.extras&&i.setExtras(t.extras),e.addSampler(i),i}));return(t.channels||[]).forEach((t=>{const n=s.createAnimationChannel().setSampler(i[t.sampler]).setTargetPath(t.target.path);void 0!==t.target.node&&n.setTargetNode(r.nodes[t.target.node]),t.extras&&n.setExtras(t.extras),e.addChannel(n)})),e}));const g=n.scenes||[];return s.getRoot().listExtensionsUsed().filter((t=>t.prereadTypes.includes(Oy.SCENE))).forEach((t=>t.preread(r,Oy.SCENE))),r.scenes=g.map((t=>{const e=s.createScene(t.name);return t.extras&&e.setExtras(t.extras),(t.nodes||[]).map((t=>r.nodes[t])).forEach((t=>e.addChild(t))),e})),void 0!==n.scene&&s.getRoot().setDefaultScene(r.scenes[n.scene]),s.getRoot().listExtensionsUsed().forEach((t=>t.read(r))),u.forEach(((t,e)=>{const i=r.accessors[e],n=!!t.sparse,s=!t.bufferView&&!i.getArray();(n||s)&&i.setSparse(!0).setArray(function(t,e){const i=Fy[t.componentType],n=bx.getElementSize(t.type);let s;s=void 0!==t.bufferView?qx(t,e):new i(t.count*n);const r=t.sparse;if(!r)return s;const o=r.count,a=zx({},t,r.indices,{count:o,type:"SCALAR"}),h=zx({},t,r.values,{count:o}),l=qx(a,e),c=qx(h,e);for(let t=0;t<a.count;t++)for(let e=0;e<n;e++)s[l[t]*n+e]=c[t*n+e];return s}(t,r))})),s}static validate(t,e){const i=t.json;if("2.0"!==i.asset.version)throw new Error(`Unsupported glTF version, "${i.asset.version}".`);if(i.extensionsRequired)for(const t of i.extensionsRequired)if(!e.extensions.find((e=>e.EXTENSION_NAME===t)))throw new Error(`Missing required extension, "${t}".`);if(i.extensionsUsed)for(const t of i.extensionsUsed)e.extensions.find((e=>e.EXTENSION_NAME===t))||e.logger.warn(`Missing optional extension, "${t}".`)}}function qx(t,e){const i=e.bufferViews[t.bufferView],n=e.jsonDoc.json.bufferViews[t.bufferView],s=Fy[t.componentType],r=bx.getElementSize(t.type),o=s.BYTES_PER_ELEMENT;if(void 0!==n.byteStride&&n.byteStride!==r*o)return function(t,e){const i=e.bufferViews[t.bufferView],n=e.jsonDoc.json.bufferViews[t.bufferView],s=Fy[t.componentType],r=bx.getElementSize(t.type),o=s.BYTES_PER_ELEMENT,a=t.byteOffset||0,h=new s(t.count*r),l=new DataView(i.buffer,i.byteOffset,i.byteLength),c=n.byteStride;for(let e=0;e<t.count;e++)for(let i=0;i<r;i++){const n=a+e*c+i*o;let s;switch(t.componentType){case bx.ComponentType.FLOAT:s=l.getFloat32(n,!0);break;case bx.ComponentType.UNSIGNED_INT:s=l.getUint32(n,!0);break;case bx.ComponentType.UNSIGNED_SHORT:s=l.getUint16(n,!0);break;case bx.ComponentType.UNSIGNED_BYTE:s=l.getUint8(n);break;case bx.ComponentType.SHORT:s=l.getInt16(n,!0);break;case bx.ComponentType.BYTE:s=l.getInt8(n);break;default:throw new Error(`Unexpected componentType "${t.componentType}".`)}h[e*r+i]=s}return h}(t,e);const a=i.byteOffset+(t.byteOffset||0);return new s(i.buffer.slice(a,a+t.count*r*o))}var Yx;!function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(Yx||(Yx={}));class Kx{constructor(t,e,i){this.C=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.F=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.C=t,this.jsonDoc=e,this.options=i;const n=t.getRoot(),s=n.listBuffers().length,r=n.listTextures().length;this.bufferURIGenerator=new Zx(s>1,(()=>i.basename||"buffer")),this.imageURIGenerator=new Zx(r>1,(e=>function(t,e){const i=t.getGraph().listParentEdges(e).find((e=>e.getParent()!==t.getRoot()));return i?i.getName().replace(/texture$/i,""):""}(t,e)||i.basename||"texture")),this.logger=t.getLogger()}createTextureInfoDef(t,e){const i={magFilter:e.getMagFilter()||void 0,minFilter:e.getMinFilter()||void 0,wrapS:e.getWrapS(),wrapT:e.getWrapT()},n=JSON.stringify(i);this.samplerDefIndexMap.has(n)||(this.samplerDefIndexMap.set(n,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(i));const s={source:this.imageIndexMap.get(t),sampler:this.samplerDefIndexMap.get(n)},r=JSON.stringify(s);this.textureDefIndexMap.has(r)||(this.textureDefIndexMap.set(r,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(s));const o={index:this.textureDefIndexMap.get(r)};return 0!==e.getTexCoord()&&(o.texCoord=e.getTexCoord()),Object.keys(e.getExtras()).length>0&&(o.extras=e.getExtras()),this.textureInfoDefMap.set(e,o),o}createPropertyDef(t){const e={};return t.getName()&&(e.name=t.getName()),Object.keys(t.getExtras()).length>0&&(e.extras=t.getExtras()),e}createAccessorDef(t){const e=this.createPropertyDef(t);return e.type=t.getType(),e.componentType=t.getComponentType(),e.count=t.getCount(),this.C.getGraph().listParentEdges(t).some((t=>"attributes"===t.getName()&&"POSITION"===t.getAttributes().key||"input"===t.getName()))&&(e.max=t.getMax([]).map(Math.fround),e.min=t.getMin([]).map(Math.fround)),t.getNormalized()&&(e.normalized=t.getNormalized()),e}createImageData(t,e,i){if(this.options.format===Uy.GLB)this.imageBufferViews.push(e),t.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:e.byteLength});else{const n=Zy.mimeTypeToExtension(i.getMimeType());t.uri=this.imageURIGenerator.createURI(i,n),this.jsonDoc.resources[t.uri]=e}}getAccessorUsage(t){const e=this.F.get(t);if(e)return e;if(t.getSparse())return By.SPARSE;for(const e of this.C.getGraph().listParentEdges(t)){const{usage:t}=e.getAttributes();if(t)return t;e.getParent().propertyType!==Oy.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${e.getName()}".`)}return By.OTHER}addAccessorToUsageGroup(t,e){const i=this.F.get(t);if(i&&i!==e)throw new Error(`Accessor with usage "${i}" cannot be reused as "${e}".`);return this.F.set(t,e),this}listAccessorUsageGroups(){const t={};for(const[e,i]of Array.from(this.F.entries()))t[i]=t[i]||[],t[i].push(e);return t}}Kx.BufferViewTarget=Yx,Kx.BufferViewUsage=By,Kx.USAGE_TO_TARGET={[By.ARRAY_BUFFER]:Yx.ARRAY_BUFFER,[By.ELEMENT_ARRAY_BUFFER]:Yx.ELEMENT_ARRAY_BUFFER};class Zx{constructor(t,e){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=t,this.basename=e}createURI(t,e){if(t.getURI())return t.getURI();if(this.multiple){const i=this.basename(t);return this.counter[i]=this.counter[i]||1,`${i}_${this.counter[i]++}.${e}`}return`${this.basename(t)}.${e}`}}const{BufferViewUsage:Jx}=Kx,{UNSIGNED_INT:Qx,UNSIGNED_SHORT:t_,UNSIGNED_BYTE:e_}=bx.ComponentType;class i_{static write(t,e){const i=t.getRoot(),n={asset:zx({generator:`glTF-Transform ${Dy}`},i.getAsset()),extras:zx({},i.getExtras())},s={json:n,resources:{}},r=new Kx(t,s,e),o=e.logger||sx.DEFAULT_INSTANCE,a=new Set(e.extensions.map((t=>t.EXTENSION_NAME))),h=t.getRoot().listExtensionsUsed().filter((t=>a.has(t.extensionName))),l=t.getRoot().listExtensionsRequired().filter((t=>a.has(t.extensionName)));h.length<t.getRoot().listExtensionsUsed().length&&o.warn("Some extensions were not registered for I/O, and will not be written.");for(const t of h)for(const i of t.writeDependencies)t.install(i,e.dependencies[i]);function c(t,e,i,s){const o=[];let a=0;for(const e of t){const t=r.createAccessorDef(e);t.bufferView=n.bufferViews.length;const i=e.getArray(),s=qy.pad(qy.toView(i));t.byteOffset=a,a+=s.byteLength,o.push(s),r.accessorIndexMap.set(e,n.accessors.length),n.accessors.push(t)}const h={buffer:e,byteOffset:i,byteLength:qy.concat(o).byteLength};return s&&(h.target=s),n.bufferViews.push(h),{buffers:o,byteLength:a}}function u(t,e,i){const s=t[0].getCount();let o=0;for(const e of t){const t=r.createAccessorDef(e);t.bufferView=n.bufferViews.length,t.byteOffset=o;const i=e.getElementSize(),s=e.getComponentSize();o+=qy.padNumber(i*s),r.accessorIndexMap.set(e,n.accessors.length),n.accessors.push(t)}const a=s*o,h=new ArrayBuffer(a),l=new DataView(h);for(let e=0;e<s;e++){let i=0;for(const n of t){const t=n.getElementSize(),s=n.getComponentSize(),r=n.getComponentType(),a=n.getArray();for(let n=0;n<t;n++){const h=e*o+i+n*s,c=a[e*t+n];switch(r){case bx.ComponentType.FLOAT:l.setFloat32(h,c,!0);break;case bx.ComponentType.BYTE:l.setInt8(h,c);break;case bx.ComponentType.SHORT:l.setInt16(h,c,!0);break;case bx.ComponentType.UNSIGNED_BYTE:l.setUint8(h,c);break;case bx.ComponentType.UNSIGNED_SHORT:l.setUint16(h,c,!0);break;case bx.ComponentType.UNSIGNED_INT:l.setUint32(h,c,!0);break;default:throw new Error("Unexpected component type: "+r)}}i+=qy.padNumber(t*s)}}return n.bufferViews.push({buffer:e,byteOffset:i,byteLength:a,byteStride:o,target:Kx.BufferViewTarget.ARRAY_BUFFER}),{byteLength:a,buffers:[new Uint8Array(h)]}}function d(t,e,i){const s=[];let a=0;const h=new Map;let l=-1/0;for(const e of t){const t=r.createAccessorDef(e);n.accessors.push(t),r.accessorIndexMap.set(e,n.accessors.length-1);const i=[],s=[],a=[],c=new Array(e.getElementSize()).fill(0);for(let t=0,n=e.getCount();t<n;t++)if(e.getElement(t,a),!ox.eq(a,c,0)){l=Math.max(t,l),i.push(t);for(let t=0;t<a.length;t++)s.push(a[t])}const u=i.length,d={accessorDef:t,count:u};if(h.set(e,d),0===u)continue;if(u>e.getCount()/3){const t=(100*i.length/e.getCount()).toFixed(1);o.warn(`Sparse accessor with many non-zero elements (${t}%) may increase file size.`)}const p=Fy[e.getComponentType()];d.indices=i,d.values=new p(s)}if(!Number.isFinite(l))return{buffers:s,byteLength:a};const c=l<255?Uint8Array:l<65535?Uint16Array:Uint32Array,u=l<255?e_:l<65535?t_:Qx,d={buffer:e,byteOffset:i+a,byteLength:0};for(const e of t){const t=h.get(e);if(0===t.count)continue;t.indicesByteOffset=d.byteLength;const i=qy.pad(qy.toView(new c(t.indices)));s.push(i),a+=i.byteLength,d.byteLength+=i.byteLength}n.bufferViews.push(d);const p=n.bufferViews.length-1,m={buffer:e,byteOffset:i+a,byteLength:0};for(const e of t){const t=h.get(e);if(0===t.count)continue;t.valuesByteOffset=m.byteLength;const i=qy.pad(qy.toView(t.values));s.push(i),a+=i.byteLength,m.byteLength+=i.byteLength}n.bufferViews.push(m);const f=n.bufferViews.length-1;for(const e of t){const t=h.get(e);0!==t.count&&(t.accessorDef.sparse={count:t.count,indices:{bufferView:p,byteOffset:t.indicesByteOffset,componentType:u},values:{bufferView:f,byteOffset:t.valuesByteOffset}})}return{buffers:s,byteLength:a}}const p=new Map;for(const e of t.getGraph().listEdges()){if(e.getParent()===i)continue;const t=e.getChild();if(t instanceof bx){const i=p.get(t)||[];i.push(e),p.set(t,i)}}if(n.accessors=[],n.bufferViews=[],n.samplers=[],n.textures=[],n.images=i.listTextures().map(((t,e)=>{const i=r.createPropertyDef(t);t.getMimeType()&&(i.mimeType=t.getMimeType());const n=t.getImage();return n&&r.createImageData(i,n,t),r.imageIndexMap.set(t,e),i})),h.filter((t=>t.prewriteTypes.includes(Oy.ACCESSOR))).forEach((t=>t.prewrite(r,Oy.ACCESSOR))),i.listAccessors().forEach((t=>{const e=r.accessorUsageGroupedByParent,i=r.accessorParents;if(r.accessorIndexMap.has(t))return;const n=p.get(t)||[],s=r.getAccessorUsage(t);if(r.addAccessorToUsageGroup(t,s),e.has(s)){const e=n[0].getParent(),s=i.get(e)||new Set;s.add(t),i.set(e,s)}})),h.filter((t=>t.prewriteTypes.includes(Oy.BUFFER))).forEach((t=>t.prewrite(r,Oy.BUFFER))),(i.listAccessors().length>0||i.listTextures().length>0||r.otherBufferViews.size>0)&&0===i.listBuffers().length)throw new Error("Buffer required for Document resources, but none was found.");n.buffers=[],i.listBuffers().forEach(((t,i)=>{const o=r.createPropertyDef(t),a=r.accessorUsageGroupedByParent,h=r.accessorParents,l=t.listParents().filter((t=>t instanceof bx)),p=new Set(l),m=[],f=n.buffers.length;let g=0;const v=r.listAccessorUsageGroups();for(const t in v)if(a.has(t))for(const i of Array.from(h.values())){const n=Array.from(i).filter((t=>p.has(t))).filter((e=>r.getAccessorUsage(e)===t));if(n.length)if(t!==Jx.ARRAY_BUFFER||e.vertexLayout===Ny.INTERLEAVED){const e=t===Jx.ARRAY_BUFFER?u(n,f,g):c(n,f,g);g+=e.byteLength,m.push(...e.buffers)}else for(const t of n){const e=u([t],f,g);g+=e.byteLength,m.push(...e.buffers)}}else{const e=v[t].filter((t=>p.has(t)));if(!e.length)continue;const i=t===Jx.ELEMENT_ARRAY_BUFFER?Kx.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,n=t===Jx.SPARSE?d(e,f,g):c(e,f,g,i);g+=n.byteLength,m.push(...n.buffers)}if(r.imageBufferViews.length&&0===i)for(let t=0;t<r.imageBufferViews.length;t++)if(n.bufferViews[n.images[t].bufferView].byteOffset=g,g+=r.imageBufferViews[t].byteLength,m.push(r.imageBufferViews[t]),g%8){const t=8-g%8;g+=t,m.push(new Uint8Array(t))}if(r.otherBufferViews.has(t))for(const e of r.otherBufferViews.get(t))n.bufferViews.push({buffer:f,byteOffset:g,byteLength:e.byteLength}),r.otherBufferViewsIndexMap.set(e,n.bufferViews.length-1),g+=e.byteLength,m.push(e);if(g){let i;e.format===Uy.GLB?i=Ly:(i=r.bufferURIGenerator.createURI(t,"bin"),o.uri=i),o.byteLength=g,s.resources[i]=qy.concat(m)}n.buffers.push(o),r.bufferIndexMap.set(t,i)})),i.listAccessors().find((t=>!t.getBuffer()))&&o.warn("Skipped writing one or more Accessors: no Buffer assigned."),n.materials=i.listMaterials().map(((t,e)=>{const i=r.createPropertyDef(t);if(t.getAlphaMode()!==Dx.AlphaMode.OPAQUE&&(i.alphaMode=t.getAlphaMode()),t.getAlphaMode()===Dx.AlphaMode.MASK&&(i.alphaCutoff=t.getAlphaCutoff()),t.getDoubleSided()&&(i.doubleSided=!0),i.pbrMetallicRoughness={},ox.eq(t.getBaseColorFactor(),[1,1,1,1])||(i.pbrMetallicRoughness.baseColorFactor=t.getBaseColorFactor()),ox.eq(t.getEmissiveFactor(),[0,0,0])||(i.emissiveFactor=t.getEmissiveFactor()),1!==t.getRoughnessFactor()&&(i.pbrMetallicRoughness.roughnessFactor=t.getRoughnessFactor()),1!==t.getMetallicFactor()&&(i.pbrMetallicRoughness.metallicFactor=t.getMetallicFactor()),t.getBaseColorTexture()){const e=t.getBaseColorTexture(),n=t.getBaseColorTextureInfo();i.pbrMetallicRoughness.baseColorTexture=r.createTextureInfoDef(e,n)}if(t.getEmissiveTexture()){const e=t.getEmissiveTexture(),n=t.getEmissiveTextureInfo();i.emissiveTexture=r.createTextureInfoDef(e,n)}if(t.getNormalTexture()){const e=t.getNormalTexture(),n=t.getNormalTextureInfo(),s=r.createTextureInfoDef(e,n);1!==t.getNormalScale()&&(s.scale=t.getNormalScale()),i.normalTexture=s}if(t.getOcclusionTexture()){const e=t.getOcclusionTexture(),n=t.getOcclusionTextureInfo(),s=r.createTextureInfoDef(e,n);1!==t.getOcclusionStrength()&&(s.strength=t.getOcclusionStrength()),i.occlusionTexture=s}if(t.getMetallicRoughnessTexture()){const e=t.getMetallicRoughnessTexture(),n=t.getMetallicRoughnessTextureInfo();i.pbrMetallicRoughness.metallicRoughnessTexture=r.createTextureInfoDef(e,n)}return r.materialIndexMap.set(t,e),i})),n.meshes=i.listMeshes().map(((t,e)=>{const i=r.createPropertyDef(t);let n=null;return i.primitives=t.listPrimitives().map((t=>{const e={attributes:{}};e.mode=t.getMode();const i=t.getMaterial();i&&(e.material=r.materialIndexMap.get(i)),Object.keys(t.getExtras()).length&&(e.extras=t.getExtras());const s=t.getIndices();s&&(e.indices=r.accessorIndexMap.get(s));for(const i of t.listSemantics())e.attributes[i]=r.accessorIndexMap.get(t.getAttribute(i));for(const i of t.listTargets()){const t={};for(const e of i.listSemantics())t[e]=r.accessorIndexMap.get(i.getAttribute(e));e.targets=e.targets||[],e.targets.push(t)}return t.listTargets().length&&!n&&(n=t.listTargets().map((t=>t.getName()))),e})),t.getWeights().length&&(i.weights=t.getWeights()),n&&(i.extras=i.extras||{},i.extras.targetNames=n),r.meshIndexMap.set(t,e),i})),n.cameras=i.listCameras().map(((t,e)=>{const i=r.createPropertyDef(t);if(i.type=t.getType(),i.type===Ex.Type.PERSPECTIVE){i.perspective={znear:t.getZNear(),zfar:t.getZFar(),yfov:t.getYFov()};const e=t.getAspectRatio();null!==e&&(i.perspective.aspectRatio=e)}else i.orthographic={znear:t.getZNear(),zfar:t.getZFar(),xmag:t.getXMag(),ymag:t.getYMag()};return r.cameraIndexMap.set(t,e),i})),n.nodes=i.listNodes().map(((t,e)=>{const i=r.createPropertyDef(t);return ox.eq(t.getTranslation(),[0,0,0])||(i.translation=t.getTranslation()),ox.eq(t.getRotation(),[0,0,0,1])||(i.rotation=t.getRotation()),ox.eq(t.getScale(),[1,1,1])||(i.scale=t.getScale()),t.getWeights().length&&(i.weights=t.getWeights()),r.nodeIndexMap.set(t,e),i})),n.skins=i.listSkins().map(((t,e)=>{const i=r.createPropertyDef(t),n=t.getInverseBindMatrices();n&&(i.inverseBindMatrices=r.accessorIndexMap.get(n));const s=t.getSkeleton();return s&&(i.skeleton=r.nodeIndexMap.get(s)),i.joints=t.listJoints().map((t=>r.nodeIndexMap.get(t))),r.skinIndexMap.set(t,e),i})),i.listNodes().forEach(((t,e)=>{const i=n.nodes[e],s=t.getMesh();s&&(i.mesh=r.meshIndexMap.get(s));const o=t.getCamera();o&&(i.camera=r.cameraIndexMap.get(o));const a=t.getSkin();a&&(i.skin=r.skinIndexMap.get(a)),t.listChildren().length>0&&(i.children=t.listChildren().map((t=>r.nodeIndexMap.get(t))))})),n.animations=i.listAnimations().map(((t,e)=>{const i=r.createPropertyDef(t),n=new Map;return i.samplers=t.listSamplers().map(((t,e)=>{const i=r.createPropertyDef(t);return i.input=r.accessorIndexMap.get(t.getInput()),i.output=r.accessorIndexMap.get(t.getOutput()),i.interpolation=t.getInterpolation(),n.set(t,e),i})),i.channels=t.listChannels().map((t=>{const e=r.createPropertyDef(t);return e.sampler=n.get(t.getSampler()),e.target={node:r.nodeIndexMap.get(t.getTargetNode()),path:t.getTargetPath()},e})),r.animationIndexMap.set(t,e),i})),n.scenes=i.listScenes().map(((t,e)=>{const i=r.createPropertyDef(t);return i.nodes=t.listChildren().map((t=>r.nodeIndexMap.get(t))),r.sceneIndexMap.set(t,e),i}));const m=i.getDefaultScene();return m&&(n.scene=i.listScenes().indexOf(m)),n.extensionsUsed=h.map((t=>t.extensionName)),n.extensionsRequired=l.map((t=>t.extensionName)),h.forEach((t=>t.write(r))),function(t){const e=[];for(const i in t){const n=t[i];(Array.isArray(n)&&0===n.length||null===n||""===n||n&&"object"==typeof n&&0===Object.keys(n).length)&&e.push(i)}for(const i of e)delete t[i]}(n),s}}var n_;!function(t){t[t.JSON=1313821514]="JSON",t[t.BIN=5130562]="BIN"}(n_||(n_={}));class s_{constructor(){this.M=sx.DEFAULT_INSTANCE,this.l=new Set,this.U={},this.P=Ny.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(t){return this.M=t,this}registerExtensions(t){for(const e of t)this.l.add(e),e.register();return this}registerDependencies(t){return Object.assign(this.U,t),this}setVertexLayout(t){return this.P=t,this}async read(t){return await this.readJSON(await this.readAsJSON(t))}async readAsJSON(t){const e=await this.readURI(t,"view");this.lastReadBytes=e.byteLength;const i=r_(e)?this.L(e):{json:JSON.parse(qy.decodeText(e)),resources:{}};return await this.j(i,this.dirname(t)),this.D(i),i}async readJSON(t){return t=this._(t),this.D(t),$x.read(t,{extensions:Array.from(this.l),dependencies:this.U,logger:this.M})}async binaryToJSON(t){const e=this.L(qy.assertView(t));this.D(e);const i=e.json;if(i.buffers&&i.buffers.some((t=>function(t,e){return void 0!==e.uri&&!(e.uri in t.resources)}(e,t))))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(i.images&&i.images.some((t=>function(t,e){return void 0!==e.uri&&!(e.uri in t.resources)&&void 0===e.bufferView}(e,t))))throw new Error("Cannot resolve external images with binaryToJSON().");return e}async readBinary(t){return this.readJSON(await this.binaryToJSON(qy.assertView(t)))}async writeJSON(t,e={}){if(e.format===Uy.GLB&&t.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return i_.write(t,{format:e.format||Uy.GLTF,basename:e.basename||"",logger:this.M,vertexLayout:this.P,dependencies:zx({},this.U),extensions:Array.from(this.l)})}async writeBinary(t){const{json:e,resources:i}=await this.writeJSON(t,{format:Uy.GLB}),n=new Uint32Array([1179937895,2,12]),s=JSON.stringify(e),r=qy.pad(qy.encodeText(s),32),o=qy.toView(new Uint32Array([r.byteLength,1313821514])),a=qy.concat([o,r]);n[n.length-1]+=a.byteLength;const h=Object.values(i)[0];if(!h||!h.byteLength)return qy.concat([qy.toView(n),a]);const l=qy.pad(h,0),c=qy.toView(new Uint32Array([l.byteLength,5130562])),u=qy.concat([c,l]);return n[n.length-1]+=u.byteLength,qy.concat([qy.toView(n),a,u])}async j(t,e){var i=this;const n=[...t.json.images||[],...t.json.buffers||[]].map((async function(n){const s=n.uri;if(!s||s.match(/data:/))return Promise.resolve();t.resources[s]=await i.readURI(i.resolve(e,s),"view"),i.lastReadBytes+=t.resources[s].byteLength}));await Promise.all(n)}D(t){function e(e){if(e.uri)if(e.uri in t.resources)qy.assertView(t.resources[e.uri]);else if(e.uri.match(/data:/)){const i=`__${function(){for(let t=0;t<999;t++){const t=mx();if(!px.has(t))return px.add(t),t}return""}()}.${Qy.extension(e.uri)}`;t.resources[i]=qy.createBufferFromDataURI(e.uri),e.uri=i}}(t.json.images||[]).forEach((t=>{if(void 0===t.bufferView&&void 0===t.uri)throw new Error("Missing resource URI or buffer view.");e(t)})),(t.json.buffers||[]).forEach(e)}_(t){const{images:e,buffers:i}=t.json;return t={json:zx({},t.json),resources:zx({},t.resources)},e&&(t.json.images=e.map((t=>zx({},t)))),i&&(t.json.buffers=i.map((t=>zx({},t)))),t}L(t){if(!r_(t))throw new Error("Invalid glTF 2.0 binary.");const e=new Uint32Array(t.buffer,t.byteOffset+12,2);if(e[1]!==n_.JSON)throw new Error("Missing required GLB JSON chunk.");const i=e[0],n=qy.decodeText(qy.toView(t,20,i)),s=JSON.parse(n),r=20+i;if(t.byteLength<=r)return{json:s,resources:{}};const o=new Uint32Array(t.buffer,t.byteOffset+r,2);if(o[1]!==n_.BIN)throw new Error("Expected GLB BIN in second chunk.");const a=qy.toView(t,r+8,o[0]);return{json:s,resources:{[Ly]:a}}}}function r_(t){if(t.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(t.buffer,t.byteOffset,3);return 1179937895===e[0]&&2===e[1]}class o_ extends s_{constructor(t=gx.DEFAULT_INIT){super(),this.J=void 0,this.J=t}async readURI(t,e){const i=await fetch(t,this.J);switch(e){case"view":return new Uint8Array(await i.arrayBuffer());case"text":return i.text()}}resolve(t,e){return gx.resolve(t,e)}dirname(t){return gx.dirname(t)}}class a_{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class h_{constructor(t,e,i,n){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(t.buffer,t.byteOffset+e,i),this._littleEndian=n,this._offset=0}_nextUint8(){const t=this._dataView.getUint8(this._offset);return this._offset+=1,t}_nextUint16(){const t=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,t}_nextUint32(){const t=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,t}_nextUint64(){const t=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,t}_nextInt32(){const t=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,t}_nextUint8Array(t){const e=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,t);return this._offset+=t,e}_skip(t){return this._offset+=t,this}_scan(t,e=0){const i=this._offset;let n=0;for(;this._dataView.getUint8(this._offset)!==e&&n<t;)n++,this._offset++;return n<t&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,n)}}new Uint8Array([0]);const l_=[171,75,84,88,32,50,48,187,13,10,26,10];function c_(t){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(t):Buffer.from(t).toString("utf8")}function u_(t){const e=new Uint8Array(t.buffer,t.byteOffset,l_.length);if(e[0]!==l_[0]||e[1]!==l_[1]||e[2]!==l_[2]||e[3]!==l_[3]||e[4]!==l_[4]||e[5]!==l_[5]||e[6]!==l_[6]||e[7]!==l_[7]||e[8]!==l_[8]||e[9]!==l_[9]||e[10]!==l_[10]||e[11]!==l_[11])throw new Error("Missing KTX 2.0 identifier.");const i=new a_,n=17*Uint32Array.BYTES_PER_ELEMENT,s=new h_(t,l_.length,n,!0);i.vkFormat=s._nextUint32(),i.typeSize=s._nextUint32(),i.pixelWidth=s._nextUint32(),i.pixelHeight=s._nextUint32(),i.pixelDepth=s._nextUint32(),i.layerCount=s._nextUint32(),i.faceCount=s._nextUint32();const r=s._nextUint32();i.supercompressionScheme=s._nextUint32();const o=s._nextUint32(),a=s._nextUint32(),h=s._nextUint32(),l=s._nextUint32(),c=s._nextUint64(),u=s._nextUint64(),d=new h_(t,l_.length+n,3*r*8,!0);for(let e=0;e<r;e++)i.levels.push({levelData:new Uint8Array(t.buffer,t.byteOffset+d._nextUint64(),d._nextUint64()),uncompressedByteLength:d._nextUint64()});const p=new h_(t,o,a,!0),m={vendorId:p._skip(4)._nextUint16(),descriptorType:p._nextUint16(),versionNumber:p._nextUint16(),descriptorBlockSize:p._nextUint16(),colorModel:p._nextUint8(),colorPrimaries:p._nextUint8(),transferFunction:p._nextUint8(),flags:p._nextUint8(),texelBlockDimension:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],bytesPlane:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],samples:[]},f=(m.descriptorBlockSize/4-6)/4;for(let t=0;t<f;t++){const e={bitOffset:p._nextUint16(),bitLength:p._nextUint8(),channelType:p._nextUint8(),samplePosition:[p._nextUint8(),p._nextUint8(),p._nextUint8(),p._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&e.channelType?(e.sampleLower=p._nextInt32(),e.sampleUpper=p._nextInt32()):(e.sampleLower=p._nextUint32(),e.sampleUpper=p._nextUint32()),m.samples[t]=e}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(m);const g=new h_(t,h,l,!0);for(;g._offset<l;){const t=g._nextUint32(),e=g._scan(t),n=c_(e);if(i.keyValue[n]=g._nextUint8Array(t-e.byteLength-1),n.match(/^ktx/i)){const t=c_(i.keyValue[n]);i.keyValue[n]=t.substring(0,t.lastIndexOf("\0"))}const s=t%4?4-t%4:0;g._skip(s)}if(u<=0)return i;const v=new h_(t,c,u,!0),y=v._nextUint16(),x=v._nextUint16(),_=v._nextUint32(),b=v._nextUint32(),w=v._nextUint32(),M=v._nextUint32(),S=[];for(let t=0;t<r;t++)S.push({imageFlags:v._nextUint32(),rgbSliceByteOffset:v._nextUint32(),rgbSliceByteLength:v._nextUint32(),alphaSliceByteOffset:v._nextUint32(),alphaSliceByteLength:v._nextUint32()});const T=c+v._offset,E=T+_,A=E+b,C=A+w,I=new Uint8Array(t.buffer,t.byteOffset+T,_),R=new Uint8Array(t.buffer,t.byteOffset+E,b),P=new Uint8Array(t.buffer,t.byteOffset+A,w),k=new Uint8Array(t.buffer,t.byteOffset+C,M);return i.globalData={endpointCount:y,selectorCount:x,imageDescs:S,endpointsData:I,selectorsData:R,tablesData:P,extendedData:k},i}const d_="EXT_mesh_gpu_instancing",p_="EXT_meshopt_compression",m_="KHR_draco_mesh_compression",f_="KHR_lights_punctual",g_="KHR_materials_anisotropy",v_="KHR_materials_clearcoat",y_="KHR_materials_emissive_strength",x_="KHR_materials_ior",__="KHR_materials_iridescence",b_="KHR_materials_pbrSpecularGlossiness",w_="KHR_materials_sheen",M_="KHR_materials_specular",S_="KHR_materials_transmission",T_="KHR_materials_unlit",E_="KHR_materials_volume",A_="KHR_materials_variants",C_="KHR_texture_transform",I_="KHR_xmp_json_ld",R_="INSTANCE_ATTRIBUTE";class P_ extends Ax{init(){this.extensionName=d_,this.propertyType="InstancedMesh",this.parentTypes=[Oy.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(t){return this.getRefMap("attributes",t)}setAttribute(t,e){return this.setRefMap("attributes",t,e,{usage:R_})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}P_.EXTENSION_NAME=d_;const k_=d_;class D_ extends jx{constructor(...t){super(...t),this.extensionName=k_,this.provideTypes=[Oy.NODE],this.prewriteTypes=[Oy.ACCESSOR]}createInstancedMesh(){return new P_(this.document.getGraph())}read(t){return(t.jsonDoc.json.nodes||[]).forEach(((e,i)=>{if(!e.extensions||!e.extensions[k_])return;const n=e.extensions[k_],s=this.createInstancedMesh();for(const e in n.attributes)s.setAttribute(e,t.accessors[n.attributes[e]]);t.nodes[i].setExtension(k_,s)})),this}prewrite(t){t.accessorUsageGroupedByParent.add(R_);for(const e of this.properties)for(const i of e.listAttributes())t.addAccessorToUsageGroup(i,R_);return this}write(t){const e=t.jsonDoc;return this.document.getRoot().listNodes().forEach((i=>{const n=i.getExtension(k_);if(n){const s=t.nodeIndexMap.get(i),r=e.json.nodes[s],o={attributes:{}};n.listSemantics().forEach((e=>{const i=n.getAttribute(e);o.attributes[e]=t.accessorIndexMap.get(i)})),r.extensions=r.extensions||{},r.extensions[k_]=o}})),this}}function L_(){return L_=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},L_.apply(this,arguments)}var O_,N_,B_;D_.EXTENSION_NAME=k_,function(t){t.QUANTIZE="quantize",t.FILTER="filter"}(O_||(O_={})),function(t){t.ATTRIBUTES="ATTRIBUTES",t.TRIANGLES="TRIANGLES",t.INDICES="INDICES"}(N_||(N_={})),function(t){t.NONE="NONE",t.OCTAHEDRAL="OCTAHEDRAL",t.QUATERNION="QUATERNION",t.EXPONENTIAL="EXPONENTIAL"}(B_||(B_={}));const{BYTE:z_,SHORT:U_,FLOAT:F_}=bx.ComponentType,{encodeNormalizedInt:G_,decodeNormalizedInt:H_}=ox;function V_(t,e,i,n){const{filter:s,bits:r}=n,o={array:t.getArray(),byteStride:t.getElementSize()*t.getComponentSize(),componentType:t.getComponentType(),normalized:t.getNormalized()};if(i!==N_.ATTRIBUTES)return o;if(s!==B_.NONE){let i=t.getNormalized()?function(t){const e=t.getComponentType(),i=t.getArray(),n=new Float32Array(i.length);for(let t=0;t<i.length;t++)n[t]=H_(i[t],e);return n}(t):new Float32Array(o.array);switch(s){case B_.EXPONENTIAL:o.byteStride=4*t.getElementSize(),o.componentType=F_,o.normalized=!1,o.array=e.encodeFilterExp(i,t.getCount(),o.byteStride,r);break;case B_.OCTAHEDRAL:o.byteStride=r>8?8:4,o.componentType=r>8?U_:z_,o.normalized=!0,i=3===t.getElementSize()?function(t){const e=new Float32Array(4*t.length/3);for(let i=0,n=t.length/3;i<n;i++)e[4*i]=t[3*i],e[4*i+1]=t[3*i+1],e[4*i+2]=t[3*i+2];return e}(i):i,o.array=e.encodeFilterOct(i,t.getCount(),o.byteStride,r);break;case B_.QUATERNION:o.byteStride=8,o.componentType=U_,o.normalized=!0,o.array=e.encodeFilterQuat(i,t.getCount(),o.byteStride,r);break;default:throw new Error("Invalid filter.")}o.min=t.getMin([]),o.max=t.getMax([]),t.getNormalized()&&(o.min=o.min.map((e=>H_(e,t.getComponentType()))),o.max=o.max.map((e=>H_(e,t.getComponentType())))),o.normalized&&(o.min=o.min.map((t=>G_(t,o.componentType))),o.max=o.max.map((t=>G_(t,o.componentType))))}else o.byteStride%4&&(o.array=function(t,e){const i=qy.padNumber(t.BYTES_PER_ELEMENT*e)/t.BYTES_PER_ELEMENT,n=new t.constructor(t.length/e*i);for(let s=0;s*e<t.length;s++)for(let r=0;r<e;r++)n[s*i+r]=t[s*e+r];return n}(o.array,t.getElementSize()),o.byteStride=o.array.byteLength/t.getCount());return o}function j_(t,e){return e===Kx.BufferViewUsage.ELEMENT_ARRAY_BUFFER?t.listParents().some((t=>t instanceof Nx&&t.getMode()===Nx.Mode.TRIANGLES))?N_.TRIANGLES:N_.INDICES:N_.ATTRIBUTES}function W_(t,e){const i=e.getGraph().listParentEdges(t).filter((t=>!(t.getParent()instanceof Hx)));for(const e of i){const i=e.getName(),n=e.getAttributes().key||"",s=e.getParent().propertyType===Oy.PRIMITIVE_TARGET;if("indices"===i)return{filter:B_.NONE};if("attributes"===i){if("POSITION"===n)return{filter:B_.NONE};if("TEXCOORD_0"===n)return{filter:B_.NONE};if(n.startsWith("JOINTS_"))return{filter:B_.NONE};if(n.startsWith("WEIGHTS_"))return{filter:B_.NONE};if("NORMAL"===n||"TANGENT"===n)return s?{filter:B_.NONE}:{filter:B_.OCTAHEDRAL,bits:8}}if("output"===i){const e=X_(t);return"rotation"===e?{filter:B_.QUATERNION,bits:16}:"translation"===e||"scale"===e?{filter:B_.EXPONENTIAL,bits:12}:{filter:B_.NONE}}if("input"===i)return{filter:B_.NONE};if("inverseBindMatrices"===i)return{filter:B_.NONE}}return{filter:B_.NONE}}function X_(t){for(const e of t.listParents())if(e instanceof Sx)for(const t of e.listParents())if(t instanceof Mx)return t.getTargetPath();return null}const $_=p_,q_={method:O_.QUANTIZE};class Y_ extends jx{constructor(...t){super(...t),this.extensionName=$_,this.prereadTypes=[Oy.BUFFER,Oy.PRIMITIVE],this.prewriteTypes=[Oy.BUFFER,Oy.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=q_,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(t,e){return"meshopt.decoder"===t&&(this._decoder=e),"meshopt.encoder"===t&&(this._encoder=e),this}setEncoderOptions(t){return this._encoderOptions=L_({},q_,t),this}preread(t,e){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${$_}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${$_}]: Missing WASM support.`)}return e===Oy.BUFFER?this._prereadBuffers(t):e===Oy.PRIMITIVE&&this._prereadPrimitives(t),this}_prereadBuffers(t){const e=t.jsonDoc;(e.json.bufferViews||[]).forEach(((i,n)=>{if(!i.extensions||!i.extensions[$_])return;const s=i.extensions[$_],r=s.byteOffset||0,o=s.byteLength||0,a=s.count,h=s.byteStride,l=new Uint8Array(a*h),c=e.json.buffers[s.buffer],u=qy.toView(c.uri?e.resources[c.uri]:e.resources[Ly],r,o);this._decoder.decodeGltfBuffer(l,a,h,u,s.mode,s.filter),t.bufferViews[n]=l}))}_prereadPrimitives(t){const e=t.jsonDoc;(e.json.bufferViews||[]).forEach((i=>{var n;i.extensions&&i.extensions[$_]&&(n=e.json.buffers[i.buffer]).extensions&&n.extensions[p_]&&n.extensions[p_].fallback&&this._decoderFallbackBufferMap.set(t.buffers[i.buffer],t.buffers[i.extensions[$_].buffer])}))}read(t){if(!this.isRequired())return this;for(const[t,e]of this._decoderFallbackBufferMap){for(const i of t.listParents())i instanceof bx&&i.swap(t,e);t.dispose()}return this}prewrite(t,e){return e===Oy.ACCESSOR?this._prewriteAccessors(t):e===Oy.BUFFER&&this._prewriteBuffers(t),this}_prewriteAccessors(t){const e=t.jsonDoc.json,i=this._encoder,n=this._encoderOptions,s=this.document.createBuffer(),r=this.document.getRoot().listBuffers().indexOf(s);this._encoderFallbackBuffer=s,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const s of this.document.getRoot().listAccessors()){if("weights"===X_(s))continue;if(s.getSparse())continue;const o=t.getAccessorUsage(s),a=j_(s,o),h=n.method===O_.FILTER?W_(s,this.document):{filter:B_.NONE},l=V_(s,i,a,h),{array:c,byteStride:u}=l,d=s.getBuffer();if(!d)throw new Error(`${$_}: Missing buffer for accessor.`);const p=this.document.getRoot().listBuffers().indexOf(d),m=[o,a,h.filter,u,p].join(":");let f=this._encoderBufferViews[m],g=this._encoderBufferViewData[m],v=this._encoderBufferViewAccessors[m];f&&g||(v=this._encoderBufferViewAccessors[m]=[],g=this._encoderBufferViewData[m]=[],f=this._encoderBufferViews[m]={buffer:r,target:Kx.USAGE_TO_TARGET[o],byteOffset:0,byteLength:0,byteStride:o===Kx.BufferViewUsage.ARRAY_BUFFER?u:void 0,extensions:{[$_]:{buffer:p,byteOffset:0,byteLength:0,mode:a,filter:h.filter!==B_.NONE?h.filter:void 0,byteStride:u,count:0}}});const y=t.createAccessorDef(s);y.componentType=l.componentType,y.normalized=l.normalized,y.byteOffset=f.byteLength,y.min&&l.min&&(y.min=l.min),y.max&&l.max&&(y.max=l.max),t.accessorIndexMap.set(s,e.accessors.length),e.accessors.push(y),v.push(y),g.push(new Uint8Array(c.buffer,c.byteOffset,c.byteLength)),f.byteLength+=c.byteLength,f.extensions.EXT_meshopt_compression.count+=s.getCount()}}_prewriteBuffers(t){const e=this._encoder;for(const i in this._encoderBufferViews){const n=this._encoderBufferViews[i],s=this._encoderBufferViewData[i],r=this.document.getRoot().listBuffers()[n.extensions[$_].buffer],o=t.otherBufferViews.get(r)||[],{count:a,byteStride:h,mode:l}=n.extensions[$_],c=qy.concat(s),u=e.encodeGltfBuffer(c,a,h,l),d=qy.pad(u);n.extensions[$_].byteLength=u.byteLength,s.length=0,s.push(d),o.push(d),t.otherBufferViews.set(r,o)}}write(t){let e=0;for(const i in this._encoderBufferViews){const n=this._encoderBufferViews[i],s=t.otherBufferViewsIndexMap.get(this._encoderBufferViewData[i][0]),r=this._encoderBufferViewAccessors[i];for(const t of r)t.bufferView=s;const o=t.jsonDoc.json.bufferViews[s],a=o.byteOffset||0;Object.assign(o,n),o.byteOffset=e,o.extensions[$_].byteOffset=a,e+=qy.padNumber(n.byteLength)}const i=this._encoderFallbackBuffer,n=t.bufferIndexMap.get(i),s=t.jsonDoc.json.buffers[n];return s.byteLength=e,s.extensions={[$_]:{fallback:!0}},i.dispose(),this}}Y_.EXTENSION_NAME=$_,Y_.EncoderMethod=O_;const K_="EXT_texture_avif";class Z_{match(t){return t.length>=12&&"ftypavif"===qy.decodeText(t.slice(4,12))}getSize(t){if(!this.match(t))return null;const e=new DataView(t.buffer,t.byteOffset,t.byteLength);let i=Q_(e,0);if(!i)return null;let n=i.end;for(;i=Q_(e,n);)if("meta"===i.type)n=i.start+4;else if("iprp"===i.type||"ipco"===i.type)n=i.start;else{if("ispe"===i.type)return[e.getUint32(i.start+4),e.getUint32(i.start+8)];if("mdat"===i.type)break;n=i.end}return null}getChannels(t){return 4}}class J_ extends jx{constructor(...t){super(...t),this.extensionName=K_,this.prereadTypes=[Oy.TEXTURE]}static register(){Zy.registerFormat("image/avif",new Z_)}preread(t){return(t.jsonDoc.json.textures||[]).forEach((t=>{t.extensions&&t.extensions[K_]&&(t.source=t.extensions[K_].source)})),this}read(t){return this}write(t){const e=t.jsonDoc;return this.document.getRoot().listTextures().forEach((i=>{if("image/avif"===i.getMimeType()){const n=t.imageIndexMap.get(i);(e.json.textures||[]).forEach((t=>{t.source===n&&(t.extensions=t.extensions||{},t.extensions[K_]={source:t.source},delete t.source)}))}})),this}}function Q_(t,e){if(t.byteLength<4+e)return null;const i=t.getUint32(e);return t.byteLength<i+e||i<8?null:{type:qy.decodeText(new Uint8Array(t.buffer,t.byteOffset+e+4,4)),start:e+8,end:e+i}}J_.EXTENSION_NAME=K_;const tb="EXT_texture_webp";class eb{match(t){return t.length>=12&&87===t[8]&&69===t[9]&&66===t[10]&&80===t[11]}getSize(t){const e=qy.decodeText(t.slice(0,4)),i=qy.decodeText(t.slice(8,12));if("RIFF"!==e||"WEBP"!==i)return null;const n=new DataView(t.buffer,t.byteOffset);let s=12;for(;s<n.byteLength;){const t=qy.decodeText(new Uint8Array([n.getUint8(s),n.getUint8(s+1),n.getUint8(s+2),n.getUint8(s+3)])),e=n.getUint32(s+4,!0);if("VP8 "===t)return[16383&n.getInt16(s+14,!0),16383&n.getInt16(s+16,!0)];if("VP8L"===t){const t=n.getUint8(s+9),e=n.getUint8(s+10),i=n.getUint8(s+11);return[1+((63&e)<<8|t),1+((15&n.getUint8(s+12))<<10|i<<2|(192&e)>>6)]}s+=8+e+e%2}return null}getChannels(t){return 4}}class ib extends jx{constructor(...t){super(...t),this.extensionName=tb,this.prereadTypes=[Oy.TEXTURE]}static register(){Zy.registerFormat("image/webp",new eb)}preread(t){return(t.jsonDoc.json.textures||[]).forEach((t=>{t.extensions&&t.extensions[tb]&&(t.source=t.extensions[tb].source)})),this}read(t){return this}write(t){const e=t.jsonDoc;return this.document.getRoot().listTextures().forEach((i=>{if("image/webp"===i.getMimeType()){const n=t.imageIndexMap.get(i);(e.json.textures||[]).forEach((t=>{t.source===n&&(t.extensions=t.extensions||{},t.extensions[tb]={source:t.source},delete t.source)}))}})),this}}ib.EXTENSION_NAME=tb;const nb=m_;let sb,rb,ob,ab;function hb(t,e){const i=new sb.DecoderBuffer;try{if(i.Init(e,e.length),t.GetEncodedGeometryType(i)!==sb.TRIANGULAR_MESH)throw new Error(`[${nb}] Unknown geometry type.`);const n=new sb.Mesh;if(!t.DecodeBufferToMesh(i,n).ok()||0===n.ptr)throw new Error(`[${nb}] Decoding failure.`);return n}finally{sb.destroy(i)}}function lb(t,e){const i=3*e.num_faces();let n,s;if(e.num_points()<=65534){const r=i*Uint16Array.BYTES_PER_ELEMENT;n=sb._malloc(r),t.GetTrianglesUInt16Array(e,r,n),s=new Uint16Array(sb.HEAPU16.buffer,n,i).slice()}else{const r=i*Uint32Array.BYTES_PER_ELEMENT;n=sb._malloc(r),t.GetTrianglesUInt32Array(e,r,n),s=new Uint32Array(sb.HEAPU32.buffer,n,i).slice()}return sb._free(n),s}function cb(t,e,i,n){const s=ob[n.componentType],r=rb[n.componentType],o=i.num_components(),a=e.num_points()*o,h=a*r.BYTES_PER_ELEMENT,l=sb._malloc(h);t.GetAttributeDataArrayForAllPoints(e,i,s,h,l);const c=new r(sb.HEAPF32.buffer,l,a).slice();return sb._free(l),c}var ub,db;!function(t){t[t.EDGEBREAKER=1]="EDGEBREAKER",t[t.SEQUENTIAL=0]="SEQUENTIAL"}(ub||(ub={})),function(t){t.POSITION="POSITION",t.NORMAL="NORMAL",t.COLOR="COLOR",t.TEX_COORD="TEX_COORD",t.GENERIC="GENERIC"}(db||(db={}));const pb={[db.POSITION]:14,[db.NORMAL]:10,[db.COLOR]:8,[db.TEX_COORD]:12,[db.GENERIC]:12},mb={decodeSpeed:5,encodeSpeed:5,method:ub.EDGEBREAKER,quantizationBits:pb,quantizationVolume:"mesh"};function fb(t,e=mb){const i=L_({},mb,e);i.quantizationBits=L_({},pb,e.quantizationBits);const n=new ab.MeshBuilder,s=new ab.Mesh,r=new ab.ExpertEncoder(s),o={},a=new ab.DracoInt8Array,h=t.listTargets().length>0;let l=!1;for(const e of t.listSemantics()){const a=t.getAttribute(e);if(a.getSparse()){l=!0;continue}const h=gb(e),c=vb(n,a.getComponentType(),s,ab[h],a.getCount(),a.getElementSize(),a.getArray());if(-1===c)throw new Error(`Error compressing "${e}" attribute.`);if(o[e]=c,"mesh"===i.quantizationVolume||"POSITION"!==e)r.SetAttributeQuantization(c,i.quantizationBits[h]);else{if("object"!=typeof i.quantizationVolume)throw new Error("Invalid quantization volume state.");{const{quantizationVolume:t}=i,e=Math.max(t.max[0]-t.min[0],t.max[1]-t.min[1],t.max[2]-t.min[2]);r.SetAttributeExplicitQuantization(c,i.quantizationBits[h],a.getElementSize(),t.min,e)}}}const c=t.getIndices();if(!c)throw new yb("Primitive must have indices.");n.AddFacesToMesh(s,c.getCount()/3,c.getArray()),r.SetSpeedOptions(i.encodeSpeed,i.decodeSpeed),r.SetTrackEncodedProperties(!0),r.SetEncodingMethod(i.method===ub.SEQUENTIAL||h||l?ab.MESH_SEQUENTIAL_ENCODING:ab.MESH_EDGEBREAKER_ENCODING);const u=r.EncodeToDracoBuffer(!(h||l),a);if(u<=0)throw new yb("Error applying Draco compression.");const d=new Uint8Array(u);for(let t=0;t<u;++t)d[t]=a.GetValue(t);const p=r.GetNumberOfEncodedPoints(),m=3*r.GetNumberOfEncodedFaces();return ab.destroy(a),ab.destroy(s),ab.destroy(n),ab.destroy(r),{numVertices:p,numIndices:m,data:d,attributeIDs:o}}function gb(t){return"POSITION"===t?db.POSITION:"NORMAL"===t?db.NORMAL:t.startsWith("COLOR_")?db.COLOR:t.startsWith("TEXCOORD_")?db.TEX_COORD:db.GENERIC}function vb(t,e,i,n,s,r,o){switch(e){case bx.ComponentType.UNSIGNED_BYTE:return t.AddUInt8Attribute(i,n,s,r,o);case bx.ComponentType.BYTE:return t.AddInt8Attribute(i,n,s,r,o);case bx.ComponentType.UNSIGNED_SHORT:return t.AddUInt16Attribute(i,n,s,r,o);case bx.ComponentType.SHORT:return t.AddInt16Attribute(i,n,s,r,o);case bx.ComponentType.UNSIGNED_INT:return t.AddUInt32Attribute(i,n,s,r,o);case bx.ComponentType.FLOAT:return t.AddFloatAttribute(i,n,s,r,o);default:throw new Error(`Unexpected component type, "${e}".`)}}class yb extends Error{}const xb=m_;class _b extends jx{constructor(...t){super(...t),this.extensionName=xb,this.prereadTypes=[Oy.PRIMITIVE],this.prewriteTypes=[Oy.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(t,e){return"draco3d.decoder"===t&&(this._decoderModule=e,sb=this._decoderModule,rb={[bx.ComponentType.FLOAT]:Float32Array,[bx.ComponentType.UNSIGNED_INT]:Uint32Array,[bx.ComponentType.UNSIGNED_SHORT]:Uint16Array,[bx.ComponentType.UNSIGNED_BYTE]:Uint8Array,[bx.ComponentType.SHORT]:Int16Array,[bx.ComponentType.BYTE]:Int8Array},ob={[bx.ComponentType.FLOAT]:sb.DT_FLOAT32,[bx.ComponentType.UNSIGNED_INT]:sb.DT_UINT32,[bx.ComponentType.UNSIGNED_SHORT]:sb.DT_UINT16,[bx.ComponentType.UNSIGNED_BYTE]:sb.DT_UINT8,[bx.ComponentType.SHORT]:sb.DT_INT16,[bx.ComponentType.BYTE]:sb.DT_INT8}),"draco3d.encoder"===t&&(this._encoderModule=e,ab=this._encoderModule),this}setEncoderOptions(t){return this._encoderOptions=t,this}preread(t){if(!this._decoderModule)throw new Error(`[${xb}] Please install extension dependency, "draco3d.decoder".`);const e=this.document.getLogger(),i=t.jsonDoc,n=new Map;try{const s=i.json.meshes||[];for(const r of s)for(const s of r.primitives){if(!s.extensions||!s.extensions[xb])continue;const r=s.extensions[xb];let[o,a]=n.get(r.bufferView)||[];if(!a||!o){const t=i.json.bufferViews[r.bufferView],s=i.json.buffers[t.buffer],h=qy.toView(s.uri?i.resources[s.uri]:i.resources[Ly],t.byteOffset||0,t.byteLength);o=new this._decoderModule.Decoder,a=hb(o,h),n.set(r.bufferView,[o,a]),e.debug(`[${xb}] Decompressed ${h.byteLength} bytes.`)}for(const e in s.attributes){const i=t.jsonDoc.json.accessors[s.attributes[e]],n=o.GetAttributeByUniqueId(a,r.attributes[e]),h=cb(o,a,n,i);t.accessors[s.attributes[e]].setArray(h)}void 0!==s.indices&&t.accessors[s.indices].setArray(lb(o,a))}}finally{for(const[t,e]of Array.from(n.values()))this._decoderModule.destroy(t),this._decoderModule.destroy(e)}return this}read(t){return this}prewrite(t,e){if(!this._encoderModule)throw new Error(`[${xb}] Please install extension dependency, "draco3d.encoder".`);const i=this.document.getLogger();i.debug(`[${xb}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const n=function(t){const e=t.getLogger(),i=new Set,n=new Set;for(const s of t.getRoot().listMeshes())for(const t of s.listPrimitives())t.getIndices()?t.getMode()!==Nx.Mode.TRIANGLES?(n.add(t),e.warn(`[${xb}] Skipping Draco compression on non-TRIANGLES primitive.`)):i.add(t):(n.add(t),e.warn(`[${xb}] Skipping Draco compression on non-indexed primitive.`));const s=t.getRoot().listAccessors(),r=new Map;for(let t=0;t<s.length;t++)r.set(s[t],t);const o=new Map,a=new Set,h=new Map;for(const e of Array.from(i)){let i=bb(e,r);if(a.has(i))h.set(e,i);else{if(o.has(e.getIndices())){const i=e.getIndices(),n=i.clone();r.set(n,t.getRoot().listAccessors().length-1),e.swap(i,n)}for(const i of e.listAttributes())if(o.has(i)){const n=i.clone();r.set(n,t.getRoot().listAccessors().length-1),e.swap(i,n)}i=bb(e,r),a.add(i),h.set(e,i),o.set(e.getIndices(),i);for(const t of e.listAttributes())o.set(t,i)}}for(const t of Array.from(o.keys())){const e=new Set(t.listParents().map((t=>t.propertyType)));if(2!==e.size||!e.has(Oy.PRIMITIVE)||!e.has(Oy.ROOT))throw new Error(`[${xb}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const t of Array.from(i)){const e=h.get(t),i=t.getIndices();if(o.get(i)!==e||t.listAttributes().some((t=>o.get(t)!==e)))throw new Error(`[${xb}] Draco primitives must share all, or no, accessors.`)}for(const t of Array.from(n)){const e=t.getIndices();if(o.has(e)||t.listAttributes().some((t=>o.has(t))))throw new Error(`[${xb}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return h}(this.document),s=new Map;let r="mesh";"scene"===this._encoderOptions.quantizationVolume&&(1!==this.document.getRoot().listScenes().length?i.warn(`[${xb}]: quantizationVolume=scene requires exactly 1 scene.`):r=Wy(this.document.getRoot().listScenes().pop()));for(const e of Array.from(n.keys())){const o=n.get(e);if(!o)throw new Error("Unexpected primitive.");if(s.has(o)){s.set(o,s.get(o));continue}const a=e.getIndices(),h=t.jsonDoc.json.accessors;let l;try{l=fb(e,L_({},this._encoderOptions,{quantizationVolume:r}))}catch(t){if(t instanceof yb){i.warn(`[${xb}]: ${t.message} Skipping primitive compression.`);continue}throw t}s.set(o,l);const c=t.createAccessorDef(a);c.count=l.numIndices,t.accessorIndexMap.set(a,h.length),h.push(c);for(const i of e.listSemantics()){const n=e.getAttribute(i);if(void 0===l.attributeIDs[i])continue;const s=t.createAccessorDef(n);s.count=l.numVertices,t.accessorIndexMap.set(n,h.length),h.push(s)}const u=e.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];t.otherBufferViews.has(u)||t.otherBufferViews.set(u,[]),t.otherBufferViews.get(u).push(l.data)}return i.debug(`[${xb}] Compressed ${n.size} primitives.`),t.extensionData[xb]={primitiveHashMap:n,primitiveEncodingMap:s},this}write(t){const e=t.extensionData[xb];for(const i of this.document.getRoot().listMeshes()){const n=t.jsonDoc.json.meshes[t.meshIndexMap.get(i)];for(let s=0;s<i.listPrimitives().length;s++){const r=i.listPrimitives()[s],o=n.primitives[s],a=e.primitiveHashMap.get(r);if(!a)continue;const h=e.primitiveEncodingMap.get(a);h&&(o.extensions=o.extensions||{},o.extensions[xb]={bufferView:t.otherBufferViewsIndexMap.get(h.data),attributes:h.attributeIDs})}}if(!e.primitiveHashMap.size){const e=t.jsonDoc.json;e.extensionsUsed=(e.extensionsUsed||[]).filter((t=>t!==xb)),e.extensionsRequired=(e.extensionsRequired||[]).filter((t=>t!==xb))}return this}}function bb(t,e){const i=[],n=t.getIndices();i.push(e.get(n));for(const n of t.listAttributes())i.push(e.get(n));return i.sort().join("|")}_b.EXTENSION_NAME=xb,_b.EncoderMethod=ub;class wb extends Ax{init(){this.extensionName=f_,this.propertyType="Light",this.parentTypes=[Oy.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:wb.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(t){return this.set("color",t)}getColorHex(){return Yy.factorToHex(this.getColor())}setColorHex(t){const e=this.getColor().slice();return Yy.hexToFactor(t,e),this.setColor(e)}getIntensity(){return this.get("intensity")}setIntensity(t){return this.set("intensity",t)}getType(){return this.get("type")}setType(t){return this.set("type",t)}getRange(){return this.get("range")}setRange(t){return this.set("range",t)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(t){return this.set("innerConeAngle",t)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(t){return this.set("outerConeAngle",t)}}wb.EXTENSION_NAME=f_,wb.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const Mb=f_;class Sb extends jx{constructor(...t){super(...t),this.extensionName=Mb}createLight(t=""){return new wb(this.document.getGraph(),t)}read(t){const e=t.jsonDoc;if(!e.json.extensions||!e.json.extensions[Mb])return this;const i=(e.json.extensions[Mb].lights||[]).map((t=>{var e,i;const n=this.createLight().setName(t.name||"").setType(t.type);return void 0!==t.color&&n.setColor(t.color),void 0!==t.intensity&&n.setIntensity(t.intensity),void 0!==t.range&&n.setRange(t.range),void 0!==(null==(e=t.spot)?void 0:e.innerConeAngle)&&n.setInnerConeAngle(t.spot.innerConeAngle),void 0!==(null==(i=t.spot)?void 0:i.outerConeAngle)&&n.setOuterConeAngle(t.spot.outerConeAngle),n}));return e.json.nodes.forEach(((e,n)=>{e.extensions&&e.extensions[Mb]&&t.nodes[n].setExtension(Mb,i[e.extensions[Mb].light])})),this}write(t){const e=t.jsonDoc;if(0===this.properties.size)return this;const i=[],n=new Map;for(const t of this.properties){const e=t,s={type:e.getType()};ox.eq(e.getColor(),[1,1,1])||(s.color=e.getColor()),1!==e.getIntensity()&&(s.intensity=e.getIntensity()),null!=e.getRange()&&(s.range=e.getRange()),e.getName()&&(s.name=e.getName()),e.getType()===wb.Type.SPOT&&(s.spot={innerConeAngle:e.getInnerConeAngle(),outerConeAngle:e.getOuterConeAngle()}),i.push(s),n.set(e,i.length-1)}return this.document.getRoot().listNodes().forEach((i=>{const s=i.getExtension(Mb);if(s){const r=t.nodeIndexMap.get(i),o=e.json.nodes[r];o.extensions=o.extensions||{},o.extensions[Mb]={light:n.get(s)}}})),e.json.extensions=e.json.extensions||{},e.json.extensions[Mb]={lights:i},this}}Sb.EXTENSION_NAME=Mb;const{R:Tb,G:Eb,B:Ab}=zy;class Cb extends Ax{init(){this.extensionName=g_,this.propertyType="Anisotropy",this.parentTypes=[Oy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new Cx(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(t){return this.set("anisotropyStrength",t)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(t){return this.set("anisotropyRotation",t)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(t){return this.setRef("anisotropyTexture",t,{channels:Tb|Eb|Ab})}}Cb.EXTENSION_NAME=g_;const Ib=g_;class Rb extends jx{constructor(...t){super(...t),this.extensionName=Ib}createAnisotropy(){return new Cb(this.document.getGraph())}read(t){const e=t.jsonDoc,i=e.json.textures||[];return(e.json.materials||[]).forEach(((e,n)=>{if(e.extensions&&e.extensions[Ib]){const s=this.createAnisotropy();t.materials[n].setExtension(Ib,s);const r=e.extensions[Ib];if(void 0!==r.anisotropyStrength&&s.setAnisotropyStrength(r.anisotropyStrength),void 0!==r.anisotropyRotation&&s.setAnisotropyRotation(r.anisotropyRotation),void 0!==r.anisotropyTexture){const e=r.anisotropyTexture;s.setAnisotropyTexture(t.textures[i[e.index].source]),t.setTextureInfo(s.getAnisotropyTextureInfo(),e)}}})),this}write(t){const e=t.jsonDoc;return this.document.getRoot().listMaterials().forEach((i=>{const n=i.getExtension(Ib);if(n){const s=t.materialIndexMap.get(i),r=e.json.materials[s];r.extensions=r.extensions||{};const o=r.extensions[Ib]={};if(n.getAnisotropyStrength()>0&&(o.anisotropyStrength=n.getAnisotropyStrength()),0!==n.getAnisotropyRotation()&&(o.anisotropyRotation=n.getAnisotropyRotation()),n.getAnisotropyTexture()){const e=n.getAnisotropyTexture(),i=n.getAnisotropyTextureInfo();o.anisotropyTexture=t.createTextureInfoDef(e,i)}}})),this}}Rb.EXTENSION_NAME=Ib;const{R:Pb,G:kb,B:Db}=zy;class Lb extends Ax{init(){this.extensionName=v_,this.propertyType="Clearcoat",this.parentTypes=[Oy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new Cx(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new Cx(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new Cx(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(t){return this.set("clearcoatFactor",t)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(t){return this.setRef("clearcoatTexture",t,{channels:Pb})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(t){return this.set("clearcoatRoughnessFactor",t)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(t){return this.setRef("clearcoatRoughnessTexture",t,{channels:kb})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(t){return this.set("clearcoatNormalScale",t)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(t){return this.setRef("clearcoatNormalTexture",t,{channels:Pb|kb|Db})}}Lb.EXTENSION_NAME=v_;const Ob=v_;class Nb extends jx{constructor(...t){super(...t),this.extensionName=Ob}createClearcoat(){return new Lb(this.document.getGraph())}read(t){const e=t.jsonDoc,i=e.json.textures||[];return(e.json.materials||[]).forEach(((e,n)=>{if(e.extensions&&e.extensions[Ob]){const s=this.createClearcoat();t.materials[n].setExtension(Ob,s);const r=e.extensions[Ob];if(void 0!==r.clearcoatFactor&&s.setClearcoatFactor(r.clearcoatFactor),void 0!==r.clearcoatRoughnessFactor&&s.setClearcoatRoughnessFactor(r.clearcoatRoughnessFactor),void 0!==r.clearcoatTexture){const e=r.clearcoatTexture;s.setClearcoatTexture(t.textures[i[e.index].source]),t.setTextureInfo(s.getClearcoatTextureInfo(),e)}if(void 0!==r.clearcoatRoughnessTexture){const e=r.clearcoatRoughnessTexture;s.setClearcoatRoughnessTexture(t.textures[i[e.index].source]),t.setTextureInfo(s.getClearcoatRoughnessTextureInfo(),e)}if(void 0!==r.clearcoatNormalTexture){const e=r.clearcoatNormalTexture;s.setClearcoatNormalTexture(t.textures[i[e.index].source]),t.setTextureInfo(s.getClearcoatNormalTextureInfo(),e),void 0!==e.scale&&s.setClearcoatNormalScale(e.scale)}}})),this}write(t){const e=t.jsonDoc;return this.document.getRoot().listMaterials().forEach((i=>{const n=i.getExtension(Ob);if(n){const s=t.materialIndexMap.get(i),r=e.json.materials[s];r.extensions=r.extensions||{};const o=r.extensions[Ob]={clearcoatFactor:n.getClearcoatFactor(),clearcoatRoughnessFactor:n.getClearcoatRoughnessFactor()};if(n.getClearcoatTexture()){const e=n.getClearcoatTexture(),i=n.getClearcoatTextureInfo();o.clearcoatTexture=t.createTextureInfoDef(e,i)}if(n.getClearcoatRoughnessTexture()){const e=n.getClearcoatRoughnessTexture(),i=n.getClearcoatRoughnessTextureInfo();o.clearcoatRoughnessTexture=t.createTextureInfoDef(e,i)}if(n.getClearcoatNormalTexture()){const e=n.getClearcoatNormalTexture(),i=n.getClearcoatNormalTextureInfo();o.clearcoatNormalTexture=t.createTextureInfoDef(e,i),1!==n.getClearcoatNormalScale()&&(o.clearcoatNormalTexture.scale=n.getClearcoatNormalScale())}}})),this}}Nb.EXTENSION_NAME=Ob;class Bb extends Ax{init(){this.extensionName=y_,this.propertyType="EmissiveStrength",this.parentTypes=[Oy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(t){return this.set("emissiveStrength",t)}}Bb.EXTENSION_NAME=y_;const zb=y_;class Ub extends jx{constructor(...t){super(...t),this.extensionName=zb}createEmissiveStrength(){return new Bb(this.document.getGraph())}read(t){return(t.jsonDoc.json.materials||[]).forEach(((e,i)=>{if(e.extensions&&e.extensions[zb]){const n=this.createEmissiveStrength();t.materials[i].setExtension(zb,n);const s=e.extensions[zb];void 0!==s.emissiveStrength&&n.setEmissiveStrength(s.emissiveStrength)}})),this}write(t){const e=t.jsonDoc;return this.document.getRoot().listMaterials().forEach((i=>{const n=i.getExtension(zb);if(n){const s=t.materialIndexMap.get(i),r=e.json.materials[s];r.extensions=r.extensions||{},r.extensions[zb]={emissiveStrength:n.getEmissiveStrength()}}})),this}}Ub.EXTENSION_NAME=zb;class Fb extends Ax{init(){this.extensionName=x_,this.propertyType="IOR",this.parentTypes=[Oy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(t){return this.set("ior",t)}}Fb.EXTENSION_NAME=x_;const Gb=x_;class Hb extends jx{constructor(...t){super(...t),this.extensionName=Gb}createIOR(){return new Fb(this.document.getGraph())}read(t){return(t.jsonDoc.json.materials||[]).forEach(((e,i)=>{if(e.extensions&&e.extensions[Gb]){const n=this.createIOR();t.materials[i].setExtension(Gb,n);const s=e.extensions[Gb];void 0!==s.ior&&n.setIOR(s.ior)}})),this}write(t){const e=t.jsonDoc;return this.document.getRoot().listMaterials().forEach((i=>{const n=i.getExtension(Gb);if(n){const s=t.materialIndexMap.get(i),r=e.json.materials[s];r.extensions=r.extensions||{},r.extensions[Gb]={ior:n.getIOR()}}})),this}}Hb.EXTENSION_NAME=Gb;const{R:Vb,G:jb}=zy;class Wb extends Ax{init(){this.extensionName=__,this.propertyType="Iridescence",this.parentTypes=[Oy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new Cx(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new Cx(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(t){return this.set("iridescenceFactor",t)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(t){return this.setRef("iridescenceTexture",t,{channels:Vb})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(t){return this.set("iridescenceIOR",t)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(t){return this.set("iridescenceThicknessMinimum",t)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(t){return this.set("iridescenceThicknessMaximum",t)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(t){return this.setRef("iridescenceThicknessTexture",t,{channels:jb})}}Wb.EXTENSION_NAME=__;const Xb=__;class $b extends jx{constructor(...t){super(...t),this.extensionName=Xb}createIridescence(){return new Wb(this.document.getGraph())}read(t){const e=t.jsonDoc,i=e.json.textures||[];return(e.json.materials||[]).forEach(((e,n)=>{if(e.extensions&&e.extensions[Xb]){const s=this.createIridescence();t.materials[n].setExtension(Xb,s);const r=e.extensions[Xb];if(void 0!==r.iridescenceFactor&&s.setIridescenceFactor(r.iridescenceFactor),void 0!==r.iridescenceIor&&s.setIridescenceIOR(r.iridescenceIor),void 0!==r.iridescenceThicknessMinimum&&s.setIridescenceThicknessMinimum(r.iridescenceThicknessMinimum),void 0!==r.iridescenceThicknessMaximum&&s.setIridescenceThicknessMaximum(r.iridescenceThicknessMaximum),void 0!==r.iridescenceTexture){const e=r.iridescenceTexture;s.setIridescenceTexture(t.textures[i[e.index].source]),t.setTextureInfo(s.getIridescenceTextureInfo(),e)}if(void 0!==r.iridescenceThicknessTexture){const e=r.iridescenceThicknessTexture;s.setIridescenceThicknessTexture(t.textures[i[e.index].source]),t.setTextureInfo(s.getIridescenceThicknessTextureInfo(),e)}}})),this}write(t){const e=t.jsonDoc;return this.document.getRoot().listMaterials().forEach((i=>{const n=i.getExtension(Xb);if(n){const s=t.materialIndexMap.get(i),r=e.json.materials[s];r.extensions=r.extensions||{};const o=r.extensions[Xb]={};if(n.getIridescenceFactor()>0&&(o.iridescenceFactor=n.getIridescenceFactor()),1.3!==n.getIridescenceIOR()&&(o.iridescenceIor=n.getIridescenceIOR()),100!==n.getIridescenceThicknessMinimum()&&(o.iridescenceThicknessMinimum=n.getIridescenceThicknessMinimum()),400!==n.getIridescenceThicknessMaximum()&&(o.iridescenceThicknessMaximum=n.getIridescenceThicknessMaximum()),n.getIridescenceTexture()){const e=n.getIridescenceTexture(),i=n.getIridescenceTextureInfo();o.iridescenceTexture=t.createTextureInfoDef(e,i)}if(n.getIridescenceThicknessTexture()){const e=n.getIridescenceThicknessTexture(),i=n.getIridescenceThicknessTextureInfo();o.iridescenceThicknessTexture=t.createTextureInfoDef(e,i)}}})),this}}$b.EXTENSION_NAME=Xb;const{R:qb,G:Yb,B:Kb,A:Zb}=zy;class Jb extends Ax{init(){this.extensionName=b_,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[Oy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new Cx(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new Cx(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(t){return this.set("diffuseFactor",t)}getDiffuseHex(){return Yy.factorToHex(this.getDiffuseFactor())}setDiffuseHex(t){const e=this.getDiffuseFactor().slice();return this.setDiffuseFactor(Yy.hexToFactor(t,e))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(t){return this.setRef("diffuseTexture",t,{channels:qb|Yb|Kb|Zb,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(t){return this.set("specularFactor",t)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(t){return this.set("glossinessFactor",t)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(t){return this.setRef("specularGlossinessTexture",t,{channels:qb|Yb|Kb|Zb})}}Jb.EXTENSION_NAME=b_;const Qb=b_;class tw extends jx{constructor(...t){super(...t),this.extensionName=Qb}createPBRSpecularGlossiness(){return new Jb(this.document.getGraph())}read(t){const e=t.jsonDoc,i=e.json.textures||[];return(e.json.materials||[]).forEach(((e,n)=>{if(e.extensions&&e.extensions[Qb]){const s=this.createPBRSpecularGlossiness();t.materials[n].setExtension(Qb,s);const r=e.extensions[Qb];if(void 0!==r.diffuseFactor&&s.setDiffuseFactor(r.diffuseFactor),void 0!==r.specularFactor&&s.setSpecularFactor(r.specularFactor),void 0!==r.glossinessFactor&&s.setGlossinessFactor(r.glossinessFactor),void 0!==r.diffuseTexture){const e=r.diffuseTexture;s.setDiffuseTexture(t.textures[i[e.index].source]),t.setTextureInfo(s.getDiffuseTextureInfo(),e)}if(void 0!==r.specularGlossinessTexture){const e=r.specularGlossinessTexture;s.setSpecularGlossinessTexture(t.textures[i[e.index].source]),t.setTextureInfo(s.getSpecularGlossinessTextureInfo(),e)}}})),this}write(t){const e=t.jsonDoc;return this.document.getRoot().listMaterials().forEach((i=>{const n=i.getExtension(Qb);if(n){const s=t.materialIndexMap.get(i),r=e.json.materials[s];r.extensions=r.extensions||{};const o=r.extensions[Qb]={diffuseFactor:n.getDiffuseFactor(),specularFactor:n.getSpecularFactor(),glossinessFactor:n.getGlossinessFactor()};if(n.getDiffuseTexture()){const e=n.getDiffuseTexture(),i=n.getDiffuseTextureInfo();o.diffuseTexture=t.createTextureInfoDef(e,i)}if(n.getSpecularGlossinessTexture()){const e=n.getSpecularGlossinessTexture(),i=n.getSpecularGlossinessTextureInfo();o.specularGlossinessTexture=t.createTextureInfoDef(e,i)}}})),this}}tw.EXTENSION_NAME=Qb;const{R:ew,G:iw,B:nw,A:sw}=zy;class rw extends Ax{init(){this.extensionName=w_,this.propertyType="Sheen",this.parentTypes=[Oy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new Cx(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new Cx(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return Yy.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(t){return this.set("sheenColorFactor",t)}setSheenColorHex(t){const e=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",Yy.hexToFactor(t,e))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(t){return this.setRef("sheenColorTexture",t,{channels:ew|iw|nw,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(t){return this.set("sheenRoughnessFactor",t)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(t){return this.setRef("sheenRoughnessTexture",t,{channels:sw})}}rw.EXTENSION_NAME=w_;const ow=w_;class aw extends jx{constructor(...t){super(...t),this.extensionName=ow}createSheen(){return new rw(this.document.getGraph())}read(t){const e=t.jsonDoc,i=e.json.textures||[];return(e.json.materials||[]).forEach(((e,n)=>{if(e.extensions&&e.extensions[ow]){const s=this.createSheen();t.materials[n].setExtension(ow,s);const r=e.extensions[ow];if(void 0!==r.sheenColorFactor&&s.setSheenColorFactor(r.sheenColorFactor),void 0!==r.sheenRoughnessFactor&&s.setSheenRoughnessFactor(r.sheenRoughnessFactor),void 0!==r.sheenColorTexture){const e=r.sheenColorTexture;s.setSheenColorTexture(t.textures[i[e.index].source]),t.setTextureInfo(s.getSheenColorTextureInfo(),e)}if(void 0!==r.sheenRoughnessTexture){const e=r.sheenRoughnessTexture;s.setSheenRoughnessTexture(t.textures[i[e.index].source]),t.setTextureInfo(s.getSheenRoughnessTextureInfo(),e)}}})),this}write(t){const e=t.jsonDoc;return this.document.getRoot().listMaterials().forEach((i=>{const n=i.getExtension(ow);if(n){const s=t.materialIndexMap.get(i),r=e.json.materials[s];r.extensions=r.extensions||{};const o=r.extensions[ow]={sheenColorFactor:n.getSheenColorFactor(),sheenRoughnessFactor:n.getSheenRoughnessFactor()};if(n.getSheenColorTexture()){const e=n.getSheenColorTexture(),i=n.getSheenColorTextureInfo();o.sheenColorTexture=t.createTextureInfoDef(e,i)}if(n.getSheenRoughnessTexture()){const e=n.getSheenRoughnessTexture(),i=n.getSheenRoughnessTextureInfo();o.sheenRoughnessTexture=t.createTextureInfoDef(e,i)}}})),this}}aw.EXTENSION_NAME=ow;const{R:hw,G:lw,B:cw,A:uw}=zy;class dw extends Ax{init(){this.extensionName=M_,this.propertyType="Specular",this.parentTypes=[Oy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new Cx(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new Cx(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(t){return this.set("specularFactor",t)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(t){return this.set("specularColorFactor",t)}getSpecularColorHex(){return Yy.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(t){const e=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",Yy.hexToFactor(t,e))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(t){return this.setRef("specularTexture",t,{channels:uw})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(t){return this.setRef("specularColorTexture",t,{channels:hw|lw|cw,isColor:!0})}}dw.EXTENSION_NAME=M_;const pw=M_;class mw extends jx{constructor(...t){super(...t),this.extensionName=pw}createSpecular(){return new dw(this.document.getGraph())}read(t){const e=t.jsonDoc,i=e.json.textures||[];return(e.json.materials||[]).forEach(((e,n)=>{if(e.extensions&&e.extensions[pw]){const s=this.createSpecular();t.materials[n].setExtension(pw,s);const r=e.extensions[pw];if(void 0!==r.specularFactor&&s.setSpecularFactor(r.specularFactor),void 0!==r.specularColorFactor&&s.setSpecularColorFactor(r.specularColorFactor),void 0!==r.specularTexture){const e=r.specularTexture;s.setSpecularTexture(t.textures[i[e.index].source]),t.setTextureInfo(s.getSpecularTextureInfo(),e)}if(void 0!==r.specularColorTexture){const e=r.specularColorTexture;s.setSpecularColorTexture(t.textures[i[e.index].source]),t.setTextureInfo(s.getSpecularColorTextureInfo(),e)}}})),this}write(t){const e=t.jsonDoc;return this.document.getRoot().listMaterials().forEach((i=>{const n=i.getExtension(pw);if(n){const s=t.materialIndexMap.get(i),r=e.json.materials[s];r.extensions=r.extensions||{};const o=r.extensions[pw]={};if(1!==n.getSpecularFactor()&&(o.specularFactor=n.getSpecularFactor()),ox.eq(n.getSpecularColorFactor(),[1,1,1])||(o.specularColorFactor=n.getSpecularColorFactor()),n.getSpecularTexture()){const e=n.getSpecularTexture(),i=n.getSpecularTextureInfo();o.specularTexture=t.createTextureInfoDef(e,i)}if(n.getSpecularColorTexture()){const e=n.getSpecularColorTexture(),i=n.getSpecularColorTextureInfo();o.specularColorTexture=t.createTextureInfoDef(e,i)}}})),this}}mw.EXTENSION_NAME=pw;const{R:fw}=zy;class gw extends Ax{init(){this.extensionName=S_,this.propertyType="Transmission",this.parentTypes=[Oy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new Cx(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(t){return this.set("transmissionFactor",t)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(t){return this.setRef("transmissionTexture",t,{channels:fw})}}gw.EXTENSION_NAME=S_;const vw=S_;class yw extends jx{constructor(...t){super(...t),this.extensionName=vw}createTransmission(){return new gw(this.document.getGraph())}read(t){const e=t.jsonDoc,i=e.json.textures||[];return(e.json.materials||[]).forEach(((e,n)=>{if(e.extensions&&e.extensions[vw]){const s=this.createTransmission();t.materials[n].setExtension(vw,s);const r=e.extensions[vw];if(void 0!==r.transmissionFactor&&s.setTransmissionFactor(r.transmissionFactor),void 0!==r.transmissionTexture){const e=r.transmissionTexture;s.setTransmissionTexture(t.textures[i[e.index].source]),t.setTextureInfo(s.getTransmissionTextureInfo(),e)}}})),this}write(t){const e=t.jsonDoc;return this.document.getRoot().listMaterials().forEach((i=>{const n=i.getExtension(vw);if(n){const s=t.materialIndexMap.get(i),r=e.json.materials[s];r.extensions=r.extensions||{};const o=r.extensions[vw]={transmissionFactor:n.getTransmissionFactor()};if(n.getTransmissionTexture()){const e=n.getTransmissionTexture(),i=n.getTransmissionTextureInfo();o.transmissionTexture=t.createTextureInfoDef(e,i)}}})),this}}yw.EXTENSION_NAME=vw;class xw extends Ax{init(){this.extensionName=T_,this.propertyType="Unlit",this.parentTypes=[Oy.MATERIAL]}}xw.EXTENSION_NAME=T_;const _w=T_;class bw extends jx{constructor(...t){super(...t),this.extensionName=_w}createUnlit(){return new xw(this.document.getGraph())}read(t){return(t.jsonDoc.json.materials||[]).forEach(((e,i)=>{e.extensions&&e.extensions[_w]&&t.materials[i].setExtension(_w,this.createUnlit())})),this}write(t){const e=t.jsonDoc;return this.document.getRoot().listMaterials().forEach((i=>{if(i.getExtension(_w)){const n=t.materialIndexMap.get(i),s=e.json.materials[n];s.extensions=s.extensions||{},s.extensions[_w]={}}})),this}}bw.EXTENSION_NAME=_w;class ww extends Ax{init(){this.extensionName=A_,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(t){return this.setRef("material",t)}addVariant(t){return this.addRef("variants",t)}removeVariant(t){return this.removeRef("variants",t)}listVariants(){return this.listRefs("variants")}}ww.EXTENSION_NAME=A_;class Mw extends Ax{init(){this.extensionName=A_,this.propertyType="MappingList",this.parentTypes=[Oy.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(t){return this.addRef("mappings",t)}removeMapping(t){return this.removeRef("mappings",t)}listMappings(){return this.listRefs("mappings")}}Mw.EXTENSION_NAME=A_;class Sw extends Ax{init(){this.extensionName=A_,this.propertyType="Variant",this.parentTypes=["MappingList"]}}Sw.EXTENSION_NAME=A_;const Tw=A_;class Ew extends jx{constructor(...t){super(...t),this.extensionName=Tw}createMappingList(){return new Mw(this.document.getGraph())}createVariant(t=""){return new Sw(this.document.getGraph(),t)}createMapping(){return new ww(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter((t=>t instanceof Sw))}read(t){const e=t.jsonDoc;if(!e.json.extensions||!e.json.extensions[Tw])return this;const i=(e.json.extensions[Tw].variants||[]).map((t=>this.createVariant().setName(t.name||"")));return(e.json.meshes||[]).forEach(((e,n)=>{const s=t.meshes[n];(e.primitives||[]).forEach(((e,n)=>{if(!e.extensions||!e.extensions[Tw])return;const r=this.createMappingList(),o=e.extensions[Tw];for(const e of o.mappings){const n=this.createMapping();void 0!==e.material&&n.setMaterial(t.materials[e.material]);for(const t of e.variants||[])n.addVariant(i[t]);r.addMapping(n)}s.listPrimitives()[n].setExtension(Tw,r)}))})),this}write(t){const e=t.jsonDoc,i=this.listVariants();if(!i.length)return this;const n=[],s=new Map;for(const e of i)s.set(e,n.length),n.push(t.createPropertyDef(e));for(const e of this.document.getRoot().listMeshes()){const i=t.meshIndexMap.get(e);e.listPrimitives().forEach(((e,n)=>{const r=e.getExtension(Tw);if(!r)return;const o=t.jsonDoc.json.meshes[i].primitives[n],a=r.listMappings().map((e=>{const i=t.createPropertyDef(e),n=e.getMaterial();return n&&(i.material=t.materialIndexMap.get(n)),i.variants=e.listVariants().map((t=>s.get(t))),i}));o.extensions=o.extensions||{},o.extensions[Tw]={mappings:a}}))}return e.json.extensions=e.json.extensions||{},e.json.extensions[Tw]={variants:n},this}}Ew.EXTENSION_NAME=Tw;const{G:Aw}=zy;class Cw extends Ax{init(){this.extensionName=E_,this.propertyType="Volume",this.parentTypes=[Oy.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new Cx(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(t){return this.set("thicknessFactor",t)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(t){return this.setRef("thicknessTexture",t,{channels:Aw})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(t){return this.set("attenuationDistance",t)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(t){return this.set("attenuationColor",t)}getAttenuationColorHex(){return Yy.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(t){const e=this.getAttenuationColor().slice();return this.set("attenuationColor",Yy.hexToFactor(t,e))}}Cw.EXTENSION_NAME=E_;const Iw=E_;class Rw extends jx{constructor(...t){super(...t),this.extensionName=Iw}createVolume(){return new Cw(this.document.getGraph())}read(t){const e=t.jsonDoc,i=e.json.textures||[];return(e.json.materials||[]).forEach(((e,n)=>{if(e.extensions&&e.extensions[Iw]){const s=this.createVolume();t.materials[n].setExtension(Iw,s);const r=e.extensions[Iw];if(void 0!==r.thicknessFactor&&s.setThicknessFactor(r.thicknessFactor),void 0!==r.attenuationDistance&&s.setAttenuationDistance(r.attenuationDistance),void 0!==r.attenuationColor&&s.setAttenuationColor(r.attenuationColor),void 0!==r.thicknessTexture){const e=r.thicknessTexture;s.setThicknessTexture(t.textures[i[e.index].source]),t.setTextureInfo(s.getThicknessTextureInfo(),e)}}})),this}write(t){const e=t.jsonDoc;return this.document.getRoot().listMaterials().forEach((i=>{const n=i.getExtension(Iw);if(n){const s=t.materialIndexMap.get(i),r=e.json.materials[s];r.extensions=r.extensions||{};const o=r.extensions[Iw]={};if(n.getThicknessFactor()>0&&(o.thicknessFactor=n.getThicknessFactor()),Number.isFinite(n.getAttenuationDistance())&&(o.attenuationDistance=n.getAttenuationDistance()),ox.eq(n.getAttenuationColor(),[1,1,1])||(o.attenuationColor=n.getAttenuationColor()),n.getThicknessTexture()){const e=n.getThicknessTexture(),i=n.getThicknessTextureInfo();o.thicknessTexture=t.createTextureInfoDef(e,i)}}})),this}}Rw.EXTENSION_NAME=Iw;const Pw="KHR_mesh_quantization";class kw extends jx{constructor(...t){super(...t),this.extensionName=Pw}read(t){return this}write(t){return this}}kw.EXTENSION_NAME=Pw;const Dw="KHR_texture_basisu";class Lw{match(t){return 171===t[0]&&75===t[1]&&84===t[2]&&88===t[3]&&32===t[4]&&50===t[5]&&48===t[6]&&187===t[7]&&13===t[8]&&10===t[9]&&26===t[10]&&10===t[11]}getSize(t){const e=u_(t);return[e.pixelWidth,e.pixelHeight]}getChannels(t){const e=u_(t).dataFormatDescriptor[0];if(163===e.colorModel)return 2===e.samples.length&&15==(15&e.samples[1].channelType)?4:3;if(166===e.colorModel)return 3==(15&e.samples[0].channelType)?4:3;throw new Error(`Unexpected KTX2 colorModel, "${e.colorModel}".`)}getVRAMByteLength(t){const e=u_(t),i=this.getChannels(t)>3;let n=0;for(let t=0;t<e.levels.length;t++){const s=e.levels[t];n+=s.uncompressedByteLength?s.uncompressedByteLength:Math.max(1,Math.floor(e.pixelWidth/Math.pow(2,t)))/4*(Math.max(1,Math.floor(e.pixelHeight/Math.pow(2,t)))/4)*(i?16:8)}return n}}class Ow extends jx{constructor(...t){super(...t),this.extensionName=Dw,this.prereadTypes=[Oy.TEXTURE]}static register(){Zy.registerFormat("image/ktx2",new Lw)}preread(t){return t.jsonDoc.json.textures.forEach((t=>{t.extensions&&t.extensions[Dw]&&(t.source=t.extensions[Dw].source)})),this}read(t){return this}write(t){const e=t.jsonDoc;return this.document.getRoot().listTextures().forEach((i=>{if("image/ktx2"===i.getMimeType()){const n=t.imageIndexMap.get(i);e.json.textures.forEach((t=>{t.source===n&&(t.extensions=t.extensions||{},t.extensions[Dw]={source:t.source},delete t.source)}))}})),this}}Ow.EXTENSION_NAME=Dw;class Nw extends Ax{init(){this.extensionName=C_,this.propertyType="Transform",this.parentTypes=[Oy.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(t){return this.set("offset",t)}getRotation(){return this.get("rotation")}setRotation(t){return this.set("rotation",t)}getScale(){return this.get("scale")}setScale(t){return this.set("scale",t)}getTexCoord(){return this.get("texCoord")}setTexCoord(t){return this.set("texCoord",t)}}Nw.EXTENSION_NAME=C_;const Bw=C_;class zw extends jx{constructor(...t){super(...t),this.extensionName=Bw}createTransform(){return new Nw(this.document.getGraph())}read(t){for(const[e,i]of Array.from(t.textureInfos.entries())){if(!i.extensions||!i.extensions[Bw])continue;const t=this.createTransform(),n=i.extensions[Bw];void 0!==n.offset&&t.setOffset(n.offset),void 0!==n.rotation&&t.setRotation(n.rotation),void 0!==n.scale&&t.setScale(n.scale),void 0!==n.texCoord&&t.setTexCoord(n.texCoord),e.setExtension(Bw,t)}return this}write(t){const e=Array.from(t.textureInfoDefMap.entries());for(const[t,i]of e){const e=t.getExtension(Bw);if(!e)continue;i.extensions=i.extensions||{};const n={},s=ox.eq;s(e.getOffset(),[0,0])||(n.offset=e.getOffset()),0!==e.getRotation()&&(n.rotation=e.getRotation()),s(e.getScale(),[1,1])||(n.scale=e.getScale()),null!=e.getTexCoord()&&(n.texCoord=e.getTexCoord()),i.extensions[Bw]=n}return this}}zw.EXTENSION_NAME=Bw;const Uw=[Oy.ROOT,Oy.SCENE,Oy.NODE,Oy.MESH,Oy.MATERIAL,Oy.TEXTURE,Oy.ANIMATION];class Fw extends Ax{init(){this.extensionName=I_,this.propertyType="Packet",this.parentTypes=Uw}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(t){return this.set("context",L_({},t))}listProperties(){return Object.keys(this.get("properties"))}getProperty(t){const e=this.get("properties");return t in e?e[t]:null}setProperty(t,e){this._assertContext(t);const i=L_({},this.get("properties"));return e?i[t]=e:delete i[t],this.set("properties",i)}toJSONLD(){return L_({"@context":Gw(this.get("context"))},Gw(this.get("properties")))}fromJSONLD(t){const e=(t=Gw(t))["@context"];return e&&this.set("context",e),delete t["@context"],this.set("properties",t)}_assertContext(t){if(!(t.split(":")[0]in this.get("context")))throw new Error(`${I_}: Missing context for term, "${t}".`)}}function Gw(t){return JSON.parse(JSON.stringify(t))}Fw.EXTENSION_NAME=I_;const Hw=I_;class Vw extends jx{constructor(...t){super(...t),this.extensionName=Hw}createPacket(){return new Fw(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(t){var e;const i=null==(e=t.jsonDoc.json.extensions)?void 0:e[Hw];if(!i||!i.packets)return this;const n=t.jsonDoc.json,s=this.document.getRoot(),r=i.packets.map((t=>this.createPacket().fromJSONLD(t))),o=[[n.asset],n.scenes,n.nodes,n.meshes,n.materials,n.images,n.animations],a=[[s],s.listScenes(),s.listNodes(),s.listMeshes(),s.listMaterials(),s.listTextures(),s.listAnimations()];for(let t=0;t<o.length;t++){const e=o[t]||[];for(let i=0;i<e.length;i++){const n=e[i];n.extensions&&n.extensions[Hw]&&a[t][i].setExtension(Hw,r[n.extensions[Hw].packet])}}return this}write(t){const{json:e}=t.jsonDoc,i=[];for(const n of this.properties){i.push(n.toJSONLD());for(const s of n.listParents()){let n;switch(s.propertyType){case Oy.ROOT:n=e.asset;break;case Oy.SCENE:n=e.scenes[t.sceneIndexMap.get(s)];break;case Oy.NODE:n=e.nodes[t.nodeIndexMap.get(s)];break;case Oy.MESH:n=e.meshes[t.meshIndexMap.get(s)];break;case Oy.MATERIAL:n=e.materials[t.materialIndexMap.get(s)];break;case Oy.TEXTURE:n=e.images[t.imageIndexMap.get(s)];break;case Oy.ANIMATION:n=e.animations[t.animationIndexMap.get(s)];break;default:n=null,this.document.getLogger().warn(`[${Hw}]: Unsupported parent property, "${s.propertyType}"`)}n&&(n.extensions=n.extensions||{},n.extensions[Hw]={packet:i.length-1})}}return i.length>0&&(e.extensions=e.extensions||{},e.extensions[Hw]={packets:i}),this}}Vw.EXTENSION_NAME=Hw;const jw=[_b,Sb,Rb,Nb,Ub,Hb,$b,tw,mw,aw,yw,bw,Ew,Rw,kw,Ow,zw,Vw];var Ww=o(448),Xw=o(367);function $w(t,e,i=-1){if(4===t.shape.length)return $w(t.pick(i),e,0);if(3===t.shape.length)if(3===t.shape[2])Xw.assign(Ww(e,[t.shape[0],t.shape[1],3],[4,4*t.shape[0],1]),t),Xw.assigns(Ww(e,[t.shape[0]*t.shape[1]],[4],3),255);else if(4===t.shape[2])Xw.assign(Ww(e,[t.shape[0],t.shape[1],4],[4,4*t.shape[0],1]),t);else{if(1!==t.shape[2])throw new Error("[ndarray-pixels] Incompatible array shape.");Xw.assign(Ww(e,[t.shape[0],t.shape[1],3],[4,4*t.shape[0],1]),Ww(t.data,[t.shape[0],t.shape[1],3],[t.stride[0],t.stride[1],0],t.offset)),Xw.assigns(Ww(e,[t.shape[0]*t.shape[1]],[4],3),255)}else{if(2!==t.shape.length)throw new Error("[ndarray-pixels] Incompatible array shape.");Xw.assign(Ww(e,[t.shape[0],t.shape[1],3],[4,4*t.shape[0],1]),Ww(t.data,[t.shape[0],t.shape[1],3],[t.stride[0],t.stride[1],0],t.offset)),Xw.assigns(Ww(e,[t.shape[0]*t.shape[1]],[4],3),255)}return e}async function qw(t,e,i={}){const n=document.createElement("canvas");n.width=t.shape[0],n.height=t.shape[1];const s=n.getContext("2d"),r=s.getImageData(0,0,n.width,n.height);$w(t,r.data),s.putImageData(r,0,0);const o=i.quality?i.quality/100:void 0;return"image/jpeg"===e?Yw(n,"image/jpeg",o):Yw(n,e)}function Yw(t,e,i){return new Promise(((n,s)=>{t.toBlob((async t=>{t?n(new Uint8Array(await t.arrayBuffer())):s(new Error("[ndarray-pixels] Failed to canvas.toBlob()."))}),e,i)}))}async function Kw(t,e){return function(t,e){if(!(t instanceof Uint8Array))throw new Error("[ndarray-pixels] Input must be Uint8Array or Buffer.");const i=new Blob([t],{type:e}),n=URL.createObjectURL(i);return new Promise(((t,e)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=function(){URL.revokeObjectURL(n);const e=document.createElement("canvas");e.width=i.width,e.height=i.height;const s=e.getContext("2d");s.drawImage(i,0,0);const r=s.getImageData(0,0,i.width,i.height);t(Ww(new Uint8Array(r.data),[i.width,i.height,4],[4,4*i.width,1],0))},i.onerror=t=>{URL.revokeObjectURL(n),e(t)},i.src=n}))}(t,e)}function Zw(){return Zw=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},Zw.apply(this,arguments)}function Jw(t,e){return Object.defineProperty(e,"name",{value:t}),e}async function Qw(t,e,i){if(!t)return null;const n=t.getImage();if(!n)return null;const s=await Kw(n,t.getMimeType());for(let t=0;t<s.shape[0];++t)for(let e=0;e<s.shape[1];++e)i(s,t,e);const r=await async function(t,e){return qw(t,e)}(s,"image/png");return e.setImage(r).setMimeType("image/png")}var tM="undefined"!=typeof Float32Array?Float32Array:Array;function eM(){var t=new tM(3);return tM!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function iM(){var t=new tM(4);return tM!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}eM();iM();Oy.ACCESSOR,Oy.MESH,Oy.TEXTURE,Oy.MATERIAL,Oy.SKIN;Oy.NODE,Oy.SKIN,Oy.MESH,Oy.CAMERA,Oy.PRIMITIVE,Oy.PRIMITIVE_TARGET,Oy.ANIMATION,Oy.MATERIAL,Oy.TEXTURE,Oy.ACCESSOR,Oy.BUFFER;const nM={DEFAULT:1e-4,TEXCOORD:1e-4,COLOR:.01,NORMAL:.05,JOINTS:0,WEIGHTS:.01};nM.DEFAULT,nM.NORMAL;const{ROOT:sM,NODE:rM,MESH:oM,PRIMITIVE:aM,ACCESSOR:hM}=Oy;Int8Array,Int16Array,Int32Array;const{TRANSLATION:lM,ROTATION:cM,SCALE:uM,WEIGHTS:dM}=Mx.TargetPath,pM={pattern:/.*/,quantizationVolume:"mesh",quantizePosition:14,quantizeNormal:10,quantizeTexcoord:12,quantizeColor:8,quantizeWeight:8,quantizeGeneric:12,normalizeWeights:!0};Zw({level:"high"},pM);const mM="metalRough",fM={};function gM(t=fM){return Zw({},fM,t),Jw(mM,(async t=>{const e=t.getLogger();if(!t.getRoot().listExtensionsUsed().map((t=>t.extensionName)).includes("KHR_materials_pbrSpecularGlossiness"))return void e.warn(`${mM}: KHR_materials_pbrSpecularGlossiness not found on document.`);const i=t.createExtension(Hb),n=t.createExtension(mw),s=t.createExtension(tw),r=new Set;for(const e of t.getRoot().listMaterials()){const s=e.getExtension("KHR_materials_pbrSpecularGlossiness");if(!s)continue;const o=n.createSpecular().setSpecularFactor(1).setSpecularColorFactor(s.getSpecularFactor());r.add(s.getSpecularGlossinessTexture()),r.add(e.getBaseColorTexture()),r.add(e.getMetallicRoughnessTexture()),e.setBaseColorFactor(s.getDiffuseFactor()).setMetallicFactor(0).setRoughnessFactor(1).setExtension("KHR_materials_ior",i.createIOR().setIOR(1e3)).setExtension("KHR_materials_specular",o);const a=s.getDiffuseTexture();a&&(e.setBaseColorTexture(a),e.getBaseColorTextureInfo().copy(s.getDiffuseTextureInfo()));const h=s.getSpecularGlossinessTexture();if(h){const i=s.getSpecularGlossinessTextureInfo(),n=t.createTexture();await Qw(h,n,((t,e,i)=>{t.set(e,i,3,255)})),o.setSpecularTexture(n),o.setSpecularColorTexture(n),o.getSpecularTextureInfo().copy(i),o.getSpecularColorTextureInfo().copy(i);const r=s.getGlossinessFactor(),a=t.createTexture();await Qw(h,a,((t,e,i)=>{const n=255-Math.round(t.get(e,i,3)*r);t.set(e,i,0,0),t.set(e,i,1,n),t.set(e,i,2,0),t.set(e,i,3,255)})),e.setMetallicRoughnessTexture(a),e.getMetallicRoughnessTextureInfo().copy(i)}else o.setSpecularColorFactor(s.getSpecularFactor()),e.setRoughnessFactor(1-s.getGlossinessFactor());e.setExtension("KHR_materials_pbrSpecularGlossiness",null)}s.dispose();for(const t of r)t&&1===t.listParents().length&&t.dispose();e.debug(`${mM}: Complete.`)}))}var vM;function yM(t,e,i){for(let n=0,s=i.length;n<s;n++)i[n]=t[e*s+n];return i}function xM(t,e,i){for(let n=0,s=i.length;n<s;n++)t[e*s+n]=i[n]}function _M(t,e,i=0){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(Math.abs(t[n]-e[n])>i)return!1;return!0}function bM(t,e,i){return t*(1-i)+e*i}function wM(t,e,i,n){for(let s=0;s<e.length;s++)t[s]=bM(e[s],i[s],n);return t}function MM(t,e,i,n){let s,r,o,a,h,l=e[0],c=e[1],u=e[2],d=e[3],p=i[0],m=i[1],f=i[2],g=i[3];return l*p+c*m+u*f+d*g,r<0&&(-r,-p,-m,-f,-g),1-r>1e-6?(Math.acos(r),Math.sin(s),Math.sin((1-n)*s)/o,Math.sin(n*s)/o):(1-n,n),t[0]=a*l+h*p,t[1]=a*c+h*m,t[2]=a*u+h*f,t[3]=a*d+h*g,t}function SM(t,e){const i=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}(t,e);return Math.acos(2*i*i-1)}!function(t){t[t.STEP=0]="STEP",t[t.LERP=1]="LERP",t[t.SLERP=2]="SLERP"}(vM||(vM={}));new Float32Array(0),Promise.resolve();var TM;!function(t){t.LANCZOS3="lanczos3",t.LANCZOS2="lanczos2"}(TM||(TM={}));TM.LANCZOS3;TM.LANCZOS3;var EM=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class AM extends tc{get Id(){return Zl.Viking}constructor(t){super(t,Jl.GltfParser,"",(e=>EM(this,void 0,void 0,(function*(){const i=(new o_).registerExtensions(jw),n=yield i.read("assets/monster/toad_mage.glb");yield n.transform(gM());const s=yield i.writeBinary(n);t.Load.parse(s.buffer,"",(t=>{this.Gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.scale.set(2,2,2),this.mixer=new Nl(t.scene),this.clips.set(Kl.Idle,t.animations.find((t=>"idle"==t.name))),this.clips.set(Kl.Run,t.animations.find((t=>"run"==t.name))),this.clips.set(Kl.Punch,t.animations.find((t=>"attack"==t.name))),this.clips.set(Kl.Dying,t.animations.find((t=>"cast"==t.name))),e(this.meshs)}))}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.set(e.x,e.y,e.z),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=2*Math.ceil(this.size.x),this.size.y=4,this.size.z=2*Math.ceil(this.size.z),this.size}}var CM=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class IM extends tc{get Id(){return Zl.Viking}constructor(t){super(t,Jl.GltfParser,"",(e=>CM(this,void 0,void 0,(function*(){const i=(new o_).registerExtensions(jw),n=yield i.read("assets/monster/kitten_monk.glb");yield n.transform(gM());const s=yield i.writeBinary(n);t.Load.parse(s.buffer,"",(t=>{this.Gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.scale.set(1,1,1),this.mixer=new Nl(t.scene),this.clips.set(Kl.Idle,t.animations.find((t=>"idle"==t.name))),this.clips.set(Kl.Run,t.animations.find((t=>"run"==t.name))),this.clips.set(Kl.Punch,t.animations.find((t=>"kick-1"==t.name))),this.clips.set(Kl.MagicH1,t.animations.find((t=>"kick-2"==t.name))),e(this.meshs)}))}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.set(e.x,e.y,e.z),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=2.3,this.size.z=Math.ceil(this.size.z),this.size}}var RM=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class PM extends tc{get Id(){return Zl.CrabMon}constructor(t){super(t,Jl.Gltf,"assets/monster/skeleton.glb",(t=>RM(this,void 0,void 0,(function*(){this.Gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));const e=.008;this.meshs.scale.set(e,e,e),this.mixer=new Nl(t.scene),this.clips.set(Kl.Idle,t.animations.find((t=>"metarig|0_Idle"==t.name))),this.clips.set(Kl.Run,t.animations.find((t=>"metarig|1_Walk"==t.name))),this.clips.set(Kl.Punch,t.animations.find((t=>"metarig|3_Attack"==t.name))),this.clips.set(Kl.Dying,t.animations.find((t=>"metarig|4_GetHit"==t.name))),this.meshs.children[0].position.y=360}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.set(e.x,e.y,e.z),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(this.meshs);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x)/3,this.size.z=Math.ceil(this.size.z)/4.5,this.size}}var kM=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class DM extends tc{get Id(){return Zl.Tomato0}constructor(t){super(t,Jl.Gltf,"assets/plant/tomato_0.glb",(t=>kM(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0;this.meshs.scale.set(2,2,2),this.meshs.position.set(0,0,0),this.meshs.rotation.set(0,0,0)}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=2*Math.ceil(this.size.x),this.size.y=3,this.size.z=2*Math.ceil(this.size.z),this.size}}class LM extends tc{get Id(){return Zl.Tomato1}constructor(t){super(t,Jl.Gltf,"assets/plant/tomato_1.glb",(t=>kM(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0;this.meshs.scale.set(2,2,2),this.meshs.position.set(0,0,0),this.meshs.rotation.set(0,0,0)}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=3,this.size.z=Math.ceil(this.size.z),this.size}}class OM extends tc{get Id(){return Zl.Tomato2}constructor(t){super(t,Jl.Gltf,"assets/plant/tomato_2.glb",(t=>kM(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0;this.meshs.scale.set(2,2,2),this.meshs.position.set(0,0,0),this.meshs.rotation.set(0,0,0)}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=3,this.size.z=Math.ceil(this.size.z),this.size}}var NM=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class BM extends tc{get Id(){return Zl.Carrot0}constructor(t){super(t,Jl.Gltf,"assets/plant/carrot_0.glb",(t=>NM(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0;this.meshs.scale.set(2,2,2),this.meshs.position.set(0,0,0),this.meshs.rotation.set(0,0,0)}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=2*Math.ceil(this.size.x),this.size.y=3,this.size.z=2*Math.ceil(this.size.z),this.size}}class zM extends tc{get Id(){return Zl.Carrot1}constructor(t){super(t,Jl.Gltf,"assets/plant/carrot_1.glb",(t=>NM(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0;this.meshs.scale.set(2,2,2),this.meshs.position.set(0,0,0),this.meshs.rotation.set(0,0,0)}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=3,this.size.z=Math.ceil(this.size.z),this.size}}class UM extends tc{get Id(){return Zl.Carrot2}constructor(t){super(t,Jl.Gltf,"assets/plant/carrot_2.glb",(t=>NM(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0;this.meshs.scale.set(2,2,2),this.meshs.position.set(0,0,0),this.meshs.rotation.set(0,0,0)}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=3,this.size.z=Math.ceil(this.size.z),this.size}}var FM=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class GM extends tc{get Id(){return Zl.Potato0}constructor(t){super(t,Jl.Gltf,"assets/plant/potato_0.glb",(t=>FM(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0;this.meshs.scale.set(2,2,2),this.meshs.position.set(0,0,0),this.meshs.rotation.set(0,0,0)}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=2*Math.ceil(this.size.x),this.size.y=3,this.size.z=2*Math.ceil(this.size.z),this.size}}class HM extends tc{get Id(){return Zl.Potato1}constructor(t){super(t,Jl.Gltf,"assets/plant/potato_1.glb",(t=>FM(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0;this.meshs.scale.set(2,2,2),this.meshs.position.set(0,0,0),this.meshs.rotation.set(0,0,0)}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=3,this.size.z=Math.ceil(this.size.z),this.size}}class VM extends tc{get Id(){return Zl.Potato2}constructor(t){super(t,Jl.Gltf,"assets/plant/potato_2.glb",(t=>FM(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0;this.meshs.scale.set(2,2,2),this.meshs.position.set(0,0,0),this.meshs.rotation.set(0,0,0)}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=3,this.size.z=Math.ceil(this.size.z),this.size}}class jM extends tc{get Id(){return this.id}constructor(t){super(t,Jl.Gltf,"assets/furniture/toilet.glb",(t=>{this.meshs=new Po,this.meshs.add(t.scene),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.children[0].rotateY(Math.PI),this.meshs.children[0].scale.set(.8,.8,.8)})),this.id=Zl.Toilet}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(this.meshs.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=Math.ceil(this.size.y),this.size.z=Math.ceil(this.size.z),this.size}GetBodyMeshId(){return"mixamorigRightHand"}}class WM extends tc{get Id(){return this.id}constructor(t){super(t,Jl.Gltf,"assets/furniture/sink.glb",(t=>{this.meshs=new Po,this.meshs.add(t.scene),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.children[0].rotateY(Math.PI),this.meshs.children[0].scale.set(.8,.8,.8)})),this.id=Zl.Sink}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=Math.ceil(this.size.y),this.size.z=Math.ceil(this.size.z),this.size}GetBodyMeshId(){return"mixamorigRightHand"}}class XM extends tc{get Id(){return this.id}constructor(t){super(t,Jl.Gltf,"assets/furniture/bath.glb",(t=>{this.meshs=new Po,this.meshs.add(t.scene),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.children[0].rotateY(Math.PI),this.meshs.children[0].scale.set(1,.8,1)})),this.id=Zl.Bath}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=Math.ceil(this.size.y),this.size.z=Math.ceil(this.size.z),this.size}GetBodyMeshId(){return"mixamorigRightHand"}}class $M extends tc{get Id(){return this.id}constructor(t){super(t,Jl.Gltf,"assets/furniture/tv.glb",(t=>{this.meshs=new Po,this.meshs.add(t.scene),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.children[0].rotateY(Math.PI),this.meshs.children[0].scale.set(1,1,1)})),this.id=Zl.TV}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=Math.ceil(this.size.y),this.size.z=Math.ceil(this.size.z),this.size}GetBodyMeshId(){return"mixamorigRightHand"}}class qM extends tc{get Id(){return this.id}constructor(t){super(t,Jl.Gltf,"assets/furniture/table.glb",(t=>{this.meshs=new Po,this.meshs.add(t.scene),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.children[0].rotateY(Math.PI),this.meshs.children[0].scale.set(.8,.8,.8)})),this.id=Zl.Table}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=Math.ceil(this.size.y),this.size.z=Math.ceil(this.size.z),this.size}GetBodyMeshId(){return"mixamorigRightHand"}}class YM extends tc{get Id(){return this.id}constructor(t){super(t,Jl.Gltf,"assets/furniture/bookshelf.glb",(t=>{this.meshs=new Po,this.meshs.add(t.scene),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.children[0].rotateY(Math.PI),this.meshs.children[0].scale.set(.8,.8,.8),this.meshs.children[0].position.z=-.5})),this.id=Zl.Bookshelf}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=Math.ceil(this.size.y)-.5,this.size.z=Math.ceil(this.size.z)-1,this.size}GetBodyMeshId(){return"mixamorigRightHand"}}class KM extends tc{get Id(){return this.id}constructor(t){super(t,Jl.Gltf,"assets/furniture/kitchen.glb",(t=>{this.meshs=new Po,this.meshs.add(t.scene),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.children[0].rotateY(Math.PI),this.meshs.children[0].scale.set(.8,.8,.8)})),this.id=Zl.Kitchen}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=Math.ceil(this.size.y),this.size.z=Math.ceil(this.size.z),this.size}GetBodyMeshId(){return"mixamorigRightHand"}}class ZM extends tc{get Id(){return this.id}constructor(t){super(t,Jl.Gltf,"assets/furniture/refrigerator.glb",(t=>{this.meshs=new Po,this.meshs.add(t.scene),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.children[0].rotateY(Math.PI),this.meshs.children[0].scale.set(.8,.8,.8)})),this.id=Zl.Refrigerator}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=Math.ceil(this.size.y),this.size.z=Math.ceil(this.size.z),this.size}GetBodyMeshId(){return"mixamorigRightHand"}}class JM extends tc{get Id(){return this.id}constructor(t){super(t,Jl.Gltf,"assets/furniture/kit_table.glb",(t=>{this.meshs=new Po,this.meshs.add(t.scene),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.children[0].rotateY(Math.PI),this.meshs.children[0].scale.set(.8,.8,.8)})),this.id=Zl.KitTable}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=Math.ceil(this.size.y),this.size.z=Math.ceil(this.size.z),this.size}GetBodyMeshId(){return"mixamorigRightHand"}}class QM extends tc{get Id(){return this.id}constructor(t){super(t,Jl.Gltf,"assets/furniture/oven.glb",(t=>{this.meshs=new Po,this.meshs.add(t.scene),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}));this.meshs.children[0].rotateY(Math.PI),this.meshs.children[0].scale.set(.8,.8,.8)})),this.id=Zl.Oven}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),this.size)return this.size;const e=(new Le).setFromObject(t);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.y=Math.ceil(this.size.y),this.size.z=Math.ceil(this.size.z),this.size}GetBodyMeshId(){return"mixamorigRightHand"}}var tS=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class eS extends tc{get Id(){return Zl.Apple}constructor(t){super(t,Jl.Gltf,"assets/plant/apple.glb",(t=>tS(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0;this.meshs.scale.set(.5,.5,.5),this.meshs.position.set(0,0,0),this.meshs.rotation.set(0,0,0)}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size}}class iS extends tc{get Id(){return Zl.Coconut}constructor(t){super(t,Jl.Gltf,"assets/plant/coconut.glb",(t=>tS(this,void 0,void 0,(function*(){this.gltf=t,this.meshs=t.scene,this.meshs.castShadow=!0;this.meshs.scale.set(.5,.5,.5),this.meshs.position.set(0,0,0),this.meshs.rotation.set(0,0,0)}))))}GetBodyMeshId(){return"mixamorigRightHand"}GetBox(t){if(null==this.meshs&&(this.meshs=t),null==this.box){const e=this.GetSize(t);this.box=new kn(new Ln(e.x,e.y,e.z),this.boxMat)}const e=this.GetBoxPos(t);return this.box.position.copy(e),this.box.rotation.copy(t.rotation),(new Le).setFromObject(this.box)}GetSize(t){if(null==this.meshs&&(this.meshs=t),null!=this.size)return this.size;const e=(new Le).setFromObject(this.meshs.children[0]);return this.size=e.getSize(new Pe),this.size.x=Math.ceil(this.size.x),this.size.z=Math.ceil(this.size.z),this.size}}class nS{get MaleAsset(){return this.male}get FemaleAsset(){return this.female}get Mushroom1Asset(){return this.mushroom1}get Mushroom2Asset(){return this.mushroom2}get TreeAsset(){return this.tree}get DeadTreeAsset(){return this.deadtree}get DeadTree2Asset(){return this.deadTree2}get PortalAsset(){return this.portal}get ZombieAsset(){return this.zombie}get MinatuarAsset(){return this.minatuar}get CrabAsset(){return this.crab}get BatPigAsset(){return this.batpig}get BirdMonAsset(){return this.birdmon}get BilbyAsset(){return this.bilby}get WereWolfAsset(){return this.werewolf}get GunAsset(){return this.gun}get BatAsset(){return this.bat}get BedAsset(){return this.bed}get BathAsset(){return this.bath}get BookShelfAsset(){return this.bookshelf}get ClosetAsset(){return this.closet}get DeskAsset(){return this.desk}get KitchenAsset(){return this.kitchen}get KitTableAsset(){return this.kitTable}get OvenAsset(){return this.oven}get RefrigeratorAsset(){return this.refrigerator}get SinkAsset(){return this.sink}get TableAsset(){return this.table}get ToiletAsset(){return this.toilet}get TvAsset(){return this.tv}get WarteringCanAsset(){return this.wartercan}get HammerAsset(){return this.hammer}get AppleTreeAsset(){return this.appleTree}get AppleAsset(){return this.apple}get CoconutTreeAsset(){return this.coconutTree}get CoconutAsset(){return this.coconut}get Tomato0Asset(){return this.tomato0}get Tomato1Asset(){return this.tomato1}get Tomato2Asset(){return this.tomato2}get Potato0Asset(){return this.potato0}get Potato1Asset(){return this.potato1}get Potato2Asset(){return this.potato2}get Carrot0Asset(){return this.carrot0}get Carrot1Asset(){return this.carrot1}get Carrot2Asset(){return this.carrot2}get Load(){return this.loader}get LoadingManager(){return this.loadingManager}get FBXLoader(){return this.fbxLoader}get StoneAsset(){return this.stone}constructor(){this.fbxLoader=new uv,this.loadingManager=new Jh,this.loader=new Rf(this.loadingManager),this.male=new Pv(this),this.female=new Dv(this),this.mushroom1=new Lv(this,1),this.mushroom2=new Lv(this,2),this.tree=new Ov(this),this.deadtree=new Iv(this),this.portal=new Bv(this),this.test=new Uv(this),this.zombie=new Gv(this),this.minatuar=new $v(this),this.crab=new Yv(this),this.batpig=new ay(this),this.birdmon=new ly(this),this.bilby=new uy(this),this.werewolf=new py(this),this.golem=new fy(this),this.biggolem=new gy(this),this.snake=new yy(this),this.viking=new _y(this),this.builder=new wy(this),this.toadmage=new AM(this),this.kittenmonk=new IM(this),this.skeleton=new PM(this),this.bat=new Vv(this),this.gun=new Wv(this),this.stone=new Kv(this),this.bed=new iy(this),this.bath=new XM(this),this.bookshelf=new YM(this),this.closet=new ty(this),this.desk=new ey(this),this.kitchen=new KM(this),this.kitTable=new JM(this),this.oven=new QM(this),this.refrigerator=new ZM(this),this.sink=new WM(this),this.table=new qM(this),this.toilet=new jM(this),this.tv=new $M(this),this.appleTree=new sy(this),this.apple=new eS(this),this.coconutTree=new ry(this),this.coconut=new iS(this),this.deadTree2=new Nv(this),this.tomato0=new DM(this),this.tomato1=new LM(this),this.tomato2=new OM(this),this.potato0=new GM(this),this.potato1=new HM(this),this.potato2=new VM(this),this.carrot0=new BM(this),this.carrot1=new zM(this),this.carrot2=new UM(this),this.wartercan=new Jv(this),this.hammer=new Qv(this),this.assets=new Map,Zh.enabled=!0,this.assets.set(Zl.Male,this.male),this.assets.set(Zl.Female,this.female),this.assets.set(Zl.Tree,this.tree),this.assets.set(Zl.DeadTree,this.deadtree),this.assets.set(Zl.Mushroom1,this.mushroom1),this.assets.set(Zl.Mushroom2,this.mushroom2),this.assets.set(Zl.Portal,this.portal),this.assets.set(Zl.Test,this.test),this.assets.set(Zl.Zombie,this.zombie),this.assets.set(Zl.Minataur,this.minatuar),this.assets.set(Zl.CrabMon,this.crab),this.assets.set(Zl.BatPig,this.batpig),this.assets.set(Zl.BirdMon,this.birdmon),this.assets.set(Zl.Bilby,this.bilby),this.assets.set(Zl.WereWolf,this.werewolf),this.assets.set(Zl.Golem,this.golem),this.assets.set(Zl.BigGolem,this.biggolem),this.assets.set(Zl.Snake,this.snake),this.assets.set(Zl.Viking,this.viking),this.assets.set(Zl.Builder,this.builder),this.assets.set(Zl.ToadMage,this.toadmage),this.assets.set(Zl.KittenMonk,this.kittenmonk),this.assets.set(Zl.Skeleton,this.skeleton),this.assets.set(Zl.Bat,this.bat),this.assets.set(Zl.Gun,this.gun),this.assets.set(Zl.WarteringCan,this.wartercan),this.assets.set(Zl.Hammer,this.hammer),this.assets.set(Zl.AppleTree,this.appleTree),this.assets.set(Zl.Apple,this.apple),this.assets.set(Zl.CoconutTree,this.coconutTree),this.assets.set(Zl.Coconut,this.coconut),this.assets.set(Zl.DeadTree2,this.deadTree2),this.assets.set(Zl.Tomato0,this.tomato0),this.assets.set(Zl.Tomato1,this.tomato1),this.assets.set(Zl.Tomato2,this.tomato2),this.assets.set(Zl.Potato0,this.potato0),this.assets.set(Zl.Potato1,this.potato1),this.assets.set(Zl.Potato2,this.potato2),this.assets.set(Zl.Carrot0,this.carrot0),this.assets.set(Zl.Carrot1,this.carrot1),this.assets.set(Zl.Carrot2,this.carrot2),this.assets.set(Zl.Stone,this.stone),this.assets.set(Zl.Bed,this.bed),this.assets.set(Zl.Bath,this.bath),this.assets.set(Zl.Bookshelf,this.bookshelf),this.assets.set(Zl.Closet,this.closet),this.assets.set(Zl.Desk,this.desk),this.assets.set(Zl.Kitchen,this.kitchen),this.assets.set(Zl.KitTable,this.kitTable),this.assets.set(Zl.Oven,this.oven),this.assets.set(Zl.Refrigerator,this.refrigerator),this.assets.set(Zl.Sink,this.sink),this.assets.set(Zl.Table,this.table),this.assets.set(Zl.Toilet,this.toilet),this.assets.set(Zl.TV,this.tv);const t=document.querySelector("#progress-bar");this.LoadingManager.onProgress=(e,i,n)=>{t.value=i/n*100}}GetAssets(t){const e=this.assets.get(t);return null==e?this.MaleAsset:e}}const sS={rand_range:function(t,e){return Math.random()*(e-t)+t},rand_normalish:function(){return(Math.random()+Math.random()+Math.random()+Math.random())/4*2-1},rand_int:function(t,e){return Math.round(Math.random()*(e-t)+t)},lerp:function(t,e,i){return t*(i-e)+e},smoothstep:function(t,e,i){return(t=t*t*(3-2*t))*(i-e)+e},smootherstep:function(t,e,i){return(t=t*t*t*(t*(6*t-15)+10))*(i-e)+e},clamp:function(t,e,i){return Math.min(Math.max(t,e),i)},sat:function(t){return Math.min(Math.max(t,0),1)},in_range:(t,e,i)=>t>=e&&t<=i};var rS=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class oS extends xc{constructor(t){super(t)}Init(){return rS(this,void 0,void 0,(function*(){}))}MassLoader(t,e,i){return rS(this,void 0,void 0,(function*(){this.meshs=t.clone(),this.meshs.scale.set(e,e,e),this.meshs.position.set(i.x,i.y,i.z),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}))}))}}var aS=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class hS extends xc{constructor(t){super(t),this.meshs=new Po}Init(){return aS(this,void 0,void 0,(function*(){}))}MassLoader(t,e,i,n){this.meshs=t.clone(),this.meshs.scale.set(e,e,e),this.meshs.position.set(i.x,i.y,i.z),this.meshs.castShadow=!1,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!1,t.receiveShadow=!0})),this.meshs.rotateY(n)}}var lS=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class cS extends xc{get BoxPos(){return this.asset.GetBoxPos(this.meshs)}constructor(t,e,i,n){super(t),this.store=e,this.gphysic=n,this.controllerEnable=!1,this.movePos=new Pe,e.RegisterStore(this),i.RegisterInputEvent(((t,e,i)=>{this.controllerEnable&&("move"==t.type?this.movePos.copy(i):"end"==t.type&&this.moveEvent(this.movePos))})),i.RegisterKeyDownEvent((t=>{if(!this.controllerEnable)return;const e=t.ExecuteKeyDown();this.moveEvent(e)})),i.RegisterAppModeEvent(((t,e)=>{if(t==qE.Portal)switch(e){case nc.Start:this.controllerEnable=!0;break;case nc.End:this.controllerEnable=!1}}))}moveEvent(t){const e=t.x*this.Size.x/2,i=t.z*this.Size.z/2;if(this.meshs.position.x+=e,this.meshs.position.y=0,this.meshs.position.z+=i,this.gphysic.Check(this))do{this.meshs.position.y+=.2}while(this.gphysic.Check(this));else{do{this.meshs.position.y-=.2}while(!this.gphysic.Check(this)&&this.meshs.position.y>=4.7);this.meshs.position.y+=.2}this.store.Portal=this.meshs.position}Viliageload(){return lS(this,void 0,void 0,(function*(){this.meshs.position.copy(ic.DefaultPortalPosition)}))}Reload(){return lS(this,void 0,void 0,(function*(){this.meshs.position.copy(ic.DefaultPortalPosition);const t=this.store.Portal;null!=t&&this.meshs.position.copy(t)}))}Loader(t){return lS(this,void 0,void 0,(function*(){this.meshs=yield this.asset.CloneModel(),this.meshs.position.copy(t),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}))}))}}class uS extends _c{get BoxPos(){return this.position}constructor(t,e,i){const n=new Ln(1,1,1),s=new Ah({transparent:!0,color:i,emissiveIntensity:0});super(n,s),this.castShadow=!0,this.receiveShadow=!0,this.size=e,this.scale.copy(e),this._geometry=n,this._material=s,this.Init(t)}Init(t){this.position.copy(t)}Dispose(){this._geometry.dispose(),this._material.dispose()}}class dS{get Size(){return this.size}get BoxPos(){return this.position}set Key(t){this.key=t}get Key(){return this.key}constructor(t,e){this.size=t,this.position=e,this.key=""}Dispose(){this.brick&&this.brick.Dispose()}}class pS{constructor(t,e,i,n,s,r,o){this.scene=t,this.eventCtrl=e,this.store=i,this.physics=n,this.player=s,this.mode=r,this.save=o,this.bricks2=[],this.eventbricks=[],this.deleteMode=!1,this.brickType=fS.Event,this.brickSize=new Pe(1,1,1),this.brickColor=new Yi(16777215),this.subV=new Pe(.1,.1,.1),this.movePos=new Pe,this.fieldWidth=ic.LegoFieldW,this.fieldHeight=ic.LegoFieldH,e.RegisterInputEvent(((t,e,i)=>{null!=this.brickGuide&&this.brickGuide.ControllerEnable&&(this.currentMode!=qE.LegoDelete&&this.mode!=this.currentMode||("move"==t.type?(this.movePos.copy(i),this.moveEvent(this.movePos)):"end"==t.type&&this.moveEvent(this.movePos)))})),e.RegisterKeyDownEvent((t=>{if(null==this.brickGuide||!this.brickGuide.ControllerEnable)return;if(this.currentMode!=qE.LegoDelete&&this.mode!=this.currentMode)return;const e=t.ExecuteKeyDown();this.moveEvent(e)})),this.brickfield=new kn(new es(this.fieldWidth,this.fieldHeight),new Qi({color:255,side:2,opacity:.3,transparent:!0})),this.brickfield.position.z+=this.fieldHeight/2,this.brickfield.position.y=.01,this.brickfield.rotation.x=Math.PI/2,this.brickfield.visible=!1,this.scene.add(this.brickfield)}moveEvent(t){if(null==this.brickGuide)return;const e=t.x>0?1:t.x<0?-1:0,i=t.z>0?1:t.z<0?-1:0;t.y>0?this.deleteMode?this.DeleteBrick():this.CreateBrickEvent():(this.brickGuide.position.x+=e,this.brickGuide.position.y=Math.ceil(this.brickGuide.position.y),this.brickGuide.position.z+=i),this.CheckCollision()}GetCollisionBox(){if(null==this.brickGuide)return[void 0,[""]];this.brickGuide.position.y-=1;const t=this.brickGuide.Box;let[e,i]=this.physics.GetCollisionBox(this.brickGuide.position,t);if(this.brickGuide.position.y+=1,e){const[t,n]=this.physics.GetCollisionBox(e.pos,e.box);i=n}return[null==e?void 0:e.model,i]}DeleteBrick(){const[t,e]=this.GetCollisionBox();if(null==t)return;this.physics.DeleteBox(e,t);const i=t instanceof uS?t:t.brick;if(null==i)throw"error";this.scene.remove(i),i.Dispose(),this.DeleteLegos(i)}DeleteLegos(t){const e=this.save;for(let i=0;i<e.length;i++)this.VEqual(e[i].position,t.position)&&(e.splice(i,1),i--)}VEqual(t,e){return t.x==e.x&&t.y==e.y&&t.z==e.z}CreateBrickEvent(){if(null==this.brickGuide||!this.brickGuide.Creation)return;const t=new uS(this.brickGuide.position,this.brickSize,this.brickColor);t.rotation.copy(this.brickGuide.Meshs.rotation),this.save.push({position:t.position,size:(new Pe).copy(this.brickSize),rotation:t.rotation,color:t.Meshs.material.color,type:this.brickGuide.ShapeType}),this.scene.add(t),this.bricks2.push(t);const e=new Pe(.1,.1,.1),i=(new Pe).copy(this.brickSize).sub(e),n=new dS(this.brickSize,t.position);n.brick=t,this.eventbricks.push(n),this.physics.addBuilding(n,t.position,i,t.rotation),t.Visible=!0}ClearBlock(){this.bricks2.forEach((t=>{this.scene.remove(t),t.Dispose()})),this.bricks2.length=0,null!=this.instancedBlock&&(this.scene.remove(this.instancedBlock),this.instancedBlock.geometry.dispose(),this.instancedBlock.material.dispose(),this.instancedBlock.dispose(),this.instancedBlock=void 0)}GetBrickGuide(t){return null==t&&(t=(new Pe).copy(this.brickfield.position)),t.x=Math.ceil(t.x),t.y=Math.ceil(t.y),t.z=Math.ceil(t.z),t.y<2&&(t.y=2),null==this.brickGuide?(this.brickGuide=new yS(t,this.brickSize,this.brickType),this.scene.add(this.brickGuide),this.brickfield.visible=!0):(this.brickGuide.Init(t),this.brickGuide.Visible=!0,this.brickfield.visible=!0),this.eventCtrl.OnChangeCtrlObjEvent(this.brickGuide),this.CheckCollision(),this.brickGuide}CheckCollision(){if(null==this.brickGuide)return;this.brickGuide.CannonPos.x=Math.ceil(this.brickGuide.CannonPos.x),this.brickGuide.CannonPos.z=Math.ceil(this.brickGuide.CannonPos.z);const t=this.brickGuide.Size.y/2;if(this.brickGuide.CannonPos.y=this.brickGuide.CannonPos.y<t?t:this.brickGuide.CannonPos.y,this.physics.CheckBox(this.brickGuide.position,this.brickGuide.Box))do{this.brickGuide.CannonPos.y+=.5}while(this.physics.CheckBox(this.brickGuide.position,this.brickGuide.Box));else{do{this.brickGuide.CannonPos.y-=.5}while(!this.physics.CheckBox(this.brickGuide.position,this.brickGuide.Box)&&this.brickGuide.CannonPos.y>=t);this.brickGuide.CannonPos.y+=.5}this.currentMode!=qE.LegoDelete&&this.checkEx&&this.checkEx()}ClearEventBrick(){this.eventbricks.length=0}}var mS,fS,gS=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};!function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundCorner=1]="RoundCorner"}(mS||(mS={}));class vS extends pS{get Size(){return this.brickGuide?this.brickGuide.Size:this.brickSize}constructor(t,e,i,n,s){super(t,e,i,n,s,qE.Lego,i.Legos),i.RegisterStore(this),this.brickType=fS.Lego,this.dom=document.createElement("div"),this.drawHtml(this.dom),e.RegisterBrickInfo((t=>{if(t.clear){const t=this.store.Legos;t&&(t.length=0);const e=this.store.NonLegos;e&&(e.length=0);const i=this.store.Bricks;i&&(i.length=0)}null!=this.brickGuide&&(t.v&&(this.brickSize.copy(t.v),this.brickGuide.Meshs.scale.copy(t.v)),t.r&&(this.brickGuide.Meshs.rotateX(ie.degToRad(t.r.x)),this.brickGuide.Meshs.rotateY(ie.degToRad(t.r.y)),this.brickGuide.Meshs.rotateZ(ie.degToRad(t.r.z))),t.color&&this.brickColor.set(t.color),this.CheckCollision())})),this.eventCtrl.RegisterAppModeEvent(((t,e)=>{if(this.currentMode=t,this.deleteMode=t==qE.LegoDelete,t==qE.Lego||t==qE.LegoDelete)switch(null==this.brickGuide&&(this.brickGuide=this.GetBrickGuide(this.player.CenterPos)),e){case nc.Start:this.brickGuide.ControllerEnable=!0,this.brickGuide.Visible=!0,this.brickGuide.position.copy(this.player.CannonPos),this.brickfield.visible=!0,this.deleteMode&&(this.dom.style.display="block",this.brickGuide.scale.set(1,1,1),this.brickSize.set(1,1,1)),this.eventCtrl.OnChangeCtrlObjEvent(this.brickGuide),this.CheckCollision();break;case nc.End:this.deleteMode&&(this.dom.style.display="none"),this.brickGuide.ControllerEnable=!1,this.brickGuide.Visible=!1,this.brickfield.visible=!1}})),this.checkEx=()=>{if(!this.brickGuide)return;const t=(new Pe).copy(this.brickfield.position);t.x-=this.fieldWidth/2,t.z-=this.fieldHeight/2;const e=(new Pe).copy(this.brickGuide.position),i=this.brickGuide.Size;e.x-=i.x/2,e.z-=i.z/2,e.x>=t.x&&e.x+i.x<=t.x+this.fieldWidth&&e.z>=t.z&&e.z+i.z<=t.z+this.fieldHeight?this.brickGuide.Creation=!0:this.brickGuide.Creation=!1}}ChangeGuide(){}EditMode(){this.ClearBlock(),this.CreateBricks()}CreateBricks(){const t=this.store.Legos,e=new Pe;t.forEach((t=>{const i=new uS(t.position,t.size,t.color);i.rotation.copy(t.rotation),this.scene.add(i),this.bricks2.push(i),e.copy(t.size).sub(this.subV),this.physics.addBuilding(i,t.position,e,i.rotation)}))}CreateInstacedMesh(){const t=this.store.Legos;if(!(null==t?void 0:t.length))return;const e=new Ln(1,1,1),i=new Rh({color:16777215,transparent:!0});this.instancedBlock=new Aa(e,i,t.length),this.instancedBlock.castShadow=!0,this.instancedBlock.receiveShadow=!0;const n=new ai,s=new Pe,r=new Re;t.forEach(((t,e)=>{var i,o;r.setFromEuler(t.rotation),n.compose(t.position,r,t.size),null===(i=this.instancedBlock)||void 0===i||i.setColorAt(e,new Yi(t.color)),null===(o=this.instancedBlock)||void 0===o||o.setMatrixAt(e,n),s.copy(t.size).sub(this.subV);const a=new dS(this.brickSize,t.position);this.eventbricks.push(a),this.physics.addBuilding(a,t.position,s,t.rotation)})),this.scene.add(this.instancedBlock)}Viliageload(){return gS(this,void 0,void 0,(function*(){this.ClearBlock(),this.ClearEventBrick(),this.CreateInstacedMesh()}))}Reload(){return gS(this,void 0,void 0,(function*(){this.ClearBlock(),this.ClearEventBrick(),this.CreateBricks()}))}drawHtml(t){t.className="brickctrl border rounded p-2 m-1",t.innerHTML='\n        <div class="row">\n            <div class="col text-white">\n                <div class="border rounded bg-secondary p-2 d-inline-block">space</div> or\n                <span class="material-symbols-outlined align-middle">\n                close\n                </span> = 삭제\n            </div>\n            <div class="col p-2 text-center handcursor">\n                <span class="material-symbols-outlined" id="lego_exit">\n                    disabled_by_default\n                </span>\n            </div>\n        </div>\n        ',t.style.display="none",document.body.appendChild(t);const e=document.getElementById("lego_exit");e&&(e.onclick=()=>{this.eventCtrl.OnAppModeEvent(qE.EditPlay),e.style.display="none"})}}!function(t){t[t.Lego=0]="Lego",t[t.NonLego=1]="NonLego",t[t.Delete=2]="Delete",t[t.Event=3]="Event"}(fS||(fS={}));class yS extends _c{get Creation(){return this.creationFlag}set Creation(t){t?this.material.color.setHex(65280):this.material.color.setHex(16711680),this.creationFlag=t}get BoxPos(){return this.position}set ControllerEnable(t){this.contollerEnable=t}get ControllerEnable(){return this.contollerEnable}constructor(t,e,i){super(new Ln(1,1,1),new Ah({color:new Yi(0,255,0),transparent:!0,opacity:.5})),this.ShapeType=mS.Rectangle,this.contollerEnable=!0,this.creationFlag=!1,this.castShadow=!0,this.size=e,this.scale.copy(e),this.Init(t)}Init(t){const e=t.x-t.x%this.Size.x,i=t.z-t.z%this.Size.z;this.position.set(e,t.y,i),this.position.y=this.CenterPos.y}}var xS=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class _S extends pS{get Size(){return this.brickSize}constructor(t,e,i,n,s){super(t,e,i,n,s,qE.Brick,i.Legos),this.bricks=[],this.brickType=fS.Event,this.brickSize.set(3,3,3),i.RegisterStore(this),this.eventCtrl.RegisterAppModeEvent(((t,e)=>{if(this.currentMode=t,this.deleteMode=t==qE.LegoDelete,t==qE.Brick&&null!=this.brickGuide)switch(e){case nc.Start:this.brickGuide.ControllerEnable=!0,this.brickGuide.Visible=!0,this.brickfield.visible=!0,this.eventCtrl.OnChangeCtrlObjEvent(this.brickGuide),this.CheckCollision();break;case nc.End:this.brickGuide.ControllerEnable=!1,this.brickGuide.Visible=!1,this.brickfield.visible=!1}})),this.checkEx=()=>{if(!this.brickGuide)return;const t=(new Pe).copy(this.brickfield.position);t.x-=this.fieldWidth/2,t.z-=this.fieldHeight/2;const e=(new Pe).copy(this.brickGuide.position),i=this.brickGuide.Size;e.x-=i.x/2,e.z-=i.z/2,e.x>=t.x&&e.x+i.x<=t.x+this.fieldWidth&&e.z>=t.z&&e.z+i.z<=t.z+this.fieldHeight?this.brickGuide.Creation=!1:this.brickGuide.Creation=!0}}Init(){return xS(this,void 0,void 0,(function*(){}))}EditMode(){this.ClearBlock(),this.ClearEventBrick();const t=this.store.Bricks,e=new Pe;t.forEach((t=>{const i=new uS(t.position,this.brickSize,t.color);this.scene.add(i),this.bricks2.push(i),e.copy(this.brickSize).sub(this.subV),this.physics.addBuilding(i,t.position,e,i.rotation)}))}CreateInstacedMesh(t){const e=new Ln(1,1,1),i=new Ah({color:16777215,transparent:!0});return this.instancedBlock=new Aa(e,i,t),this.instancedBlock.castShadow=!0,this.instancedBlock.receiveShadow=!0,this.instancedBlock}Viliageload(){return xS(this,void 0,void 0,(function*(){this.ClearBlock(),this.ClearEventBrick()}))}Reload(){return xS(this,void 0,void 0,(function*(){this.ClearBlock(),this.ClearEventBrick();const t=this.store.Bricks;if(0==t.length)return;if(this.deleteMode)return void this.EditMode();this.instancedBlock=this.CreateInstacedMesh(t.length);const e=new ai,i=new Re,n=(new Pe).copy(this.brickSize).sub(this.subV);t.forEach(((t,s)=>{var r;e.compose(t.position,i,this.brickSize),null===(r=this.instancedBlock)||void 0===r||r.setMatrixAt(s,e);const o=new dS(this.brickSize,t.position);this.eventbricks.push(o),this.physics.addBuilding(o,t.position,n)})),this.scene.add(this.instancedBlock)}))}}class bS extends ia{constructor(t){const e=document.createElement("canvas"),i=e.getContext("2d");if(null==i)super();else{i.canvas.width=256,i.canvas.height=128,i.fillStyle="#FFF",i.font="18pt Helvetica",i.shadowOffsetX=3,i.shadowOffsetY=3,i.shadowColor="rgba(0,255,0,0.3)",i.shadowBlur=2,i.textAlign="center",i.fillText(t,128,64);const e=new Xa(i.canvas);super(new Ho({map:e,color:16777215,fog:!1,depthTest:!1})),this.scale.set(2,1,1),this.position.y=2}this.params_=t,this.visible_=!0,this.element_=e,this.context2d_=i}Destroy(){this.traverse((t=>{if(t instanceof kn){if(t.material){let e=t.material;t.material instanceof Array||(e=[t.material]);for(let t of e)t.dispose()}t.geometry&&t.geometry.dispose()}})),this.parent&&this.parent.remove(this)}InitComponent(){}OnDeath_(){this.Destroy()}SetText(t){if(!this.visible_||null==this.context2d_)return;this.params_=t,this.context2d_.canvas.width=256,this.context2d_.canvas.height=128,this.context2d_.fillStyle="#FFF",this.context2d_.font="18pt Helvetica",this.context2d_.shadowOffsetX=3,this.context2d_.shadowOffsetY=3,this.context2d_.shadowColor="rgba(0,0,0,0.5)",this.context2d_.shadowBlur=4,this.context2d_.textAlign="center",this.context2d_.fillText(this.params_,128,64);const e=new Xa(this.context2d_.canvas);this.material=new Ho({map:e,color:16777215,fog:!1,depthTest:!1}),this.scale.set(4,2,1),this.position.y=2}}var wS=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class MS extends xc{get BoxPos(){return this.asset.GetBoxPos(this.meshs)}get Model(){return this.asset.Id}set ControllerEnable(t){this.controllerEnable=t}get ControllerEnable(){return this.controllerEnable}constructor(t,e,i){super(i),this.gphysic=e,this.currentActionType=Ef.Idle,this.clipMap=new Map,this.controllerEnable=!1,this.movePos=new Pe,this.vFlag=!0,this.clock=new Sl,this.text=new bS("Welcome"),t.RegisterInputEvent(((t,e,i)=>{this.controllerEnable&&("move"==t.type?this.movePos.copy(i):"end"==t.type&&this.moveEvent(this.movePos))})),t.RegisterKeyDownEvent((t=>{if(!this.controllerEnable)return;const e=t.ExecuteKeyDown();this.moveEvent(e)}))}moveEvent(t){const e=t.x>0?1:t.x<0?-1:0,i=t.z>0?1:t.z<0?-1:0;if(this.meshs.position.x+=e,this.meshs.position.z+=i,this.gphysic.Check(this))do{this.meshs.position.y+=.2}while(this.gphysic.Check(this));else{do{this.meshs.position.y-=.2}while(!this.gphysic.Check(this)&&this.meshs.position.y>=0);this.meshs.position.y+=.2}}Init(t){return wS(this,void 0,void 0,(function*(){null!=this.text&&(this.text.SetText(t),this.text.position.y+=3)}))}Loader(t,e,i){return wS(this,void 0,void 0,(function*(){this.asset=t;const[n,s]=yield t.UniqModel(i);if(this.meshs=n,this.meshs.position.set(e.x,e.y,e.z),s&&null!=this.text&&this.meshs.remove(this.text),null!=this.text&&(this.text.SetText(i),this.text.position.y+=3,this.meshs.add(this.text)),this.mixer=this.asset.GetMixer(i),null==this.mixer)throw new Error("mixer is undefined");this.clipMap.set(Ef.Idle,this.asset.GetAnimationClip(Kl.Idle)),this.clipMap.set(Ef.Run,this.asset.GetAnimationClip(Kl.Run)),this.clipMap.set(Ef.Jump,this.asset.GetAnimationClip(Kl.Jump)),this.clipMap.set(Ef.Punch,this.asset.GetAnimationClip(Kl.Punch)),this.clipMap.set(Ef.Fight,this.asset.GetAnimationClip(Kl.FightIdle)),this.clipMap.set(Ef.Dance,this.asset.GetAnimationClip(Kl.Dance0)),this.clipMap.set(Ef.PickFruit,this.asset.GetAnimationClip(Kl.PickFruit)),this.clipMap.set(Ef.PickFruitTree,this.asset.GetAnimationClip(Kl.PickFruitTree)),this.clipMap.set(Ef.PlantAPlant,this.asset.GetAnimationClip(Kl.PlantAPlant)),this.clipMap.set(Ef.Watering,this.asset.GetAnimationClip(Kl.Wartering)),this.clipMap.set(Ef.Hammering,this.asset.GetAnimationClip(Kl.Hammering)),this.clipMap.set(Ef.Building,this.asset.GetAnimationClip(Kl.Hammering)),this.changeAnimate(this.clipMap.get(this.currentActionType)),this.Visible=!1}))}ChangeAction(t,e){this.currentActionType=t,this.changeAnimate(this.clipMap.get(t),e)}changeAnimate(t,e){var i,n;if(null==t)return;const s=null===(i=this.mixer)||void 0===i?void 0:i.clipAction(t);if(null==s)return;null===(n=this.currentAni)||void 0===n||n.fadeOut(.2),null!=e&&(s.timeScale=t.duration/e),s.setLoop(xt,1e4),s.reset().fadeIn(.2).play(),this.currentAni=s,this.currentClip=t}resize(){}update(){var t;const e=this.clock.getDelta();null===(t=this.mixer)||void 0===t||t.update(e)}UpdatePhysics(){}}var SS=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class TS{get Helper(){return this.helper}get Helper2(){return this.helper2}get Owner(){return this.owner}constructor(t,e,i,n,s,r){this.loader=t,this.eventCtrl=e,this.game=i,this.canvas=n,this.store=s,this.ownerModel=Zl.Male,this.helper=new MS(e,r,t.MaleAsset),this.helper2=new MS(e,r,t.FemaleAsset),this.owner=new MS(e,r,t.MaleAsset),this.store.RegisterStore(this),this.canvas.RegisterViewer(this.helper),this.canvas.RegisterViewer(this.helper2),this.canvas.RegisterViewer(this.owner),this.eventCtrl.RegisterAppModeEvent(((t,e)=>{switch(t){case qE.Weapon:case qE.Farmer:case qE.Furniture:case qE.EditPlay:case qE.Brick:case qE.Lego:case qE.LegoDelete:switch(e){case nc.Start:this.owner.Visible=!1,this.owner.ControllerEnable=!1;break;case nc.End:this.eventCtrl.OnChangeCtrlObjEvent(),this.owner.Visible=!0}break;case qE.Close:case qE.Face:this.eventCtrl.OnChangeCtrlObjEvent(this.owner);case qE.Play:switch(e){case nc.Start:this.owner.Visible=!0,this.owner.ControllerEnable=!1;break;case nc.End:this.eventCtrl.OnChangeCtrlObjEvent(),this.owner.Visible=!1}break;case qE.Long:switch(e){case nc.Start:this.eventCtrl.OnChangeCtrlObjEvent(this.helper),this.owner.Visible=!1,this.helper.Visible=!0,this.helper2.Visible=!0;break;case nc.End:this.helper.Visible=!1,this.helper2.Visible=!1}}}))}CreateOwner(t){return SS(this,void 0,void 0,(function*(){t.model!=this.ownerModel?(this.game.remove(this.owner.Meshs),this.ownerModel=t.model,yield this.owner.Loader(this.loader.GetAssets(this.ownerModel),t.position,t.name),this.game.add(this.owner.Meshs)):(this.owner.Init(t.name),this.owner.CannonPos=t.position),this.owner.ChangeAction(t.actionType),this.owner.Visible=!0}))}NpcLoader(){return SS(this,void 0,void 0,(function*(){const t=ic.DefaultPortalPosition;return yield Promise.all([this.helper.Loader(this.loader.MaleAsset,new Pe(t.x-6,0,t.z+10),"여관 주인"),this.helper2.Loader(this.loader.FemaleAsset,new Pe(t.x-4,0,t.z+10),"Eve"),this.owner.Loader(this.loader.GetAssets(this.ownerModel),new Pe(10,0,15),"unknown")])}))}Viliageload(){return SS(this,void 0,void 0,(function*(){this.game.remove(this.owner.Meshs)}))}Reload(){return SS(this,void 0,void 0,(function*(){this.game.add(this.owner.Meshs);const t=this.store.Owner,e={name:this.store.Name,position:null==t?new Pe(10,5,15):(new Pe).copy(t),model:null==this.store.OwnerModel?Zl.Male:this.store.OwnerModel,actionType:this.store.OwnerAction};yield this.CreateOwner(e)}))}InitScene(){this.game.add(this.helper.Meshs,this.helper2.Meshs,this.owner.Meshs)}}var ES=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class AS{set Portal(t){this.data.portal=null==this.data.portal?(new Pe).copy(t):this.data.portal.copy(t)}get Portal(){return this.data.portal}get Plants(){return this.data.plants?this.data.plants:this.data.plants=[]}get Deck(){return this.data.monDeck?this.data.monDeck:this.data.monDeck=[]}get Furn(){return this.data.furn?this.data.furn:this.data.furn=[]}get Legos(){return this.data.legos?this.data.legos:this.data.legos=[]}get NonLegos(){return this.data.nonlegos?this.data.nonlegos:this.data.nonlegos=[]}get Bricks(){return this.data.bricks}get Owner(){return this.data.owner}set Owner(t){t&&null!=this.data.owner&&(this.data.owner.x=t.x,this.data.owner.y=t.y,this.data.owner.z=t.z)}get OwnerModel(){return this.data.ownerModel}get OwnerAction(){return this.data.ownerAction}get PlayerModel(){return this.playerModel}get Name(){return this.name}constructor(t,e){this.eventCtrl=t,this.invenFab=e,this.mgrs=[],this.playerModel=Zl.Male,this.data={furn:[],plants:[],monDeck:[],bricks:[],legos:[],nonlegos:[],owner:void 0,ownerModel:Zl.Male,ownerAction:Ef.Idle,portal:void 0},this.owners=new Array,this.ownerModels=new Array,this.name="unknown",this.eventCtrl.RegisterReloadEvent((()=>ES(this,void 0,void 0,(function*(){const t=this.mgrs.map((t=>ES(this,void 0,void 0,(function*(){yield t.Reload()}))));yield Promise.all(t)}))))}RegisterStore(t){this.mgrs.push(t)}RegisterPlayer(t,e){this.player=t,this.mgrs.push(e)}ChangeCharactor(t){this.data.ownerModel=t,this.mgrs.forEach((t=>ES(this,void 0,void 0,(function*(){yield t.Reload()}))))}StoreInventory(){return JSON.stringify(this.invenFab.invenHouse.data)}LoadInventory(t){return null!=t&&(this.invenFab.invenHouse.Copy(t),this.eventCtrl.OnChangeEquipmentEvent(this.invenFab.invenHouse)),this.invenFab.invenHouse}ChangeInventory(t){return null!=t&&(this.invenFab.inven.Copy(t),this.eventCtrl.OnChangeEquipmentEvent(this.invenFab.inven)),this.invenFab.inven}GetEmptyInventory(){return this.invenFab.inven}StoreModels(){var t,e;this.data.owner=null===(t=this.player)||void 0===t?void 0:t.Meshs.position,this.data.ownerModel=null===(e=this.player)||void 0===e?void 0:e.Model,this.data.ownerAction=this.player?this.player.ActionType:Ef.Idle;return JSON.stringify(this.data)}LoadModelsEmpty(t,e){return ES(this,void 0,void 0,(function*(){if(null!=e){const t=JSON.parse(e);this.playerModel=t.ownerModel}this.name=t,this.data.legos.length=0,this.data.bricks.length=0,this.data.owner=void 0,this.data.ownerModel=Zl.Male,this.data.portal=ic.DefaultPortalPosition;const i=this.mgrs.map((t=>ES(this,void 0,void 0,(function*(){yield t.Reload()}))));yield Promise.all(i)}))}LoadModels(t,e,i){var n,s,r;return ES(this,void 0,void 0,(function*(){if(null!=i){const t=JSON.parse(i);this.playerModel=t.ownerModel}this.name=e,this.data=JSON.parse(t),this.data.portal=new Pe(null===(n=this.data.portal)||void 0===n?void 0:n.x,null===(s=this.data.portal)||void 0===s?void 0:s.y,null===(r=this.data.portal)||void 0===r?void 0:r.z);const o=this.mgrs.map((t=>ES(this,void 0,void 0,(function*(){yield t.Reload()}))));yield Promise.all(o)}))}LoadVillage(t,e){return ES(this,void 0,void 0,(function*(){if(null!=e){const t=JSON.parse(e);this.playerModel=t.ownerModel}let i=-1;this.data.legos.length=0,this.owners.length=0,this.ownerModels.length=0,t.forEach((t=>{var e,n,s;i++;const r=JSON.parse(t);0!=i?(r.legos.forEach((t=>{t.position.x-=ic.LegoFieldW*i})),this.data.legos.push(...r.legos),this.data.portal=new Pe(null===(e=r.portal)||void 0===e?void 0:e.x,null===(n=r.portal)||void 0===n?void 0:n.y,null===(s=r.portal)||void 0===s?void 0:s.z),this.owners.push(r.owner),this.ownerModels.push(r.ownerModel)):this.data.legos.push(...r.legos)}));const n=this.mgrs.map((t=>ES(this,void 0,void 0,(function*(){yield t.Viliageload()}))));yield Promise.all(n)}))}}class CS{get LandY(){return this.landPos.y}constructor(t,e){this.scene=t,this.movingBoxs=[],this.landPos=new Pe,this.objs=[],this.pboxs=new Map,this.debugBoxMat=new Qi({color:16777215,wireframe:!0}),this.debugBox=[],this.optx=10,this.opty=10,this.optz=10,this.clock=new Sl,e.RegisterSceneClearEvent((()=>{this.PBoxDispose()}))}Register(t){this.objs.push(t)}DebugMode(t){t?(this.movingBoxs.forEach((t=>{t.box&&this.scene.remove(t.box)})),this.debugBox.forEach((t=>{this.scene.remove(t)}))):(this.movingBoxs.forEach((t=>{t.box&&this.scene.add(t.box)})),this.debugBox.forEach((t=>{this.scene.add(t)})))}PBoxDispose(){this.pboxs.clear(),this.debugBox.forEach((t=>{this.scene.remove(t)})),this.debugBox.length=0}addPlayer(t){const e=new kn(new Ln(t.Size.x,t.Size.y,t.Size.z),this.debugBoxMat);this.player=t,this.movingBoxs.push({model:t,box:e})}add(...t){t.forEach((t=>{const e=new kn(new Ln(t.Size.x,t.Size.y,t.Size.z),this.debugBoxMat);this.movingBoxs.push({model:t,box:e})}))}addMeshBuilding(...t){t.forEach((t=>{const e=new kn(new Ln(t.Size.x,t.Size.y,t.Size.z),this.debugBoxMat),i=t.BoxPos;e.position.set(i.x,i.y,i.z),this.debugBox.push(e),this.addBoxs({pos:i,box:(new Le).setFromObject(e),model:t})}))}addBuilding(t,e,i,n){const s=new kn(new Ln(1,1,1),this.debugBoxMat);s.position.copy(e),s.scale.copy(i),n&&s.rotation.copy(n),this.debugBox.push(s),this.addBoxs({pos:e,box:(new Le).setFromObject(s),model:t})}addLand(t){this.landPos.y=0}makeHash(t,e){const i=Math.floor(Math.floor(t.x)/this.optx),n=Math.floor(Math.floor(t.y)/this.opty),s=Math.floor(Math.floor(t.z)/this.optz),r=Math.ceil(Math.ceil(t.x+e.x)/this.optx),o=Math.ceil(Math.ceil(t.y+e.y)/this.opty),a=Math.ceil(Math.ceil(t.z+e.z)/this.optz),h=[];for(let t=i;t<=r;t++)for(let e=n;e<=o;e++)for(let i=s;i<=a;i++)h.push(t+"."+e+"."+i);return h}addBoxs(t){const e=t.pos;this.makeHash(e,t.box.getSize(new Pe)).forEach((e=>{const i=this.pboxs.get(e);null==i?this.pboxs.set(e,[t]):i.push(t)}))}Check(t){const e=t.BoxPos;if(e.y-t.Size.y/2<this.landPos.y)return!0;return this.makeHash(e,t.Size).some((e=>{const i=this.pboxs.get(e);if(null==i)return!1;const n=t.Box;return i.some((t=>!!n.intersectsBox(t.box)))}))}CheckBox(t,e){return this.makeHash(t,e.getSize(new Pe)).some((t=>{const i=this.pboxs.get(t);if(null==i)return!1;const n=e;return i.some((t=>!!n.intersectsBox(t.box)))}))}DeleteBox(t,e){t.forEach((t=>{const i=this.pboxs.get(t);if(null==i)return!1;for(let t=i.length-1;t>=0;t--)i[t].model==e&&i.splice(t,1)}))}GetCollisionBox(t,e){const i=this.makeHash(t,e.getSize(new Pe));let n;const s=[];return i.some((t=>{const i=this.pboxs.get(t);if(null==i)return!1;const r=e;i.some((e=>{r.intersectsBox(e.box)&&(n=e,s.push(t))}))})),[n,s]}checkGravity(t){if(null!=this.player&&0!=this.player.Velocity){const e=this.player.Velocity*t;this.player.Meshs.position.y-=e,this.Check(this.player)&&(this.player.Meshs.position.y+=e,this.player.Velocity=0),this.player.Velocity-=19.6*t}}update(){const t=this.clock.getDelta();this.objs.forEach((e=>{e.update(t)})),this.movingBoxs.forEach((t=>{const e=t.model.BoxPos;null!=t.box&&t.box.position.copy(e)}))}}class IS{constructor(t,e,i){this.playerCtrl=t,this.player=e,this.gphysic=i}DefaultCheck(){const t=this.CheckRun();if(null!=t)return t;const e=this.CheckAttack();if(null!=e)return e;const i=this.CheckJump();if(null!=i)return i;const n=this.CheckMagic();if(null!=n)return n;const s=this.CheckMagic2();return null!=s?s:void 0}CheckRun(){if(this.playerCtrl.moveDirection.x||this.playerCtrl.moveDirection.z)return this.playerCtrl.RunSt.Init(),this.playerCtrl.RunSt}CheckAttack(){if(this.playerCtrl.KeyState[sc.Action1])return this.playerCtrl.mode==qE.Play?(this.playerCtrl.AttackSt.Init(),this.playerCtrl.AttackSt):this.playerCtrl.mode==qE.Weapon?(this.playerCtrl.DeckSt.Init(),this.playerCtrl.DeckSt):(this.playerCtrl.PlantASt.Init(),this.playerCtrl.PlantASt)}CheckMagic(){if(this.playerCtrl.KeyState[sc.Action2])return this.playerCtrl.mode==qE.Play?(this.playerCtrl.MagicH1St.Init(),this.playerCtrl.MagicH1St):(this.playerCtrl.WarteringSt.Init(),this.playerCtrl.WarteringSt)}CheckMagic2(){if(this.playerCtrl.KeyState[sc.Action3])return this.playerCtrl.mode==qE.Play?(this.playerCtrl.MagicH2St.Init(),this.playerCtrl.MagicH2St):(this.playerCtrl.PickFruitTreeSt.Init(),this.playerCtrl.PickFruitTreeSt)}CheckJump(){if(this.playerCtrl.KeyState[sc.Action0])return this.playerCtrl.JumpSt.Init(),this.playerCtrl.JumpSt}CheckGravity(){if(this.player.Meshs.position.y-=.3,!this.gphysic.Check(this.player))return this.player.Meshs.position.y+=.3,this.playerCtrl.JumpSt.Init(),this.playerCtrl.JumpSt.velocity_y=0,this.playerCtrl.JumpSt;this.player.Meshs.position.y+=.3}}class RS extends IS{constructor(t,e,i){super(t,e,i),this.next=this}Init(){var t;const e=null!==(t=this.player.ChangeAction(Ef.MagicH2))&&void 0!==t?t:2;this.next=this,this.keytimeout=setTimeout((()=>{this.Uninit(),this.playerCtrl.AttackIdleSt.Init(),this.next=this.playerCtrl.AttackIdleSt}),1e3*e),this.playerCtrl.RunSt.PreviousState(this.playerCtrl.AttackIdleSt)}Uninit(){null!=this.keytimeout&&clearTimeout(this.keytimeout)}Update(){const t=this.DefaultCheck();return null!=t?(this.Uninit(),t):this.next}}class PS extends IS{constructor(t,e,i){super(t,e,i),this.next=this}Init(){var t;const e=null!==(t=this.player.ChangeAction(Ef.MagicH1))&&void 0!==t?t:2;this.next=this,this.keytimeout=setTimeout((()=>{this.Uninit(),this.playerCtrl.AttackIdleSt.Init(),this.next=this.playerCtrl.AttackIdleSt}),1e3*e),this.playerCtrl.RunSt.PreviousState(this.playerCtrl.AttackIdleSt)}Uninit(){null!=this.keytimeout&&clearTimeout(this.keytimeout)}Update(){const t=this.DefaultCheck();return null!=t?(this.Uninit(),t):this.next}}class kS extends IS{constructor(t,e,i){super(t,e,i)}Init(){this.player.ChangeAction(Ef.Dying)}Uninit(){}Update(){return this}}class DS extends IS{constructor(t,e,i){super(t,e,i),this.Init()}Init(){this.player.ChangeAction(Ef.Idle),this.playerCtrl.RunSt.PreviousState(this)}Uninit(){}Update(){const t=this.DefaultCheck();if(null!=t)return t;const e=this.CheckGravity();return null!=e?e:this}}class LS extends IS{constructor(t,e,i){super(t,e,i),this.speed=10,this.previous=this.playerCtrl.IdleSt,this.ZeroV=new Pe(0,0,0),this.YV=new Pe(0,1,0),this.MX=new ai,this.QT=new Re}Init(){this.player.ChangeAction(Ef.Run)}Uninit(){}PreviousState(t){this.previous=t}Update(t,e){const i=this.CheckAttack();if(null!=i)return i;const n=this.CheckJump();if(null!=n)return n;const s=this.CheckGravity();if(null!=s)return s;if(0==e.x&&0==e.z)return this.previous.Init(),this.previous;e.y=0;const r=e.x*t*this.speed,o=e.z*t*this.speed;this.player.Meshs.position.x+=r,this.player.Meshs.position.z+=o;const a=this.MX.lookAt(e,this.ZeroV,this.YV),h=this.QT.setFromRotationMatrix(a);return this.player.Meshs.quaternion.copy(h),this.gphysic.Check(this.player)&&(this.player.Meshs.position.x-=r,this.player.Meshs.position.z-=o),this}}class OS{constructor(t,e,i){this.playerCtrl=t,this.player=e,this.gphysic=i,this.speed=10,this.velocity_y=16,this.dirV=new Pe(0,0,0),this.ZeroV=new Pe(0,0,0),this.YV=new Pe(0,1,0),this.MX=new ai,this.QT=new Re}Init(){this.player.ChangeAction(Ef.Jump),this.velocity_y=16,this.playerCtrl.RunSt.PreviousState(this.playerCtrl.IdleSt)}Uninit(){this.velocity_y=16}Update(t,e){const i=e.x*t*this.speed,n=e.z*t*this.speed,s=this.velocity_y*t;if(this.player.Meshs.position.x+=i,this.player.Meshs.position.z+=n,i||n){this.dirV.copy(e),this.dirV.y=0;const t=this.MX.lookAt(this.dirV,this.ZeroV,this.YV),i=this.QT.setFromRotationMatrix(t);this.player.Meshs.quaternion.copy(i)}return this.gphysic.Check(this.player)&&(this.player.Meshs.position.x-=i,this.player.Meshs.position.z-=n),this.player.Meshs.position.y+=s,this.gphysic.Check(this.player)?(this.player.Meshs.position.y-=s,this.Uninit(),this.playerCtrl.IdleSt.Init(),this.playerCtrl.IdleSt):(this.velocity_y-=9.8*3*t,this)}}var NS,BS,zS,US=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};!function(t){t[t.Attack=0]="Attack",t[t.Shield=1]="Shield",t[t.Armor=2]="Armor",t[t.Potion=3]="Potion",t[t.Material=4]="Material",t[t.Farm=5]="Farm",t[t.Deck=6]="Deck"}(NS||(NS={})),function(t){t[t.Blunt=0]="Blunt",t[t.Axe=1]="Axe",t[t.Knife=2]="Knife",t[t.Sword=3]="Sword",t[t.Bow=4]="Bow",t[t.Gun=5]="Gun",t[t.Wand=6]="Wand"}(BS||(BS={})),function(t){t[t.Common=0]="Common",t[t.Uncommon=1]="Uncommon",t[t.Rare=2]="Rare",t[t.Unique=3]="Unique",t[t.Legendary=4]="Legendary",t[t.Mythic=5]="Mythic"}(zS||(zS={}));class FS{get Id(){return this.property.id}get DamageMin(){return null==this.property.damageMin?0:this.property.damageMin}get DamageMax(){return null==this.property.damageMax?0:this.property.damageMax}get ItemType(){return this.property.type}get Speed(){return null==this.property.speed?0:this.property.speed}get IconPath(){return this.property.icon}get Bindable(){return this.property.binding}get Bind(){return this.property.bind}get Mesh(){return this.property.meshs}get Name(){return this.property.name}get AttackType(){return this.property.weapon}get Stackable(){return this.property.stackable}get Deck(){return this.property.deck}constructor(t){this.property=t}MakeInformation(){const t=new Array,e=this.property;switch(t.push({v:e.name}),e.type){case NS.Attack:switch(e.weapon){case BS.Blunt:t.push({k:"Weapon",v:"Blunt"});break;case BS.Axe:t.push({k:"Weapon",v:"Axe"});break;case BS.Bow:t.push({k:"Weapon",v:"Bow"});break;case BS.Gun:t.push({k:"Weapon",v:"Gun"});break;case BS.Knife:t.push({k:"Weapon",v:"Knife"});break;case BS.Sword:t.push({k:"Weapon",v:"Sword"});break;case BS.Wand:t.push({k:"Weapon",v:"Wand"})}break;case NS.Shield:t.push({v:"Shield"});break;case NS.Armor:t.push({v:"Armor"});break;case NS.Potion:t.push({v:"Potion"});break;case NS.Material:t.push({v:"Material"})}return null!=e.damageMax&&t.push({k:"공격력",v:e.damageMin+" ~ "+e.damageMax}),null!=e.speed&&t.push({k:"공속",v:e.speed.toString()}),t}Loader(){return US(this,void 0,void 0,(function*(){const t=this.property.asset;if(null==t)return;const[e,i]=yield t.UniqModel(this.property.name);this.property.meshs=e}))}}class GS extends IS{constructor(t,e,i,n,s){super(t,e,i),this.eventCtrl=n,this.spec=s,this.raycast=new Bl,this.attackDist=5,this.attackDir=new Pe,this.attackTime=0,this.attackSpeed=2,this.attackDamageMax=1,this.attackDamageMin=1,this.attackProcess=!1,this.raycast.params.Points.threshold=20}Init(){this.attackProcess=!1,this.attackSpeed=this.spec.attackSpeed,this.attackDamageMax=this.spec.AttackDamageMax,this.attackDamageMin=this.spec.AttackDamageMin;const t=this.playerCtrl.inventory.GetBindItem(Yl.Hands_R);if(null==t)this.player.ChangeAction(Ef.Punch,this.attackSpeed);else switch(t.AttackType){case BS.Blunt:case BS.Axe:case BS.Sword:case BS.Knife:this.player.ChangeAction(Ef.Sword,this.attackSpeed);break;case BS.Gun:this.player.ChangeAction(Ef.Gun,this.attackSpeed);break;case BS.Bow:this.player.ChangeAction(Ef.Bow,this.attackSpeed);break;case BS.Wand:this.player.ChangeAction(Ef.Wand,this.attackSpeed)}this.playerCtrl.RunSt.PreviousState(this),this.attackTime=this.attackSpeed,this.clock=new Sl}Uninit(){null!=this.keytimeout&&clearTimeout(this.keytimeout)}attack(){this.player.Meshs.getWorldDirection(this.attackDir),this.raycast.set(this.player.CenterPos,this.attackDir.normalize());const t=this.raycast.intersectObjects(this.playerCtrl.targets);if(t.length>0&&t[0].distance<this.attackDist){const e=new Map;t.forEach((t=>{if(t.distance>this.attackDist)return!1;const i=e.get(t.object.name),n={type:ET.NormalSwing,damage:ie.randInt(this.attackDamageMin,this.attackDamageMax),obj:t.object};null==i?e.set(t.object.name,[n]):i.push(n)})),e.forEach(((t,e)=>{this.eventCtrl.OnAttackEvent(e,t)}))}this.attackProcess=!1}Update(t){var e;const i=this.DefaultCheck();return null!=i?i:null==this.clock?this:(t=null===(e=this.clock)||void 0===e?void 0:e.getDelta(),this.attackTime+=t,this.attackProcess||this.attackTime/this.attackSpeed<1||(this.attackTime-=this.attackSpeed,this.attackProcess=!0,this.keytimeout=setTimeout((()=>{this.attack()}),1e3*this.attackSpeed*.6)),this)}}class HS extends IS{constructor(t,e,i){super(t,e,i)}Init(){this.player.ChangeAction(Ef.Fight)}Uninit(){}Update(){const t=this.DefaultCheck();return null!=t?t:this}}const VS={level:1,maxHealth:100,health:100,maxMana:100,mana:100,maxExp:100,exp:0};class jS{get AttackSpeed(){let t=this.attackSpeed;return null!=this.buff&&this.buff.forEach((e=>{t*=e.GetAttackSpeed()})),t}get AttackDamageMax(){let t=this.attackDamageMax;return null!=this.buff&&this.buff.forEach((e=>{t*=e.GetDamageMax()})),t}get AttackDamageMin(){return this.attackDamageMin}get Status(){return this.status}constructor(t){this.inven=t,this.attackSpeed=2,this.attackDamageMax=1,this.attackDamageMin=1,this.defence=1,this.status=Object.assign({},VS)}SetBuff(t){this.buff=t}ResetStatus(){this.status=Object.assign({},VS)}NextLevelUp(){this.status.level++,this.ItemUpdate(),this.HealthLevelUp()}DefaultLevelSpec(){this.attackSpeed=2,this.attackDamageMax=1*this.status.level,this.attackDamageMin=1*this.status.level,this.defence=1*this.status.level*10}HealthLevelUp(){const t=this.status.maxHealth;this.status.maxHealth+=100*this.status.level,this.status.health+=this.status.maxHealth-t,this.status.maxMana+=100*this.status.level,this.status.mana=this.status.maxMana,this.status.maxExp+=50*this.status.level,this.status.exp=0}ItemUpdate(){this.DefaultLevelSpec();const t=this.inven.GetBindItem(Yl.Hands_R);null!=t&&(this.attackSpeed=t.Speed,this.attackDamageMax+=t.DamageMax,this.attackDamageMin+=t.DamageMin)}ReceiveExp(t){this.status.exp+=t,this.status.exp>this.status.maxExp&&this.NextLevelUp()}ReceiveCalcDamage(t){this.status.health-=Math.round(5500/(5500+this.defence)*t)}ReceiveCalcHeal(t){this.status.health>=this.status.maxHealth?this.status.health=this.status.maxHealth:this.status.health+=t}CheckDie(){return this.status.health<=0}Update(t){var e;null===(e=this.buff)||void 0===e||e.forEach((e=>{e.Update(t,this.status)}))}}var WS,XS,$S;class qS{}WS=qS,qS.Zombie="Zombie",qS.Minotaur="Minataur",qS.Batpig="Batpig",qS.Bilby="Bilby",qS.Birdmon="Birdmon",qS.Crab="Crab",qS.Builder="Builder",qS.Golem="Golem",qS.BigGolem="Biggolem",qS.KittenMonk="Kittenmonk",qS.Skeleton="Skeleton",qS.Snake="Snake",qS.ToadMage="Toadmage",qS.Viking="Viking",qS.WereWolf="Werewolf",qS.Stone="stone",qS.Tree="tree",qS.List=[WS.Zombie,WS.Minotaur,WS.Batpig,WS.Bilby,WS.Birdmon,WS.Crab,WS.Builder,WS.Golem,WS.BigGolem,WS.KittenMonk,WS.Skeleton,WS.Snake,WS.ToadMage,WS.Viking,WS.WereWolf],function(t){t[t.Undead=0]="Undead",t[t.Dragon=1]="Dragon",t[t.Machine=2]="Machine",t[t.Warrior=3]="Warrior",t[t.Angel=4]="Angel",t[t.Element=5]="Element",t[t.Fish=6]="Fish",t[t.Plant=7]="Plant",t[t.Insect=8]="Insect",t[t.Reptile=9]="Reptile",t[t.Wizard=10]="Wizard",t[t.Alien=11]="Alien",t[t.Beast=12]="Beast",t[t.Dinosaur=13]="Dinosaur",t[t.Lightning=14]="Lightning",t[t.Flame=15]="Flame",t[t.Rock=16]="Rock"}(XS||(XS={}));class YS{}$S=YS,YS.Zombie="ZombieDeck",YS.Minotaur="MinataurDeck",YS.Batpig="BatpigDeck",YS.Bilby="BilbyDeck",YS.Birdmon="BirdmonDeck",YS.Crab="CrabDeck",YS.Builder="BuilderDeck",YS.Golem="GolemDeck",YS.BigGolem="BiggolemDeck",YS.KittenMonk="KittenmonkDeck",YS.Skeleton="SkeletonDeck",YS.Snake="SnakeDeck",YS.ToadMage="ToadmageDeck",YS.Viking="VikingDeck",YS.WereWolf="WerewolfDeck",YS.List=[$S.Zombie,$S.Minotaur,$S.Batpig,$S.Bilby,$S.Birdmon,$S.Crab,$S.Builder,$S.Golem,$S.BigGolem,$S.KittenMonk,$S.Skeleton,$S.Snake,$S.ToadMage,$S.Viking,$S.WereWolf];class KS{constructor(){KS.DeckDb.set(KS.Zombie.id,KS.Zombie),KS.DeckDb.set(KS.Minotaur.id,KS.Minotaur),KS.DeckDb.set(KS.BatPig.id,KS.BatPig),KS.DeckDb.set(KS.BirdMon.id,KS.BirdMon),KS.DeckDb.set(KS.Crap.id,KS.Crap),KS.DeckDb.set(KS.Builder.id,KS.Builder),KS.DeckDb.set(KS.Golem.id,KS.Golem),KS.DeckDb.set(KS.BigGolem.id,KS.BigGolem),KS.DeckDb.set(KS.KittenMonk.id,KS.KittenMonk),KS.DeckDb.set(KS.Skeleton.id,KS.Skeleton),KS.DeckDb.set(KS.Snake.id,KS.Snake),KS.DeckDb.set(KS.ToadMage.id,KS.ToadMage),KS.DeckDb.set(KS.Viking.id,KS.Viking),KS.DeckDb.set(KS.WereWolf.id,KS.WereWolf)}}KS.DeckDb=new Map,KS.Zombie={id:YS.Zombie,title:"전염된 좀비들",contents:" 이 카드는 최대 30마리의 좀비를 소환할 수 있습니다.",maxLv:5,minTime:0,maxTime:10,maxSpawn:30,uniq:!1,monId:qS.Zombie},KS.Minotaur={id:YS.Minotaur,title:"미노타우르스의 자식들",contents:"이 카드는 최대 10마리의 미노타우르스의 자식을 소환할 수 있습니다.",maxLv:5,minTime:0,maxTime:15,maxSpawn:5,uniq:!1,monId:qS.Minotaur},KS.BatPig={id:YS.Batpig,title:"이상한 박쥐",contents:"높은 곳도 추적할 수 있습니다.\n        이 카드는 최대 30마리를 소환할 수 있습니다.",maxLv:5,minTime:0,maxTime:15,maxSpawn:30,uniq:!1,monId:qS.Batpig},KS.BirdMon={id:YS.Birdmon,title:"탈출한 타조",contents:"탈출에 5분의 시간이 필요합니다. 5분 이후 사용가능합니다.\n        이 카드는 최대 3마리를 소환할 수 있습니다.",maxLv:5,minTime:5,maxTime:15,maxSpawn:3,uniq:!1,monId:qS.Birdmon},KS.Crap={id:YS.Crab,title:"영혼의 게",contents:"맛있는 요리에 필요한 재료를 얻을 수 있습니다.\n        이 카드는 최대 10마리를 소환할 수 있습니다.",maxLv:5,minTime:5,maxTime:15,maxSpawn:10,uniq:!1,monId:qS.Crab},KS.Builder={id:YS.Builder,title:"노동자",contents:"\n        이 카드는 한번만 사용할 수 있습니다.",maxLv:5,minTime:5,maxTime:15,maxSpawn:1,uniq:!0,monId:qS.Builder},KS.Golem={id:YS.Golem,title:"골렘",contents:"뛰어난 방어력으로 주변 데미지를 흡수합니다.\n        ",maxLv:5,minTime:5,maxTime:15,maxSpawn:20,uniq:!1,monId:qS.Golem},KS.BigGolem={id:YS.BigGolem,title:"골렘의왕",contents:"소환된 모든 카드에 뛰어난 방어력을 선사합니다.\n        ",maxLv:5,minTime:10,maxTime:15,maxSpawn:1,uniq:!0,monId:qS.BigGolem},KS.KittenMonk={id:YS.KittenMonk,title:"고양이전사",contents:"너무 귀여워 이동속도를 느리게 만듭니다.\n        ",maxLv:10,minTime:5,maxTime:15,maxSpawn:1,uniq:!0,monId:qS.KittenMonk},KS.Skeleton={id:YS.Skeleton,title:"말단 해골전사",contents:"죽지 않고 끊임없이 부활합니다.\n        ",maxLv:5,minTime:0,maxTime:15,maxSpawn:30,uniq:!1,monId:qS.Skeleton},KS.Snake={id:YS.Snake,title:"뱀의 왕",contents:"플레이어의 체력을 지속적으로 감소 시킵니다.\n        ",maxLv:5,minTime:10,maxTime:15,maxSpawn:1,uniq:!0,monId:qS.Snake},KS.ToadMage={id:YS.ToadMage,title:"개구리전사",contents:"\n        ",maxLv:5,minTime:0,maxTime:15,maxSpawn:15,uniq:!1,monId:qS.ToadMage},KS.Viking={id:YS.Viking,title:"바이킹전사",contents:"\n        ",maxLv:5,minTime:0,maxTime:15,maxSpawn:15,uniq:!1,monId:qS.Viking},KS.WereWolf={id:YS.WereWolf,title:"늑대인간",contents:"빠르고 강력합니다.\n        ",maxLv:5,minTime:5,maxTime:15,maxSpawn:3,uniq:!1,monId:qS.WereWolf};class ZS{}ZS.Hanhwasbat="Hanhwasbat",ZS.WarterCan="WarterCan",ZS.Hammer="Hammer",ZS.DefaultGun="DefaultGun",ZS.Leather="Leather",ZS.Logs="Logs",ZS.Rocks="Rocks",ZS.ZombieDeck="ZombieDeck",ZS.MinataurDeck="MinataurDeck",ZS.BatPigDeck="BatPigDeck",ZS.BilbyDeck="BilbyDeck",ZS.BirdmonDeck="BirdmonDeck",ZS.CrabDeck="CrabDeck",ZS.BuilderDeck="BuilderDeck",ZS.GolemDeck="GolemDeck",ZS.BigGolemDeck="BigGolemDeck",ZS.KittenMonkDeck="KittenMonkDeck",ZS.SkeletonDeck="SkeletonDeck",ZS.SnakeDeck="SnakeDeck",ZS.ToadMageDeck="GolemDeck",ZS.VikingDeck="VikingDeck",ZS.WereWolfDeck="WerewolfDeck",ZS.Apple="Apple",ZS.Coconut="Coconut",ZS.Tomato="Tomato",ZS.Potato="Potato",ZS.Carrot="Carrot";class JS{constructor(t){this.loader=t,this.itemDb=new Map,this.itemDb.set(ZS.Hanhwasbat,{id:ZS.Hanhwasbat,type:NS.Attack,weapon:BS.Blunt,bind:Yl.Hands_R,asset:this.loader.BatAsset,level:zS.Common,name:"Hanhwa's Bat",icon:"WeaponTool/TopazStaff.png",stackable:!1,binding:!0,damageMax:5,damageMin:3,speed:1}),this.itemDb.set(ZS.WarterCan,{id:ZS.WarterCan,type:NS.Farm,bind:Yl.Hands_R,asset:this.loader.WarteringCanAsset,level:zS.Common,name:"Wartering Can",icon:"Misc/Lantern.png",stackable:!1,binding:!0,damageMax:5,damageMin:3,speed:1}),this.itemDb.set(ZS.Hammer,{id:ZS.Hammer,type:NS.Attack,bind:Yl.Hands_R,asset:this.loader.HammerAsset,level:zS.Common,name:"Hammer H3",icon:"WeaponTool/Hammer.png",stackable:!1,binding:!0,damageMax:5,damageMin:3,speed:1.5}),this.itemDb.set(ZS.Leather,{id:ZS.Leather,type:NS.Material,name:"Leather",icon:"Material/Leather.png",stackable:!0,binding:!1,price:1}),this.itemDb.set(ZS.Logs,{id:ZS.Logs,type:NS.Material,name:"WoodLog",icon:"Material/WoodLog.png",stackable:!0,binding:!1,price:1}),this.itemDb.set(ZS.Rocks,{id:ZS.Rocks,type:NS.Material,name:"Rocks",icon:"OreGem/SilverNugget.png",stackable:!0,binding:!1,price:1}),this.itemDb.set(ZS.ZombieDeck,{id:ZS.ZombieDeck,type:NS.Deck,name:"Zombie Deck",icon:"Misc/Book.png",stackable:!1,binding:!1,price:1,deck:KS.Zombie}),this.itemDb.set(ZS.MinataurDeck,{id:ZS.MinataurDeck,type:NS.Deck,name:"Minataur Deck",icon:"Misc/Book.png",stackable:!1,binding:!1,price:1,deck:KS.Minotaur}),this.itemDb.set(ZS.BatPigDeck,{id:ZS.BatPigDeck,type:NS.Deck,name:"BatPig Deck",icon:"Misc/Book.png",stackable:!1,binding:!1,price:1,deck:KS.BatPig}),this.itemDb.set(ZS.CrabDeck,{id:ZS.CrabDeck,type:NS.Deck,name:"Crab Deck",icon:"Misc/Book.png",stackable:!1,binding:!1,price:1,deck:KS.Crap}),this.itemDb.set(ZS.BuilderDeck,{id:ZS.BuilderDeck,type:NS.Deck,name:"Builder Deck",icon:"Misc/Book.png",stackable:!1,binding:!1,price:1,deck:KS.Builder}),this.itemDb.set(ZS.GolemDeck,{id:ZS.GolemDeck,type:NS.Deck,name:"Golem Deck",icon:"Misc/Book.png",stackable:!1,binding:!1,price:1,deck:KS.Golem}),this.itemDb.set(ZS.BigGolemDeck,{id:ZS.BigGolemDeck,type:NS.Deck,name:"BigGolem Deck",icon:"Misc/Book.png",stackable:!1,binding:!1,price:1,deck:KS.BigGolem}),this.itemDb.set(ZS.KittenMonkDeck,{id:ZS.KittenMonkDeck,type:NS.Deck,name:"KittenMonk Deck",icon:"Misc/Book.png",stackable:!1,binding:!1,price:1,deck:KS.KittenMonk}),this.itemDb.set(ZS.SkeletonDeck,{id:ZS.SkeletonDeck,type:NS.Deck,name:"Skeleton Deck",icon:"Misc/Book.png",stackable:!1,binding:!1,price:1,deck:KS.Skeleton}),this.itemDb.set(ZS.SnakeDeck,{id:ZS.SnakeDeck,type:NS.Deck,name:"Snake Deck",icon:"Misc/Book.png",stackable:!1,binding:!1,price:1,deck:KS.Snake}),this.itemDb.set(ZS.ToadMageDeck,{id:ZS.ToadMageDeck,type:NS.Deck,name:"ToadMage Deck",icon:"Misc/Book.png",stackable:!1,binding:!1,price:1,deck:KS.ToadMage}),this.itemDb.set(ZS.VikingDeck,{id:ZS.VikingDeck,type:NS.Deck,name:"Viking Deck",icon:"Misc/Book.png",stackable:!1,binding:!1,price:1,deck:KS.Viking}),this.itemDb.set(ZS.WereWolfDeck,{id:ZS.WereWolfDeck,type:NS.Deck,name:"WereWolf Deck",icon:"Misc/Book.png",stackable:!1,binding:!1,price:1,deck:KS.WereWolf}),this.itemDb.set(ZS.Apple,{id:ZS.Apple,type:NS.Farm,name:"Apple",icon:"Food/Apple.png",stackable:!0,binding:!1,price:1}),this.itemDb.set(ZS.Coconut,{id:ZS.Coconut,type:NS.Farm,name:"Coconut",icon:"Food/GreenApple.png",stackable:!0,binding:!1,price:1}),this.itemDb.set(ZS.Tomato,{id:ZS.Tomato,type:NS.Farm,name:"Tomato",icon:"Food/Wine2.png",stackable:!0,binding:!1,price:1}),this.itemDb.set(ZS.Potato,{id:ZS.Potato,type:NS.Farm,name:"Potato",icon:"Food/GreenApple.png",stackable:!0,binding:!1,price:1}),this.itemDb.set(ZS.Carrot,{id:ZS.Carrot,type:NS.Farm,name:"Carrot",icon:"Food/GreenApple.png",stackable:!0,binding:!1,price:1})}GetItem(t){const e=this.itemDb.get(t);if(null==e)throw new Error("unkown key");return e}}class QS extends _c{get BoxPos(){const t=this.CannonPos;return new Pe(t.x,t.y,t.z)}constructor(t,e,i){super(new Ya(t,e,i,5),new Ah({color:36314,transparent:!0,opacity:.5})),this.depth=i;const n=new Ya(t,e,i,5),s=new Ah({color:36314});this.gauge=new kn(n,s),this.gauge.scale.set(.9,.01,.9),this.gauge.position.y=i/2,this.add(this.gauge),this.rotation.x=Math.PI/2,this.rotation.y=Math.PI/2,this.rotation.z=Math.PI/2}SetProgress(t){t>1?t=1:t<0&&(t=0),this.gauge.scale.y=t,this.gauge.position.y=this.depth/2*(1-t)}}var tT,eT,iT,nT=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class sT extends xc{get BoxPos(){return this.asset.GetBoxPos(this.meshs)}constructor(t,e,i,n){super(t),this.fruitAsset=e,this.deadtree=i,this.meshName=n,this.gauge=new QS(.1,.1,2),this.gaugeEnable=!1,this.lv=1,this.text=new bS("나무를 심어주세요"),this.text.position.y=7}Init(){return nT(this,void 0,void 0,(function*(){}))}SetLevel(t){this.lv=t}SetProgress(t){this.gaugeEnable||(this.CreateGauge(),this.gauge.visible=!0),this.gauge.SetProgress(t)}Enough(){null!=this.text&&(this.text.visible=!1),this.SetOpacity(1),this.gauge.Meshs.traverse((t=>{if("material"in t){t.material.color=new Yi("#008DDA")}}))}NeedHavest(){this.fruit&&(this.fruit.traverse((t=>{if("material"in t){const e=t.material;e.transparent=!1,e.depthWrite=!0,e.opacity=1}})),this.fruit.visible=!0)}Havest(){this.fruit&&(this.fruit.visible=!1)}NeedWarter(){null!=this.text&&(this.text.visible=!0,this.text.SetText("물을 주세요")),this.SetOpacity(1),this.gauge.Meshs.traverse((t=>{if("material"in t){t.material.color=new Yi("#008DDA")}}))}Death(){return nT(this,void 0,void 0,(function*(){null!=this.text&&(this.text.visible=!0,this.text.SetText("나무가 죽었습니다.")),this.fruit&&(this.fruit.visible=!1),this.meshs.children[0].visible=!1,this.deadTree=yield this.CreateDeadTree(),this.meshs.add(this.deadTree)}))}Damage(){}Delete(){this.meshs.children[0].traverse((t=>{if("material"in t){const e=t.material;e.transparent=!0,e.depthWrite=!0,e.opacity=.3}}))}SetOpacity(t){this.meshs.children[0].traverse((e=>{if("material"in e){const i=e.material;i.transparent=!0,i.depthWrite=!0,i.opacity=t}}))}Plant(){this.meshs.children[0].traverse((t=>{if("material"in t){const e=t.material;e.transparent=!1,e.depthWrite=!0,e.opacity=1}})),this.fruit&&this.fruit.traverse((t=>{if("material"in t){const e=t.material;e.transparent=!1,e.depthWrite=!0,e.opacity=1}})),null!=this.text&&this.text.SetText("물을 주세요"),this.CreateGauge(),this.gauge.SetProgress(.01)}CreateGauge(){this.gaugeEnable=!0,this.gauge.position.x+=1,this.gauge.position.y=this.gauge.CenterPos.y,this.gauge.position.z+=2,this.gauge.Meshs.traverse((t=>{if("material"in t){t.material.color=new Yi("#008DDA")}})),this.meshs.add(this.gauge)}SetText(t){var e;null===(e=this.text)||void 0===e||e.SetText(t)}Create(){null!=this.text&&(this.text.position.y=7,this.meshs.add(this.text))}MassLoader(t,e){return nT(this,void 0,void 0,(function*(){if(this.meshs=new Po,e){const[t,i]=yield this.asset.UniqModel(this.meshName+e);this.meshs.add(t)}else this.meshs.add(yield this.asset.CloneModel());this.fruit=yield this.fruitAsset.CloneModel(),this.fruit.name="fruit",this.fruit.visible=!1,this.fruit.position.set(0,4,2),this.meshs.add(this.fruit),this.meshs.position.set(t.x,t.y,t.z),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0,"material"in t&&(t.material.transparent=!0,t.material.depthWrite=!1,t.material.opacity=.3)})),this.meshs.visible=!1}))}CreateDeadTree(){return nT(this,void 0,void 0,(function*(){return yield this.deadtree.CloneModel()}))}}class rT{}tT=rT,rT.AppleTree="appletree",rT.CoconutTree="coconutree",rT.Tomato="tomato",rT.Potato="potato",rT.Carrot="carrot",rT.List=[tT.AppleTree,tT.CoconutTree,tT.Tomato,tT.Potato,tT.Carrot],function(t){t[t.Tree=0]="Tree",t[t.Vegetable=1]="Vegetable",t[t.Fruit=2]="Fruit"}(eT||(eT={}));class oT{get Items(){return this.plantDb}constructor(){this.plantDb=new Map,this.plantDb.set(rT.AppleTree,{plantId:rT.AppleTree,type:eT.Tree,assetId:Zl.AppleTree,name:"Apple Tree",namekr:"사과나무",maxLevel:2,levelUpTime:1e4,warteringTime:36e5,drop:[{itemId:ZS.Apple,ratio:1}]}),this.plantDb.set(rT.CoconutTree,{plantId:rT.CoconutTree,type:eT.Tree,assetId:Zl.CoconutTree,name:"Coconut Tree",namekr:"코코넛나무",maxLevel:2,levelUpTime:1e4,warteringTime:36e5,drop:[{itemId:ZS.Coconut,ratio:1}]}),this.plantDb.set(rT.Tomato,{plantId:rT.Tomato,type:eT.Vegetable,assetId:Zl.Tomato0,name:"Tomato",namekr:"토마토",maxLevel:3,levelUpTime:1e4,warteringTime:36e5,drop:[{itemId:ZS.Tomato,ratio:1}]}),this.plantDb.set(rT.Potato,{plantId:rT.Potato,type:eT.Vegetable,assetId:Zl.Potato0,name:"Potato",namekr:"감자",maxLevel:3,levelUpTime:864e5,warteringTime:36e5,drop:[{itemId:ZS.Potato,ratio:1}]}),this.plantDb.set(rT.Carrot,{plantId:rT.Carrot,type:eT.Vegetable,assetId:Zl.Carrot0,name:"Carrot",namekr:"당근",maxLevel:3,levelUpTime:864e5,warteringTime:36e5,drop:[{itemId:ZS.Carrot,ratio:1}]})}get(t){return this.plantDb.get(t)}}class aT{get State(){return this.save.state}get PlantType(){return this.property.type}get NeedHavest(){return this.needHavest}get Drop(){return this.property.drop}constructor(t,e,i,n,s){this.tree=e,this.treeMotion=i,this.property=n,this.save=s,this.lv=1,this.timer=0,this.checktime=0,this.health=3,this.havest=3,this.needHavest=!1,this.position=e.CannonPos;const r=e.Size,o=new Ln(r.x/2,r.y,r.z/2),a=new Qi({color:16711680,wireframe:!0});this.phybox=new fT(t,"farmtree",o,a,this),"hons.ghostwebservice.com"==window.location.hostname&&(this.phybox.visible=!1),this.phybox.position.copy(this.tree.BoxPos),this.CheckWartering(),this.dom=document.getElementById("edit-progress-bar-container"),this.progress=document.getElementById("edit-progress-bar"),this.msg=document.getElementById("job_label")}ReAlloc(t){this.tree.CannonPos.copy(t),this.phybox.position.copy(this.tree.BoxPos)}Release(){this.lv=1,this.timer=0,this.checktime=0,this.health=3,this.havest=3,this.needHavest=!1,this.save.state=uT.NeedSeed,this.treeMotion.Delete()}AfterHavest(){this.lv=1,this.timer=0,this.checktime=0,this.health=3,this.havest=3,this.needHavest=!1}SeedStart(){this.save.state==uT.NeedSeed&&(this.timer=0,this.save.state=uT.Seeding,this.msg.innerText="나무를 심습니다.",this.dom.style.display="block")}SeedCancel(){this.save.state==uT.Seeding&&(this.save.state=uT.NeedSeed),this.dom.style.display="none"}WarteringStart(){this.save.state!=uT.Death&&(this.save.state!=uT.Enough&&this.save.state!=uT.NeedWartering||(this.timer=0,this.save.state=uT.Wartering))}WarteringCancel(){this.save.state==uT.Wartering&&this.CheckWartering()}WaterDone(){this.save.state=uT.Enough,this.timer=0,this.save.lastWarteringTime=(new Date).getTime()}StartGrow(){if(this.save.state==uT.Death)return;this.save.state=uT.NeedWartering;const t=(new Date).getTime();this.save.lastWarteringTime=t-this.property.warteringTime,this.save.lastHarvestTime=t,this.treeMotion.Plant(),this.dom.style.display="none"}Delete(t){return t?(this.msg.innerText="나무를 제거합니다.",this.dom.style.display="block",this.health-=t,this.progress.value=1-this.health/3,this.treeMotion.Damage(this.health/3)):this.dom.style.display="none",this.health<=0?(this.Release(),0):this.health}HavestStart(t){return t?(this.msg.innerText="수확합니다.",this.dom.style.display="block",this.havest-=t,this.progress.value=1-this.havest/3):this.dom.style.display="none",this.havest<=0?(this.Havest(),0):this.havest}Havest(){this.AfterHavest(),this.save.lastHarvestTime=(new Date).getTime(),this.treeMotion.Havest()}CheckWartering(){if(this.save.state==uT.NeedSeed)return;const t=1-((new Date).getTime()-this.save.lastWarteringTime)/this.property.warteringTime;this.treeMotion.SetProgress(t),t<-1?(this.save.state=uT.Death,this.treeMotion.Death()):t>.5?(this.save.state=uT.Enough,this.treeMotion.Enough()):(this.save.state=uT.NeedWartering,this.treeMotion.NeedWarter())}CheckLevelUp(){if(this.save.state==uT.NeedSeed)return;const t=(new Date).getTime()-this.save.lastHarvestTime,e=Math.floor(t/this.property.levelUpTime)+1;this.lv!=e&&(this.lv=e>this.property.maxLevel?this.property.maxLevel:this.lv+1,this.treeMotion.SetLevel(this.lv),this.lv==this.property.maxLevel&&(this.treeMotion.NeedHavest(),this.needHavest=!0)),this.save.lv=this.lv}update(t){if(this.checktime+=t,!(Math.floor(this.checktime)<1)){switch(this.checktime=0,this.save.state){case uT.NeedSeed:case uT.Death:return;case uT.Wartering:{this.timer+=10*t;const e=this.timer/5;this.treeMotion.SetProgress(e),e>1&&this.WaterDone()}return;case uT.Seeding:this.timer+=10*t;const e=this.timer/2;return this.progress.value=e,void(e>1&&this.StartGrow());case uT.Enough:this.treeMotion.Enough()}this.CheckWartering(),this.CheckLevelUp()}}}!function(t){t[t.Normal=0]="Normal",t[t.Warning=1]="Warning",t[t.Deck=2]="Deck"}(iT||(iT={}));class hT{constructor(){this.dom=document.createElement("div"),this.bigDom=document.createElement("div"),this.dom.className="playalarm",document.body.appendChild(this.dom),this.bigDom.className="bigplayalarm",document.body.appendChild(this.bigDom)}NotifyInfo(t,e){switch(e){case iT.Normal:this.dom.style.display="block",this.dom.insertAdjacentHTML("beforeend",t+"<br>"),cf.fromTo(".playalarm",2,{opacity:1},{opacity:0,ease:"power1.inOut",onComplete:()=>{this.dom.style.display="none",this.dom.innerText=""}});break;case iT.Deck:this.bigDom.style.display="block",this.bigDom.insertAdjacentHTML("beforeend",t+"<br>"),cf.to(".bigplayalarm",3,{scale:2,ease:"elastic.out",onComplete:()=>{this.bigDom.style.display="none",this.bigDom.innerText=""}})}}}var lT=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class cT extends xc{get BoxPos(){return this.asset.GetBoxPos(this.meshs)}constructor(t,e){super(t[0]),this.assets=t,this.meshName=e,this.gauge=new QS(.1,.1,2),this.gaugeEnable=!1,this.lv=1,this.text=new bS(""),this.text.SetText(this.meshName+"를 심어주세요"),this.text.position.y=7}Init(){return lT(this,void 0,void 0,(function*(){}))}SetLevel(t){this.lv=t;const e=t-1;for(let t=0;t<this.assets.length;t++)this.meshs.children[t].visible=t==e}SetProgress(t){this.gaugeEnable||(this.CreateGauge(),this.gauge.visible=!0),this.gauge.SetProgress(t)}Enough(){null!=this.text&&(this.text.visible=!1),this.SetOpacity(1),this.gauge.Meshs.traverse((t=>{if("material"in t){t.material.color=new Yi("#008DDA")}}))}NeedHavest(){}Havest(){this.SetLevel(1)}NeedWarter(){null!=this.text&&(this.text.visible=!0,this.text.SetText("물을 주세요")),this.SetOpacity(1),this.gauge.Meshs.traverse((t=>{if("material"in t){t.material.color=new Yi("#008DDA")}}))}Death(){return lT(this,void 0,void 0,(function*(){null!=this.text&&(this.text.visible=!0,this.text.SetText("식물이 죽었습니다."));const t=this.lv-1;this.meshs.children[t].traverse((t=>{if("material"in t){t.material.color=new Yi("#000000")}}))}))}Damage(){}Delete(){for(let t=0;t<this.assets.length;t++)this.meshs.children[t].traverse((t=>{if("material"in t){const e=t.material;e.transparent=!0,e.depthWrite=!1,e.opacity=.3}}))}SetOpacity(t){const e=this.lv-1;this.meshs.children[e].traverse((e=>{if("material"in e){const i=e.material;i.transparent=!0,i.depthWrite=!0,i.opacity=t}}))}Plant(){for(let t=0;t<this.assets.length;t++)this.meshs.children[t].traverse((t=>{if("material"in t){const e=t.material;e.transparent=!0,e.depthWrite=!0,e.opacity=1}}));null!=this.text&&this.text.SetText("물을 주세요"),this.gaugeEnable||this.CreateGauge(),this.gauge.SetProgress(.01)}CreateGauge(){this.gaugeEnable=!0,this.gauge.position.x+=1,this.gauge.position.y=this.gauge.CenterPos.y,this.gauge.position.z+=2,this.gauge.Meshs.traverse((t=>{if("material"in t){t.material.color=new Yi("#008DDA")}})),this.meshs.add(this.gauge)}SetText(t){var e;null===(e=this.text)||void 0===e||e.SetText(t)}Create(){null!=this.text&&(this.text.position.y=7,this.meshs.add(this.text)),this.SetLevel(this.lv)}MassLoader(t,e){return lT(this,void 0,void 0,(function*(){if(this.meshs=new Po,e)for(let t=0;t<this.assets.length;t++){const i=this.assets[t],[n,s]=yield i.UniqModel(this.meshName+t+"_"+e);t&&(n.visible=!1),this.meshs.add(n)}else for(let t=0;t<this.assets.length;t++){const e=this.assets[t],i=yield e.CloneModel();t&&(i.visible=!1),this.meshs.add(i)}this.meshs.position.copy(t),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0,"material"in t&&(t.material.transparent=!0,t.material.depthWrite=!1,t.material.opacity=.3)})),this.meshs.visible=!1}))}}var uT,dT,pT,mT=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};!function(t){t[t.NeedSeed=0]="NeedSeed",t[t.Seeding=1]="Seeding",t[t.Enough=2]="Enough",t[t.NeedWartering=3]="NeedWartering",t[t.Wartering=4]="Wartering",t[t.Death=5]="Death",t[t.Delete=6]="Delete"}(uT||(uT={}));class fT extends kn{constructor(t,e,i,n,s){super(i,n),this.Id=t,this.ObjName=e,this.ctrl=s,this.name=e}}class gT{constructor(t,e,i,n,s,r,o,a,h,l,c){this.loader=t,this.player=e,this.playerCtrl=i,this.game=n,this.store=s,this.gphysic=r,this.eventCtrl=a,this.alarm=h,this.drop=l,this.plantDb=c,this.controllable=!1,this.plantsFab=new Map,this.plantset=[],this.recycle=[],this.saveData=this.store.Plants,this.allocPos=0,o.RegisterViewer(this),s.RegisterStore(this),a.RegisterAppModeEvent(((t,e,i)=>{if(t==qE.Farmer)switch(e){case nc.Start:if(this.target=this.plantsFab.get(i),!this.target)return;this.targetId=i,this.controllable=!0,this.game.add(this.target.Meshs),this.target.Visible=!0,this.target.CannonPos.x=this.player.CannonPos.x,this.target.CannonPos.z=this.player.CannonPos.z,this.eventCtrl.OnChangeCtrlObjEvent(this.target),this.CheckCollision();break;case nc.End:if(this.controllable=!1,!this.target)return;this.target.Visible=!1,this.game.remove(this.target.Meshs)}})),a.RegisterKeyDownEvent((t=>{if(this.controllable)if(t.Type===sc.Action0){if(!this.target||!this.targetId||this.CheckPlantAPlant())return;const t={position:(new Pe).copy(this.target.CannonPos),id:this.targetId,state:uT.NeedSeed,lastWarteringTime:0,lv:1,createTime:0,lastHarvestTime:0};this.saveData.push(t),this.CreatePlant(t),a.OnAppModeEvent(qE.EditPlay)}else{const e=t.ExecuteKeyDown();this.moveEvent(e)}})),a.RegisterAttackEvent("farmtree",(t=>{t.forEach((t=>{let e=t.obj;if(null==e)return;const i=this.plantset[e.Id];t.type==ET.PlantAPlant?t.damage?i.plantCtrl.SeedStart():i.plantCtrl.SeedCancel():t.type==ET.Wartering?t.damage?i.plantCtrl.WarteringStart():i.plantCtrl.WarteringCancel():t.type==ET.Havest?i.plantCtrl.HavestStart(t.damage)<=0&&this.HavestPlant(e.Id):t.type==ET.Delete&&i.plantCtrl.Delete(t.damage)<=0&&this.DeletePlant(e.Id)}))}))}resize(){}update(t){for(let e=0;e<this.plantset.length;e++)this.plantset[e].plantCtrl.update(t)}Viliageload(){return mT(this,void 0,void 0,(function*(){this.ReleaseAllPlantPool()}))}Reload(){return mT(this,void 0,void 0,(function*(){this.ReleaseAllPlantPool(),this.saveData=this.store.Plants,this.saveData&&this.saveData.forEach((t=>{this.CreatePlant(t)}))}))}CheckPlantAPlant(){const t=this.target;if(!t)return!0;return this.plantset.filter((t=>1==t.used)).some((e=>e.plant.Box.intersectsBox(t.Box)))?(this.alarm.NotifyInfo("다른 식물과 가깝습니다.",iT.Normal),!0):t.CannonPos.y>.1&&(this.alarm.NotifyInfo("지면에 심어야합니다.",iT.Normal),!0)}HavestPlant(t){const e=this.plantset[t];this.drop.DirectItem(e.plantCtrl.Drop)}DeletePlant(t){const e=this.plantset[t];if(!e.used)return;e.used=!1;const i=this.saveData.findIndex((t=>t.position.x==e.plant.CannonPos.x&&t.position.z==e.plant.CannonPos.z));i>-1&&this.saveData.splice(i,1),this.playerCtrl.remove(e.plantCtrl.phybox),this.game.remove(e.plant.Meshs,e.plantCtrl.phybox)}CreatePlant(t){return mT(this,void 0,void 0,(function*(){const e=this.plantDb.get(t.id);if(!e)return;let i=this.AllocatePlantPool(e,t.position);i||(i=yield this.NewPlantEntryPool(t,e)),this.playerCtrl.add(i.plantCtrl.phybox),this.game.add(i.plant.Meshs,i.plantCtrl.phybox)}))}moveEvent(t){if(!this.target)return;const e=t.x>0?1:t.x<0?-1:0,i=t.z>0?1:t.z<0?-1:0;this.target.Meshs.position.x+=e,this.target.Meshs.position.z+=i,this.gphysic.Check(this.target)&&(this.target.Meshs.position.x-=e,this.target.Meshs.position.z-=i),this.CheckCollision()}CheckCollision(){if(this.target)if(this.gphysic.Check(this.target))do{this.target.CannonPos.y+=.5}while(this.gphysic.Check(this.target));else{do{this.target.CannonPos.y-=.5}while(!this.gphysic.Check(this.target)&&this.target.CannonPos.y>=0);this.target.CannonPos.y+=.5}}AllocatePlantPool(t,e){for(let i=0;i<this.plantset.length;i++,this.allocPos++){this.allocPos%=this.plantset.length;const i=this.plantset[this.allocPos];if(i.plantId==t.plantId&&0==i.used)return i.used=!0,i.plantCtrl.ReAlloc(e),i}}ReleaseAllPlantPool(){this.plantset.forEach((t=>{t.used=!1,this.playerCtrl.remove(t.plantCtrl.phybox),this.game.remove(t.plant.Meshs,t.plantCtrl.phybox)}))}NewPlantEntryPool(t,e){return mT(this,void 0,void 0,(function*(){const i=yield this.allocModel(t.id,t);yield i.MassLoader(t.position,this.plantset.length.toString()),i.Create(),i.Visible=!0;const n=new aT(this.plantset.length,i,i,e,t),s={plantId:t.id,plant:i,plantCtrl:n,used:!0};return this.plantset.push(s),s}))}FarmLoader(){return mT(this,void 0,void 0,(function*(){rT.List.map((t=>mT(this,void 0,void 0,(function*(){yield this.allocModel(t)}))))}))}allocModel(t,e){return mT(this,void 0,void 0,(function*(){const i=ic.DefaultPortalPosition;let n;switch(t){default:case rT.AppleTree:n=new sT(this.loader.AppleTreeAsset,this.loader.AppleAsset,this.loader.DeadTree2Asset,"appletree");break;case rT.CoconutTree:n=new sT(this.loader.CoconutTreeAsset,this.loader.CoconutAsset,this.loader.DeadTree2Asset,"coconuttree");break;case rT.Tomato:n=new cT([this.loader.Tomato0Asset,this.loader.Tomato1Asset,this.loader.Tomato2Asset],"tomato");break;case rT.Potato:n=new cT([this.loader.Potato0Asset,this.loader.Potato1Asset,this.loader.Potato2Asset],"potato");break;case rT.Carrot:n=new cT([this.loader.Carrot0Asset,this.loader.Carrot1Asset,this.loader.Carrot2Asset],"carrot")}return e?(yield n.MassLoader(e.position,this.plantset.length.toString()),n):(this.plantsFab.set(t,n),yield n.MassLoader(i),n)}))}}class vT{get State(){return this.state}constructor(t,e,i,n,s,r,o){this.funi=e,this.treeMotion=i,this.property=n,this.gphysic=s,this.save=r,this.state=o,this.lv=1,this.timer=0,this.lastBuildingTime=0,this.checktime=0,this.health=3,this.position=e.CannonPos;const a=e.Size,h=new Ln(a.x,a.y,a.z),l=new Qi({color:16711680,wireframe:!0});this.phybox=new ST(t,"furniture",h,l,this),"hons.ghostwebservice.com"==window.location.hostname&&(this.phybox.visible=!1);this.phybox.scale.set(1.2,1,1.2),this.phybox.position.copy(this.funi.BoxPos),this.phybox.rotation.copy(this.funi.Meshs.rotation),o==wT.Done&&this.treeMotion.Done(),this.dom=document.getElementById("edit-progress-bar-container"),this.progress=document.getElementById("edit-progress-bar"),this.msg=document.getElementById("job_label")}BuildingStart(){if(this.state==wT.Done)return;this.timer=0,this.state=wT.Building;const t=(new Date).getTime();this.lastBuildingTime=t-this.property.buildingTime,this.msg.innerText="제작하고 있습니다.",this.dom.style.display="block"}BuildingCancel(){this.state==wT.Building&&(this.state=wT.Suspend),this.dom.style.display="none"}BuildingDone(){this.state=wT.Done,this.timer=0,this.lastBuildingTime=(new Date).getTime(),this.treeMotion.Done(),this.save.push({id:this.property.id,createTime:this.lastBuildingTime,state:this.state,position:this.funi.CannonPos,rotation:this.funi.Meshs.rotation}),this.dom.style.display="none"}Delete(t){return t?(this.msg.innerText="가구를 제거합니다.",this.dom.style.display="block",this.health-=t,this.progress.value=1-this.health/3):this.dom.style.display="none",this.health}update(t){if(this.checktime+=t,!(Math.floor(this.checktime)<1)){this.checktime=0;do{this.funi.CannonPos.y-=.2}while(!this.gphysic.Check(this.funi)&&this.funi.CannonPos.y>=0);switch(this.funi.CannonPos.y+=.2,this.state){case wT.NeedBuilding:return;case wT.Building:{this.timer+=10*t;const e=this.timer/5;this.progress.value=e,e>1&&this.BuildingDone()}return}}}}class yT{}dT=yT,yT.DefaultBed="defaultbed",yT.DefaultBath="defaultbath",yT.DefaultBookShelf="defaultbookshelf",yT.DefaultCloset="defaultcloset",yT.DefaultDesk="defaultdesk",yT.DefaultKitchen="defaultkitchen",yT.DefaultKitTable="defaultkittable",yT.DefaultOven="defaultoven",yT.DefaultRefrigerator="defaultrefrigerator",yT.DefaultSink="defaultsink",yT.DefaultTable="defaulttable",yT.DefaultToilet="defaulttoilet",yT.DefaultTv="defaulttv",yT.List=[dT.DefaultBed,dT.DefaultBath,dT.DefaultBookShelf,dT.DefaultCloset,dT.DefaultDesk,dT.DefaultKitTable,dT.DefaultKitchen,dT.DefaultOven,dT.DefaultRefrigerator,dT.DefaultSink,dT.DefaultTable,dT.DefaultToilet,dT.DefaultTv],function(t){t[t.Bed=0]="Bed",t[t.Bath=1]="Bath",t[t.BookShelf=2]="BookShelf",t[t.Closet=3]="Closet",t[t.Desk=4]="Desk",t[t.Kitchen=5]="Kitchen",t[t.Table=6]="Table",t[t.Oven=7]="Oven",t[t.Refrigerator=8]="Refrigerator",t[t.Sink=9]="Sink",t[t.Toilet=10]="Toilet",t[t.Tv=11]="Tv"}(pT||(pT={}));class xT{get Items(){return this.furnDb}constructor(){this.furnDb=new Map,this.furnDb.set(yT.DefaultBed,{id:yT.DefaultBed,type:pT.Bed,assetId:Zl.Bed,name:"Bed",namekr:"침대",buildingTime:6e4}),this.furnDb.set(yT.DefaultBath,{id:yT.DefaultBath,type:pT.Bath,assetId:Zl.Bath,name:"Bath",namekr:"욕조",buildingTime:6e4}),this.furnDb.set(yT.DefaultBookShelf,{id:yT.DefaultBookShelf,type:pT.BookShelf,assetId:Zl.Bookshelf,name:"BookShelf",namekr:"책장",buildingTime:6e4}),this.furnDb.set(yT.DefaultCloset,{id:yT.DefaultCloset,type:pT.Closet,assetId:Zl.Closet,name:"Closet",namekr:"옷장",buildingTime:6e4}),this.furnDb.set(yT.DefaultDesk,{id:yT.DefaultDesk,type:pT.Desk,assetId:Zl.Desk,name:"Desk",namekr:"컴퓨터책상",buildingTime:6e4}),this.furnDb.set(yT.DefaultKitchen,{id:yT.DefaultKitchen,type:pT.Kitchen,assetId:Zl.Kitchen,name:"Kitchen",namekr:"부엌",buildingTime:6e4}),this.furnDb.set(yT.DefaultKitTable,{id:yT.DefaultKitTable,type:pT.Table,assetId:Zl.KitTable,name:"Kitchen Table",namekr:"식탁",buildingTime:6e4}),this.furnDb.set(yT.DefaultOven,{id:yT.DefaultOven,type:pT.Oven,assetId:Zl.Oven,name:"Oven",namekr:"오븐",buildingTime:6e4}),this.furnDb.set(yT.DefaultRefrigerator,{id:yT.DefaultRefrigerator,type:pT.Refrigerator,assetId:Zl.Refrigerator,name:"Refrigerator",namekr:"냉장고",buildingTime:6e4}),this.furnDb.set(yT.DefaultSink,{id:yT.DefaultSink,type:pT.Sink,assetId:Zl.Sink,name:"Sink",namekr:"세면대",buildingTime:6e4}),this.furnDb.set(yT.DefaultTable,{id:yT.DefaultTable,type:pT.Table,assetId:Zl.Table,name:"Table",namekr:"책상",buildingTime:6e4}),this.furnDb.set(yT.DefaultToilet,{id:yT.DefaultToilet,type:pT.Toilet,assetId:Zl.Toilet,name:"Toilet",namekr:"변기",buildingTime:6e4}),this.furnDb.set(yT.DefaultTv,{id:yT.DefaultTv,type:pT.Tv,assetId:Zl.TV,name:"TV",namekr:"티비",buildingTime:6e4})}get(t){return this.furnDb.get(t)}}var _T=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class bT extends xc{get BoxPos(){return this.asset.GetBoxPos(this.meshs)}constructor(t,e){super(t),this.name=e,this.text=new bS("제작을 시작해주세요")}Init(){return _T(this,void 0,void 0,(function*(){}))}Building(){}Done(){this.meshs.traverse((t=>{if("material"in t){const e=t.material;e.transparent=!1,e.depthWrite=!0,e.opacity=1}})),null!=this.text&&(this.text.visible=!1)}SetText(t){var e;null===(e=this.text)||void 0===e||e.SetText(t)}Create(){null!=this.text&&(this.text.position.y=4,this.meshs.add(this.text))}MassLoader(t,e,i){return _T(this,void 0,void 0,(function*(){if(i){const[t,e]=yield this.asset.UniqModel(this.name+i);this.meshs=t}else this.meshs=yield this.asset.CloneModel();this.meshs.position.set(t.x,t.y,t.z),e&&this.meshs.rotation.copy(e),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0,"material"in t&&(t.material.transparent=!0,t.material.depthWrite=!1,t.material.opacity=.3)}))}))}}var wT,MT=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};!function(t){t[t.NeedBuilding=0]="NeedBuilding",t[t.Building=1]="Building",t[t.Suspend=2]="Suspend",t[t.Done=3]="Done"}(wT||(wT={}));class ST extends kn{constructor(t,e,i,n,s){super(i,n),this.Id=t,this.ObjName=e,this.ctrl=s,this.name=e}}class TT{constructor(t,e,i,n,s,r,o,a,h){this.loader=t,this.player=e,this.playerCtrl=i,this.game=n,this.store=s,this.gphysic=r,this.eventCtrl=a,this.furnDb=h,this.controllable=!1,this.furnFab=new Map,this.furnitures=[],this.saveData=this.store.Furn,this.allocPos=0,o.RegisterViewer(this),s.RegisterStore(this),a.RegisterAppModeEvent(((t,e,i)=>{if(t==qE.Furniture)switch(e){case nc.Start:if(this.target=this.furnFab.get(i),!this.target)return;this.targetId=i,this.controllable=!0,this.game.add(this.target.Meshs),this.target.Visible=!0,this.target.CannonPos.copy(this.player.CannonPos),this.eventCtrl.OnChangeCtrlObjEvent(this.target),this.CheckCollision();break;case nc.End:if(this.controllable=!1,!this.target)return;this.target.Visible=!1,this.game.remove(this.target.Meshs)}})),a.RegisterKeyDownEvent((t=>{if(this.controllable)switch(t.Type){case sc.Action0:if(!this.target||!this.targetId)return;const e={id:this.targetId,position:(new Pe).copy(this.target.CannonPos),rotation:(new vi).copy(this.target.Meshs.rotation),state:wT.NeedBuilding,createTime:0};this.CreateFurn(e),a.OnAppModeEvent(qE.EditPlay);break;case sc.Action1:if(!this.target||!this.targetId)return;this.target.Meshs.rotation.y+=Math.PI/2;break;default:const i=t.ExecuteKeyDown();this.moveEvent(i)}})),a.RegisterAttackEvent("furniture",(t=>{t.forEach((t=>{let e=t.obj;if(null==e)return;const i=this.furnitures[e.Id];t.type==ET.Building?t.damage?i.furnCtrl.BuildingStart():i.furnCtrl.BuildingCancel():t.type==ET.Delete&&i.furnCtrl.Delete(t.damage)<=0&&this.DeleteFurn(e.Id)}))}))}resize(){}update(t){for(let e=0;e<this.furnitures.length;e++)this.furnitures[e].furnCtrl.update(t)}CheckCollision(){if(this.target)if(this.gphysic.Check(this.target))do{this.target.CannonPos.y+=.5}while(this.gphysic.Check(this.target));else{do{this.target.CannonPos.y-=.5}while(!this.gphysic.Check(this.target)&&this.target.CannonPos.y>=0);this.target.CannonPos.y+=.5}}Viliageload(){return MT(this,void 0,void 0,(function*(){this.ReleaseAllFurnPool()}))}Reload(){return MT(this,void 0,void 0,(function*(){this.ReleaseAllFurnPool(),this.saveData=this.store.Furn,this.saveData&&this.saveData.forEach((t=>{this.CreateFurn(t)}))}))}CreateFurn(t){return MT(this,void 0,void 0,(function*(){const e=this.furnDb.get(t.id);if(!e)return;let i=this.AllocateFurnPool(e,t);i||(i=yield this.NewFurnEntryPool(t,e)),this.playerCtrl.add(i.furnCtrl.phybox),this.game.add(i.furn.Meshs,i.furnCtrl.phybox)}))}DeleteFurn(t){const e=this.furnitures[t];if(!e.used)return;e.used=!1;const i=this.saveData.findIndex((t=>t.position.x==e.furn.CannonPos.x&&t.position.z==e.furn.CannonPos.z));i>-1&&this.saveData.splice(i,1),this.playerCtrl.remove(e.furnCtrl.phybox),this.game.remove(e.furn.Meshs,e.furnCtrl.phybox)}moveEvent(t){if(!this.target)return;const e=t.x>0?1:t.x<0?-1:0,i=t.z>0?1:t.z<0?-1:0;this.target.Meshs.position.x+=e,this.target.Meshs.position.z+=i,this.gphysic.Check(this.target)&&(this.target.Meshs.position.x-=e,this.target.Meshs.position.z-=i);do{this.target.CannonPos.y-=.2}while(!this.gphysic.Check(this.target)&&this.target.CannonPos.y>=0);this.target.CannonPos.y+=.2}AllocateFurnPool(t,e){for(let i=0;i<this.furnitures.length;i++,this.allocPos++){this.allocPos%=this.furnitures.length;const i=this.furnitures[this.allocPos];if(i.id==t.id&&0==i.used)return i.used=!0,i.furn.CannonPos.copy(e.position),i.furn.Meshs.rotation.copy(e.rotation),i.furnCtrl.phybox.position.copy(i.furn.BoxPos),i}}ReleaseAllFurnPool(){this.furnitures.forEach((t=>{t.used=!1,this.playerCtrl.remove(t.furnCtrl.phybox),this.game.remove(t.furn.Meshs,t.furnCtrl.phybox)}))}NewFurnEntryPool(t,e){return MT(this,void 0,void 0,(function*(){const i=this.getModel(t.id);if(!i)throw new Error("unexpected allocation fail");yield i.MassLoader(t.position,t.rotation,this.furnitures.length.toString()),i.Create(),i.Visible=!0;const n=new vT(this.furnitures.length,i,i,e,this.gphysic,this.saveData,t.state),s={id:t.id,furn:i,furnCtrl:n,used:!0};return this.furnitures.push(s),s}))}FurnLoader(){return MT(this,void 0,void 0,(function*(){yT.List.map((t=>MT(this,void 0,void 0,(function*(){yield this.allocModel(t,this.getModel(t))}))))}))}allocModel(t,e){return MT(this,void 0,void 0,(function*(){const i=ic.DefaultPortalPosition;this.furnFab.set(t,e),yield e.MassLoader(i)}))}getModel(t){let e;switch(t){default:case yT.DefaultBed:e=new bT(this.loader.BedAsset,"bed");break;case yT.DefaultBath:e=new bT(this.loader.BathAsset,"bath");break;case yT.DefaultBookShelf:e=new bT(this.loader.BookShelfAsset,"bookshelf");break;case yT.DefaultCloset:e=new bT(this.loader.ClosetAsset,"closet");break;case yT.DefaultDesk:e=new bT(this.loader.DeskAsset,"desk");break;case yT.DefaultKitchen:e=new bT(this.loader.KitchenAsset,"kitchen");break;case yT.DefaultKitTable:e=new bT(this.loader.KitTableAsset,"kittable");break;case yT.DefaultOven:e=new bT(this.loader.OvenAsset,"oven");break;case yT.DefaultRefrigerator:e=new bT(this.loader.RefrigeratorAsset,"refrigerator");break;case yT.DefaultSink:e=new bT(this.loader.SinkAsset,"sink");break;case yT.DefaultTable:e=new bT(this.loader.TableAsset,"table");break;case yT.DefaultToilet:e=new bT(this.loader.ToiletAsset,"toilet");break;case yT.DefaultTv:e=new bT(this.loader.TableAsset,"tv")}return e}}var ET,AT=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class CT extends IS{constructor(t,e,i,n){super(t,e,i),this.eventCtrl=n,this.next=this,this.attackDist=3,this.attackDir=new Pe,this.raycast=new Bl,this.attackTime=0,this.attackSpeed=2}Init(){this.player.ChangeAction(Ef.PickFruit),this.playerCtrl.RunSt.PreviousState(this.playerCtrl.IdleSt);const t=this.havest();null!=t&&(this.Uninit(),this.next=t)}Uninit(){this.target&&this.targetMsg&&(this.targetMsg.damage=0,this.eventCtrl.OnAttackEvent(this.target,[this.targetMsg]))}havest(){this.player.Meshs.getWorldDirection(this.attackDir),this.raycast.set(this.player.CenterPos,this.attackDir.normalize());const t=this.raycast.intersectObjects(this.playerCtrl.targets);if(!(t.length>0&&t[0].distance<this.attackDist))return this.playerCtrl.IdleSt.Init(),this.playerCtrl.IdleSt;for(let e=0;e<t.length;e++){const i=t[e];if(i.distance>this.attackDist)return;const n=i.object.name;if("farmtree"==n){const t=i.object.ctrl;if(t.PlantType==eT.Tree)return this.playerCtrl.PickFruitTreeSt.Init(),this.playerCtrl.PickFruitTreeSt;if(!t.NeedHavest)return this.playerCtrl.IdleSt.Init(),this.playerCtrl.IdleSt}const s={type:ET.Havest,damage:1,obj:i.object};this.eventCtrl.OnAttackEvent(n,[s]),this.target=n,this.targetMsg=s}}Update(t){const e=this.DefaultCheck();if(null!=e)return this.Uninit(),e;if(this.attackTime+=t,this.attackTime/this.attackSpeed<1)return this;this.attackTime-=this.attackSpeed;const i=this.havest();return null!=i?(this.Uninit(),i):this.next}}class IT extends IS{constructor(t,e,i,n){super(t,e,i),this.eventCtrl=n,this.next=this,this.attackDist=3,this.attackDir=new Pe,this.raycast=new Bl,this.attackTime=0,this.attackSpeed=2}Init(){this.player.ChangeAction(Ef.PickFruitTree),this.playerCtrl.RunSt.PreviousState(this.playerCtrl.IdleSt);const t=this.havest();null!=t&&(this.Uninit(),this.next=t)}Uninit(){this.target&&this.targetMsg&&(this.targetMsg.damage=0,this.eventCtrl.OnAttackEvent(this.target,[this.targetMsg]))}havest(){this.player.Meshs.getWorldDirection(this.attackDir),this.raycast.set(this.player.CenterPos,this.attackDir.normalize());const t=this.raycast.intersectObjects(this.playerCtrl.targets);if(!(t.length>0&&t[0].distance<this.attackDist))return this.playerCtrl.IdleSt.Init(),this.playerCtrl.IdleSt;for(let e=0;e<t.length;e++){const i=t[e];if(i.distance>this.attackDist)return;const n=i.object.name;if("farmtree"==n){const t=i.object.ctrl;if(t.PlantType==eT.Vegetable)return this.playerCtrl.PickFruitSt.Init(),this.playerCtrl.PickFruitSt;if(!t.NeedHavest)return this.playerCtrl.IdleSt.Init(),this.playerCtrl.IdleSt}const s={type:ET.Havest,damage:1,obj:i.object};this.eventCtrl.OnAttackEvent(n,[s]),this.target=n,this.targetMsg=s}}Update(t){const e=this.DefaultCheck();if(null!=e)return this.Uninit(),e;if(this.attackTime+=t,this.attackTime/this.attackSpeed<1)return this;this.attackTime-=this.attackSpeed;const i=this.havest();return null!=i?(this.Uninit(),i):this.next}}class RT extends IS{constructor(t,e,i,n){super(t,e,i),this.eventCtrl=n,this.next=this,this.attackDist=3,this.attackDir=new Pe,this.raycast=new Bl,this.trigger=!1}Init(){this.player.ChangeAction(Ef.PlantAPlant),this.playerCtrl.RunSt.PreviousState(this.playerCtrl.IdleSt),this.trigger=!0}plant(){if(!this.trigger)return;this.trigger=!1,this.player.Meshs.getWorldDirection(this.attackDir),this.raycast.set(this.player.CenterPos,this.attackDir.normalize());const t=this.raycast.intersectObjects(this.playerCtrl.targets);if(!(t.length>0&&t[0].distance<this.attackDist))return this.playerCtrl.IdleSt.Init(),this.playerCtrl.IdleSt;for(let e=0;e<t.length;e++){const i=t[e];if(i.distance>this.attackDist)return;const n=i.object.name;if("furniture"==n)return this.playerCtrl.BuildingSt.Init(),this.playerCtrl.BuildingSt;if("farmtree"==n){const t=i.object.ctrl;if(t.State!=uT.NeedSeed&&t.State!=uT.Seeding)return this.playerCtrl.DeleteSt.InitWithObj(i),this.playerCtrl.DeleteSt}if("deck"==n)return this.playerCtrl.DeckSt.Init(),this.playerCtrl.DeckSt;const s={type:ET.PlantAPlant,damage:1,obj:i.object};this.eventCtrl.OnAttackEvent(n,[s]),this.target=n,this.targetMsg=s}}Uninit(){this.target&&this.targetMsg&&(this.targetMsg.damage=0,this.eventCtrl.OnAttackEvent(this.target,[this.targetMsg]))}Update(){const t=this.DefaultCheck();if(null!=t)return this.Uninit(),t;const e=this.plant();return null!=e?(this.Uninit(),e):this.next}}class PT extends IS{constructor(t,e,i,n,s){super(t,e,i),this.invenFab=n,this.eventCtrl=s,this.attackDist=3,this.attackDir=new Pe,this.raycast=new Bl,this.trigger=!1}Init(){return AT(this,void 0,void 0,(function*(){this.player.ChangeAction(Ef.Watering),this.playerCtrl.RunSt.PreviousState(this.playerCtrl.IdleSt);const t=this.player.Asset.GetBodyMeshId(Yl.Hands_R);if(null==t)return;const e=this.player.Meshs.getObjectByName(t);if(!e)return;const i=yield this.invenFab.GetNewItem(ZS.WarterCan);if(i&&null!=i.Mesh){const t=e.getObjectById(i.Mesh.id);t?t.visible=!0:e.add(i.Mesh)}this.warteringCan=i,this.trigger=!0}))}Uninit(){this.warteringCan&&this.warteringCan.Mesh&&(this.warteringCan.Mesh.visible=!1),this.target&&this.targetMsg&&(this.targetMsg.damage=0,this.eventCtrl.OnAttackEvent(this.target,[this.targetMsg]))}wartering(){if(!this.trigger)return;this.trigger=!1,this.player.Meshs.getWorldDirection(this.attackDir),this.raycast.set(this.player.CenterPos,this.attackDir.normalize());const t=this.raycast.intersectObjects(this.playerCtrl.targets);if(!(t.length>0&&t[0].distance<this.attackDist))return this.playerCtrl.IdleSt.Init(),this.playerCtrl.IdleSt;t.forEach((t=>{if(t.distance>this.attackDist)return!1;const e=t.object.name,i={type:ET.Wartering,damage:1,obj:t.object};this.eventCtrl.OnAttackEvent(e,[i]),this.target=e,this.targetMsg=i}))}Update(){const t=this.DefaultCheck();if(null!=t)return this.Uninit(),t;const e=this.wartering();return null!=e?(this.Uninit(),e):this}}class kT extends IS{constructor(t,e,i,n){super(t,e,i),this.eventCtrl=n,this.next=this,this.attackDist=3,this.attackDir=new Pe,this.raycast=new Bl,this.attackTime=0,this.attackSpeed=2}InitWithObj(t){const e=t.object.name,i={type:ET.Delete,damage:1,obj:t.object};this.eventCtrl.OnAttackEvent(e,[i]),this.target=e,this.targetMsg=i,this.Init()}Init(){this.player.ChangeAction(Ef.Hammering,this.attackSpeed),this.playerCtrl.RunSt.PreviousState(this.playerCtrl.IdleSt)}delete(){this.player.Meshs.getWorldDirection(this.attackDir),this.raycast.set(this.player.CenterPos,this.attackDir.normalize());const t=this.raycast.intersectObjects(this.playerCtrl.targets);if(!(t.length>0&&t[0].distance<this.attackDist))return this.Uninit(),this.playerCtrl.IdleSt.Init(),this.playerCtrl.IdleSt;for(let e=0;e<t.length;e++){const i=t[e];if(i.distance>this.attackDist)return;const n=i.object.name,s={type:ET.Delete,damage:1,obj:i.object};this.eventCtrl.OnAttackEvent(n,[s]),this.target=n,this.targetMsg=s}return this}Uninit(){this.target&&this.targetMsg&&(this.targetMsg.damage=0,this.eventCtrl.OnAttackEvent(this.target,[this.targetMsg]))}Update(t){const e=this.DefaultCheck();return null!=e?(this.Uninit(),e):(this.attackTime+=t,this.attackTime/this.attackSpeed<1||(this.attackTime-=this.attackSpeed,this.delete()),this)}}class DT extends IS{constructor(t,e,i,n,s){super(t,e,i),this.invenFab=n,this.eventCtrl=s,this.attackDist=3,this.attackDir=new Pe,this.raycast=new Bl,this.trigger=!1}Init(){return AT(this,void 0,void 0,(function*(){this.player.ChangeAction(Ef.Building),this.playerCtrl.RunSt.PreviousState(this.playerCtrl.IdleSt);const t=this.player.Asset.GetBodyMeshId(Yl.Hands_R);if(null==t)return;const e=this.player.Meshs.getObjectByName(t);if(!e)return;const i=yield this.invenFab.GetNewItem(ZS.Hammer);if(i&&null!=i.Mesh){const t=e.getObjectById(i.Mesh.id);t?t.visible=!0:e.add(i.Mesh)}this.hammer=i,this.trigger=!0}))}Uninit(){this.hammer&&this.hammer.Mesh&&(this.hammer.Mesh.visible=!1),this.target&&this.targetMsg&&(this.targetMsg.damage=0,this.eventCtrl.OnAttackEvent(this.target,[this.targetMsg]))}building(){if(!this.trigger)return;this.trigger=!1,this.player.Meshs.getWorldDirection(this.attackDir),this.raycast.set(this.player.CenterPos,this.attackDir.normalize());const t=this.raycast.intersectObjects(this.playerCtrl.targets);if(!(t.length>0&&t[0].distance<this.attackDist))return this.Uninit(),this.playerCtrl.IdleSt.Init(),this.playerCtrl.IdleSt;for(let e=0;e<t.length;e++){const i=t[e];if(i.distance>this.attackDist)break;const n=i.object.name;if(i.object.ctrl.State==wT.Done)return this.playerCtrl.DeleteSt.InitWithObj(i),this.playerCtrl.DeleteSt;const s={type:ET.Building,damage:1,obj:i.object};this.eventCtrl.OnAttackEvent(n,[s]),this.target=n,this.targetMsg=s}}Update(){const t=this.DefaultCheck();if(null!=t)return this.Uninit(),t;const e=this.building();return null!=e?(this.Uninit(),e):this}}class LT extends IS{constructor(t,e,i,n){super(t,e,i),this.eventCtrl=n,this.next=this,this.attackDist=3,this.attackDir=new Pe,this.raycast=new Bl}Init(){this.player.ChangeAction(Ef.MagicH1),this.playerCtrl.RunSt.PreviousState(this.playerCtrl.IdleSt)}deckBuilding(){this.player.Meshs.getWorldDirection(this.attackDir),this.raycast.set(this.player.CenterPos,this.attackDir.normalize());const t=this.raycast.intersectObjects(this.playerCtrl.targets);if(!(t.length>0&&t[0].distance<this.attackDist))return this.playerCtrl.IdleSt.Init(),this.playerCtrl.IdleSt;for(let e=0;e<t.length;e++){const i=t[e];if(i.distance>this.attackDist)return;const n=i.object.name,s={type:ET.Delete,damage:1,obj:i.object};this.eventCtrl.OnAttackEvent(n,[s])}}Uninit(){}Update(){const t=this.DefaultCheck();if(null!=t)return this.Uninit(),t;const e=this.deckBuilding();return null!=e?(this.Uninit(),e):this.next}}!function(t){t[t.NormalSwing=0]="NormalSwing",t[t.Magic0=1]="Magic0",t[t.Exp=2]="Exp",t[t.Heal=3]="Heal",t[t.AOE=4]="AOE",t[t.Buff=5]="Buff",t[t.PlantAPlant=6]="PlantAPlant",t[t.Wartering=7]="Wartering",t[t.Havest=8]="Havest",t[t.Building=9]="Building",t[t.Delete=10]="Delete"}(ET||(ET={}));class OT{constructor(t,e,i,n,s){this.player=t,this.inventory=e,this.invenFab=i,this.gphysic=n,this.eventCtrl=s,this.mode=qE.Play,this.keyDownQueue=[],this.keyUpQueue=[],this.inputVQueue=[],this.targets=[],this.contollerEnable=!0,this.inputMode=!1,this.moveDirection=new Pe,this.spec=new jS(this.inventory),this.keyType=sc.None,this.AttackSt=new GS(this,this.player,this.gphysic,this.eventCtrl,this.spec),this.MagicH1St=new PS(this,this.player,this.gphysic),this.MagicH2St=new RS(this,this.player,this.gphysic),this.AttackIdleSt=new HS(this,this.player,this.gphysic),this.RunSt=new LS(this,this.player,this.gphysic),this.JumpSt=new OS(this,this.player,this.gphysic),this.IdleSt=new DS(this,this.player,this.gphysic),this.DyingSt=new kS(this,this.player,this.gphysic),this.PickFruitSt=new CT(this,this.player,this.gphysic,this.eventCtrl),this.PickFruitTreeSt=new IT(this,this.player,this.gphysic,this.eventCtrl),this.PlantASt=new RT(this,this.player,this.gphysic,this.eventCtrl),this.DeckSt=new LT(this,this.player,this.gphysic,this.eventCtrl),this.WarteringSt=new PT(this,this.player,this.gphysic,this.invenFab,this.eventCtrl),this.BuildingSt=new DT(this,this.player,this.gphysic,this.invenFab,this.eventCtrl),this.DeleteSt=new kT(this,this.player,this.gphysic,this.eventCtrl),this.currentState=this.IdleSt,this.KeyState=new Array(sc.Count),this.none=new oc,n.Register(this),s.RegisterAppModeEvent(((e,i)=>{if(this.mode=e,e==qE.EditPlay||e==qE.Weapon)switch(i){case nc.Start:for(;this.gphysic.Check(t);)t.CannonPos.y+=.2;this.currentState=this.IdleSt,this.currentState.Init();break;case nc.End:this.currentState.Uninit()}if(e==qE.Play)switch(i){case nc.Start:this.spec.ResetStatus(),s.OnChangePlayerStatusEvent(this.spec.Status),this.currentState=this.IdleSt,this.currentState.Init();break;case nc.End:this.currentState.Uninit()}})),s.RegisterKeyDownEvent((t=>{this.contollerEnable&&this.keyDownQueue.push(t)})),s.RegisterKeyUpEvent((t=>{this.contollerEnable&&this.keyUpQueue.push(t)})),s.RegisterInputEvent(((t,e)=>{this.contollerEnable&&("move"==t.type?(this.inputVQueue.push((new Pe).copy(e)),this.inputMode=!0):(this.inputMode=!1,this.reset()))})),s.RegisterChangeEquipmentEvent((()=>{this.spec.ItemUpdate(),this.currentState==this.AttackSt&&this.currentState.Init()})),s.RegisterAttackEvent("player",(t=>{t.forEach((t=>{switch(t.type){case ET.NormalSwing:case ET.Magic0:if(this.currentState==this.DyingSt)break;this.spec.ReceiveCalcDamage(t.damage),this.player.DamageEffect(t.damage),this.spec.CheckDie()&&(this.currentState=this.DyingSt,this.currentState.Init());break;case ET.Exp:this.spec.ReceiveExp(t.damage);break;case ET.Heal:this.player.HealEffect(t.damage),this.spec.ReceiveCalcHeal(t.damage)}})),s.OnChangePlayerStatusEvent(this.spec.Status)}))}add(...t){this.targets.push(...t)}remove(t){const e=this.targets.indexOf(t);e<0||this.targets.splice(e,1)}updateInputVector(){const t=this.inputVQueue.shift();null!=t&&(this.moveDirection.x=t.x,this.moveDirection.z=t.z)}reset(){this.moveDirection.x=0,this.moveDirection.z=0,this.inputVQueue.length=0}update(t){this.updateInputVector(),this.updateDownKey(),this.updateUpKey(),this.player.Visible&&(this.currentState=this.currentState.Update(t,this.moveDirection),this.player.Update(),this.spec.Update(t),this.actionReset())}actionReset(){for(let t=sc.Action0;t<sc.Count;t++)this.KeyState[t]=!1}updateDownKey(){let t=this.keyDownQueue.shift();if(null==t)return this.keyType=sc.None,void(t=this.none);this.KeyState[t.Type]=!0,this.keyType=t.Type;const e=t.ExecuteKeyDown();0!=e.x&&(this.moveDirection.x=e.x),0!=e.y&&(this.moveDirection.y=e.y),0!=e.z&&(this.moveDirection.z=e.z)}updateUpKey(){let t=this.keyUpQueue.shift();if(null==t)return this.keyType=sc.None,void(t=this.none);this.KeyState[t.Type]=!1,this.keyType=t.Type;const e=t.ExecuteKeyUp();e.x==this.moveDirection.x&&(this.moveDirection.x=0),e.y==this.moveDirection.y&&(this.moveDirection.y=0),e.z==this.moveDirection.z&&(this.moveDirection.z=0)}UpdateBuff(t){this.spec.SetBuff(t)}}class NT{constructor(t,e,i,n,s="div"){this.parent=t,this.object=e,this.property=i,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement(s),this.domElement.classList.add("controller"),this.domElement.classList.add(n),this.$name=document.createElement("div"),this.$name.classList.add("name"),NT.nextNameID=NT.nextNameID||0,this.$name.id="lil-gui-name-"+ ++NT.nextNameID,this.$widget=document.createElement("div"),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.domElement.addEventListener("keydown",(t=>t.stopPropagation())),this.domElement.addEventListener("keyup",(t=>t.stopPropagation())),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(i)}name(t){return this._name=t,this.$name.innerHTML=t,this}onChange(t){return this._onChange=t,this}_callOnChange(){this.parent._callOnChange(this),void 0!==this._onChange&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),void 0!==this._onFinishChange&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(t=!0){return this.disable(!t)}disable(t=!0){return t===this._disabled||(this._disabled=t,this.domElement.classList.toggle("disabled",t),this.$disable.toggleAttribute("disabled",t)),this}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(t){const e=this.parent.add(this.object,this.property,t);return e.name(this._name),this.destroy(),e}min(t){return this}max(t){return this}step(t){return this}decimals(t){return this}listen(t=!0){return this._listening=t,void 0!==this._listenCallbackID&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const t=this.save();t!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=t}getValue(){return this.object[this.property]}setValue(t){return this.object[this.property]=t,this._callOnChange(),this.updateDisplay(),this}updateDisplay(){return this}load(t){return this.setValue(t),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class BT extends NT{constructor(t,e,i){super(t,e,i,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",(()=>{this.setValue(this.$input.checked),this._callOnFinishChange()})),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function zT(t){let e,i;return(e=t.match(/(#|0x)?([a-f0-9]{6})/i))?i=e[2]:(e=t.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?i=parseInt(e[1]).toString(16).padStart(2,0)+parseInt(e[2]).toString(16).padStart(2,0)+parseInt(e[3]).toString(16).padStart(2,0):(e=t.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(i=e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),!!i&&"#"+i}const UT={isPrimitive:!0,match:t=>"number"==typeof t,fromHexString:t=>parseInt(t.substring(1),16),toHexString:t=>"#"+t.toString(16).padStart(6,0)},FT={isPrimitive:!1,match:t=>Array.isArray(t),fromHexString(t,e,i=1){const n=UT.fromHexString(t);e[0]=(n>>16&255)/255*i,e[1]=(n>>8&255)/255*i,e[2]=(255&n)/255*i},toHexString:([t,e,i],n=1)=>UT.toHexString(t*(n=255/n)<<16^e*n<<8^i*n<<0)},GT={isPrimitive:!1,match:t=>Object(t)===t,fromHexString(t,e,i=1){const n=UT.fromHexString(t);e.r=(n>>16&255)/255*i,e.g=(n>>8&255)/255*i,e.b=(255&n)/255*i},toHexString:({r:t,g:e,b:i},n=1)=>UT.toHexString(t*(n=255/n)<<16^e*n<<8^i*n<<0)},HT=[{isPrimitive:!0,match:t=>"string"==typeof t,fromHexString:zT,toHexString:zT},UT,FT,GT];class VT extends NT{constructor(t,e,i,n){var s;super(t,e,i,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=(s=this.initialValue,HT.find((t=>t.match(s)))),this._rgbScale=n,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",(()=>{this._setValueFromHexString(this.$input.value)})),this.$input.addEventListener("blur",(()=>{this._callOnFinishChange()})),this.$text.addEventListener("input",(()=>{const t=zT(this.$text.value);t&&this._setValueFromHexString(t)})),this.$text.addEventListener("focus",(()=>{this._textFocused=!0,this.$text.select()})),this.$text.addEventListener("blur",(()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()})),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(t){if(this._format.isPrimitive){const e=this._format.fromHexString(t);this.setValue(e)}else this._format.fromHexString(t,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(t){return this._setValueFromHexString(t),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class jT extends NT{constructor(t,e,i){super(t,e,i,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",(t=>{t.preventDefault(),this.getValue().call(this.object),this._callOnChange()})),this.$button.addEventListener("touchstart",(()=>{}),{passive:!0}),this.$disable=this.$button}}class WT extends NT{constructor(t,e,i,n,s,r){super(t,e,i,"number"),this._initInput(),this.min(n),this.max(s);const o=void 0!==r;this.step(o?r:this._getImplicitStep(),o),this.updateDisplay()}decimals(t){return this._decimals=t,this.updateDisplay(),this}min(t){return this._min=t,this._onUpdateMinMax(),this}max(t){return this._max=t,this._onUpdateMinMax(),this}step(t,e=!0){return this._step=t,this._stepExplicit=e,this}updateDisplay(){const t=this.getValue();if(this._hasSlider){let e=(t-this._min)/(this._max-this._min);e=Math.max(0,Math.min(e,1)),this.$fill.style.width=100*e+"%"}return this._inputFocused||(this.$input.value=void 0===this._decimals?t:t.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id);window.matchMedia("(pointer: coarse)").matches&&(this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any")),this.$widget.appendChild(this.$input),this.$disable=this.$input;const t=t=>{const e=parseFloat(this.$input.value);isNaN(e)||(this._snapClampSetValue(e+t),this.$input.value=this.getValue())};let e,i,n,s,r,o=!1;const a=t=>{if(o){const n=t.clientX-e,s=t.clientY-i;Math.abs(s)>5?(t.preventDefault(),this.$input.blur(),o=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(n)>5&&h()}if(!o){const e=t.clientY-n;r-=e*this._step*this._arrowKeyMultiplier(t),s+r>this._max?r=this._max-s:s+r<this._min&&(r=this._min-s),this._snapClampSetValue(s+r)}n=t.clientY},h=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",h)};this.$input.addEventListener("input",(()=>{let t=parseFloat(this.$input.value);isNaN(t)||(this._stepExplicit&&(t=this._snap(t)),this.setValue(this._clamp(t)))})),this.$input.addEventListener("keydown",(e=>{"Enter"===e.key&&this.$input.blur(),"ArrowUp"===e.code&&(e.preventDefault(),t(this._step*this._arrowKeyMultiplier(e))),"ArrowDown"===e.code&&(e.preventDefault(),t(this._step*this._arrowKeyMultiplier(e)*-1))})),this.$input.addEventListener("wheel",(e=>{this._inputFocused&&(e.preventDefault(),t(this._step*this._normalizeMouseWheel(e)))}),{passive:!1}),this.$input.addEventListener("mousedown",(t=>{e=t.clientX,i=n=t.clientY,o=!0,s=this.getValue(),r=0,window.addEventListener("mousemove",a),window.addEventListener("mouseup",h)})),this.$input.addEventListener("focus",(()=>{this._inputFocused=!0})),this.$input.addEventListener("blur",(()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()}))}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const t=t=>{const e=this.$slider.getBoundingClientRect();let i=((t,e,i,n,s)=>(t-e)/(i-e)*(s-n)+n)(t,e.left,e.right,this._min,this._max);this._snapClampSetValue(i)},e=e=>{t(e.clientX)},i=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",e),window.removeEventListener("mouseup",i)};let n,s,r=!1;const o=e=>{e.preventDefault(),this._setDraggingStyle(!0),t(e.touches[0].clientX),r=!1},a=e=>{if(r){const t=e.touches[0].clientX-n,i=e.touches[0].clientY-s;Math.abs(t)>Math.abs(i)?o(e):(window.removeEventListener("touchmove",a),window.removeEventListener("touchend",h))}else e.preventDefault(),t(e.touches[0].clientX)},h=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",h)},l=this._callOnFinishChange.bind(this);let c;this.$slider.addEventListener("mousedown",(n=>{this._setDraggingStyle(!0),t(n.clientX),window.addEventListener("mousemove",e),window.addEventListener("mouseup",i)})),this.$slider.addEventListener("touchstart",(t=>{t.touches.length>1||(this._hasScrollBar?(n=t.touches[0].clientX,s=t.touches[0].clientY,r=!0):o(t),window.addEventListener("touchmove",a,{passive:!1}),window.addEventListener("touchend",h))}),{passive:!1}),this.$slider.addEventListener("wheel",(t=>{if(Math.abs(t.deltaX)<Math.abs(t.deltaY)&&this._hasScrollBar)return;t.preventDefault();const e=this._normalizeMouseWheel(t)*this._step;this._snapClampSetValue(this.getValue()+e),this.$input.value=this.getValue(),clearTimeout(c),c=setTimeout(l,400)}),{passive:!1})}_setDraggingStyle(t,e="horizontal"){this.$slider&&this.$slider.classList.toggle("active",t),document.body.classList.toggle("lil-gui-dragging",t),document.body.classList.toggle(`lil-gui-${e}`,t)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(t){let{deltaX:e,deltaY:i}=t;Math.floor(t.deltaY)!==t.deltaY&&t.wheelDelta&&(e=0,i=-t.wheelDelta/120,i*=this._stepExplicit?1:10);return e+-i}_arrowKeyMultiplier(t){let e=this._stepExplicit?1:10;return t.shiftKey?e*=10:t.altKey&&(e/=10),e}_snap(t){const e=Math.round(t/this._step)*this._step;return parseFloat(e.toPrecision(15))}_clamp(t){return t<this._min&&(t=this._min),t>this._max&&(t=this._max),t}_snapClampSetValue(t){this.setValue(this._clamp(this._snap(t)))}get _hasScrollBar(){const t=this.parent.root.$children;return t.scrollHeight>t.clientHeight}get _hasMin(){return void 0!==this._min}get _hasMax(){return void 0!==this._max}}class XT extends NT{constructor(t,e,i,n){super(t,e,i,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$select.addEventListener("change",(()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()})),this.$select.addEventListener("focus",(()=>{this.$display.classList.add("focus")})),this.$select.addEventListener("blur",(()=>{this.$display.classList.remove("focus")})),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.options(n)}options(t){return this._values=Array.isArray(t)?t:Object.values(t),this._names=Array.isArray(t)?t:Object.keys(t),this.$select.replaceChildren(),this._names.forEach((t=>{const e=document.createElement("option");e.innerHTML=t,this.$select.appendChild(e)})),this.updateDisplay(),this}updateDisplay(){const t=this.getValue(),e=this._values.indexOf(t);return this.$select.selectedIndex=e,this.$display.innerHTML=-1===e?t:this._names[e],this}}class $T extends NT{constructor(t,e,i){super(t,e,i,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",(()=>{this.setValue(this.$input.value)})),this.$input.addEventListener("keydown",(t=>{"Enter"===t.code&&this.$input.blur()})),this.$input.addEventListener("blur",(()=>{this._callOnFinishChange()})),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}let qT=!1;class YT{constructor({parent:t,autoPlace:e=void 0===t,container:i,width:n,title:s="Controls",closeFolders:r=!1,injectStyles:o=!0,touchStyles:a=!0}={}){if(this.parent=t,this.root=t?t.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("div"),this.$title.classList.add("title"),this.$title.setAttribute("role","button"),this.$title.setAttribute("aria-expanded",!0),this.$title.setAttribute("tabindex",0),this.$title.addEventListener("click",(()=>this.openAnimated(this._closed))),this.$title.addEventListener("keydown",(t=>{"Enter"!==t.code&&"Space"!==t.code||(t.preventDefault(),this.$title.click())})),this.$title.addEventListener("touchstart",(()=>{}),{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(s),this.parent)return this.parent.children.push(this),this.parent.folders.push(this),void this.parent.$children.appendChild(this.domElement);this.domElement.classList.add("root"),a&&this.domElement.classList.add("allow-touch-styles"),!qT&&o&&(!function(t){const e=document.createElement("style");e.innerHTML=t;const i=document.querySelector("head link[rel=stylesheet], head style");i?document.head.insertBefore(e,i):document.head.appendChild(e)}('.lil-gui {\n  font-family: var(--font-family);\n  font-size: var(--font-size);\n  line-height: 1;\n  font-weight: normal;\n  font-style: normal;\n  text-align: left;\n  color: var(--text-color);\n  user-select: none;\n  -webkit-user-select: none;\n  touch-action: manipulation;\n  --background-color: #1f1f1f;\n  --text-color: #ebebeb;\n  --title-background-color: #111111;\n  --title-text-color: #ebebeb;\n  --widget-color: #424242;\n  --hover-color: #4f4f4f;\n  --focus-color: #595959;\n  --number-color: #2cc9ff;\n  --string-color: #a2db3c;\n  --font-size: 11px;\n  --input-font-size: 11px;\n  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;\n  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;\n  --padding: 4px;\n  --spacing: 4px;\n  --widget-height: 20px;\n  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);\n  --name-width: 45%;\n  --slider-knob-width: 2px;\n  --slider-input-width: 27%;\n  --color-input-width: 27%;\n  --slider-input-min-width: 45px;\n  --color-input-min-width: 45px;\n  --folder-indent: 7px;\n  --widget-padding: 0 0 0 3px;\n  --widget-border-radius: 2px;\n  --checkbox-size: calc(0.75 * var(--widget-height));\n  --scrollbar-width: 5px;\n}\n.lil-gui, .lil-gui * {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n.lil-gui.root {\n  width: var(--width, 245px);\n  display: flex;\n  flex-direction: column;\n  background: var(--background-color);\n}\n.lil-gui.root > .title {\n  background: var(--title-background-color);\n  color: var(--title-text-color);\n}\n.lil-gui.root > .children {\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n.lil-gui.root > .children::-webkit-scrollbar {\n  width: var(--scrollbar-width);\n  height: var(--scrollbar-width);\n  background: var(--background-color);\n}\n.lil-gui.root > .children::-webkit-scrollbar-thumb {\n  border-radius: var(--scrollbar-width);\n  background: var(--focus-color);\n}\n@media (pointer: coarse) {\n  .lil-gui.allow-touch-styles, .lil-gui.allow-touch-styles .lil-gui {\n    --widget-height: 28px;\n    --padding: 6px;\n    --spacing: 6px;\n    --font-size: 13px;\n    --input-font-size: 16px;\n    --folder-indent: 10px;\n    --scrollbar-width: 7px;\n    --slider-input-min-width: 50px;\n    --color-input-min-width: 65px;\n  }\n}\n.lil-gui.force-touch-styles, .lil-gui.force-touch-styles .lil-gui {\n  --widget-height: 28px;\n  --padding: 6px;\n  --spacing: 6px;\n  --font-size: 13px;\n  --input-font-size: 16px;\n  --folder-indent: 10px;\n  --scrollbar-width: 7px;\n  --slider-input-min-width: 50px;\n  --color-input-min-width: 65px;\n}\n.lil-gui.autoPlace {\n  max-height: 100%;\n  position: fixed;\n  top: 0;\n  right: 15px;\n  z-index: 1001;\n}\n\n.lil-gui .controller {\n  display: flex;\n  align-items: center;\n  padding: 0 var(--padding);\n  margin: var(--spacing) 0;\n}\n.lil-gui .controller.disabled {\n  opacity: 0.5;\n}\n.lil-gui .controller.disabled, .lil-gui .controller.disabled * {\n  pointer-events: none !important;\n}\n.lil-gui .controller > .name {\n  min-width: var(--name-width);\n  flex-shrink: 0;\n  white-space: pre;\n  padding-right: var(--spacing);\n  line-height: var(--widget-height);\n}\n.lil-gui .controller .widget {\n  position: relative;\n  display: flex;\n  align-items: center;\n  width: 100%;\n  min-height: var(--widget-height);\n}\n.lil-gui .controller.string input {\n  color: var(--string-color);\n}\n.lil-gui .controller.boolean {\n  cursor: pointer;\n}\n.lil-gui .controller.color .display {\n  width: 100%;\n  height: var(--widget-height);\n  border-radius: var(--widget-border-radius);\n  position: relative;\n}\n@media (hover: hover) {\n  .lil-gui .controller.color .display:hover:before {\n    content: " ";\n    display: block;\n    position: absolute;\n    border-radius: var(--widget-border-radius);\n    border: 1px solid #fff9;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n  }\n}\n.lil-gui .controller.color input[type=color] {\n  opacity: 0;\n  width: 100%;\n  height: 100%;\n  cursor: pointer;\n}\n.lil-gui .controller.color input[type=text] {\n  margin-left: var(--spacing);\n  font-family: var(--font-family-mono);\n  min-width: var(--color-input-min-width);\n  width: var(--color-input-width);\n  flex-shrink: 0;\n}\n.lil-gui .controller.option select {\n  opacity: 0;\n  position: absolute;\n  width: 100%;\n  max-width: 100%;\n}\n.lil-gui .controller.option .display {\n  position: relative;\n  pointer-events: none;\n  border-radius: var(--widget-border-radius);\n  height: var(--widget-height);\n  line-height: var(--widget-height);\n  max-width: 100%;\n  overflow: hidden;\n  word-break: break-all;\n  padding-left: 0.55em;\n  padding-right: 1.75em;\n  background: var(--widget-color);\n}\n@media (hover: hover) {\n  .lil-gui .controller.option .display.focus {\n    background: var(--focus-color);\n  }\n}\n.lil-gui .controller.option .display.active {\n  background: var(--focus-color);\n}\n.lil-gui .controller.option .display:after {\n  font-family: "lil-gui";\n  content: "↕";\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  padding-right: 0.375em;\n}\n.lil-gui .controller.option .widget,\n.lil-gui .controller.option select {\n  cursor: pointer;\n}\n@media (hover: hover) {\n  .lil-gui .controller.option .widget:hover .display {\n    background: var(--hover-color);\n  }\n}\n.lil-gui .controller.number input {\n  color: var(--number-color);\n}\n.lil-gui .controller.number.hasSlider input {\n  margin-left: var(--spacing);\n  width: var(--slider-input-width);\n  min-width: var(--slider-input-min-width);\n  flex-shrink: 0;\n}\n.lil-gui .controller.number .slider {\n  width: 100%;\n  height: var(--widget-height);\n  background: var(--widget-color);\n  border-radius: var(--widget-border-radius);\n  padding-right: var(--slider-knob-width);\n  overflow: hidden;\n  cursor: ew-resize;\n  touch-action: pan-y;\n}\n@media (hover: hover) {\n  .lil-gui .controller.number .slider:hover {\n    background: var(--hover-color);\n  }\n}\n.lil-gui .controller.number .slider.active {\n  background: var(--focus-color);\n}\n.lil-gui .controller.number .slider.active .fill {\n  opacity: 0.95;\n}\n.lil-gui .controller.number .fill {\n  height: 100%;\n  border-right: var(--slider-knob-width) solid var(--number-color);\n  box-sizing: content-box;\n}\n\n.lil-gui-dragging .lil-gui {\n  --hover-color: var(--widget-color);\n}\n.lil-gui-dragging * {\n  cursor: ew-resize !important;\n}\n\n.lil-gui-dragging.lil-gui-vertical * {\n  cursor: ns-resize !important;\n}\n\n.lil-gui .title {\n  height: var(--title-height);\n  line-height: calc(var(--title-height) - 4px);\n  font-weight: 600;\n  padding: 0 var(--padding);\n  -webkit-tap-highlight-color: transparent;\n  cursor: pointer;\n  outline: none;\n  text-decoration-skip: objects;\n}\n.lil-gui .title:before {\n  font-family: "lil-gui";\n  content: "▾";\n  padding-right: 2px;\n  display: inline-block;\n}\n.lil-gui .title:active {\n  background: var(--title-background-color);\n  opacity: 0.75;\n}\n@media (hover: hover) {\n  body:not(.lil-gui-dragging) .lil-gui .title:hover {\n    background: var(--title-background-color);\n    opacity: 0.85;\n  }\n  .lil-gui .title:focus {\n    text-decoration: underline var(--focus-color);\n  }\n}\n.lil-gui.root > .title:focus {\n  text-decoration: none !important;\n}\n.lil-gui.closed > .title:before {\n  content: "▸";\n}\n.lil-gui.closed > .children {\n  transform: translateY(-7px);\n  opacity: 0;\n}\n.lil-gui.closed:not(.transition) > .children {\n  display: none;\n}\n.lil-gui.transition > .children {\n  transition-duration: 300ms;\n  transition-property: height, opacity, transform;\n  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);\n  overflow: hidden;\n  pointer-events: none;\n}\n.lil-gui .children:empty:before {\n  content: "Empty";\n  padding: 0 var(--padding);\n  margin: var(--spacing) 0;\n  display: block;\n  height: var(--widget-height);\n  font-style: italic;\n  line-height: var(--widget-height);\n  opacity: 0.5;\n}\n.lil-gui.root > .children > .lil-gui > .title {\n  border: 0 solid var(--widget-color);\n  border-width: 1px 0;\n  transition: border-color 300ms;\n}\n.lil-gui.root > .children > .lil-gui.closed > .title {\n  border-bottom-color: transparent;\n}\n.lil-gui + .controller {\n  border-top: 1px solid var(--widget-color);\n  margin-top: 0;\n  padding-top: var(--spacing);\n}\n.lil-gui .lil-gui .lil-gui > .title {\n  border: none;\n}\n.lil-gui .lil-gui .lil-gui > .children {\n  border: none;\n  margin-left: var(--folder-indent);\n  border-left: 2px solid var(--widget-color);\n}\n.lil-gui .lil-gui .controller {\n  border: none;\n}\n\n.lil-gui label, .lil-gui input, .lil-gui button {\n  -webkit-tap-highlight-color: transparent;\n}\n.lil-gui input {\n  border: 0;\n  outline: none;\n  font-family: var(--font-family);\n  font-size: var(--input-font-size);\n  border-radius: var(--widget-border-radius);\n  height: var(--widget-height);\n  background: var(--widget-color);\n  color: var(--text-color);\n  width: 100%;\n}\n@media (hover: hover) {\n  .lil-gui input:hover {\n    background: var(--hover-color);\n  }\n  .lil-gui input:active {\n    background: var(--focus-color);\n  }\n}\n.lil-gui input:disabled {\n  opacity: 1;\n}\n.lil-gui input[type=text],\n.lil-gui input[type=number] {\n  padding: var(--widget-padding);\n  -moz-appearance: textfield;\n}\n.lil-gui input[type=text]:focus,\n.lil-gui input[type=number]:focus {\n  background: var(--focus-color);\n}\n.lil-gui input[type=checkbox] {\n  appearance: none;\n  width: var(--checkbox-size);\n  height: var(--checkbox-size);\n  border-radius: var(--widget-border-radius);\n  text-align: center;\n  cursor: pointer;\n}\n.lil-gui input[type=checkbox]:checked:before {\n  font-family: "lil-gui";\n  content: "✓";\n  font-size: var(--checkbox-size);\n  line-height: var(--checkbox-size);\n}\n@media (hover: hover) {\n  .lil-gui input[type=checkbox]:focus {\n    box-shadow: inset 0 0 0 1px var(--focus-color);\n  }\n}\n.lil-gui button {\n  outline: none;\n  cursor: pointer;\n  font-family: var(--font-family);\n  font-size: var(--font-size);\n  color: var(--text-color);\n  width: 100%;\n  height: var(--widget-height);\n  text-transform: none;\n  background: var(--widget-color);\n  border-radius: var(--widget-border-radius);\n  border: none;\n}\n@media (hover: hover) {\n  .lil-gui button:hover {\n    background: var(--hover-color);\n  }\n  .lil-gui button:focus {\n    box-shadow: inset 0 0 0 1px var(--focus-color);\n  }\n}\n.lil-gui button:active {\n  background: var(--focus-color);\n}\n\n@font-face {\n  font-family: "lil-gui";\n  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");\n}'),qT=!0),i?i.appendChild(this.domElement):e&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),n&&this.domElement.style.setProperty("--width",n+"px"),this._closeFolders=r}add(t,e,i,n,s){if(Object(i)===i)return new XT(this,t,e,i);switch(typeof t[e]){case"number":return new WT(this,t,e,i,n,s);case"boolean":return new BT(this,t,e);case"string":return new $T(this,t,e);case"function":return new jT(this,t,e)}}addColor(t,e,i=1){return new VT(this,t,e,i)}addFolder(t){const e=new YT({parent:this,title:t});return this.root._closeFolders&&e.close(),e}load(t,e=!0){return t.controllers&&this.controllers.forEach((e=>{e instanceof jT||e._name in t.controllers&&e.load(t.controllers[e._name])})),e&&t.folders&&this.folders.forEach((e=>{e._title in t.folders&&e.load(t.folders[e._title])})),this}save(t=!0){const e={controllers:{},folders:{}};return this.controllers.forEach((t=>{if(!(t instanceof jT)){if(t._name in e.controllers)throw new Error(`Cannot save GUI with duplicate property "${t._name}"`);e.controllers[t._name]=t.save()}})),t&&this.folders.forEach((t=>{if(t._title in e.folders)throw new Error(`Cannot save GUI with duplicate folder "${t._title}"`);e.folders[t._title]=t.save()})),e}open(t=!0){return this._setClosed(!t),this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}_setClosed(t){this._closed!==t&&(this._closed=t,this._callOnOpenClose(this))}show(t=!0){return this._hidden=!t,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(t=!0){return this._setClosed(!t),this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame((()=>{const e=this.$children.clientHeight;this.$children.style.height=e+"px",this.domElement.classList.add("transition");const i=t=>{t.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",i))};this.$children.addEventListener("transitionend",i);const n=t?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!t),requestAnimationFrame((()=>{this.$children.style.height=n+"px"}))})),this}title(t){return this._title=t,this.$title.innerHTML=t,this}reset(t=!0){return(t?this.controllersRecursive():this.controllers).forEach((t=>t.reset())),this}onChange(t){return this._onChange=t,this}_callOnChange(t){this.parent&&this.parent._callOnChange(t),void 0!==this._onChange&&this._onChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onFinishChange(t){return this._onFinishChange=t,this}_callOnFinishChange(t){this.parent&&this.parent._callOnFinishChange(t),void 0!==this._onFinishChange&&this._onFinishChange.call(this,{object:t.object,property:t.property,value:t.getValue(),controller:t})}onOpenClose(t){return this._onOpenClose=t,this}_callOnOpenClose(t){this.parent&&this.parent._callOnOpenClose(t),void 0!==this._onOpenClose&&this._onOpenClose.call(this,t)}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach((t=>t.destroy()))}controllersRecursive(){let t=Array.from(this.controllers);return this.folders.forEach((e=>{t=t.concat(e.controllersRecursive())})),t}foldersRecursive(){let t=Array.from(this.folders);return this.folders.forEach((e=>{t=t.concat(e.foldersRecursive())})),t}}var KT=o(49),ZT=o.n(KT);const JT=new YT;JT.hide();class QT{constructor(t,e,i,n,s,r,o,a,h,l,c,u,d){this.scene=t,this.playerCtrl=i,this.rayViewer=h,this.physics=l,this.gui=JT,this.debugMode=!1,this.axesHelper=new ql(300),this.gridHelper=new Gl(300),this.stats=new(ZT()),this.gui.hide(),this.gui.close(),this.CreateMeshGui(e.meshs,"Player"),this.CreateMeshGui(n.Owner.Meshs,"Owner"),this.CreateMeshGui(n.Helper.Meshs,"Helper1"),this.CreateMeshGui(n.Helper2.Meshs,"Helper2"),this.CreateMeshGui(s.Meshs,"Portal"),this.CreateMeshGui(d.points,"drop");this.CreateMeshGui(a,"Camera").add(a,"debugMode").listen();this.CreateMeshGui(o.brickfield,"Brick Field").add(o.brickfield,"visible").listen().name("visible");this.CreateMeshGui(r,"floor").add(r,"visible").listen().name("visible"),this.arrowHelper=new $l(h.ray.direction,h.ray.origin,300,65280),this.arrowAttackHelper=new $l(this.playerCtrl.AttackSt.raycast.ray.direction,this.playerCtrl.AttackSt.raycast.ray.origin,300,16711680),u.RegisterKeyDownEvent((t=>{t.Type==sc.System0&&this.On()})),c.RegisterViewer(this)}resize(){}update(){this.arrowHelper.position.copy(this.rayViewer.ray.origin),this.arrowHelper.setDirection(this.rayViewer.ray.direction),this.arrowAttackHelper.position.copy(this.playerCtrl.AttackSt.raycast.ray.origin),this.arrowAttackHelper.setDirection(this.playerCtrl.AttackSt.raycast.ray.direction)}On(){this.debugMode?(this.scene.remove(this.axesHelper,this.gridHelper,this.arrowHelper,this.arrowAttackHelper),document.body.removeChild(this.stats.dom),this.gui.hide(),this.debugMode=!1,this.physics.DebugMode(!0)):(this.scene.add(this.axesHelper,this.gridHelper,this.arrowHelper,this.arrowAttackHelper),document.body.appendChild(this.stats.dom),this.stats.showPanel(0),this.gui.show(),this.debugMode=!0,this.physics.DebugMode(!1))}CheckStateBegin(){this.debugMode}CheckStateEnd(){this.debugMode&&this.stats.update()}CreateVectorGui(t,e,i){t.add(e,"x",-100,100,.1).listen().name(i+"X"),t.add(e,"y",-100,100,.1).listen().name(i+"Y"),t.add(e,"z",-100,100,.1).listen().name(i+"Z")}CreateMeshGui(t,e){const i=this.gui.addFolder(e);return this.CreateVectorGui(i,t.position,"Pos"),this.CreateVectorGui(i,t.rotation,"Rot"),this.CreateVectorGui(i,t.scale,"Scale"),i.add(t,"visible").listen().name("Visible"),i.close(),i}}class tE{constructor(t){this.options=t,this.joy=document.createElement("canvas"),this.ctx=this.joy.getContext("2d"),this.joyPos=this.joy.getBoundingClientRect(),this.startX=0,this.startY=0,this.moveX=0,this.moveY=0,this.onTouch=!1,this.moveMax=40,this.msgPrev="s",this.msg="s",this.color="rgb(255, 255, 255)",this.joy.setAttribute("id","zone_joystick"),document.body.appendChild(this.joy),this.joy.width=200,this.joy.height=200,this.joy.ontouchstart=t=>{this.start(t.touches[0].clientX,t.touches[0].clientY),this.options.ontouchstart&&this.options.ontouchstart(t.touches[1])},this.joy.ontouchmove=t=>{this.move(t.touches[0].clientX,t.touches[0].clientY),this.options.ontouchmove&&this.options.ontouchmove(t.touches[1])},this.joy.ontouchend=t=>{this.end(),this.options.ontouchend&&this.options.ontouchend(t.touches[1])},this.joy.onmousedown=t=>{this.start(t.clientX,t.clientY)},this.joy.onmousemove=t=>{this.onTouch&&this.move(t.clientX,t.clientY)},this.joy.onmouseup=()=>{this.end()},null!=this.ctx&&(this.ctx.lineWidth=10,this.ctx.globalAlpha=.5,this.clearBackground(),this.drawCircle(100,100,50,this.color))}MultiEvent(){}Hide(){this.joy.style.display="none"}Show(){this.joy.style.display="block"}send(t){}clearBackground(){null!=this.ctx&&(this.ctx.clearRect(0,0,this.joy.width,this.joy.height),this.ctx.beginPath(),this.ctx.strokeStyle=this.color,this.ctx.arc(100,100,90,0,2*Math.PI),this.ctx.stroke())}drawCircle(t,e,i,n){null!=this.ctx&&(this.ctx.beginPath(),this.ctx.fillStyle=n,this.ctx.arc(t,e,i,0,2*Math.PI),this.ctx.fill())}start(t,e){this.startX=Math.round(t-this.joyPos.left),this.startY=Math.round(e-this.joyPos.top),this.onTouch=!0}move(t,e){this.onTouch&&(this.moveX=Math.round(t-this.joyPos.left)-this.startX,this.moveY=Math.round(e-this.joyPos.top)-this.startY,this.moveX>this.moveMax?this.moveX=this.moveMax:this.moveX<-this.moveMax&&(this.moveX=-this.moveMax),this.moveY>this.moveMax?this.moveY=this.moveMax:this.moveY<-this.moveMax&&(this.moveY=-this.moveMax),this.clearBackground(),this.drawCircle(100+this.moveX,100+this.moveY,50,this.color),this.moveX>=40?this.msg="d":this.moveX<=-40?this.msg="a":this.moveY<=-40?this.msg="w":this.moveY>=40&&(this.msg="x"),this.options.event("move",this.msg,this.moveX/this.moveMax,this.moveY/this.moveMax),this.msg!=this.msgPrev&&(this.send(this.msg),this.msgPrev=this.msg))}end(){this.clearBackground(),this.drawCircle(100,100,50,this.color),this.msg="s",this.msgPrev="s",this.onTouch=!1,this.send(this.msg),this.options.event("end",this.msg,this.moveX,this.moveY)}}class eE{constructor(t){this.eventCtrl=t,this.realV=new Pe,this.virtualV=new Pe,this.zeroV=new Pe,this.left=document.getElementById("goleft"),this.right=document.getElementById("goright"),this.up=document.getElementById("goup"),this.down=document.getElementById("godown"),this.jump=document.getElementById("joypad_button1"),this.action1=document.getElementById("joypad_button2"),this.action2=document.getElementById("joypad_button3"),this.action3=document.getElementById("joypad_button4"),this.clock=new Sl,this.startTime=this.clock.getElapsedTime().toFixed(2),this.joystick=new tE({event:(t,e,i,n)=>{if("move"==t){const t=this.clock.getElapsedTime().toFixed(2);if(this.startTime==t)return;this.startTime=t}const s=this.virtualV.copy(this.zeroV);switch(e){case"w":s.z=-1;break;case"x":s.z=1;break;case"d":s.x=1;break;case"a":s.x=-1}this.realV.set(i,0,n),this.eventCtrl.OnInputEvent({type:t},this.realV,this.virtualV)}}),this.eventCtrl.RegisterAppModeEvent(((t,e)=>{switch(t){case qE.Brick:case qE.NonLego:case qE.LegoDelete:case qE.Lego:case qE.Portal:case qE.Farmer:case qE.Furniture:e==nc.Start?(this.LegacyButtonShow(),this.ButtonShow()):e==nc.End&&(this.LegacyButtonHide(),this.ButtonHide());break;case qE.Weapon:case qE.EditPlay:case qE.Play:e==nc.Start?(this.joystick.Show(),this.ButtonShow()):e==nc.End&&(this.joystick.Hide(),this.ButtonHide())}})),this.up.ontouchstart=()=>{this.eventCtrl.OnKeyDownEvent(new pc)},this.down.ontouchstart=()=>{this.eventCtrl.OnKeyDownEvent(new mc)},this.left.ontouchstart=()=>{this.eventCtrl.OnKeyDownEvent(new fc)},this.right.ontouchstart=()=>{this.eventCtrl.OnKeyDownEvent(new gc)},this.up.ontouchend=()=>{this.eventCtrl.OnKeyUpEvent(new pc)},this.down.ontouchend=()=>{this.eventCtrl.OnKeyUpEvent(new mc)},this.left.ontouchend=()=>{this.eventCtrl.OnKeyUpEvent(new fc)},this.right.ontouchend=()=>{this.eventCtrl.OnKeyUpEvent(new gc)},this.jump.ontouchstart=()=>{this.eventCtrl.OnKeyDownEvent(new dc)},this.jump.ontouchend=()=>{this.eventCtrl.OnKeyUpEvent(new dc)},this.action1.ontouchstart=()=>{this.eventCtrl.OnKeyDownEvent(new ac)},this.action1.ontouchend=()=>{this.eventCtrl.OnKeyUpEvent(new ac)},this.action2.ontouchstart=()=>{this.eventCtrl.OnKeyDownEvent(new hc)},this.action2.ontouchend=()=>{this.eventCtrl.OnKeyUpEvent(new hc)},this.action3.ontouchstart=()=>{this.eventCtrl.OnKeyDownEvent(new lc)},this.action3.ontouchend=()=>{this.eventCtrl.OnKeyUpEvent(new lc)}}LegacyButtonShow(){document.getElementById("joypad").style.display="block"}LegacyButtonHide(){document.getElementById("joypad").style.display="none"}ButtonShow(){document.getElementById("joypad_buttons").style.display="block"}ButtonHide(){document.getElementById("joypad_buttons").style.display="none"}MultiTouchEvent(t){if(null==this.currentEvent){if(null!=t){switch(t.target.id){case"joypad_button1":this.eventCtrl.OnKeyDownEvent(new dc);break;case"joypad_button2":this.eventCtrl.OnKeyDownEvent(new ac);break;case"joypad_button3":this.eventCtrl.OnKeyDownEvent(new hc);break;case"joypad_button4":this.eventCtrl.OnKeyDownEvent(new lc);break;case"zone_joystick":this.joystick.start(t.clientX,t.clientY)}}this.currentEvent=t}if(null!=this.currentEvent)if(null!=t){if("zone_joystick"===t.target.id)this.joystick.move(t.clientX,t.clientY)}else{switch(this.currentEvent.target.id){case"joypad_button1":this.eventCtrl.OnKeyUpEvent(new dc);break;case"joypad_button2":this.eventCtrl.OnKeyUpEvent(new ac);break;case"joypad_button3":this.eventCtrl.OnKeyUpEvent(new hc);break;case"joypad_button4":this.eventCtrl.OnKeyUpEvent(new lc);break;case"zone_joystick":this.joystick.end()}}this.currentEvent=t}}class iE extends Bl{constructor(t,e,i,n,s,r,o){super(),this.target=t,this._camera=e,this.legos=i,this.nonlegos=n,this.eventBricks=s,this.dir=new Pe(0,0,0),this.pos=new Pe(0,0,0),this.objs=[],this.color=new Yi,this.opacityBox=[[],[],[]],r.RegisterViewer(this),o.RegisterChangeCtrlObjEvent((t=>{this.target=t}))}resize(){}update(){null!=this.target?(this.dir.subVectors(this.target.CenterPos,this._camera.position),this.set(this._camera.position,this.dir.normalize()),null!=this.legos.instancedBlock&&this.CheckVisible(this.legos.instancedBlock),this.legos.bricks2.length>0&&this.CheckVisibleMeshs(this.legos.bricks2,this.opacityBox[0]),null!=this.nonlegos.instancedBlock&&this.CheckVisible(this.nonlegos.instancedBlock),this.nonlegos.bricks2.length>0&&this.CheckVisibleMeshs(this.nonlegos.bricks2,this.opacityBox[1]),null!=this.eventBricks.instancedBlock&&this.CheckVisible(this.eventBricks.instancedBlock),this.eventBricks.bricks2.length>0&&this.CheckVisibleMeshs(this.eventBricks.bricks2,this.opacityBox[2])):this.opacityBox.forEach((t=>{t.length&&this.ResetBox(t)}))}CheckVisible(t){const e=this.intersectObject(t,!1),i=this.target.CenterPos.distanceTo(this._camera.position);e.length>0&&e[0].distance<i?t.material.opacity=.5:t.material.opacity=1}CheckVisibleMeshs(t,e){const i=this.intersectObjects(t,!1),n=this.target.CenterPos.distanceTo(this._camera.position);i.length>0&&i[0].distance<n?i.forEach((t=>{if(t.distance>n)return!1;const i=t.object;.1!=i.material.opacity&&(e.push(i),i.castShadow=!1,i.material.opacity=.1)})):this.ResetBox(e)}ResetBox(t){t.forEach((t=>{t.castShadow=!0,t.material.opacity=1})),t.length=0}}class nE{constructor(){this.process=!1,this.startTime=0,this.start=ic.StartPosition.clone(),this.end=this.start.clone(),this.count=10,this.end.y+=10;const t=new mn,e=this.lightning(this.start,this.end,ie.randInt(5,8),this.count);t.setFromPoints(e);const i=[],n=ie.randInt(Math.random(),.1),s=ie.randInt(.6,1),r=ie.randInt(0,.8);for(let t=0;t<e.length;t++)i.push(n,s,r);t.setAttribute("color",new on(i,3));const o=ss.points,a=zn.clone(o.uniforms),h=new Image;a.map.value=new Se(h),h.onload=()=>{a.map.value.needsUpdate=!0},h.src="assets/texture/particle.png";const l=ie.randInt(2,3);a.size.value=l,a.scale.value=40,this.points=new ja(t,new Un({uniforms:a,defines:{USE_COLOR:"",USE_MAP:"",USE_SIZEATTENUATION:""},transparent:!0,depthWrite:!1,depthTest:!1,blending:2,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader})),this.points.visible=!1}Start(){this.points.visible=!0,this.start.set(0,0,0),this.end.copy(this.start),this.end.y+=5,this.process=!0}Update(t){if(!this.process)return;const e=this.points.geometry,i=this.lightning(this.start,this.end,ie.randInt(6,10),this.count);e.setFromPoints(i),e.attributes.position.needsUpdate=!0,this.startTime+=t,this.startTime>1&&(this.process=!1,this.points.visible=!1)}lightning(t,e,i,n){let s,r,o,a,h=[t,e],l=[];if(n=n||100,i<1)return h;for(;i--;){for(a=h.length;a--;){if(t=h[a],a<1){l.push(t);break}e=h[a-1],s=t.clone().lerp(e,.5),o=new Pe(ie.randInt(-1,1),ie.randInt(-1,1),ie.randInt(-1,1)),r=o.cross(e.clone().sub(t).normalize()),s.add(r.multiplyScalar(ie.randInt(-n,n))),l.push(t,s)}h=l.splice(0),n/=2}return h}getPositions(t,e,i){let n=[];if(!t)return n;let s,r,o,a=e,h=new Pe,l=h.clone(),c=h.clone();for(;a--;){if(h.set(t.getX(a),t.getY(a),t.getZ(a)),c.set(h.x,h.y,h.z),a<1){n.push(c.x,c.y,c.z);break}for(l.set(t.getX(a-1),t.getY(a-1),t.getZ(a-1)),s=c.distanceTo(l),r=s*i|0,o=0;o<r;o++)c.set(h.x,h.y,h.z),c.lerp(l,o/r),n.push(c.x,c.y,c.z)}return n}}var sE;!function(t){t[t.Lightning=0]="Lightning",t[t.Damage=1]="Damage",t[t.Status=2]="Status"}(sE||(sE={}));class rE{constructor(){this.effects=[],this.meshs=new Po,this.meshs.name="effector"}Enable(t,...e){switch(t){case sE.Lightning:const t=new nE;this.effects[sE.Lightning]=t,this.meshs.add(t.points);break;case sE.Status:const i=new Tf("0","#ff0000");this.effects[sE.Status]=i,this.meshs.add(i);break;case sE.Damage:const n=new Mf(e[0],e[1],e[2]);this.effects[sE.Damage]=n,n.Mesh.position.y+=2,this.meshs.add(n.Mesh)}}StartEffector(t,...e){this.effects[t].Start(...e)}Update(t){this.effects.forEach((e=>{e.Update(t)}))}}var oE=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class aE extends xc{get BoxPos(){return this.asset.GetBoxPos(this.meshs)}get Model(){return this.asset.Id}set ControllerEnable(t){this.controllerEnable=t}get ControllerEnable(){return this.controllerEnable}constructor(t,e){super(t),this.monId=e,this.controllerEnable=!1,this.effector=new rE,this.movePos=new Pe,this.vFlag=!0,this.clock=new Sl,this.flag=!1,this.text=new bS(this.monId.toString()),this.effector.Enable(sE.Damage,0,1,0),this.effector.Enable(sE.Status)}Init(t){return oE(this,void 0,void 0,(function*(){null!=this.text&&(this.text.SetText(t),this.text.position.y=3.5)}))}SetOpacity(t){this.meshs.traverse((e=>{if("material"in e){const i=e.material;i.transparent=!0,i.depthWrite=!0,i.opacity=t}e.castShadow=0!=t}))}Loader(t,e,i){return oE(this,void 0,void 0,(function*(){const[n,s]=yield this.asset.UniqModel(e+i);if(this.meshs=n,this.meshs.position.copy(t),null!=this.text&&this.meshs.remove(this.text),null!=this.text&&(this.text.SetText(e),this.text.position.y=3.5,this.meshs.add(this.text)),this.meshs.add(this.effector.meshs),this.mixer=this.asset.GetMixer(e+i),null==this.mixer)throw new Error("mixer is undefined");this.idleClip=this.asset.GetAnimationClip(Kl.Idle),this.runClip=this.asset.GetAnimationClip(Kl.Run),this.punchingClip=this.asset.GetAnimationClip(Kl.Punch),this.dyingClip=this.asset.GetAnimationClip(Kl.Dying),this.changeAnimate(this.idleClip),this.Visible=!1}))}changeAnimate(t){var e,i;if(null==t)return;const n=null===(e=this.mixer)||void 0===e?void 0:e.clipAction(t);if(null==n)return;let s=.2;null===(i=this.currentAni)||void 0===i||i.fadeOut(.2),t==this.dyingClip?(s=0,n.clampWhenFinished=!0,n.setLoop(yt,1)):n.setLoop(xt,1e4),n.reset().fadeIn(s).play(),this.currentAni=n,this.currentClip=t}StopAnimation(){var t;null===(t=this.currentAni)||void 0===t||t.stop()}ChangeAction(t){let e;switch(t){case Ef.Idle:e=this.idleClip;break;case Ef.Run:e=this.runClip;break;case Ef.Punch:e=this.punchingClip;break;case Ef.Dying:e=this.dyingClip}return this.changeAnimate(e),null==e?void 0:e.duration}DamageEffect(t,e){switch(e){case sE.Damage:case sE.Lightning:}this.effector.StartEffector(sE.Damage),this.effector.StartEffector(sE.Status,t.toString(),"#fff")}update(){var t;const e=this.clock.getDelta();this.effector.Update(e),null===(t=this.mixer)||void 0===t||t.update(e)}UpdatePhysics(){}}class hE{constructor(t,e,i){this.zCtrl=t,this.zombie=e,this.gphysic=i,this.attackDist=3}CheckRun(t){if(t.x||t.z)return this.zCtrl.RunSt.Init(),this.zCtrl.RunSt}CheckGravity(){if(this.zombie.Meshs.position.y-=.5,!this.gphysic.Check(this.zombie))return this.zombie.Meshs.position.y+=.5,this.zCtrl.JumpSt.Init(),this.zCtrl.JumpSt.velocity_y=0,this.zCtrl.JumpSt;this.zombie.Meshs.position.y+=.5}}class lE{constructor(t,e,i){this.ctrl=t,this.zombie=e,this.gphysic=i,this.speed=10,this.velocity_y=16,this.dirV=new Pe(0,0,0),this.ZeroV=new Pe(0,0,0),this.YV=new Pe(0,1,0),this.MX=new ai,this.QT=new Re}Init(){this.velocity_y=16}Uninit(){this.velocity_y=16}Update(t,e){const i=e.x*t*this.speed,n=e.z*t*this.speed,s=this.velocity_y*t;if(this.zombie.Meshs.position.x+=i,this.zombie.Meshs.position.z+=n,i||n){this.dirV.copy(e),this.dirV.y=0;const t=this.MX.lookAt(this.dirV,this.ZeroV,this.YV),i=this.QT.setFromRotationMatrix(t);this.zombie.Meshs.quaternion.copy(i)}return this.gphysic.Check(this.zombie)&&(this.zombie.Meshs.position.x-=i,this.zombie.Meshs.position.z-=n),this.zombie.Meshs.position.y+=s,this.gphysic.Check(this.zombie)?(this.zombie.Meshs.position.y-=s,this.Uninit(),this.ctrl.IdleSt.Init(),this.ctrl.IdleSt):(this.velocity_y-=9.8*3*t,this)}}class cE extends hE{constructor(t,e,i,n,s){super(t,e,i),this.eventCtrl=n,this.property=s,this.attackSpeed=this.property.attackSpeed,this.attackProcess=!1,this.attackTime=0,this.attackDamageMax=this.property.damageMax,this.attackDamageMin=this.property.damageMin}Init(){const t=this.zombie.ChangeAction(Ef.Punch);null!=t&&(this.attackSpeed=.8*t),this.attackTime=this.attackSpeed}Uninit(){null!=this.keytimeout&&clearTimeout(this.keytimeout)}Update(t,e,i){if(i>this.attackDist){const t=this.CheckRun(e);if(null!=t)return t}return this.attackProcess?this:(this.attackTime+=t,this.attackTime/this.attackSpeed<1||(this.attackTime-=this.attackSpeed,this.attackProcess=!0,this.keytimeout=setTimeout((()=>{this.attack()}),1e3*this.attackSpeed*.4)),this)}attack(){this.eventCtrl.OnAttackEvent("player",[{type:ET.NormalSwing,damage:ie.randInt(this.attackDamageMin,this.attackDamageMax)}]),this.attackProcess=!1}}class uE extends hE{constructor(t,e,i){super(t,e,i),this.Init()}Init(){this.zombie.ChangeAction(Ef.Idle)}Uninit(){}Update(t,e){const i=this.CheckRun(e);return null!=i?i:this}}class dE extends hE{constructor(t,e,i,n){super(t,e,i),this.eventCtrl=n,this.fadeMode=!1,this.fade=1}Init(){this.fadeMode=null==this.zombie.dyingClip,this.fade=1,this.fadeMode?this.zombie.StopAnimation():this.zombie.ChangeAction(Ef.Dying),this.eventCtrl.OnAttackEvent("player",[{type:ET.Exp,damage:20}])}Uninit(){}Update(t){return this.fadeMode&&(this.fade-=t,this.fade<0&&(this.fade=0),this.zombie.SetOpacity(this.fade)),this}}class pE extends hE{constructor(t,e,i,n){super(t,e,i),this.property=n,this.speed=this.property.speed,this.ZeroV=new Pe(0,0,0),this.YV=new Pe(0,1,0),this.MX=new ai,this.QT=new Re}Init(){this.zombie.ChangeAction(Ef.Run)}Uninit(){}Update(t,e,i){const n=this.CheckGravity();if(null!=n)return n;if(i<this.attackDist)return this.zCtrl.AttackSt.Init(),this.zCtrl.AttackSt;if(0==e.x&&0==e.z)return this.zCtrl.IdleSt.Init(),this.zCtrl.IdleSt;e.y=0;const s=e.x*t*this.speed,r=e.z*t*this.speed;this.zombie.Meshs.position.x+=s,this.zombie.Meshs.position.z+=r;const o=this.MX.lookAt(e,this.ZeroV,this.YV),a=this.QT.setFromRotationMatrix(o);return this.zombie.Meshs.quaternion.copy(a),this.gphysic.Check(this.zombie)&&(this.zombie.Meshs.position.x-=s,this.zombie.Meshs.position.z-=r),this}}class mE{get Drop(){return this.property.drop}get MonsterBox(){return this.phybox}constructor(t,e,i,n,s,r,o,a,h){this.player=e,this.zombie=i,this.legos=n,this.nonlegos=s,this.eventBricks=r,this.gphysic=o,this.eventCtrl=a,this.property=h,this.IdleSt=new uE(this,this.zombie,this.gphysic),this.AttackSt=new cE(this,this.zombie,this.gphysic,this.eventCtrl,this.property),this.RunSt=new pE(this,this.zombie,this.gphysic,this.property),this.DyingSt=new dE(this,this.zombie,this.gphysic,this.eventCtrl),this.JumpSt=new lE(this,this.zombie,this.gphysic),this.currentState=this.IdleSt,this.raycast=new Bl,this.dir=new Pe(0,0,0),this.moveDirection=new Pe,this.health=this.property.health,o.Register(this);const l=i.Size,c=new Ln(2*l.x,l.y,l.z),u=new Qi({color:16711680,wireframe:!0});this.phybox=new yE(t,"mon",h.id,c,u),"hons.ghostwebservice.com"==window.location.hostname&&(this.phybox.visible=!1),this.phybox.position.copy(this.zombie.CannonPos)}Respawning(){this.health=10,this.zombie.SetOpacity(1),this.currentState=this.IdleSt,this.currentState.Init()}update(t){if(!this.zombie.Visible)return;const e=this.zombie.CannonPos.distanceTo(this.player.CannonPos);if(this.health>0){this.dir.subVectors(this.player.CenterPos,this.zombie.CenterPos),this.raycast.set(this.zombie.CenterPos,this.dir.normalize());let t=!1;null!=this.legos.instancedBlock&&(t=this.CheckVisible(this.legos.instancedBlock,e)),this.legos.bricks2.length>0&&!t&&(t=this.CheckVisibleMeshs(this.legos.bricks2,e)),null!=this.nonlegos.instancedBlock&&(t=this.CheckVisible(this.nonlegos.instancedBlock,e)),this.nonlegos.bricks2.length>0&&!t&&(t=this.CheckVisibleMeshs(this.nonlegos.bricks2,e)),null==this.eventBricks.instancedBlock||t||(t=this.CheckVisible(this.eventBricks.instancedBlock,e)),this.eventBricks.bricks2.length>0&&!t&&(t=this.CheckVisibleMeshs(this.eventBricks.bricks2,e)),t?this.moveDirection.set(0,0,0):this.moveDirection.copy(this.dir)}this.currentState=this.currentState.Update(t,this.moveDirection,e),this.zombie.update(),this.phybox.position.copy(this.zombie.CannonPos),this.phybox.rotation.copy(this.zombie.Meshs.rotation),this.phybox.position.y+=this.zombie.Size.y/2}ReceiveDemage(t,e){return!(this.health<=0)&&(this.zombie.DamageEffect(t,e),this.health-=t,!(this.health<=0)||(this.DyingSt.Init(),this.currentState=this.DyingSt,!1))}CheckVisible(t,e){const i=this.raycast.intersectObject(t,!1);return i.length>0&&i[0].distance<e}CheckVisibleMeshs(t,e){const i=this.raycast.intersectObjects(t,!1);return i.length>0&&i[0].distance<e}}var fE=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class gE{constructor(t,e,i,n,s,r,o,a){this.loader=t,this.eventCtrl=e,this.player=i,this.legos=n,this.nonlegos=s,this.eventBricks=r,this.gphysic=o,this.monDb=a}Call(t,e,i){return fE(this,void 0,void 0,(function*(){i||(i=new Pe(10,0,15));const n=this.monDb.GetItem(t),s=this.loader.GetAssets(n.model),r=new aE(s,t);yield r.Loader(i,t,e);return{monModel:r,monCtrl:new mE(e,this.player,r,this.legos,this.nonlegos,this.eventBricks,this.gphysic,this.eventCtrl,n),live:!0,respawn:!1,deadtime:(new Date).getTime()}}))}}var vE=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class yE extends kn{constructor(t,e,i,n,s){super(n,s),this.Id=t,this.ObjName=e,this.MonId=i,this.name=e}}class xE{constructor(t,e,i,n,s,r,o,a,h,l,c){this.loader=t,this.eventCtrl=e,this.game=i,this.player=n,this.playerCtrl=s,this.legos=r,this.nonlegos=o,this.eventBricks=a,this.gphysic=h,this.drop=l,this.monDb=c,this.monsters=new Map,this.mode=qE.Close,this.createMon=new gE(this.loader,this.eventCtrl,this.player,this.legos,this.nonlegos,this.eventBricks,this.gphysic,this.monDb),e.RegisterAppModeEvent(((t,e)=>{if(this.mode=t,t==qE.Play)switch(e){case nc.Start:break;case nc.End:this.ReleaseMonster()}})),e.RegisterAttackEvent("mon",(t=>{this.mode==qE.Play&&t.forEach((t=>{let e=t.obj;if(null==e)return;const i=this.monsters.get(e.MonId);if(!i)throw new Error("unexpected value");const n=i[e.Id];n.live&&this.ReceiveDemage(n,t.damage,t.effect)}))})),e.RegisterAttackEvent("monster",(t=>{if(this.mode!=qE.Play)return;const e=this.player.CannonPos,i=t[0].distance,n=t[0].damage,s=t[0].effect;null!=i&&this.monsters.forEach((t=>{for(let r=0;r<t.length;r++){const o=t[r];if(!o.live)continue;o.monModel.CannonPos.distanceTo(e)<i&&this.ReceiveDemage(o,n,s)}}))}))}ReceiveDemage(t,e,i){t&&!t.monCtrl.ReceiveDemage(e,i)&&(t.live=!1,t.deadtime=(new Date).getTime(),this.drop.DropItem(new Pe(t.monModel.CannonPos.x,this.player.CenterPos.y,t.monModel.CannonPos.z),t.monCtrl.Drop),this.playerCtrl.remove(t.monCtrl.MonsterBox),this.respawntimeout=setTimeout((()=>{t.respawn&&this.Spawning(t.monCtrl.MonsterBox.MonId,t.respawn,t,t.initPos)}),ie.randInt(8e3,15e3)))}RandomDeckMonsters(t){return vE(this,void 0,void 0,(function*(){this.RandomSpawning(t)}))}RandomSpawning(t){let e=this.monsters.get(t.monId);e||(e=[],this.monsters.set(t.monId,e)),e.length<t.maxSpawn&&(this.Spawning(t.monId,!0),this.keytimeout=setTimeout((()=>{this.RandomSpawning(t)}),5e3))}Resurrection(t){return vE(this,void 0,void 0,(function*(){let e=this.monsters.get(t);e||(e=[],this.monsters.set(t,e));const i=(new Date).getTime();return e.find((t=>0==t.live&&i-t.deadtime>5e3))}))}CreateMonster(t,e,i){return vE(this,void 0,void 0,(function*(){let n;e||(n=yield this.Resurrection(t)),this.Spawning(t,e,n,i)}))}ReleaseMonster(){this.monsters.forEach((t=>{t.forEach((t=>{t.monModel.Visible=!1,t.live=!1,this.playerCtrl.remove(t.monCtrl.MonsterBox),this.game.remove(t.monModel.Meshs,t.monCtrl.MonsterBox)}))})),null!=this.keytimeout&&clearTimeout(this.keytimeout),null!=this.respawntimeout&&clearTimeout(this.respawntimeout)}Spawning(t,e,i,n){return vE(this,void 0,void 0,(function*(){if(this.mode!=qE.Play)return;let s=this.monsters.get(t);for(s||(s=[],this.monsters.set(t,s)),i||(i=yield this.createMon.Call(t,s.length)),s.push(i),n?(i.monModel.CannonPos.copy(n),i.initPos=n):(i.monModel.CannonPos.x=this.player.CannonPos.x+sS.rand_int(-20,20),i.monModel.CannonPos.z=this.player.CannonPos.z+sS.rand_int(-20,20));this.gphysic.Check(i.monModel);)i.monModel.CannonPos.y+=.5;i.respawn=e,i.live=!0,i.monCtrl.Respawning(),i.monModel.Visible=!0,this.playerCtrl.add(i.monCtrl.MonsterBox),this.game.add(i.monModel.Meshs,i.monCtrl.MonsterBox)}))}}var _E=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class bE{constructor(t,e){this.itemDb=t,this.alarm=e,this.data={bodySlot:[],inventroySlot:[]}}InsertInventory(t){const e=this.data.inventroySlot.find((e=>e.item.Id==t.Id));e&&t.Stackable?e.count++:this.data.inventroySlot.push({item:t,count:1})}NewItem(t){return _E(this,void 0,void 0,(function*(){if(15==this.data.inventroySlot.length)return void this.alarm.NotifyInfo("인벤토리가 가득찼습니다.",iT.Warning);const e=new FS(this.itemDb.GetItem(t));yield e.Loader();const i=this.data.inventroySlot.find((t=>t.item.Id==e.Id));return i&&i.item.Stackable?(i.count++,e):(this.data.inventroySlot.push({item:e,count:1}),e)}))}MoveToInvenFromBindItem(t){const e=this.data.bodySlot[t],i=this.data.bodySlot.indexOf(e);if(i<0)throw new Error("there is no item");this.data.bodySlot.splice(i,1),this.data.inventroySlot.push({item:e,count:1})}MoveToBindFromInvenItem(t,e){const i=this.data.inventroySlot.find((t=>t.item.Id==e.Id));if(null==i)throw new Error("there is no item");const n=this.data.inventroySlot.indexOf(i);this.data.inventroySlot.splice(n,1),this.data.bodySlot[t]=e}GetInventory(t){return this.data.inventroySlot[t]}GetBindItem(t){return this.data.bodySlot[t]}GetItemInfo(t){return this.itemDb.GetItem(t)}Copy(t){this.data=t;let e=this.data.inventroySlot.length-1;for(;e>=0;){const t=this.data.inventroySlot[e],i=t.item.property.id;i?t.item=new FS(this.itemDb.GetItem(i)):this.data.inventroySlot.splice(e,1),e--}}Clear(){this.data.bodySlot.length=0,this.data.inventroySlot.length=0}}var wE=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class ME{constructor(t,e){this.loader=t,this.alarm=e,this.itemDb=new JS(this.loader),this.inven=new bE(this.itemDb,this.alarm),this.invenHouse=new bE(this.itemDb,this.alarm)}LoadItems(t){this.invenHouse=t}Merge(){const t=this.inven.data,e=this.invenHouse.data;for(let i=0;i<t.inventroySlot.length;i++){const n=t.inventroySlot[i],s=e.inventroySlot.find((t=>t.item.Id==n.item.Id));s?s.count+=n.count:e.inventroySlot.push(n)}}GetNewItem(t){return wE(this,void 0,void 0,(function*(){const e=new FS(this.itemDb.GetItem(t));return yield e.Loader(),e}))}}class SE{constructor(){this.name="헐크의혼",this.icon="skill2/UI_Skill_Icon_Buff.png",this.lv=0,this.attack=.05}get explain(){return`공격력이 ${Math.round(100*(.01*(this.lv+1)+this.attack))}% 증가합니다.`}IncreaseLv(){return++this.lv}GetAttackSpeed(){return 1}GetMoveSpeed(){return 1}GetDamageMax(){return 1+this.attack+.01*this.lv}Update(){}}class TE{get explain(){return`${this.time}초당 주변 ${this.area+(this.lv+1)}이내 몬스터에게 ${this.damage*(this.lv+1)} 피해를 줍니다. `}constructor(t){this.eventCtrl=t,this.name="영혼의공격",this.icon="skill2/UI_Skill_Icon_PsycicAttack.png",this.lv=0,this.time=4,this.area=3,this.damage=2,this.accTime=0}IncreaseLv(){return++this.lv}GetAttackSpeed(){return 1}GetMoveSpeed(){return 1}GetDamageMax(){return 1}Update(t,e){e.health<=0||(this.accTime+=t,this.accTime/this.time<1||(this.accTime-=this.time,this.eventCtrl.OnAttackEvent("monster",[{type:ET.AOE,effect:sE.Lightning,damage:this.damage*this.lv,distance:this.area+this.lv}])))}}class EE{get explain(){return`${this.time}초당 ${this.heal*(this.lv+1)*100}%만큼 피가 차오릅니다.`}constructor(t){this.eventCtrl=t,this.name="성스러운느낌",this.icon="skill2/UI_Skill_Icon_Heal.png",this.lv=0,this.time=4,this.heal=.01,this.accTime=0}IncreaseLv(){return++this.lv}GetAttackSpeed(){return 1}GetMoveSpeed(){return 1}GetDamageMax(){return 1}Update(t,e){e.health<=0||(this.accTime+=t,this.accTime/this.time<1||(this.accTime-=this.time,this.eventCtrl.OnAttackEvent("player",[{type:ET.Heal,damage:e.maxHealth*(this.heal*this.lv)}])))}}class AE{constructor(t,e){this.eventCtrl=t,this.playCtrl=e,this.buffItem=[new SE,new TE(this.eventCtrl),new EE(this.eventCtrl)],this.userBuff=[],t.RegisterAttackEvent("player",(t=>{t.forEach((t=>{t.type,ET.Buff}))})),t.RegisterAppModeEvent(((t,e)=>{if(t==qE.Play)switch(e){case nc.Start:case nc.End:this.buffItem.forEach((t=>{t.lv=0})),this.userBuff.length=0}}))}GetRandomBuff(){const t=[],e=[...Array(this.buffItem.length).keys()];for(let i=0;i<3;i++){const i=e[ie.randInt(0,e.length-1)];e.splice(e.indexOf(i),1),t.push(this.buffItem[i])}return t}SelectBuff(t){this.userBuff.indexOf(t)<0&&this.userBuff.push(t),t.IncreaseLv(),this.playCtrl.UpdateBuff(this.userBuff)}GetBuff(){return this.userBuff}}class CE{constructor(t,e,i,n,s,r){this.alarm=t,this.inventory=e,this.player=i,this.scene=s,this.dropBox=[],this.activeDropBox=[],this.resetPos=new Pe(ic.StartPosition.x,-10,ic.StartPosition.z),this.head=0,this.maxCount=300,this.moveDist=6,this.dummy=new ki,this.createPos=new Pe,this.speed=1,r.RegisterAppModeEvent(((t,e)=>{if(t==qE.Play)switch(e){case nc.Start:break;case nc.End:this.Uninit()}})),n.RegisterViewer(this),this.points=this.CreatePoints(),this.points.frustumCulled=!1,this.points.renderOrder=1,this.scene.add(this.points)}Uninit(){if(null==this.pointsGeometry)return;const t=this.pointsGeometry.attributes.position;for(let e=0;e<this.dropBox.length;e++){const e=this.dropBox[this.head];e.droped&&(e.droped=!1,t.setX(e.id,this.resetPos.x),t.setY(e.id,this.resetPos.y),t.setZ(e.id,this.resetPos.z)),this.head++,this.head%=this.dropBox.length}this.head=0,this.activeDropBox.length=0,t.needsUpdate=!0}DropItem(t,e){this.dropPoint(t,e)}DirectItem(t){if(null!=t){const e=Math.random();t.forEach((t=>{if(t.ratio>e){const e=this.inventory.GetItemInfo(t.itemId);this.alarm.NotifyInfo(`${e.name}을 얻었습니다.`,iT.Normal),this.inventory.NewItem(t.itemId)}}))}}dropPoint(t,e){if(null==this.pointsGeometry)return;const i=[];if(null!=e){const t=Math.random();e.forEach((e=>{e.ratio>t&&i.push(e.itemId)}))}const n=this.pointsGeometry.attributes.position;for(let e=0;e<this.dropBox.length;e++){const e=this.dropBox[this.head];if(!e.droped){e.id=this.head,e.droped=!0,e.items=i,n.setX(e.id,t.x),n.setY(e.id,t.y),n.setZ(e.id,t.z),this.activeDropBox.push(e);break}this.head++,this.head%=this.dropBox.length}n.needsUpdate=!0}pointsUpdate(t){var e;if(!this.activeDropBox.length||null==this.pointsGeometry)return;this.createPos.copy(this.player.CannonPos),this.createPos.y+=this.player.Size.y/2;const i=this.pointsGeometry.attributes.position;for(let n=0;n<this.activeDropBox.length;n++){const s=this.activeDropBox[n],r=new Pe(i.getX(s.id),i.getY(s.id),i.getZ(s.id)),o=r.distanceTo(this.createPos);o<1?(i.setX(s.id,this.resetPos.x),i.setY(s.id,this.resetPos.y),i.setZ(s.id,this.resetPos.z),s.droped=!1,this.activeDropBox.splice(n,1),null===(e=s.items)||void 0===e||e.forEach((t=>{const e=this.inventory.GetItemInfo(t);this.alarm.NotifyInfo(`${e.name}을 얻었습니다.`,iT.Normal),this.inventory.NewItem(t)}))):o<this.moveDist&&(this.createPos.x-r.x<0?r.x-=t*this.speed:r.x+=t*this.speed,this.createPos.z-r.z<0?r.z-=t*this.speed:r.z+=t*this.speed,i.setX(s.id,r.x),i.setY(s.id,r.y),i.setZ(s.id,r.z))}i.needsUpdate=!0}resize(){}update(t){this.pointsUpdate(t)}makeDropPoints(){const t=[];for(let e=0;e<this.maxCount;e++){const i=new Pe;i.copy(this.resetPos),t.push(i),this.dropBox.push({id:e,droped:!1})}return t}GetGeometry(){const t=this.makeDropPoints();this.pointsGeometry=new mn,this.pointsGeometry.setFromPoints(t);const e=[];for(let i=0;i<t.length;i++){const t=ie.randInt(Math.random(),.1),i=ie.randInt(.6,1),n=ie.randInt(0,.8);e.push(t,i,n)}this.pointsGeometry.setAttribute("color",new on(e,3))}CreatePoints(){this.GetGeometry();const t=document.createElement("CANVAS");t.width=128,t.height=128;const e=t.getContext("2d");if(null==e)throw new Error("fail get context");e.globalAlpha=.3,e.filter="blur(16px)",e.fillStyle="white",e.beginPath(),e.arc(64,64,40,0,2*Math.PI),e.fill(),e.globalAlpha=1,e.filter="blur(5px)",e.fillStyle="white",e.beginPath(),e.arc(64,64,16,0,2*Math.PI),e.fill();const i=new Xa(t),n=new Ua({color:"white",vertexColors:!0,size:2,sizeAttenuation:!0,map:i,transparent:!0,blending:2,depthWrite:!1});return new ja(this.pointsGeometry,n)}CreateShaderPoint(){this.GetGeometry();const t=ss.points,e=zn.clone(t.uniforms),i=new Image;e.map.value=new Se(i),i.onload=()=>{e.map.value.needsUpdate=!0},i.src="assets/texture/particle.png";const n=ie.randInt(2,3);e.size.value=n,e.scale.value=100,this.points=new ja(this.pointsGeometry,new Un({uniforms:e,defines:{USE_COLOR:"",USE_MAP:"",USE_SIZEATTENUATION:""},depthWrite:!1,blending:2,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader}))}CreateInstancedMesh(){const t=new Th(1,0),e=new Ah({color:65280}),i=new Aa(t,e,this.maxCount);i.instanceMatrix.setUsage(35048);const n=this.makeDropPoints();return n.forEach(((t,e)=>{this.dummy.position.copy(t),this.dummy.scale.set(.5,.5,.5),this.dummy.updateMatrix(),i.setMatrixAt(e,this.dummy.matrix);const n=ie.randInt(Math.random(),.1),s=ie.randInt(.6,1),r=ie.randInt(0,.8);i.setColorAt(e,new Yi(n,s,r))})),i}dropMesh(t){const e=this.points;for(let i=0;i<this.dropBox.length;i++){const i=this.dropBox[this.head];if(!i.droped){i.id=this.head,i.droped=!0,this.dummy.position.copy(t),this.dummy.updateMatrix(),e.setMatrixAt(i.id,this.dummy.matrix),e.instanceMatrix.needsUpdate=!0,this.activeDropBox.push(i);break}this.head++,this.head%=this.dropBox.length}}instanceUpdate(t){if(!this.activeDropBox.length)return;const e=this.player.CannonPos,i=this.points,n=new ai,s=new Pe;for(let r=0;r<this.activeDropBox.length;r++){const o=this.activeDropBox[r];i.getMatrixAt(o.id,n),s.setFromMatrixPosition(n);const a=s.distanceTo(e);a<1?(n.setPosition(this.resetPos),o.droped=!1,this.activeDropBox.splice(r,1)):a<this.moveDist&&(e.x-s.x<0?s.x-=t*this.speed*this.moveDist:s.x+=t*this.speed*this.moveDist,e.z-s.z<0?s.z-=t*this.speed*this.moveDist:s.z+=t*this.speed*this.moveDist,n.setPosition(s)),i.setMatrixAt(o.id,n)}i.instanceMatrix.needsUpdate=!0}}class IE{constructor(){this.monDb=new Map,this.monDb.set(qS.Zombie,{id:qS.Zombie,type:XS.Undead,model:Zl.Zombie,health:10,speed:1,damageMin:1,damageMax:5,attackSpeed:2,drop:[{itemId:ZS.Leather,ratio:.5},{itemId:ZS.ZombieDeck,ratio:.1}]}),this.monDb.set(qS.Minotaur,{id:qS.Minotaur,type:XS.Beast,model:Zl.Minataur,health:10,speed:1,damageMin:1,damageMax:5,attackSpeed:2,drop:[{itemId:ZS.Leather,ratio:.5},{itemId:ZS.MinataurDeck,ratio:.05}]}),this.monDb.set(qS.Batpig,{id:qS.Batpig,type:XS.Beast,model:Zl.BatPig,health:10,speed:1,damageMin:1,damageMax:5,attackSpeed:2,drop:[{itemId:ZS.Leather,ratio:.5},{itemId:ZS.BatPigDeck,ratio:.05}]}),this.monDb.set(qS.Bilby,{id:qS.Bilby,type:XS.Beast,model:Zl.Bilby,health:10,speed:1,damageMin:1,damageMax:5,attackSpeed:2,drop:[{itemId:ZS.Leather,ratio:.5},{itemId:ZS.BilbyDeck,ratio:.05}]}),this.monDb.set(qS.Birdmon,{id:qS.Birdmon,type:XS.Beast,model:Zl.BirdMon,health:10,speed:1,damageMin:1,damageMax:5,attackSpeed:2,drop:[{itemId:ZS.Leather,ratio:.5},{itemId:ZS.BirdmonDeck,ratio:.05}]}),this.monDb.set(qS.Crab,{id:qS.Crab,type:XS.Beast,model:Zl.CrabMon,health:10,speed:1,damageMin:1,damageMax:5,attackSpeed:2,drop:[{itemId:ZS.Leather,ratio:.5},{itemId:ZS.CrabDeck,ratio:.05}]}),this.monDb.set(qS.Builder,{id:qS.Builder,type:XS.Warrior,model:Zl.Builder,health:10,speed:3,damageMin:1,damageMax:5,attackSpeed:2,drop:[{itemId:ZS.Leather,ratio:.5},{itemId:ZS.BuilderDeck,ratio:.05}]}),this.monDb.set(qS.Golem,{id:qS.Golem,type:XS.Element,model:Zl.Golem,health:10,speed:1,damageMin:1,damageMax:5,attackSpeed:2,drop:[{itemId:ZS.Rocks,ratio:.5},{itemId:ZS.GolemDeck,ratio:.05}]}),this.monDb.set(qS.BigGolem,{id:qS.BigGolem,type:XS.Element,model:Zl.BigGolem,health:10,speed:4,damageMin:1,damageMax:5,attackSpeed:2,drop:[{itemId:ZS.Rocks,ratio:.5},{itemId:ZS.BigGolemDeck,ratio:.05}]}),this.monDb.set(qS.KittenMonk,{id:qS.KittenMonk,type:XS.Beast,model:Zl.KittenMonk,health:10,speed:4,damageMin:4,damageMax:8,attackSpeed:1.5,drop:[{itemId:ZS.Leather,ratio:.5},{itemId:ZS.KittenMonkDeck,ratio:.05}]}),this.monDb.set(qS.Skeleton,{id:qS.Skeleton,type:XS.Undead,model:Zl.Skeleton,health:10,speed:3,damageMin:1,damageMax:5,attackSpeed:2,drop:[{itemId:ZS.SkeletonDeck,ratio:.05}]}),this.monDb.set(qS.Snake,{id:qS.Snake,type:XS.Beast,model:Zl.Snake,health:10,speed:4,damageMin:1,damageMax:5,attackSpeed:2,drop:[{itemId:ZS.SnakeDeck,ratio:.05}]}),this.monDb.set(qS.ToadMage,{id:qS.ToadMage,type:XS.Beast,model:Zl.ToadMage,health:10,speed:5,damageMin:1,damageMax:5,attackSpeed:2,drop:[{itemId:ZS.Leather,ratio:.5},{itemId:ZS.ToadMageDeck,ratio:.05}]}),this.monDb.set(qS.Viking,{id:qS.Viking,type:XS.Warrior,model:Zl.Viking,health:10,speed:1,damageMin:1,damageMax:5,attackSpeed:2,drop:[{itemId:ZS.VikingDeck,ratio:.05}]}),this.monDb.set(qS.WereWolf,{id:qS.WereWolf,type:XS.Beast,model:Zl.WereWolf,health:10,speed:4,damageMin:8,damageMax:10,attackSpeed:2,drop:[{itemId:ZS.Leather,ratio:.5},{itemId:ZS.WereWolfDeck,ratio:.05}]}),this.monDb.set(qS.Stone,{id:qS.Stone,type:XS.Rock,model:Zl.Stone,health:1,speed:0,damageMin:0,damageMax:0,attackSpeed:0,drop:[{itemId:ZS.Rocks,ratio:1}]}),this.monDb.set(qS.Tree,{id:qS.Tree,type:XS.Plant,model:Zl.Tree,health:1,speed:0,damageMin:0,damageMax:0,attackSpeed:0,drop:[{itemId:ZS.Logs,ratio:1}]})}GetItem(t){const e=this.monDb.get(t);if(null==e)throw new Error("unkown key");return e}}var RE=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class PE extends xc{constructor(t){super(t)}Init(){return RE(this,void 0,void 0,(function*(){}))}get BoxPos(){return this.asset.GetBoxPos(this.meshs)}MassLoad(t,e,i){return RE(this,void 0,void 0,(function*(){this.meshs=t.clone(),this.meshs.scale.set(e,e,e),this.meshs.position.copy(i),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}))}))}}var kE=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class DE extends xc{constructor(t){super(t)}Init(){return kE(this,void 0,void 0,(function*(){}))}MassLoader(t,e,i){return kE(this,void 0,void 0,(function*(){const n=ie.randFloat(0,1);this.meshs=t.clone(),this.meshs.scale.set(e,e,e),this.meshs.position.set(i.x,i.y,i.z),this.meshs.rotateX(n),this.meshs.rotateZ(n),this.meshs.castShadow=!0,this.meshs.receiveShadow=!0,this.meshs.traverse((t=>{t.castShadow=!0,t.receiveShadow=!0}))}))}}var LE=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class OE{constructor(t,e,i,n,s,r,o,a,h){this.player=t,this.playerCtrl=e,this.worldSize=i,this.loader=n,this.game=r,this.canvas=o,this.drop=a,this.monDb=h,this.stones=[],this.trees=[],this.stoneBoxes=[],this.treeBoxes=[],this.dropPos=new Pe,this.effector=new rE,this.material=new Qi({transparent:!0,opacity:.5,color:16711680}),s.RegisterAppModeEvent(((t,e)=>{if(t==qE.Play)switch(e){case nc.Start:case nc.End:}})),s.RegisterAttackEvent("stone",(t=>{t.forEach((t=>{let e=t.obj;if(null==e)return;this.effector.meshs.position.copy(e.position),this.effector.StartEffector(sE.Damage);Math.random()<.7||(this.dropPos.copy(e.position),this.dropPos.z+=2,this.drop.DropItem(this.dropPos,this.monDb.GetItem(qS.Stone).drop))}))})),s.RegisterAttackEvent("tree",(t=>{t.forEach((t=>{let e=t.obj;if(null==e)return;this.effector.meshs.position.copy(e.position),this.effector.StartEffector(sE.Damage);Math.random()<.7||(this.dropPos.copy(e.position),this.dropPos.y=this.player.CenterPos.y,this.dropPos.z+=5,this.drop.DropItem(this.dropPos,this.monDb.GetItem(qS.Tree).drop))}))})),this.effector.Enable(sE.Damage,0,0,1),this.canvas.RegisterViewer(this),this.game.add(this.effector.meshs)}resize(){}update(t){this.effector.Update(t)}InitScene(){}MassLoader(){return LE(this,void 0,void 0,(function*(){return yield Promise.all([this.StoneLoader(),this.MassTreeLoad()])}))}StoneLoader(){return LE(this,void 0,void 0,(function*(){const t=yield this.loader.StoneAsset.CloneModel(),e=new Pe,i=this.worldSize/2;for(let n=0;n<10;n++){const s=Math.random()*Math.PI*2,r=ie.randFloat(.3*i,.6*i);e.set(r*Math.cos(s),2,r*Math.sin(s));const o=new DE(this.loader.StoneAsset),a=sS.rand_int(9,15);yield o.MassLoader(t,a,e);const h=this.loader.StoneAsset.GetSize(o.Meshs),l=new yE(n,"stone",qS.Stone,new Ln,this.material);l.scale.copy(h),l.position.copy(e),l.position.z+=2,l.visible=!1,this.stoneBoxes.push(l),this.playerCtrl.add(l),this.game.add(l,o.meshs)}}))}MassTreeLoad(){return LE(this,void 0,void 0,(function*(){const t=yield this.loader.TreeAsset.CloneModel(),e=new Pe,i=this.worldSize/2;for(let n=0;n<150;n++){const s=Math.random()*Math.PI*2,r=ie.randFloat(.5*i,1.5*i);e.set(r*Math.cos(s),0,r*Math.sin(s));const o=sS.rand_int(9,15),a=new PE(this.loader.TreeAsset);a.MassLoad(t,o,e),this.trees.push(a);const h=this.loader.TreeAsset.GetSize(a.Meshs),l=new yE(n,"tree",qS.Tree,new Ln,this.material);l.scale.set(h.x/2,h.y,h.z/2),l.position.copy(e),l.visible=!1,this.treeBoxes.push(l),this.playerCtrl.add(l),this.game.add(l,a.meshs)}}))}}class NE extends _c{get BoxPos(){const t=this.CannonPos;return new Pe(t.x,t.y,t.z)}constructor(t){super(new Eh(t,.5,2,11),new Qi({color:65280,transparent:!0,opacity:.5})),this.position.set(0,0,0),this.rotateX(-Math.PI/2),this.receiveShadow=!0}update(){this.rotateZ(.02*Math.PI*.5)}}var BE,zE=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};!function(t){t[t.VamSer=0]="VamSer"}(BE||(BE={}));class UE{constructor(t,e,i,n,s,r,o,a,h,l){this.player=t,this.playerCtrl=e,this.portal=i,this.monster=n,this.invenFab=s,this.alarm=o,this.game=a,this.eventCtrl=h,this.store=l,this.timer=0,this.safe=!1,this.playing=!1,this.dom=document.createElement("div"),this.torus=new NE(10),this.saveData=this.store.Deck,this.deckInfo=[],this.deckEmpty=!1,this.currentSec=0,this.currentMin=-1,l.RegisterStore(this),h.RegisterAppModeEvent(((t,e)=>{var i;if(t==qE.Play)switch(e){case nc.Start:this.deckEmpty=!1,this.invenFab.inven.Clear(),this.StartDeckParse(),this.startTimeout=setTimeout((()=>{this.createTimer(),this.timer=0,this.playing=!0}),3e3);break;case nc.End:this.playing=!1,this.torus.visible=!1,this.invenFab.Merge(),this.invenFab.inven.Clear(),this.eventCtrl.OnChangeEquipmentEvent(this.invenFab.inven),this.safe&&(null===(i=this.opt)||void 0===i||i.OnSaveInven(s.invenHouse.data)),null!=this.keytimeout&&clearTimeout(this.keytimeout),null!=this.startTimeout&&clearTimeout(this.startTimeout)}})),r.RegisterViewer(this),this.game.add(this.torus),this.torus.visible=!1,this.torus.position.copy(this.portal.CannonPos),this.dom.className="timer h2"}createTimer(){document.getElementById("contents").appendChild(this.dom),this.dom.style.display="block",this.dom.style.top="20px",this.currentSec=0,this.currentMin=-1}updateTimer(t){if(this.timer+=t,this.currentSec==Math.floor(this.timer))return!1;this.currentSec=Math.floor(this.timer);const e=900-this.currentSec,i=Math.floor(e/60),n=e%60;return this.dom.innerText=(i<10?"0"+i:i)+":"+(n<10?"0"+n:n),!0}Setup(t){this.opt=t}StartDeckParse(){this.saveData.forEach((t=>{if(!t.enable)return;const e=this.deckInfo.find((e=>e.id==t.id));if(e)e.position.push(t.position);else{const e=KS.DeckDb.get(t.id);if(!e)return;this.deckInfo.push({id:t.id,monId:e.monId,title:e.title,position:[t.position],time:t.time,rand:t.rand,uniq:null==e?void 0:e.uniq,execute:!1,max:e.maxSpawn,createCnt:0})}}))}ExecuteDeck(){if(this.deckEmpty)return;if(0==this.deckInfo.length){const t=ie.randInt(0,YS.List.length-1),e=KS.DeckDb.get(YS.List[t]);return this.monster.RandomDeckMonsters(null!=e?e:KS.Zombie),void(this.deckEmpty=!0)}const t=Math.floor(this.currentSec/60);this.currentMin!=t&&(this.currentMin=t,this.deckInfo.forEach((t=>{if(!t.execute&&t.time<=this.currentMin){if(this.alarm.NotifyInfo(`"${t.title}"이 발동되었습니다.`,iT.Deck),t.execute=!0,t.rand)this.monster.CreateMonster(t.monId,!0);else{const e=ie.randInt(0,t.position.length-1);this.monster.CreateMonster(t.monId,!0,t.position[e])}t.createCnt++,t.uniq||this.Respawning(t)}})))}Respawning(t){if(t.max==t.createCnt)return;const e=ie.randInt(4e3,8e3);this.keytimeout=setTimeout((()=>{const e=ie.randInt(0,t.position.length-1);this.monster.CreateMonster(t.monId,!0,t.position[e]),t.createCnt++,this.Respawning(t)}),e)}CheckPortal(t){const e=this.player.CannonPos,i=this.portal.CannonPos;e.distanceTo(i)<10?(this.torus.position.copy(this.portal.CannonPos),this.torus.position.y+=2,this.torus.visible=!0,this.torus.rotateZ(Math.PI*t*.5),this.safe||this.alarm.NotifyInfo("인벤토리를 저장할 수 있습니다.",iT.Normal),this.safe=!0):(this.torus.visible=!1,this.safe&&this.alarm.NotifyInfo("포탈과 멀어 인벤토리를 저장할 수 없습니다.",iT.Normal),this.safe=!1)}resize(){}update(t){this.playing&&(this.updateTimer(t)&&this.ExecuteDeck(),this.CheckPortal(t))}Viliageload(){return zE(this,void 0,void 0,(function*(){this.deckInfo.length=0,this.saveData.length=0}))}Reload(){return zE(this,void 0,void 0,(function*(){this.deckInfo.length=0,this.saveData=this.store.Deck}))}}var FE=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class GE extends kn{constructor(t,e,i,n){super(i,n),this.Id=t,this.ObjName=e,this.name=e}}class HE{constructor(t,e,i,n,s,r,o,a){this.loader=t,this.game=i,this.player=n,this.playerCtrl=s,this.monDb=o,this.store=a,this.controllable=!1,this.saveData=this.store.Deck,this.need2Reload=!1,this.deckSet=[],this.effector=new rE,this.torus=new NE(2),this.material=new Qi({transparent:!0,opacity:.5,color:16711680}),this.allocPos=0,r.RegisterViewer(this),a.RegisterStore(this),e.RegisterAppModeEvent(((t,e,i)=>{if(t==qE.Weapon)switch(e){case nc.Start:this.LazyLoad(),this.VisibleOn();break;case nc.End:this.VisibleOff(),this.controllable=!1;break;case nc.Message:const t=i[0];this.controllable=t.locatOnOff,this.lastDeckMsg=t,this.UpdateSetup(t),t.locatOnOff&&(t.id&&(this.deck=KS.DeckDb.get(t.id)),t.enable&&this.DeckEnable(t.enable))}})),e.RegisterAttackEvent("deck",(t=>{t.forEach((t=>{let e=t.obj;null!=e&&(this.effector.meshs.position.copy(e.position),this.DeleteDeck(e.Id))}))})),e.RegisterKeyDownEvent((t=>{var e,i,n,s,r,o;if(this.controllable&&this.deck&&t.Type===sc.Action1){const t={id:this.deck.id,position:(new Pe).copy(this.player.CannonPos),time:null!==(i=null===(e=this.lastDeckMsg)||void 0===e?void 0:e.time)&&void 0!==i?i:0,enable:null!==(s=null===(n=this.lastDeckMsg)||void 0===n?void 0:n.enable)&&void 0!==s&&s,rand:null===(o=null===(r=this.lastDeckMsg)||void 0===r?void 0:r.rand)||void 0===o||o};this.saveData.push(t),this.CreateDeck(t)}}))}UpdateSetup(t){this.saveData.forEach((e=>{e.id==t.id&&(e.enable=t.enable,e.rand=t.rand,e.time=t.time)}))}DeckEnable(t){this.saveData.forEach((e=>e.enable=t))}VisibleOn(){this.deckSet.forEach((t=>{t.used&&(this.playerCtrl.add(t.box),this.game.add(t.box,t.effect.Meshs,t.monModel.Meshs))}))}VisibleOff(){this.deckSet.forEach((t=>{t.used&&(this.playerCtrl.remove(t.box),this.game.remove(t.box,t.effect.Meshs,t.monModel.Meshs))}))}DeleteDeck(t){const e=this.deckSet[t];e.used=!1;const i=this.saveData.findIndex((t=>t.position.x==e.monModel.CannonPos.x&&t.position.z==e.monModel.CannonPos.z));i>-1&&this.saveData.splice(i,1),this.playerCtrl.remove(e.box),this.game.remove(e.box,e.effect.Meshs,e.monModel.Meshs)}CreateDeck(t){return FE(this,void 0,void 0,(function*(){const e=KS.DeckDb.get(t.id);if(!e)return;let i=this.AllocateDeckPool(e,t.position);i||(i=yield this.NewDeckEntryPool(e,t.position)),this.playerCtrl.add(i.box),this.game.add(i.monModel.Meshs,i.effect.Meshs,i.box)}))}LazyLoad(){return FE(this,void 0,void 0,(function*(){if(this.need2Reload&&(this.need2Reload=!1,this.saveData))for(let t=0;t<this.saveData.length;t++){const e=this.saveData[t];yield this.CreateDeck(e)}}))}Viliageload(){return FE(this,void 0,void 0,(function*(){}))}Reload(){return FE(this,void 0,void 0,(function*(){this.ReleaseAllDeckPool(),this.saveData=this.store.Deck,this.need2Reload=!0}))}resize(){}update(){this.deckSet.forEach((t=>{t.monModel.update&&t.monModel.update(),t.effect.update&&t.effect.update()}))}AllocateDeckPool(t,e){for(let i=0;i<this.deckSet.length;i++,this.allocPos++){const n=this.deckSet[i];if(n.monId==t.monId&&0==n.used)return n.used=!0,n.monModel.CannonPos.copy(e),n.effect.CannonPos.copy(e),n.box.position.copy(e),n;this.allocPos%=this.deckSet.length}}ReleaseAllDeckPool(){this.deckSet.forEach((t=>{t.used=!1,this.playerCtrl.remove(t.box),this.game.remove(t.box,t.effect.Meshs,t.monModel.Meshs)}))}NewDeckEntryPool(t,e){return FE(this,void 0,void 0,(function*(){const i=this.monDb.GetItem(t.monId),n=this.loader.GetAssets(i.model),s=new aE(n,i.id),r=t.monId+"Deck";yield s.Loader(e,r,this.deckSet.length),s.Visible=!0;const o=new Ln(4*s.Size.x,s.Size.y,3*s.Size.z),a=new GE(this.deckSet.length,"deck",o,this.material),h=this.torus.clone();h.visible=!0,a.visible=!1,h.position.copy(s.CenterPos),a.position.copy(s.CenterPos);const l={monModel:s,effect:h,box:a,monId:t.monId,used:!0};return this.deckSet.push(l),l}))}}var VE,jE=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};!function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundCorner=1]="RoundCorner"}(VE||(VE={}));class WE extends pS{get Size(){return this.brickGuide?this.brickGuide.Size:this.brickSize}constructor(t,e,i,n,s){super(t,e,i,n,s,qE.NonLego,i.NonLegos),i.RegisterStore(this),this.brickType=fS.NonLego,e.RegisterBrickInfo((t=>{null!=this.brickGuide&&(t.v&&(this.brickSize.copy(t.v),this.brickGuide.Meshs.scale.copy(t.v)),t.r&&(this.brickGuide.Meshs.rotateX(ie.degToRad(t.r.x)),this.brickGuide.Meshs.rotateY(ie.degToRad(t.r.y)),this.brickGuide.Meshs.rotateZ(ie.degToRad(t.r.z))),t.color&&this.brickColor.set(t.color),this.CheckCollision())})),this.eventCtrl.RegisterAppModeEvent(((t,e)=>{if(this.currentMode=t,this.deleteMode=t==qE.LegoDelete,t==qE.NonLego||t==qE.LegoDelete)switch(null==this.brickGuide&&(this.brickGuide=this.GetBrickGuide(this.player.CenterPos)),e){case nc.Start:this.brickGuide.ControllerEnable=!0,this.brickGuide.Visible=!0,this.brickGuide.position.copy(this.player.CannonPos),this.brickfield.visible=!0,this.deleteMode&&(this.brickGuide.scale.set(1,1,1),this.brickSize.set(1,1,1)),this.eventCtrl.OnChangeCtrlObjEvent(this.brickGuide),this.CheckCollision();break;case nc.End:this.deleteMode,this.brickGuide.ControllerEnable=!1,this.brickGuide.Visible=!1,this.brickfield.visible=!1}})),this.checkEx=()=>{if(!this.brickGuide)return;const t=(new Pe).copy(this.brickfield.position);t.x-=this.fieldWidth/2,t.z-=this.fieldHeight/2;const e=(new Pe).copy(this.brickGuide.position),i=this.brickGuide.Size;e.x-=i.x/2,e.z-=i.z/2,e.x>=t.x&&e.x<=t.x+this.fieldWidth&&e.z>=t.z&&e.z<=t.z+this.fieldHeight?this.brickGuide.Creation=!1:this.brickGuide.Creation=!0}}EditMode(){this.ClearBlock(),this.CreateBricks()}CreateBricks(){const t=this.store.NonLegos,e=new Pe;t.forEach((t=>{const i=new uS(t.position,t.size,t.color);i.rotation.copy(t.rotation),this.scene.add(i),this.bricks2.push(i),e.copy(t.size).sub(this.subV),this.physics.addBuilding(i,t.position,e,i.rotation)}))}CreateInstacedMesh(){const t=this.store.NonLegos;if(!(null==t?void 0:t.length))return;const e=new Ln(1,1,1),i=new Rh({color:16777215,transparent:!0});this.instancedBlock=new Aa(e,i,t.length),this.instancedBlock.castShadow=!0,this.instancedBlock.receiveShadow=!0;const n=new ai,s=new Pe,r=new Re;t.forEach(((t,e)=>{var i,o;r.setFromEuler(t.rotation),n.compose(t.position,r,t.size),null===(i=this.instancedBlock)||void 0===i||i.setColorAt(e,new Yi(t.color)),null===(o=this.instancedBlock)||void 0===o||o.setMatrixAt(e,n),s.copy(t.size).sub(this.subV);const a=new dS(this.brickSize,t.position);this.eventbricks.push(a),this.physics.addBuilding(a,t.position,s,t.rotation)})),this.scene.add(this.instancedBlock)}Viliageload(){return jE(this,void 0,void 0,(function*(){this.ClearBlock(),this.ClearEventBrick(),this.CreateInstacedMesh()}))}Reload(){return jE(this,void 0,void 0,(function*(){this.ClearBlock(),this.ClearEventBrick(),this.CreateBricks()}))}}var XE=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class $E{get PhysicDebugger(){return this.PhysicDebugger}get Physics(){return this.gphysics}get Canvas(){return this.canvas}get Scene(){return this.currentScene}get EventCtrl(){return this.eventCtrl}get ModelStore(){return this.store}get Player(){return this.player}get Buff(){return this.buff}get GameCenter(){return this.gameCenter}get LoadingManager(){return this.loader.LoadingManager}get Furnitures(){return this.furnDb}get Plants(){return this.plantDb}constructor(){this.alarm=new hT,this.eventCtrl=new rc,this.canvas=new wc,this.loader=new nS,this.deckDb=new KS,this.monDb=new IE,this.furnDb=new xT,this.plantDb=new oT,this.worldSize=300,this.floor=new bc(this.worldSize),this.mushrooms=[],this.deadtrees=[],this.invenFab=new ME(this.loader,this.alarm),this.store=new AS(this.eventCtrl,this.invenFab),this.input=new eE(this.eventCtrl),this.light=new wf,this.game=new yc(this.light),this.gphysics=new CS(this.game,this.eventCtrl),this.portal=new cS(this.loader.PortalAsset,this.store,this.eventCtrl,this.gphysics),this.player=new Cf(this.loader,this.eventCtrl,this.portal,this.store,this.game),this.playerCtrl=new OT(this.player,this.invenFab.inven,this.invenFab,this.gphysics,this.eventCtrl),this.drop=new CE(this.alarm,this.invenFab.inven,this.player,this.canvas,this.game,this.eventCtrl),this.brick=new _S(this.game,this.eventCtrl,this.store,this.gphysics,this.player),this.legos=new vS(this.game,this.eventCtrl,this.store,this.Physics,this.player),this.nonLegos=new WE(this.game,this.eventCtrl,this.store,this.Physics,this.player),this.npcs=new TS(this.loader,this.eventCtrl,this.game,this.canvas,this.store,this.gphysics),this.monsters=new xE(this.loader,this.eventCtrl,this.game,this.player,this.playerCtrl,this.legos,this.nonLegos,this.brick,this.gphysics,this.drop,this.monDb),this.buff=new AE(this.eventCtrl,this.playerCtrl),this.materials=new OE(this.player,this.playerCtrl,this.worldSize,this.loader,this.eventCtrl,this.game,this.canvas,this.drop,this.monDb),this.farmer=new gT(this.loader,this.player,this.playerCtrl,this.game,this.store,this.gphysics,this.canvas,this.eventCtrl,this.alarm,this.drop,this.plantDb),this.carp=new TT(this.loader,this.player,this.playerCtrl,this.game,this.store,this.gphysics,this.canvas,this.eventCtrl,this.furnDb),this.monDeck=new HE(this.loader,this.eventCtrl,this.game,this.player,this.playerCtrl,this.canvas,this.monDb,this.store),this.gameCenter=new UE(this.player,this.playerCtrl,this.portal,this.monsters,this.invenFab,this.canvas,this.alarm,this.game,this.eventCtrl,this.store),this.camera=new xf(this.canvas,this.player,this.npcs,this.brick,this.legos,this.nonLegos,this.portal,this.farmer,this.carp,this.eventCtrl),this.rayViewer=new iE(this.player,this.camera,this.legos,this.nonLegos,this.brick,this.canvas,this.eventCtrl),this.renderer=new bf(this.camera,this.game,this.canvas),this.currentScene=this.game}MassMushroomLoader(t){return XE(this,void 0,void 0,(function*(){const e=1==t?this.loader.Mushroom1Asset:this.loader.Mushroom2Asset,i=yield e.CloneModel(),n=new Pe;for(let t=0;t<50;t++){n.set((2*Math.random()-1)*(this.worldSize/1.5),0,(2*Math.random()-1)*(this.worldSize/1.5));const t=sS.rand_int(5,9),s=new oS(e);s.MassLoader(i,t,n),this.mushrooms.push(s)}}))}MassDeadTreeLoader(){return XE(this,void 0,void 0,(function*(){const t=yield this.loader.DeadTreeAsset.CloneModel(),e=new Pe,i=this.worldSize/2;for(let n=0;n<30;n++){const n=Math.random()*Math.PI*2,s=ie.randFloat(.4*i,1.5*i);e.set(s*Math.cos(n),sS.rand_int(0,1.5),s*Math.sin(n));const r=sS.rand_int(0,2),o=sS.rand_int(5,9),a=new hS(this.loader.DeadTreeAsset);a.MassLoader(t,o,e,r),this.deadtrees.push(a)}}))}GltfLoad(){return XE(this,void 0,void 0,(function*(){return yield Promise.all([yield this.player.Loader(this.loader.MaleAsset,new Pe(ic.StartPosition.x,ic.StartPosition.y,ic.StartPosition.z),"player"),yield this.portal.Loader(ic.DefaultPortalPosition),yield this.MassMushroomLoader(1),yield this.MassMushroomLoader(2),yield this.MassDeadTreeLoader(),yield this.materials.MassLoader(),yield this.npcs.NpcLoader(),yield this.farmer.FarmLoader(),yield this.carp.FurnLoader()]).then((()=>{this.gphysics.addPlayer(this.player),this.gphysics.add(this.npcs.Owner),this.gphysics.addLand(this.floor)}))}))}InitScene(){this.game.add(this.player.Meshs,this.floor.Meshs,this.portal.Meshs),this.deadtrees.forEach((t=>{this.game.add(t.Meshs)})),this.mushrooms.forEach((t=>{this.game.add(t.Meshs)})),this.npcs.InitScene(),this.Helper=new QT(this.game,this.player,this.playerCtrl,this.npcs,this.portal,this.floor,this.legos,this.camera,this.rayViewer,this.gphysics,this.canvas,this.eventCtrl,this.drop)}Despose(){this.game.dispose()}}var qE,YE=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};!function(t){t[t.Long=0]="Long",t[t.Close=1]="Close",t[t.Play=2]="Play",t[t.EditPlay=3]="EditPlay",t[t.Brick=4]="Brick",t[t.Face=5]="Face",t[t.Weapon=6]="Weapon",t[t.Furniture=7]="Furniture",t[t.Farmer=8]="Farmer",t[t.Portal=9]="Portal",t[t.Lego=10]="Lego",t[t.NonLego=11]="NonLego",t[t.LegoDelete=12]="LegoDelete"}(qE||(qE={}));class KE{get Furnitures(){return this.factory.Furnitures}get Plants(){return this.factory.Plants}constructor(){this.factory=new $E,this.initFlag=!1,this.renderFlag=!1,this.loadingVisible=!0,this.canvas=this.factory.Canvas,this.currentScene=this.factory.Scene,this.eventCtrl=this.factory.EventCtrl,this.store=this.factory.ModelStore,this.physic=this.factory.Physics,this.loadingManager=this.factory.LoadingManager,this.eventCtrl.RegisterAppModeEvent(((t,e)=>{if(t==qE.Play)switch(e){case nc.Start:this.loadingVisible=!1;break;case nc.End:this.loadingVisible=!0}}))}init(){return YE(this,void 0,void 0,(function*(){if(this.initFlag)return!1;const t=document.querySelector("#progress-bar-container");return t.style.display="flex",yield this.factory.GltfLoad(),this.factory.InitScene(),window.addEventListener("resize",(()=>this.resize())),window.addEventListener("keydown",(t=>{switch(t.code){case"ArrowUp":this.eventCtrl.OnKeyDownEvent(new pc);break;case"ArrowDown":this.eventCtrl.OnKeyDownEvent(new mc);break;case"ArrowLeft":this.eventCtrl.OnKeyDownEvent(new fc);break;case"ArrowRight":this.eventCtrl.OnKeyDownEvent(new gc)}switch(t.key){case"0":"hons.ghostwebservice.com"!=window.location.hostname&&this.eventCtrl.OnKeyDownEvent(new vc);break;case"1":this.eventCtrl.OnKeyDownEvent(new ac);break;case"2":this.eventCtrl.OnKeyDownEvent(new hc);break;case"3":this.eventCtrl.OnKeyDownEvent(new lc);break;case"4":this.eventCtrl.OnKeyDownEvent(new cc);break;case"5":this.eventCtrl.OnKeyDownEvent(new uc);break;case" ":this.eventCtrl.OnKeyDownEvent(new dc)}})),window.addEventListener("keyup",(t=>{switch(t.code){case"ArrowUp":this.eventCtrl.OnKeyUpEvent(new pc);break;case"ArrowDown":this.eventCtrl.OnKeyUpEvent(new mc);break;case"ArrowLeft":this.eventCtrl.OnKeyUpEvent(new fc);break;case"ArrowRight":this.eventCtrl.OnKeyUpEvent(new gc);break;case"Space":this.eventCtrl.OnKeyUpEvent(new dc)}})),this.initFlag=!0,"hons.ghostwebservice.com"!=window.location.hostname&&this.eventCtrl.OnKeyDownEvent(new vc),t.style.display="none",!0}))}despose(){this.factory.Despose()}loop(){window.requestAnimationFrame((()=>{var t,e;null===(t=this.factory.Helper)||void 0===t||t.CheckStateBegin(),this.currentScene.play(),this.canvas.update(),this.physic.update(),null===(e=this.factory.Helper)||void 0===e||e.CheckStateEnd(),this.loop()}))}Setup(t){this.factory.GameCenter.Setup(t)}render(){this.renderFlag||(this.renderFlag=!0,this.loop())}ChangeCharactor(t){this.factory.ModelStore.ChangeCharactor(t)}ChangeBrickInfo(t){this.eventCtrl.OnChangeBrickInfo(t)}ModeChange(t,...e){this.eventCtrl.OnAppModeEvent(t,...e)}SendModeMessage(...t){this.eventCtrl.OnAppModeMessage(...t)}ModelStore(){return this.store.StoreModels()}LoadModel(t,e,i){return YE(this,void 0,void 0,(function*(){this.eventCtrl.OnSceneClearEvent(),yield this.store.LoadModels(t,e,i)}))}LoadModelEmpty(t,e){return YE(this,void 0,void 0,(function*(){this.eventCtrl.OnSceneClearEvent(),yield this.store.LoadModelsEmpty(t,e)}))}LoadVillage(t,e){return YE(this,void 0,void 0,(function*(){this.eventCtrl.OnSceneClearEvent(),yield this.store.LoadVillage(t,e)}))}resize(){this.canvas.resize()}RegisterChangePlayerStatusEvent(t){this.eventCtrl.RegisterChangePlayerStatusEvent(t)}GetRandomBuff(){return this.factory.Buff.GetRandomBuff()}SelectRandomBuff(t){this.factory.Buff.SelectBuff(t)}GetDeckInfo(){return this.factory.ModelStore.Deck}}var ZE=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class JE{constructor(t){this.url=t}LoadHtml(){return ZE(this,void 0,void 0,(function*(){const t=document.querySelector("contents");if(null==this.page)return yield fetch(this.url).then((t=>t.text())).then((e=>{this.page=e,t.innerHTML=this.page}));t.innerHTML=this.page}))}ReleaseHtml(){const t=document.querySelector("contents");t.hasChildNodes()&&t.replaceChildren()}}class QE{constructor(t,e){this.meta=t,this.from=e,this.profileVisible=!0}Init(){}UiOff(t){const e=document.getElementById("wrapper-profile"),i=document.getElementById("navibar"),n=document.getElementById("footer"),s=document.getElementById("health"),r=document.getElementById("invenBtn");r&&(r.style.display="block"),s&&(s.style.display="block"),e&&(e.style.display="none"),n.style.display="none",i.style.display="none",this.meta.ModeChange(t),this.profileVisible=!1;const o=document.getElementById("fullscreen");/iPone|iPad|iPod|Android/i.test(window.navigator.userAgent)&&o&&(o.innerText="fullscreen_exit",document.documentElement.requestFullscreen().catch((t=>{o.innerText="fullscreen"})))}UiOn(){const t=document.getElementById("wrapper-profile"),e=document.getElementById("navibar"),i=document.getElementById("footer"),n=document.getElementById("health"),s=document.getElementById("invenBtn");s&&(s.style.display="none"),n&&(n.style.display="none"),t&&(t.style.display="block"),i.style.display="block",e.style.display="block",this.meta.ModeChange(this.from,!1),this.profileVisible=!0}VisibleUi(t,e){const i=document.getElementById("wrapper-profile"),n=document.getElementById("navibar"),s=document.getElementById("footer"),r=document.getElementById("health"),o=document.getElementById("invenBtn");this.profileVisible?(i.style.display="none",s.style.display="none",n.style.display="none",this.meta.ModeChange(e),r&&(r.style.display="block"),o&&(o.style.display="block"),this.profileVisible=!1):(i.style.display="block",s.style.display="block",n.style.display="block",this.meta.ModeChange(t,!1),r&&(r.style.display="none"),o&&(o.style.display="none"),this.profileVisible=!0)}}var tA=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class eA extends JE{constructor(t,e,i,n){super(n),this.blockStore=t,this.session=e,this.meta=i,this.m_masterAddr="",this.targetHonEmail="",this.profileVisible=!0,this.fullscreen=!1,this.honsData=[],this.ui=new QE(this.meta,qE.Close),this.alarm=document.getElementById("alarm-msg"),this.alarmText=document.getElementById("alarm-msg-text"),this.popupVisible=!1}drawHtml(t){const e={Email:decodeURIComponent(t.email),Nickname:t.id,Password:""},i=document.getElementById("nickname");if(null==i)return;i.innerHTML=e.Nickname;const n=document.getElementById("email");null!=n&&(n.innerHTML=e.Email,this.blockStore.FetchProfile(window.MasterAddr,t.email).then((t=>{""!=t.file&&"file"in t&&fetch("data:image/jpg;base64,"+t.file).then((t=>t.blob())).then((t=>{const e=URL.createObjectURL(t),i=new Image;i.src=e,i.className="twPc-avatarImg";const n=document.getElementById("bg-profile");null!=n&&(n.innerHTML="",n.appendChild(i))}))})))}requestUserInfo(t){const e=this.m_masterAddr+"/glambda?txid="+encodeURIComponent(h);fetch(e+"&table=member&key="+encodeURIComponent(t)).then((t=>t.json())).then((t=>this.drawHtml(t))).catch((()=>{}))}getParam(){var t;const e=new URLSearchParams(window.location.search),i=encodeURIComponent(null!==(t=e.get("email"))&&void 0!==t?t:"");return null==i?null:i}drawHtmlHon(t,e){return tA(this,void 0,void 0,(function*(){let i=this.blockStore.LoadHonView(e);null==i&&(i=yield f(this.blockStore,t,e),this.blockStore.SaveHonView(e,i)),this.honsData.push({id:e,email:t.email,html:i})}))}honsResult(t){const e=t.result;return 0==e.length?[]:e}RequestHon(t){return tA(this,void 0,void 0,(function*(){if(0==t.length)return;yield Promise.all(t.map((t=>tA(this,void 0,void 0,(function*(){yield this.blockStore.FetchHon(this.m_masterAddr,t).then((e=>this.drawHtmlHon(e,btoa(t)))).catch((t=>{}))})))));let e="";this.honsData.forEach((t=>{e+=t.html}));const i=document.getElementById("feeds");i&&(i.innerHTML=e)}))}RequestHons(t){this.m_masterAddr=window.MasterAddr;const e=`\n        ${this.m_masterAddr}/glambda?txid=${encodeURIComponent("nPyKGx9M0eetb8pDFFF/q9ebTl3bLG7hloYhEb2gH7U=")}&table=feedlink&key=${t}`;fetch(e).then((t=>t.json())).then((t=>this.honsResult(t))).then((t=>this.RequestHon(t)))}Follow(){document.getElementById("followBtn").onclick=()=>{const t=this.targetHonEmail,e=this.session.GetHonUser();if(!this.session.CheckLogin()||e.Email==t)return;const i=new FormData;i.append("key",e.Email),i.append("email",e.Email),i.append("password",e.Password),i.append("targetkey",t);const n=`\n                ${this.m_masterAddr}/glambda?txid=${encodeURIComponent("SIEMAHD4UoD6wDfQns3Xz5TPhlOTNyjCOVIgpQF7OIk=")}`;fetch(n,{method:"POST",cache:"no-cache",headers:{},body:i}).then((t=>t.json())).then((t=>{}))}}GetFollowerList(){const t=this.targetHonEmail,e=`\n                ${this.m_masterAddr}/glambda?txid=${encodeURIComponent(c)}&table=follower&key=${t}`;fetch(e).then((t=>t.json())).then((t=>{t.result.constructor==Array&&t.result.forEach((t=>{this.makeFollowerHtml(t)}))}))}makeFollowerHtml(t){this.blockStore.FetchProfile(window.MasterAddr,t).then((t=>{const e=t.id+t.time.toString();document.getElementById("followerlist").insertAdjacentHTML("afterend",`\n                <div class="row p-1 border-top handcursor" onclick="ClickLoadPage('hondetail', false, '&email=${t.email}')">\n                    <div class="col-auto">\n                            <span id="${e}" class="m-1"></span>\n                    </div>\n                    <div class="col">\n                        <b>${t.id}</b> @${t.email}\n                    </div>\n                </div>\n                `),""!=t.file&&fetch("data:image/jpg;base64,"+t.file).then((t=>t.blob())).then((t=>{const i=URL.createObjectURL(t),n=new Image;n.src=i,n.className="profile-sm";const s=document.getElementById(e);s.innerHTML="",s.appendChild(n)}))}))}drawHtmlEditHome(t){document.getElementById("edithome").onclick=()=>{window.ClickLoadPage("edithome",!1,"&email="+t)}}CanvasRenderer(t){document.getElementById("avatar-bg").style.display="block";document.getElementById("playBtn").onclick=()=>{window.ClickLoadPage("play",!1,`&email=${t}`)},this.meta.init().then((()=>{this.alarm.style.display="block",this.alarmText.innerHTML="이동중입니다.",this.ui.UiOn();const e=this.blockStore.GetModel(this.session.UserId);this.blockStore.FetchModel(this.m_masterAddr,t).then((t=>tA(this,void 0,void 0,(function*(){yield this.meta.LoadModel(t.models,t.id,null==e?void 0:e.models),this.alarm.style.display="none"})))).then((()=>{this.meta.ModeChange(qE.Close)})).catch((()=>tA(this,void 0,void 0,(function*(){this.alarm.style.display="none",yield this.meta.LoadModelEmpty(t,null==e?void 0:e.models),this.meta.ModeChange(qE.Close)}))))})).then((()=>{this.meta.render()}));document.getElementById("avatar-space").style.height=window.innerHeight-230+"px"}PopupMenu(){const t=document.getElementById("menuBtn"),e=document.getElementById("popmenu");t.onclick=()=>{this.popupVisible?(e.style.display="none",this.popupVisible=!1):(e.style.display="block",this.popupVisible=!0)};document.getElementById("pop_logout").onclick=()=>{this.session.SignOut()}}Run(t){return tA(this,void 0,void 0,(function*(){yield this.LoadHtml(),this.ui.Init(),this.m_masterAddr=t;const e=this.getParam();return null!=e&&(this.targetHonEmail=e,window.scrollTo({top:0,left:0,behavior:"auto"}),this.requestUserInfo(e),this.RequestHons(e),this.drawHtmlEditHome(e),this.Follow(),this.GetFollowerList(),this.CanvasRenderer(e),this.PopupMenu(),!0)}))}Release(){this.honsData.length=0;document.getElementById("footer").style.display="block",this.ReleaseHtml()}}var iA=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class nA extends JE{constructor(t,e,i,n){super(n),this.blockStore=t,this.session=e,this.meta=i,this.profileVisible=!0,this.requestCount=5,this.ui=new QE(this.meta,qE.Long),this.m_masterAddr="",this.loadedCount=0,this.targetLoadCount=0}warningMsg(t){const e=document.getElementById("information");null!=e&&(e.innerHTML=t)}honsResult(t){if("json"in t){return JSON.parse(t.json)}return this.warningMsg("Loading 실패"),[]}drawHtmlConnectMaster(){const t=document.getElementById("connect");null!=t&&(t.innerHTML=`Connected Master - \n        ${window.MasterNode.User.Nickname}`)}makeHtmlHon(t,e){return iA(this,void 0,void 0,(function*(){if(this.loadedCount++,"result"in t)return;let i=this.blockStore.LoadHonView(e);null==i&&(i=yield f(this.blockStore,t,e),this.blockStore.SaveHonView(e,i));const n=document.getElementById("feeds");n&&n.insertAdjacentHTML("beforeend",i)}))}RequestHon(t){return iA(this,void 0,void 0,(function*(){yield Promise.all(t.map((t=>iA(this,void 0,void 0,(function*(){yield this.blockStore.FetchHon(this.m_masterAddr,atob(t)).then((e=>this.makeHtmlHon(e,t)))}))))),this.ViewLoadingSpinner(!1)}))}getParam(){var t;const e=new URLSearchParams(window.location.search),i=encodeURIComponent(null!==(t=e.get("tag"))&&void 0!==t?t:"");return""==i?null:i}RequestHons(t,e){this.ViewLoadingSpinner(!0),this.m_masterAddr=window.MasterAddr;const i=this.m_masterAddr,n=this.getParam(),s=null==n?"feeds":n,o=`\n        ${i}/glambda?txid=${encodeURIComponent(r)}&table=${s}&start=${t}&count=${e}`;fetch(o).then((t=>t.json())).then((t=>this.honsResult(t))).then((e=>{this.targetLoadCount=t+e.length,this.CheckReloading(e.length),this.RequestHon(e)})).catch((()=>{this.warningMsg("Server에 문제가 생긴듯 합니다;;")}))}CheckReloading(t){const e=document.getElementById("reload");this.requestCount>t?e.style.display="none":e.style.display="block"}ViewLoadingSpinner(t){const e=document.getElementById("loading");e&&(e.innerHTML=t?'\n            <div class="spinner-grow text-primary" role="status">\n                <span class="visually-hidden"></span>\n            </div>\n        ':"")}CanvasRenderer(){document.getElementById("avatar-bg").style.display="block",this.profileVisible=!1,this.meta.init().then((()=>{this.ui.UiOn(),this.meta.render()}));const t=this.blockStore.GetModel(this.session.UserId);this.blockStore.FetchModels(this.m_masterAddr).then((e=>iA(this,void 0,void 0,(function*(){yield this.meta.LoadVillage(e,null==t?void 0:t.models)}))));document.getElementById("playBtn").onclick=()=>{window.ClickLoadPage("play",!1)};document.getElementById("avatar-space").style.height=window.innerHeight-230+"px"}Run(t){return iA(this,void 0,void 0,(function*(){yield this.LoadHtml(),this.ui.Init(),this.loadedCount=0,this.m_masterAddr=t,this.drawHtmlConnectMaster(),this.CanvasRenderer(),this.RequestHons(this.loadedCount,this.requestCount);const e=document.getElementById("tagtitle"),i=document.getElementById("newfeed"),n=this.getParam();if(null==n)e.innerText="#최신글";else{i.onclick=()=>{window.ClickLoadPage("newhon",!1,`&tag=${n}`)};try{e.innerText=decodeURIComponent(atob(n))}catch(t){e.innerText=decodeURIComponent(atob(decodeURIComponent(n)))}}return document.getElementById("reload").onclick=()=>{this.loadedCount==this.targetLoadCount&&this.RequestHons(this.loadedCount,this.requestCount)},!0}))}Release(){this.loadedCount=0,this.ReleaseHtml()}}var sA=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class rA extends JE{constructor(t,e,i){super(i),this.blockStore=t,this.session=e,this.m_masterAddr=""}drawHtmlUserReply(){this.blockStore.FetchProfile(window.MasterAddr,this.session.GetHonUser().Email).then((t=>{""!=t.file&&fetch("data:image/jpg;base64,"+t.file).then((t=>t.blob())).then((t=>{const e=URL.createObjectURL(t),i=new Image;i.src=e,i.className="profile-sm";const n=document.getElementById("userId");n.innerHTML="",n.appendChild(i)}))}))}drawHtmlReply(){this.blockStore.FetchProfile(window.MasterAddr,this.session.GetHonUser().Email).then((t=>{"file"in t&&fetch("data:image/jpg;base64,"+t.file).then((t=>t.blob())).then((t=>{const e=URL.createObjectURL(t),i=new Image;i.src=e,i.className="profile-sm";const n=document.getElementById("userId");n.innerHTML="",n.appendChild(i)}))}))}getParam(){var t;const e=new URLSearchParams(window.location.search),i=encodeURIComponent(null!==(t=e.get("key"))&&void 0!==t?t:"");return null==i?null:i}drawHtmlHon(t,e,i){return sA(this,void 0,void 0,(function*(){const n=document.getElementById(i);if(null==n)return;const s=yield f(this.blockStore,t,e);n.insertAdjacentHTML("afterend",s)}))}warningMsg(t){const e=document.getElementById("information");null!=e&&(e.innerHTML=t)}newHonResult(t){if("null"==t.result)this.warningMsg("등록 실패");else{const t=this.getParam();window.ClickLoadPage("hon",!1,`&key=${t}`)}}RequestNewReplyHon(t){const e=this.m_masterAddr,i=this.session.GetHonUser(),n=document.getElementById("inputContent"),s=e+"/glambda?txid="+encodeURIComponent("bhIPesNmn1bFj007f+/gjNB8XxhWFvHc8zHvOCcgE+U="),r=new FormData;r.append("key",i.Email),r.append("email",i.Email),r.append("password",i.Password),r.append("id",i.Nickname),r.append("targetkey",decodeURIComponent(t)),r.append("time",(new Date).getTime().toString()),r.append("table","feeds"),r.append("content",null==n?void 0:n.value),fetch(s,{method:"POST",cache:"no-cache",headers:{},body:r}).then((t=>t.json())).then((t=>this.newHonResult(t))).catch((()=>{this.warningMsg("Server에 문제가 생긴듯 합니다;;")}))}RequestHon(t){const e=atob(decodeURIComponent(t));return this.blockStore.FetchHon(this.m_masterAddr,e).then((e=>this.drawHtmlHon(e,t,"feed")))}RequestHonReply(t){const e=this.m_masterAddr+"/glambda?txid="+encodeURIComponent(a)+"&table=replyfeeds&key=";return fetch(e+t).then((t=>t.json())).then((e=>sA(this,void 0,void 0,(function*(){return yield this.drawHtmlHon(e,t,"reply")})))).then((()=>this.warningMsg("")))}RequestHonsReplys(t){this.m_masterAddr=window.MasterAddr;const e=`\n        ${this.m_masterAddr}/glambda?txid=${encodeURIComponent(l)}&table=replylink&key=${t}`;fetch(e).then((t=>t.json())).then((t=>{t.result.constructor==Array?t.result.forEach((t=>sA(this,void 0,void 0,(function*(){yield this.RequestHonReply(t)})))):this.warningMsg("")}))}CheckReplyForm(){if(!this.session.CheckLogin()){return document.getElementById("replyform").innerHTML="<b>login</b>을 해야 답글을 남길 수 있습니다.",!1}return!0}canvasVisible(t){document.getElementById("avatar-bg").style.display=t?"block":"none"}Run(t){return sA(this,void 0,void 0,(function*(){yield this.LoadHtml(),this.m_masterAddr=t;const e=this.getParam();if(null==e)return!1;this.RequestHon(e).then((()=>{if(this.drawHtmlUserReply(),this.RequestHonsReplys(e),!this.CheckReplyForm())return!1}));const i=document.getElementById("replyBtn");return i.onclick=()=>{i.disabled=!0,this.RequestNewReplyHon(e)},!0}))}Release(){this.canvasVisible(!0),this.ReleaseHtml()}}var oA=o(146),aA=o.n(oA),hA=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};const lA="Filter",cA="Gen";class uA extends JE{constructor(t,e,i){super(i),this.session=t,this.ipc=e,this.readyprocess=!1,this.alarm=document.getElementById("alarm-msg"),this.alarmText=document.getElementById("alarm-msg-text"),this.dropmenuVisible=!1,this.m_masterAddr="",this.m_model="toonyou_beta6-f16.gguf",this.m_img=new Blob,this.m_srcImg=new Blob,this.mode=lA}MsgHandler(t,e){switch(t){case"close":this.printLog("server와 연결이 끊겼습니다. 새로고침하세요.");break;case"generateLog":if(this.mode==lA){const t=JSON.parse(e.replaceAll("'",'"')),i=parseInt(t.step,10),n=parseInt(t.steps,10),s=parseFloat(t.time);0==i?this.printLog("시간을 계산중입니다."):i==n?this.printLog("사진을 생성 중입니다."):this.printLog(`남은 예상시간: \n                        ${((n-i)*s).toFixed(2)}s\n                        , 진행율: ${(i/n*100).toFixed(2)}%`)}else this.printLog(e);break;case"reply_generateImage":const t=e;fetch(`${window.MasterAddr}/image?filename=${t}`).then((t=>t.blob())).then((t=>{const e=new Blob([t],{type:"image/bmp"}),i=URL.createObjectURL(e),n=new Image;n.src=i,n.className="img-fluid rounded";const s=document.getElementById("printImg");s.innerHTML="",s.appendChild(n),this.m_img=e,this.printLog("완료")}))}}printLog(t){document.getElementById("log").innerHTML=`\n                ${t}\n            `}warningMsg(t){const e=document.getElementById("information");null!=e&&(e.innerHTML=t)}newHonResult(t){"null"==t.result?this.warningMsg("등록 실패"):window.ClickLoadPage("hons",!1)}RequestNewHon(){const t=this.m_masterAddr,e=this.session.GetHonUser(),i=document.getElementById("inputContent"),n=t+"/glambda?txid="+encodeURIComponent("5ie8zKOfGRGkbEBo/N5wuL5jzIfxwWq9BgzoLqz19K8="),s=document.getElementById("thread"),r="#"+(""==s.value?"daliy log":s.value.replace("#","")),o=new FormData;o.append("file",this.m_img),o.append("key",encodeURIComponent(e.Email)),o.append("email",encodeURIComponent(e.Email)),o.append("password",e.Password),o.append("id",e.Nickname),o.append("time",(new Date).getTime().toString()),o.append("table","feeds"),o.append("tag",btoa(encodeURIComponent(r))),o.append("content",null==i?void 0:i.value),fetch(n,{method:"POST",cache:"no-cache",headers:{},body:o}).then((t=>t.json())).then((t=>this.newHonResult(t))).catch((()=>{this.warningMsg("Server에 문제가 생긴듯 합니다;;")}))}generateImage(){this.mode=cA;const t=document.getElementById("prompt").value.toLowerCase(),e=document.getElementById("nprompt").value.toLowerCase(),i=document.getElementById("step"),n=""==i.value?"20":i.value;document.getElementById("printImg").innerHTML='\n            <div class="spinner-grow text-primary" role="status">\n                <span class="visually-hidden"></span>\n            </div>\n        ';const s=""==e?"nude, naked, nsfw":", nude, naked, nsfw";this.ipc.SendMsg("generateImage",t,e+s,"512","512",n,"-1"),this.printLog("전송중입니다.")}processImage(){this.mode=lA;const t=document.getElementById("fprompt").value.toLowerCase(),e=document.getElementById("fnprompt").value.toLowerCase(),i=document.getElementById("strength"),n=""==i.value?"0.5":i.value;document.getElementById("printImg").innerHTML='\n            <div class="spinner-grow text-primary" role="status">\n                <span class="visually-hidden"></span>\n            </div>\n        ';const s=""==e?"nude, naked, nsfw":", nude, naked, nsfw",r=new FileReader;r.readAsDataURL(this.m_srcImg),r.onloadend=()=>{this.ipc.SendMsg("processImage",t,e+s,"512","512","20","-1",this.m_model,"euler","7",n,"","","2","","",r.result)},this.printLog("작업 대기중 입니다.")}canvasVisible(t){document.getElementById("avatar-bg").style.display=t?"block":"none"}toggleMenu(){const t=document.getElementById("modellist");0==this.dropmenuVisible?(t.style.display="block",t.style.transform="translate(0px, 40px)"):(t.style.display="none",t.style.transform="translate(0px, 40px)"),this.dropmenuVisible=!this.dropmenuVisible}initFilterUi(){document.getElementById("dropdownMenuButton").onclick=()=>{this.toggleMenu()};const t=document.getElementById("strength"),e=document.getElementById("strength-text");t.onchange=()=>{e.value=t.value.toString()},e.value=t.value.toString();const i=document.getElementById("cropimg");let n=new(aA())(i);document.getElementById("origin-file").onchange=t=>{const e=new FileReader;e.onload=t=>{var e;const s=new Blob([new Uint8Array(null===(e=t.target)||void 0===e?void 0:e.result)],{type:"image/bmp"}),r=URL.createObjectURL(s);i.src=r;const o=i.width/window.innerWidth;i.height*=o,n.destroy(),n=new(aA())(i,{aspectRatio:1,viewMode:2})},e.readAsArrayBuffer(t.target.files[0])};document.getElementById("cropBtn").onclick=()=>{this.alarm.style.display="block",this.alarmText.innerText="이미지 처리중",n.getCroppedCanvas().toBlob((t=>{if(null==t)return;const e=URL.createObjectURL(t),i=new Image;i.src=e,i.onload=()=>{const t=document.createElement("canvas");t.width=t.height=512;const e=t.getContext("2d",{alpha:!1});null!=e&&(e.drawImage(i,0,0,512,512),t.toBlob((t=>{if(null==t)return;this.m_srcImg=t;const e=URL.createObjectURL(t),i=new Image;i.src=e,i.className="img-fluid";const n=document.getElementById("result");n.innerHTML="",n.appendChild(i),this.readyprocess=!0,this.alarm.style.display="none"})))}}))};document.getElementById("processBtn").onclick=()=>{this.readyprocess&&this.processImage()},this.bindClickEvent("toonyou",1),this.bindClickEvent("disney",2),this.bindClickEvent("child",4)}selectModel(t){this.toggleMenu();const e=document.getElementById("dropdownMenuButton"),i=document.getElementById("result");switch(t){case 1:e.innerText="Animation Style",this.m_model="toonyou_beta6-f16.gguf",this.readyprocess||(i.innerHTML='<img src="static/img/comp1.jpg" class="img-fluid rounded">');break;case 2:e.innerText="Disney Style",this.m_model="disneyPixarCartoon_v10-f16.gguf",this.readyprocess||(i.innerHTML='<img src="static/img/comp2.jpg" class="img-fluid rounded">');break;case 3:e.innerText="Default Style",this.m_model="sd-v1-4-f16.gguf";break;case 4:e.innerText="Real-Picture Style",this.m_model="chilled_reversemix_v2-f16.gguf",this.readyprocess||(i.innerHTML='<img src="static/img/comp3.jpg" class="img-fluid rounded">')}}bindClickEvent(t,e){document.getElementById(t).onclick=()=>{this.selectModel(e)}}getParam(){var t;const e=new URLSearchParams(window.location.search),i=decodeURIComponent(atob(null!==(t=e.get("tag"))&&void 0!==t?t:"")).replace("#","");return""==i?null:i}Run(t){var e;return hA(this,void 0,void 0,(function*(){yield this.LoadHtml(),window.scrollTo(0,0);const i=document.getElementById("feedBtn");this.session.CheckLogin()?i.onclick=()=>{i.disabled=!0,this.RequestNewHon()}:(i.innerText="체험만 가능 (Login 후 등록할 수 있습니다.)",i.disabled=!0),this.ipc.IsOpen()||this.ipc.OpenChannel(window.MasterWsAddr+"/ws"),this.m_masterAddr=t;return document.getElementById("thread").value=null!==(e=this.getParam())&&void 0!==e?e:"",fetch("views/sd1.html").then((t=>t.text())).then((t=>{document.getElementById("sd1").innerHTML=t})).then((()=>{const t=document.getElementById("inputContent");t.onfocus=()=>{"Enter text"==t.value&&(t.value="")};document.getElementById("generateBtn").onclick=()=>{this.generateImage()}})),fetch("views/editimg.html").then((t=>t.text())).then((t=>{document.getElementById("modalwindow").innerHTML=t})).then((()=>{fetch("views/filter.html").then((t=>t.text())).then((t=>{document.getElementById("filter").innerHTML=t})).then((()=>{this.initFilterUi()}))})),!0}))}Release(){this.ReleaseHtml(),this.readyprocess=!1}}function dA(t){function e(t,e){var i=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(i>>16)<<16|65535&i}function i(t,e){return t>>>e|t<<32-e}function n(t,e){return t>>>e}function s(t,e,i){return t&e^~t&i}function r(t,e,i){return t&e^t&i^e&i}function o(t){return i(t,2)^i(t,13)^i(t,22)}function a(t){return i(t,6)^i(t,11)^i(t,25)}function h(t){return i(t,7)^i(t,18)^n(t,3)}function l(t){return i(t,17)^i(t,19)^n(t,10)}return function(t){for(var e="0123456789abcdef",i="",n=0;n<4*t.length;n++)i+=e.charAt(t[n>>2]>>8*(3-n%4)+4&15)+e.charAt(t[n>>2]>>8*(3-n%4)&15);return i}(function(t,i){var n,c,u,d,p,m,f,g,v,y,x=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),_=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),b=new Array(64);t[i>>5]|=128<<24-i%32,t[15+(i+64>>9<<4)]=i;for(var w=0;w<t.length;w+=16){n=_[0],c=_[1],u=_[2],d=_[3],p=_[4],m=_[5],f=_[6],g=_[7];for(var M=0;M<64;M++)b[M]=M<16?t[M+w]:e(e(e(l(b[M-2]),b[M-7]),h(b[M-15])),b[M-16]),v=e(e(e(e(g,a(p)),s(p,m,f)),x[M]),b[M]),y=e(o(n),r(n,c,u)),g=f,f=m,m=p,p=e(d,v),d=u,u=c,c=n,n=e(v,y);_[0]=e(n,_[0]),_[1]=e(c,_[1]),_[2]=e(u,_[2]),_[3]=e(d,_[3]),_[4]=e(p,_[4]),_[5]=e(m,_[5]),_[6]=e(f,_[6]),_[7]=e(g,_[7])}return _}(function(t){for(var e=Array(),i=0;i<8*t.length;i+=8)e[i>>5]|=(255&t.charCodeAt(i/8))<<24-i%32;return e}(t=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",i=0;i<t.length;i++){var n=t.charCodeAt(i);n<128?e+=String.fromCharCode(n):n>127&&n<2048?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e}(t)),8*t.length))}var pA=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class mA extends JE{constructor(t){super(t),this.m_masterAddr=""}warningMsg(t){const e=document.getElementById("information");null!=e&&(e.innerHTML=t)}signupResult(t){"null"==t.result?this.warningMsg("Signup 실패"):"result"in t?this.warningMsg(t.result):window.ClickLoadPage("signin",!1)}RequestSignup(){const t=this.m_masterAddr,e=document.getElementById("inputEmail"),n=null==e?void 0:e.value;""==n&&this.warningMsg("email is empty");const s=document.getElementById("inputPassword"),r=dA(null==s?void 0:s.value),o=document.getElementById("inputId"),a=null==o?void 0:o.value,h=t+"/glambda?txid="+encodeURIComponent(i),l=new FormData;l.append("key",encodeURIComponent(n)),l.append("email",encodeURIComponent(n)),l.append("password",r),l.append("id",a),fetch(h,{method:"POST",cache:"no-cache",headers:{},body:l}).then((t=>t.json())).then((t=>this.signupResult(t))).catch((()=>{this.warningMsg("Server에 문제가 생긴듯 합니다;;")}))}Run(t){return pA(this,void 0,void 0,(function*(){yield this.LoadHtml(),this.m_masterAddr=t;document.getElementById("txLink").innerHTML=`\n            <a class="handcursor" href="http://ghostwebservice.com/?pageid=txdetail&txid=${encodeURIComponent(i)}">\n                gLambda Code 보기\n            </a> `;return document.getElementById("signupBtn").onclick=()=>this.RequestSignup(),!0}))}Release(){this.ReleaseHtml()}}var fA=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class gA extends JE{constructor(t,e){super(e),this.session=t,this.m_user={Email:"",Nickname:"",Password:""},this.m_masterAddr=""}warningMsg(t){const e=document.getElementById("information");null!=e&&(e.innerHTML=t)}loginResult(t){"email"in t?(this.session.SignIn({Email:t.email,Nickname:t.id,Password:this.m_user.Password}),window.ClickLoadPage("hondetail",!1,`&email=${t.email}`)):this.warningMsg("ID와 Password가 맞지 않습니다.")}RequestSignin(){const t=this.m_masterAddr,i=document.getElementById("inputEmail"),n=null==i?void 0:i.value;""==n&&this.warningMsg("email is empty");const s=document.getElementById("inputPassword"),r=dA(null==s?void 0:s.value),o=t+"/glambda?txid="+encodeURIComponent(e);this.m_user.Email=n,this.m_user.Password=r;const a=new FormData;a.append("key",encodeURIComponent(n)),a.append("email",encodeURIComponent(n)),a.append("password",r),fetch(o,{method:"POST",cache:"no-cache",headers:{},body:a}).then((t=>t.json())).then((t=>this.loginResult(t))).catch((()=>{this.warningMsg("Server에 문제가 생긴듯 합니다;;")}))}Run(t){return fA(this,void 0,void 0,(function*(){yield this.LoadHtml(),this.m_masterAddr=t;document.getElementById("txLink").innerHTML=`\n            <a class="handcursor" href="http://ghostwebservice.com/?pageid=txdetail&txid=${encodeURIComponent(e)}">\n            link click\n            </a> `;return document.getElementById("signinBtn").onclick=()=>this.RequestSignin(),!0}))}Release(){this.ReleaseHtml()}}var vA=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};const yA={Email:"",Nickname:"",Password:""},xA="HonUser";class _A{constructor(t){this.blockStore=t,this.m_user={Email:"",Nickname:"",Password:""},this.m_signinFlag=!1}get UserId(){return this.m_user.Email}GetHonUser(){return this.m_user}RequestSignIn(t,i,n){const s=window.MasterAddr+"/glambda?txid="+encodeURIComponent(e),r=new FormData;return r.append("key",t),r.append("email",t),r.append("password",i),fetch(s,{method:"POST",cache:"no-cache",headers:{},body:r}).then((t=>t.json())).then((t=>n(t)))}drawHtmlLoginUi(){if(this.m_signinFlag){document.getElementById("sessioninfo").innerHTML=`\n                <a href="javascript:void(0)" onclick="ClickLoadPage('hondetail', true, '&email=${this.m_user.Email}')"> ${this.m_user.Nickname} &nbsp; </a>  \n            `}}DrawHtmlSessionInfo(){return vA(this,void 0,void 0,(function*(){const t=sessionStorage.getItem(xA);if(null==t||0!=this.m_signinFlag)this.drawHtmlLoginUi();else{const e=JSON.parse(t);yield this.RequestSignIn(e.Email,e.Password,(t=>vA(this,void 0,void 0,(function*(){"email"in t&&(this.SignIn({Email:t.email,Nickname:t.id,Password:e.Password}),this.drawHtmlLoginUi(),yield this.blockStore.FetchModel(window.MasterAddr,t.email))}))))}}))}SignIn(t){this.m_user=t,this.m_signinFlag=!0,sessionStorage.setItem(xA,JSON.stringify(t))}SignOut(){this.m_user=yA,this.m_signinFlag=!1,sessionStorage.removeItem(xA),location.reload()}CheckLogin(){return this.m_signinFlag}}var bA=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class wA extends JE{constructor(t){super(t),this.m_masterAddr=""}warningMsg(t){const e=document.getElementById("information");null!=e&&(e.innerHTML=t)}RequestUpload(){const t=this.m_masterAddr,e=document.getElementById("inputFile");if(null==e.files)return;const i=new FormData;i.append("key",""),i.append("files",e.files[0]);const n=t+"/glambda?txid="+encodeURIComponent("");fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:i}).then((t=>t.json())).then((t=>{})).catch((()=>{this.warningMsg("Server에 문제가 생긴듯 합니다;;")}))}Run(t){return bA(this,void 0,void 0,(function*(){yield this.LoadHtml(),this.m_masterAddr=t;document.getElementById("txLink").innerHTML=`\n            <a class="handcursor" onclick='ClickLoadPage("txdetail", false, "&txid=${encodeURIComponent("")}")'>\n                \n            </a> `;return document.getElementById("uploadBtn").onclick=()=>this.RequestUpload(),!0}))}Release(){this.ReleaseHtml()}}var MA=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class SA extends JE{constructor(t,e,i){super(i),this.session=t,this.ipc=e,this.m_masterAddr="",this.m_img=new Blob}MsgHandler(t,e){switch(t){case"generateLog":this.printLog(e);break;case"reply_generateImage":const t=e;fetch(`${window.MasterAddr}/image?filename=${t}`).then((t=>t.blob())).then((t=>{const e=new Blob([t],{type:"image/bmp"}),i=URL.createObjectURL(e),n=new Image;n.src=i;const s=document.getElementById("printImg");s.innerHTML="",s.appendChild(n),this.m_img=e}))}}printLog(t){document.getElementById("log").innerHTML=`\n                ${t}\n            `}requestResult(t){"result"in t?window.ClickLoadPage("hondetail",!1,`&email=${this.session.UserId}`):this.printLog(t)}uploadImage(){if(!this.session.CheckLogin())return void this.printLog("need to sign in");const t=this.session.GetHonUser(),e=new FormData;e.append("file",this.m_img),e.append("key",t.Email),e.append("email",t.Email),e.append("password",t.Password),e.append("id",t.Nickname),e.append("time",(new Date).getTime().toString()),e.forEach((t=>{}));const i=window.MasterAddr+"/glambda?txid="+encodeURIComponent("zdER15Xm3UHCouCRy3W/pVpkqDV72BK04jPkLroP75U=");fetch(i,{method:"POST",cache:"no-cache",headers:{},body:e}).then((t=>t.json())).then((t=>this.requestResult(t)))}generateImage(){const t=document.getElementById("prompt").value.toLowerCase(),e=document.getElementById("nprompt").value.toLowerCase(),i=document.getElementById("step"),n=""==i.value?"20":i.value;document.getElementById("printImg").innerHTML='\n            <div class="spinner-grow text-primary" role="status">\n                <span class="visually-hidden"></span>\n            </div>\n        ';const s=""==e?"nude, naked, nsfw":", nude, naked, nsfw";this.ipc.SendMsg("generateImage",t,e+s,"256","256",n,"-1")}Run(){return MA(this,void 0,void 0,(function*(){yield this.LoadHtml(),this.ipc.IsOpen()||this.ipc.OpenChannel(window.MasterWsAddr+"/ws");document.getElementById("generateBtn").onclick=()=>this.generateImage();return document.getElementById("uploadBtn").onclick=()=>this.uploadImage(),this.session.CheckLogin()||this.printLog("sign in을 해야 변경이 가능합니다."),!0}))}Release(){this.ReleaseHtml()}}class TA{constructor(t){this.curId="",this.objs={},t.RegisterMsgHandler("close",(t=>{this.objs[this.curId].MsgHandler("close",t)})),t.RegisterMsgHandler("generateLog",(t=>{this.objs[this.curId].MsgHandler("generateLog",t)})),t.RegisterMsgHandler("reply_generateImage",(t=>{this.objs[this.curId].MsgHandler("reply_generateImage",t)}))}RegisterClient(t,e){this.objs[t]=e}Activate(t){this.curId=t}}var EA="top",AA="bottom",CA="right",IA="left",RA="auto",PA=[EA,AA,CA,IA],kA="start",DA="end",LA="clippingParents",OA="viewport",NA="popper",BA="reference",zA=PA.reduce((function(t,e){return t.concat([e+"-"+kA,e+"-"+DA])}),[]),UA=[].concat(PA,[RA]).reduce((function(t,e){return t.concat([e,e+"-"+kA,e+"-"+DA])}),[]),FA="beforeRead",GA="read",HA="afterRead",VA="beforeMain",jA="main",WA="afterMain",XA="beforeWrite",$A="write",qA="afterWrite",YA=[FA,GA,HA,VA,jA,WA,XA,$A,qA];function KA(t){return t?(t.nodeName||"").toLowerCase():null}function ZA(t){if(null==t)return window;if("[object Window]"!==t.toString()){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function JA(t){return t instanceof ZA(t).Element||t instanceof Element}function QA(t){return t instanceof ZA(t).HTMLElement||t instanceof HTMLElement}function tC(t){return"undefined"!=typeof ShadowRoot&&(t instanceof ZA(t).ShadowRoot||t instanceof ShadowRoot)}const eC={name:"applyStyles",enabled:!0,phase:"write",fn:function(t){var e=t.state;Object.keys(e.elements).forEach((function(t){var i=e.styles[t]||{},n=e.attributes[t]||{},s=e.elements[t];QA(s)&&KA(s)&&(Object.assign(s.style,i),Object.keys(n).forEach((function(t){var e=n[t];!1===e?s.removeAttribute(t):s.setAttribute(t,!0===e?"":e)})))}))},effect:function(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach((function(t){var n=e.elements[t],s=e.attributes[t]||{},r=Object.keys(e.styles.hasOwnProperty(t)?e.styles[t]:i[t]).reduce((function(t,e){return t[e]="",t}),{});QA(n)&&KA(n)&&(Object.assign(n.style,r),Object.keys(s).forEach((function(t){n.removeAttribute(t)})))}))}},requires:["computeStyles"]};function iC(t){return t.split("-")[0]}var nC=Math.max,sC=Math.min,rC=Math.round;function oC(){var t=navigator.userAgentData;return null!=t&&t.brands&&Array.isArray(t.brands)?t.brands.map((function(t){return t.brand+"/"+t.version})).join(" "):navigator.userAgent}function aC(){return!/^((?!chrome|android).)*safari/i.test(oC())}function hC(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1);var n=t.getBoundingClientRect(),s=1,r=1;e&&QA(t)&&(s=t.offsetWidth>0&&rC(n.width)/t.offsetWidth||1,r=t.offsetHeight>0&&rC(n.height)/t.offsetHeight||1);var o=(JA(t)?ZA(t):window).visualViewport,a=!aC()&&i,h=(n.left+(a&&o?o.offsetLeft:0))/s,l=(n.top+(a&&o?o.offsetTop:0))/r,c=n.width/s,u=n.height/r;return{width:c,height:u,top:l,right:h+c,bottom:l+u,left:h,x:h,y:l}}function lC(t){var e=hC(t),i=t.offsetWidth,n=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:n}}function cC(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&tC(i)){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function uC(t){return ZA(t).getComputedStyle(t)}function dC(t){return["table","td","th"].indexOf(KA(t))>=0}function pC(t){return((JA(t)?t.ownerDocument:t.document)||window.document).documentElement}function mC(t){return"html"===KA(t)?t:t.assignedSlot||t.parentNode||(tC(t)?t.host:null)||pC(t)}function fC(t){return QA(t)&&"fixed"!==uC(t).position?t.offsetParent:null}function gC(t){for(var e=ZA(t),i=fC(t);i&&dC(i)&&"static"===uC(i).position;)i=fC(i);return i&&("html"===KA(i)||"body"===KA(i)&&"static"===uC(i).position)?e:i||function(t){var e=/firefox/i.test(oC());if(/Trident/i.test(oC())&&QA(t)&&"fixed"===uC(t).position)return null;var i=mC(t);for(tC(i)&&(i=i.host);QA(i)&&["html","body"].indexOf(KA(i))<0;){var n=uC(i);if("none"!==n.transform||"none"!==n.perspective||"paint"===n.contain||-1!==["transform","perspective"].indexOf(n.willChange)||e&&"filter"===n.willChange||e&&n.filter&&"none"!==n.filter)return i;i=i.parentNode}return null}(t)||e}function vC(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function yC(t,e,i){return nC(t,sC(e,i))}function xC(t){return Object.assign({},{top:0,right:0,bottom:0,left:0},t)}function _C(t,e){return e.reduce((function(e,i){return e[i]=t,e}),{})}const bC={name:"arrow",enabled:!0,phase:"main",fn:function(t){var e,i=t.state,n=t.name,s=t.options,r=i.elements.arrow,o=i.modifiersData.popperOffsets,a=iC(i.placement),h=vC(a),l=[IA,CA].indexOf(a)>=0?"height":"width";if(r&&o){var c=function(t,e){return xC("number"!=typeof(t="function"==typeof t?t(Object.assign({},e.rects,{placement:e.placement})):t)?t:_C(t,PA))}(s.padding,i),u=lC(r),d="y"===h?EA:IA,p="y"===h?AA:CA,m=i.rects.reference[l]+i.rects.reference[h]-o[h]-i.rects.popper[l],f=o[h]-i.rects.reference[h],g=gC(r),v=g?"y"===h?g.clientHeight||0:g.clientWidth||0:0,y=m/2-f/2,x=c[d],_=v-u[l]-c[p],b=v/2-u[l]/2+y,w=yC(x,b,_),M=h;i.modifiersData[n]=((e={})[M]=w,e.centerOffset=w-b,e)}},effect:function(t){var e=t.state,i=t.options.element,n=void 0===i?"[data-popper-arrow]":i;null!=n&&("string"!=typeof n||(n=e.elements.popper.querySelector(n)))&&cC(e.elements.popper,n)&&(e.elements.arrow=n)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function wC(t){return t.split("-")[1]}var MC={top:"auto",right:"auto",bottom:"auto",left:"auto"};function SC(t){var e,i=t.popper,n=t.popperRect,s=t.placement,r=t.variation,o=t.offsets,a=t.position,h=t.gpuAcceleration,l=t.adaptive,c=t.roundOffsets,u=t.isFixed,d=o.x,p=void 0===d?0:d,m=o.y,f=void 0===m?0:m,g="function"==typeof c?c({x:p,y:f}):{x:p,y:f};p=g.x,f=g.y;var v=o.hasOwnProperty("x"),y=o.hasOwnProperty("y"),x=IA,_=EA,b=window;if(l){var w=gC(i),M="clientHeight",S="clientWidth";if(w===ZA(i)&&"static"!==uC(w=pC(i)).position&&"absolute"===a&&(M="scrollHeight",S="scrollWidth"),s===EA||(s===IA||s===CA)&&r===DA)_=AA,f-=(u&&w===b&&b.visualViewport?b.visualViewport.height:w[M])-n.height,f*=h?1:-1;if(s===IA||(s===EA||s===AA)&&r===DA)x=CA,p-=(u&&w===b&&b.visualViewport?b.visualViewport.width:w[S])-n.width,p*=h?1:-1}var T,E=Object.assign({position:a},l&&MC),A=!0===c?function(t,e){var i=t.x,n=t.y,s=e.devicePixelRatio||1;return{x:rC(i*s)/s||0,y:rC(n*s)/s||0}}({x:p,y:f},ZA(i)):{x:p,y:f};return p=A.x,f=A.y,h?Object.assign({},E,((T={})[_]=y?"0":"",T[x]=v?"0":"",T.transform=(b.devicePixelRatio||1)<=1?"translate("+p+"px, "+f+"px)":"translate3d("+p+"px, "+f+"px, 0)",T)):Object.assign({},E,((e={})[_]=y?f+"px":"",e[x]=v?p+"px":"",e.transform="",e))}const TC={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(t){var e=t.state,i=t.options,n=i.gpuAcceleration,s=void 0===n||n,r=i.adaptive,o=void 0===r||r,a=i.roundOffsets,h=void 0===a||a,l={placement:iC(e.placement),variation:wC(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:s,isFixed:"fixed"===e.options.strategy};null!=e.modifiersData.popperOffsets&&(e.styles.popper=Object.assign({},e.styles.popper,SC(Object.assign({},l,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:h})))),null!=e.modifiersData.arrow&&(e.styles.arrow=Object.assign({},e.styles.arrow,SC(Object.assign({},l,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:h})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}};var EC={passive:!0};const AC={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(t){var e=t.state,i=t.instance,n=t.options,s=n.scroll,r=void 0===s||s,o=n.resize,a=void 0===o||o,h=ZA(e.elements.popper),l=[].concat(e.scrollParents.reference,e.scrollParents.popper);return r&&l.forEach((function(t){t.addEventListener("scroll",i.update,EC)})),a&&h.addEventListener("resize",i.update,EC),function(){r&&l.forEach((function(t){t.removeEventListener("scroll",i.update,EC)})),a&&h.removeEventListener("resize",i.update,EC)}},data:{}};var CC={left:"right",right:"left",bottom:"top",top:"bottom"};function IC(t){return t.replace(/left|right|bottom|top/g,(function(t){return CC[t]}))}var RC={start:"end",end:"start"};function PC(t){return t.replace(/start|end/g,(function(t){return RC[t]}))}function kC(t){var e=ZA(t);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function DC(t){return hC(pC(t)).left+kC(t).scrollLeft}function LC(t){var e=uC(t),i=e.overflow,n=e.overflowX,s=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+s+n)}function OC(t){return["html","body","#document"].indexOf(KA(t))>=0?t.ownerDocument.body:QA(t)&&LC(t)?t:OC(mC(t))}function NC(t,e){var i;void 0===e&&(e=[]);var n=OC(t),s=n===(null==(i=t.ownerDocument)?void 0:i.body),r=ZA(n),o=s?[r].concat(r.visualViewport||[],LC(n)?n:[]):n,a=e.concat(o);return s?a:a.concat(NC(mC(o)))}function BC(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function zC(t,e,i){return e===OA?BC(function(t,e){var i=ZA(t),n=pC(t),s=i.visualViewport,r=n.clientWidth,o=n.clientHeight,a=0,h=0;if(s){r=s.width,o=s.height;var l=aC();(l||!l&&"fixed"===e)&&(a=s.offsetLeft,h=s.offsetTop)}return{width:r,height:o,x:a+DC(t),y:h}}(t,i)):JA(e)?function(t,e){var i=hC(t,!1,"fixed"===e);return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}(e,i):BC(function(t){var e,i=pC(t),n=kC(t),s=null==(e=t.ownerDocument)?void 0:e.body,r=nC(i.scrollWidth,i.clientWidth,s?s.scrollWidth:0,s?s.clientWidth:0),o=nC(i.scrollHeight,i.clientHeight,s?s.scrollHeight:0,s?s.clientHeight:0),a=-n.scrollLeft+DC(t),h=-n.scrollTop;return"rtl"===uC(s||i).direction&&(a+=nC(i.clientWidth,s?s.clientWidth:0)-r),{width:r,height:o,x:a,y:h}}(pC(t)))}function UC(t,e,i,n){var s="clippingParents"===e?function(t){var e=NC(mC(t)),i=["absolute","fixed"].indexOf(uC(t).position)>=0&&QA(t)?gC(t):t;return JA(i)?e.filter((function(t){return JA(t)&&cC(t,i)&&"body"!==KA(t)})):[]}(t):[].concat(e),r=[].concat(s,[i]),o=r[0],a=r.reduce((function(e,i){var s=zC(t,i,n);return e.top=nC(s.top,e.top),e.right=sC(s.right,e.right),e.bottom=sC(s.bottom,e.bottom),e.left=nC(s.left,e.left),e}),zC(t,o,n));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function FC(t){var e,i=t.reference,n=t.element,s=t.placement,r=s?iC(s):null,o=s?wC(s):null,a=i.x+i.width/2-n.width/2,h=i.y+i.height/2-n.height/2;switch(r){case EA:e={x:a,y:i.y-n.height};break;case AA:e={x:a,y:i.y+i.height};break;case CA:e={x:i.x+i.width,y:h};break;case IA:e={x:i.x-n.width,y:h};break;default:e={x:i.x,y:i.y}}var l=r?vC(r):null;if(null!=l){var c="y"===l?"height":"width";switch(o){case kA:e[l]=e[l]-(i[c]/2-n[c]/2);break;case DA:e[l]=e[l]+(i[c]/2-n[c]/2)}}return e}function GC(t,e){void 0===e&&(e={});var i=e,n=i.placement,s=void 0===n?t.placement:n,r=i.strategy,o=void 0===r?t.strategy:r,a=i.boundary,h=void 0===a?LA:a,l=i.rootBoundary,c=void 0===l?OA:l,u=i.elementContext,d=void 0===u?NA:u,p=i.altBoundary,m=void 0!==p&&p,f=i.padding,g=void 0===f?0:f,v=xC("number"!=typeof g?g:_C(g,PA)),y=d===NA?BA:NA,x=t.rects.popper,_=t.elements[m?y:d],b=UC(JA(_)?_:_.contextElement||pC(t.elements.popper),h,c,o),w=hC(t.elements.reference),M=FC({reference:w,element:x,strategy:"absolute",placement:s}),S=BC(Object.assign({},x,M)),T=d===NA?S:w,E={top:b.top-T.top+v.top,bottom:T.bottom-b.bottom+v.bottom,left:b.left-T.left+v.left,right:T.right-b.right+v.right},A=t.modifiersData.offset;if(d===NA&&A){var C=A[s];Object.keys(E).forEach((function(t){var e=[CA,AA].indexOf(t)>=0?1:-1,i=[EA,AA].indexOf(t)>=0?"y":"x";E[t]+=C[i]*e}))}return E}const HC={name:"flip",enabled:!0,phase:"main",fn:function(t){var e=t.state,i=t.options,n=t.name;if(!e.modifiersData[n]._skip){for(var s=i.mainAxis,r=void 0===s||s,o=i.altAxis,a=void 0===o||o,h=i.fallbackPlacements,l=i.padding,c=i.boundary,u=i.rootBoundary,d=i.altBoundary,p=i.flipVariations,m=void 0===p||p,f=i.allowedAutoPlacements,g=e.options.placement,v=iC(g),y=h||(v===g||!m?[IC(g)]:function(t){if(iC(t)===RA)return[];var e=IC(t);return[PC(t),e,PC(e)]}(g)),x=[g].concat(y).reduce((function(t,i){return t.concat(iC(i)===RA?function(t,e){void 0===e&&(e={});var i=e,n=i.placement,s=i.boundary,r=i.rootBoundary,o=i.padding,a=i.flipVariations,h=i.allowedAutoPlacements,l=void 0===h?UA:h,c=wC(n),u=c?a?zA:zA.filter((function(t){return wC(t)===c})):PA,d=u.filter((function(t){return l.indexOf(t)>=0}));0===d.length&&(d=u);var p=d.reduce((function(e,i){return e[i]=GC(t,{placement:i,boundary:s,rootBoundary:r,padding:o})[iC(i)],e}),{});return Object.keys(p).sort((function(t,e){return p[t]-p[e]}))}(e,{placement:i,boundary:c,rootBoundary:u,padding:l,flipVariations:m,allowedAutoPlacements:f}):i)}),[]),_=e.rects.reference,b=e.rects.popper,w=new Map,M=!0,S=x[0],T=0;T<x.length;T++){var E=x[T],A=iC(E),C=wC(E)===kA,I=[EA,AA].indexOf(A)>=0,R=I?"width":"height",P=GC(e,{placement:E,boundary:c,rootBoundary:u,altBoundary:d,padding:l}),k=I?C?CA:IA:C?AA:EA;_[R]>b[R]&&(k=IC(k));var D=IC(k),L=[];if(r&&L.push(P[A]<=0),a&&L.push(P[k]<=0,P[D]<=0),L.every((function(t){return t}))){S=E,M=!1;break}w.set(E,L)}if(M)for(var O=function(t){var e=x.find((function(e){var i=w.get(e);if(i)return i.slice(0,t).every((function(t){return t}))}));if(e)return S=e,"break"},N=m?3:1;N>0;N--){if("break"===O(N))break}e.placement!==S&&(e.modifiersData[n]._skip=!0,e.placement=S,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function VC(t,e,i){return void 0===i&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function jC(t){return[EA,CA,AA,IA].some((function(e){return t[e]>=0}))}const WC={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(t){var e=t.state,i=t.name,n=e.rects.reference,s=e.rects.popper,r=e.modifiersData.preventOverflow,o=GC(e,{elementContext:"reference"}),a=GC(e,{altBoundary:!0}),h=VC(o,n),l=VC(a,s,r),c=jC(h),u=jC(l);e.modifiersData[i]={referenceClippingOffsets:h,popperEscapeOffsets:l,isReferenceHidden:c,hasPopperEscaped:u},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":u})}};const XC={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(t){var e=t.state,i=t.options,n=t.name,s=i.offset,r=void 0===s?[0,0]:s,o=UA.reduce((function(t,i){return t[i]=function(t,e,i){var n=iC(t),s=[IA,EA].indexOf(n)>=0?-1:1,r="function"==typeof i?i(Object.assign({},e,{placement:t})):i,o=r[0],a=r[1];return o=o||0,a=(a||0)*s,[IA,CA].indexOf(n)>=0?{x:a,y:o}:{x:o,y:a}}(i,e.rects,r),t}),{}),a=o[e.placement],h=a.x,l=a.y;null!=e.modifiersData.popperOffsets&&(e.modifiersData.popperOffsets.x+=h,e.modifiersData.popperOffsets.y+=l),e.modifiersData[n]=o}};const $C={name:"popperOffsets",enabled:!0,phase:"read",fn:function(t){var e=t.state,i=t.name;e.modifiersData[i]=FC({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}};const qC={name:"preventOverflow",enabled:!0,phase:"main",fn:function(t){var e=t.state,i=t.options,n=t.name,s=i.mainAxis,r=void 0===s||s,o=i.altAxis,a=void 0!==o&&o,h=i.boundary,l=i.rootBoundary,c=i.altBoundary,u=i.padding,d=i.tether,p=void 0===d||d,m=i.tetherOffset,f=void 0===m?0:m,g=GC(e,{boundary:h,rootBoundary:l,padding:u,altBoundary:c}),v=iC(e.placement),y=wC(e.placement),x=!y,_=vC(v),b="x"===_?"y":"x",w=e.modifiersData.popperOffsets,M=e.rects.reference,S=e.rects.popper,T="function"==typeof f?f(Object.assign({},e.rects,{placement:e.placement})):f,E="number"==typeof T?{mainAxis:T,altAxis:T}:Object.assign({mainAxis:0,altAxis:0},T),A=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,C={x:0,y:0};if(w){if(r){var I,R="y"===_?EA:IA,P="y"===_?AA:CA,k="y"===_?"height":"width",D=w[_],L=D+g[R],O=D-g[P],N=p?-S[k]/2:0,B=y===kA?M[k]:S[k],z=y===kA?-S[k]:-M[k],U=e.elements.arrow,F=p&&U?lC(U):{width:0,height:0},G=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},H=G[R],V=G[P],j=yC(0,M[k],F[k]),W=x?M[k]/2-N-j-H-E.mainAxis:B-j-H-E.mainAxis,X=x?-M[k]/2+N+j+V+E.mainAxis:z+j+V+E.mainAxis,$=e.elements.arrow&&gC(e.elements.arrow),q=$?"y"===_?$.clientTop||0:$.clientLeft||0:0,Y=null!=(I=null==A?void 0:A[_])?I:0,K=D+X-Y,Z=yC(p?sC(L,D+W-Y-q):L,D,p?nC(O,K):O);w[_]=Z,C[_]=Z-D}if(a){var J,Q="x"===_?EA:IA,tt="x"===_?AA:CA,et=w[b],it="y"===b?"height":"width",nt=et+g[Q],st=et-g[tt],rt=-1!==[EA,IA].indexOf(v),ot=null!=(J=null==A?void 0:A[b])?J:0,at=rt?nt:et-M[it]-S[it]-ot+E.altAxis,ht=rt?et+M[it]+S[it]-ot-E.altAxis:st,lt=p&&rt?function(t,e,i){var n=yC(t,e,i);return n>i?i:n}(at,et,ht):yC(p?at:nt,et,p?ht:st);w[b]=lt,C[b]=lt-et}e.modifiersData[n]=C}},requiresIfExists:["offset"]};function YC(t,e,i){void 0===i&&(i=!1);var n,s,r=QA(e),o=QA(e)&&function(t){var e=t.getBoundingClientRect(),i=rC(e.width)/t.offsetWidth||1,n=rC(e.height)/t.offsetHeight||1;return 1!==i||1!==n}(e),a=pC(e),h=hC(t,o,i),l={scrollLeft:0,scrollTop:0},c={x:0,y:0};return(r||!r&&!i)&&(("body"!==KA(e)||LC(a))&&(l=(n=e)!==ZA(n)&&QA(n)?{scrollLeft:(s=n).scrollLeft,scrollTop:s.scrollTop}:kC(n)),QA(e)?((c=hC(e,!0)).x+=e.clientLeft,c.y+=e.clientTop):a&&(c.x=DC(a))),{x:h.left+l.scrollLeft-c.x,y:h.top+l.scrollTop-c.y,width:h.width,height:h.height}}function KC(t){var e=new Map,i=new Set,n=[];function s(t){i.add(t.name),[].concat(t.requires||[],t.requiresIfExists||[]).forEach((function(t){if(!i.has(t)){var n=e.get(t);n&&s(n)}})),n.push(t)}return t.forEach((function(t){e.set(t.name,t)})),t.forEach((function(t){i.has(t.name)||s(t)})),n}function ZC(t){var e;return function(){return e||(e=new Promise((function(i){Promise.resolve().then((function(){e=void 0,i(t())}))}))),e}}var JC={placement:"bottom",modifiers:[],strategy:"absolute"};function QC(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some((function(t){return!(t&&"function"==typeof t.getBoundingClientRect)}))}function tI(t){void 0===t&&(t={});var e=t,i=e.defaultModifiers,n=void 0===i?[]:i,s=e.defaultOptions,r=void 0===s?JC:s;return function(t,e,i){void 0===i&&(i=r);var s={placement:"bottom",orderedModifiers:[],options:Object.assign({},JC,r),modifiersData:{},elements:{reference:t,popper:e},attributes:{},styles:{}},o=[],a=!1,h={state:s,setOptions:function(i){var a="function"==typeof i?i(s.options):i;l(),s.options=Object.assign({},r,s.options,a),s.scrollParents={reference:JA(t)?NC(t):t.contextElement?NC(t.contextElement):[],popper:NC(e)};var c,u,d=function(t){var e=KC(t);return YA.reduce((function(t,i){return t.concat(e.filter((function(t){return t.phase===i})))}),[])}((c=[].concat(n,s.options.modifiers),u=c.reduce((function(t,e){var i=t[e.name];return t[e.name]=i?Object.assign({},i,e,{options:Object.assign({},i.options,e.options),data:Object.assign({},i.data,e.data)}):e,t}),{}),Object.keys(u).map((function(t){return u[t]}))));return s.orderedModifiers=d.filter((function(t){return t.enabled})),s.orderedModifiers.forEach((function(t){var e=t.name,i=t.options,n=void 0===i?{}:i,r=t.effect;if("function"==typeof r){var a=r({state:s,name:e,instance:h,options:n}),l=function(){};o.push(a||l)}})),h.update()},forceUpdate:function(){if(!a){var t=s.elements,e=t.reference,i=t.popper;if(QC(e,i)){s.rects={reference:YC(e,gC(i),"fixed"===s.options.strategy),popper:lC(i)},s.reset=!1,s.placement=s.options.placement,s.orderedModifiers.forEach((function(t){return s.modifiersData[t.name]=Object.assign({},t.data)}));for(var n=0;n<s.orderedModifiers.length;n++)if(!0!==s.reset){var r=s.orderedModifiers[n],o=r.fn,l=r.options,c=void 0===l?{}:l,u=r.name;"function"==typeof o&&(s=o({state:s,options:c,name:u,instance:h})||s)}else s.reset=!1,n=-1}}},update:ZC((function(){return new Promise((function(t){h.forceUpdate(),t(s)}))})),destroy:function(){l(),a=!0}};if(!QC(t,e))return h;function l(){o.forEach((function(t){return t()})),o=[]}return h.setOptions(i).then((function(t){!a&&i.onFirstUpdate&&i.onFirstUpdate(t)})),h}}var eI=tI(),iI=tI({defaultModifiers:[AC,$C,TC,eC,XC,HC,qC,bC,WC]}),nI=tI({defaultModifiers:[AC,$C,TC,eC]});const sI=new Map,rI={set(t,e,i){sI.has(t)||sI.set(t,new Map);const n=sI.get(t);(n.has(e)||0===n.size)&&n.set(e,i)},get:(t,e)=>sI.has(t)&&sI.get(t).get(e)||null,remove(t,e){if(!sI.has(t))return;const i=sI.get(t);i.delete(e),0===i.size&&sI.delete(t)}},oI="transitionend",aI=t=>(t&&window.CSS&&window.CSS.escape&&(t=t.replace(/#([^\s"#']+)/g,((t,e)=>`#${CSS.escape(e)}`))),t),hI=t=>{t.dispatchEvent(new Event(oI))},lI=t=>!(!t||"object"!=typeof t)&&(void 0!==t.jquery&&(t=t[0]),void 0!==t.nodeType),cI=t=>lI(t)?t.jquery?t[0]:t:"string"==typeof t&&t.length>0?document.querySelector(aI(t)):null,uI=t=>{if(!lI(t)||0===t.getClientRects().length)return!1;const e="visible"===getComputedStyle(t).getPropertyValue("visibility"),i=t.closest("details:not([open])");if(!i)return e;if(i!==t){const e=t.closest("summary");if(e&&e.parentNode!==i)return!1;if(null===e)return!1}return e},dI=t=>!t||t.nodeType!==Node.ELEMENT_NODE||(!!t.classList.contains("disabled")||(void 0!==t.disabled?t.disabled:t.hasAttribute("disabled")&&"false"!==t.getAttribute("disabled"))),pI=t=>{if(!document.documentElement.attachShadow)return null;if("function"==typeof t.getRootNode){const e=t.getRootNode();return e instanceof ShadowRoot?e:null}return t instanceof ShadowRoot?t:t.parentNode?pI(t.parentNode):null},mI=()=>{},fI=t=>{t.offsetHeight},gI=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,vI=[],yI=()=>"rtl"===document.documentElement.dir,xI=t=>{var e;e=()=>{const e=gI();if(e){const i=t.NAME,n=e.fn[i];e.fn[i]=t.jQueryInterface,e.fn[i].Constructor=t,e.fn[i].noConflict=()=>(e.fn[i]=n,t.jQueryInterface)}},"loading"===document.readyState?(vI.length||document.addEventListener("DOMContentLoaded",(()=>{for(const t of vI)t()})),vI.push(e)):e()},_I=(t,e=[],i=t)=>"function"==typeof t?t(...e):i,bI=(t,e,i=!0)=>{if(!i)return void _I(t);const n=(t=>{if(!t)return 0;let{transitionDuration:e,transitionDelay:i}=window.getComputedStyle(t);const n=Number.parseFloat(e),s=Number.parseFloat(i);return n||s?(e=e.split(",")[0],i=i.split(",")[0],1e3*(Number.parseFloat(e)+Number.parseFloat(i))):0})(e)+5;let s=!1;const r=({target:i})=>{i===e&&(s=!0,e.removeEventListener(oI,r),_I(t))};e.addEventListener(oI,r),setTimeout((()=>{s||hI(e)}),n)},wI=(t,e,i,n)=>{const s=t.length;let r=t.indexOf(e);return-1===r?!i&&n?t[s-1]:t[0]:(r+=i?1:-1,n&&(r=(r+s)%s),t[Math.max(0,Math.min(r,s-1))])},MI=/[^.]*(?=\..*)\.|.*/,SI=/\..*/,TI=/::\d+$/,EI={};let AI=1;const CI={mouseenter:"mouseover",mouseleave:"mouseout"},II=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function RI(t,e){return e&&`${e}::${AI++}`||t.uidEvent||AI++}function PI(t){const e=RI(t);return t.uidEvent=e,EI[e]=EI[e]||{},EI[e]}function kI(t,e,i=null){return Object.values(t).find((t=>t.callable===e&&t.delegationSelector===i))}function DI(t,e,i){const n="string"==typeof e,s=n?i:e||i;let r=BI(t);return II.has(r)||(r=t),[n,s,r]}function LI(t,e,i,n,s){if("string"!=typeof e||!t)return;let[r,o,a]=DI(e,i,n);if(e in CI){const t=t=>function(e){if(!e.relatedTarget||e.relatedTarget!==e.delegateTarget&&!e.delegateTarget.contains(e.relatedTarget))return t.call(this,e)};o=t(o)}const h=PI(t),l=h[a]||(h[a]={}),c=kI(l,o,r?i:null);if(c)return void(c.oneOff=c.oneOff&&s);const u=RI(o,e.replace(MI,"")),d=r?function(t,e,i){return function n(s){const r=t.querySelectorAll(e);for(let{target:o}=s;o&&o!==this;o=o.parentNode)for(const a of r)if(a===o)return UI(s,{delegateTarget:o}),n.oneOff&&zI.off(t,s.type,e,i),i.apply(o,[s])}}(t,i,o):function(t,e){return function i(n){return UI(n,{delegateTarget:t}),i.oneOff&&zI.off(t,n.type,e),e.apply(t,[n])}}(t,o);d.delegationSelector=r?i:null,d.callable=o,d.oneOff=s,d.uidEvent=u,l[u]=d,t.addEventListener(a,d,r)}function OI(t,e,i,n,s){const r=kI(e[i],n,s);r&&(t.removeEventListener(i,r,Boolean(s)),delete e[i][r.uidEvent])}function NI(t,e,i,n){const s=e[i]||{};for(const[r,o]of Object.entries(s))r.includes(n)&&OI(t,e,i,o.callable,o.delegationSelector)}function BI(t){return t=t.replace(SI,""),CI[t]||t}const zI={on(t,e,i,n){LI(t,e,i,n,!1)},one(t,e,i,n){LI(t,e,i,n,!0)},off(t,e,i,n){if("string"!=typeof e||!t)return;const[s,r,o]=DI(e,i,n),a=o!==e,h=PI(t),l=h[o]||{},c=e.startsWith(".");if(void 0===r){if(c)for(const i of Object.keys(h))NI(t,h,i,e.slice(1));for(const[i,n]of Object.entries(l)){const s=i.replace(TI,"");a&&!e.includes(s)||OI(t,h,o,n.callable,n.delegationSelector)}}else{if(!Object.keys(l).length)return;OI(t,h,o,r,s?i:null)}},trigger(t,e,i){if("string"!=typeof e||!t)return null;const n=gI();let s=null,r=!0,o=!0,a=!1;e!==BI(e)&&n&&(s=n.Event(e,i),n(t).trigger(s),r=!s.isPropagationStopped(),o=!s.isImmediatePropagationStopped(),a=s.isDefaultPrevented());const h=UI(new Event(e,{bubbles:r,cancelable:!0}),i);return a&&h.preventDefault(),o&&t.dispatchEvent(h),h.defaultPrevented&&s&&s.preventDefault(),h}};function UI(t,e={}){for(const[i,n]of Object.entries(e))try{t[i]=n}catch(e){Object.defineProperty(t,i,{configurable:!0,get:()=>n})}return t}function FI(t){if("true"===t)return!0;if("false"===t)return!1;if(t===Number(t).toString())return Number(t);if(""===t||"null"===t)return null;if("string"!=typeof t)return t;try{return JSON.parse(decodeURIComponent(t))}catch(e){return t}}function GI(t){return t.replace(/[A-Z]/g,(t=>`-${t.toLowerCase()}`))}const HI={setDataAttribute(t,e,i){t.setAttribute(`data-bs-${GI(e)}`,i)},removeDataAttribute(t,e){t.removeAttribute(`data-bs-${GI(e)}`)},getDataAttributes(t){if(!t)return{};const e={},i=Object.keys(t.dataset).filter((t=>t.startsWith("bs")&&!t.startsWith("bsConfig")));for(const n of i){let i=n.replace(/^bs/,"");i=i.charAt(0).toLowerCase()+i.slice(1,i.length),e[i]=FI(t.dataset[n])}return e},getDataAttribute:(t,e)=>FI(t.getAttribute(`data-bs-${GI(e)}`))};class VI{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(t){return t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t}_mergeConfigObj(t,e){const i=lI(e)?HI.getDataAttribute(e,"config"):{};return{...this.constructor.Default,..."object"==typeof i?i:{},...lI(e)?HI.getDataAttributes(e):{},..."object"==typeof t?t:{}}}_typeCheckConfig(t,e=this.constructor.DefaultType){for(const[n,s]of Object.entries(e)){const e=t[n],r=lI(e)?"element":null==(i=e)?`${i}`:Object.prototype.toString.call(i).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(s).test(r))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${n}" provided type "${r}" but expected type "${s}".`)}var i}}class jI extends VI{constructor(t,e){super(),(t=cI(t))&&(this._element=t,this._config=this._getConfig(e),rI.set(this._element,this.constructor.DATA_KEY,this))}dispose(){rI.remove(this._element,this.constructor.DATA_KEY),zI.off(this._element,this.constructor.EVENT_KEY);for(const t of Object.getOwnPropertyNames(this))this[t]=null}_queueCallback(t,e,i=!0){bI(t,e,i)}_getConfig(t){return t=this._mergeConfigObj(t,this._element),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}static getInstance(t){return rI.get(cI(t),this.DATA_KEY)}static getOrCreateInstance(t,e={}){return this.getInstance(t)||new this(t,"object"==typeof e?e:null)}static get VERSION(){return"5.3.2"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(t){return`${t}${this.EVENT_KEY}`}}const WI=t=>{let e=t.getAttribute("data-bs-target");if(!e||"#"===e){let i=t.getAttribute("href");if(!i||!i.includes("#")&&!i.startsWith("."))return null;i.includes("#")&&!i.startsWith("#")&&(i=`#${i.split("#")[1]}`),e=i&&"#"!==i?aI(i.trim()):null}return e},XI={find:(t,e=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(e,t)),findOne:(t,e=document.documentElement)=>Element.prototype.querySelector.call(e,t),children:(t,e)=>[].concat(...t.children).filter((t=>t.matches(e))),parents(t,e){const i=[];let n=t.parentNode.closest(e);for(;n;)i.push(n),n=n.parentNode.closest(e);return i},prev(t,e){let i=t.previousElementSibling;for(;i;){if(i.matches(e))return[i];i=i.previousElementSibling}return[]},next(t,e){let i=t.nextElementSibling;for(;i;){if(i.matches(e))return[i];i=i.nextElementSibling}return[]},focusableChildren(t){const e=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map((t=>`${t}:not([tabindex^="-"])`)).join(",");return this.find(e,t).filter((t=>!dI(t)&&uI(t)))},getSelectorFromElement(t){const e=WI(t);return e&&XI.findOne(e)?e:null},getElementFromSelector(t){const e=WI(t);return e?XI.findOne(e):null},getMultipleElementsFromSelector(t){const e=WI(t);return e?XI.find(e):[]}},$I=(t,e="hide")=>{const i=`click.dismiss${t.EVENT_KEY}`,n=t.NAME;zI.on(document,i,`[data-bs-dismiss="${n}"]`,(function(i){if(["A","AREA"].includes(this.tagName)&&i.preventDefault(),dI(this))return;const s=XI.getElementFromSelector(this)||this.closest(`.${n}`);t.getOrCreateInstance(s)[e]()}))},qI=".bs.alert",YI=`close${qI}`,KI=`closed${qI}`;class ZI extends jI{static get NAME(){return"alert"}close(){if(zI.trigger(this._element,YI).defaultPrevented)return;this._element.classList.remove("show");const t=this._element.classList.contains("fade");this._queueCallback((()=>this._destroyElement()),this._element,t)}_destroyElement(){this._element.remove(),zI.trigger(this._element,KI),this.dispose()}static jQueryInterface(t){return this.each((function(){const e=ZI.getOrCreateInstance(this);if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t](this)}}))}}$I(ZI,"close"),xI(ZI);const JI='[data-bs-toggle="button"]';class QI extends jI{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(t){return this.each((function(){const e=QI.getOrCreateInstance(this);"toggle"===t&&e[t]()}))}}zI.on(document,"click.bs.button.data-api",JI,(t=>{t.preventDefault();const e=t.target.closest(JI);QI.getOrCreateInstance(e).toggle()})),xI(QI);const tR=".bs.swipe",eR=`touchstart${tR}`,iR=`touchmove${tR}`,nR=`touchend${tR}`,sR=`pointerdown${tR}`,rR=`pointerup${tR}`,oR={endCallback:null,leftCallback:null,rightCallback:null},aR={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class hR extends VI{constructor(t,e){super(),this._element=t,t&&hR.isSupported()&&(this._config=this._getConfig(e),this._deltaX=0,this._supportPointerEvents=Boolean(window.PointerEvent),this._initEvents())}static get Default(){return oR}static get DefaultType(){return aR}static get NAME(){return"swipe"}dispose(){zI.off(this._element,tR)}_start(t){this._supportPointerEvents?this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX):this._deltaX=t.touches[0].clientX}_end(t){this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX-this._deltaX),this._handleSwipe(),_I(this._config.endCallback)}_move(t){this._deltaX=t.touches&&t.touches.length>1?0:t.touches[0].clientX-this._deltaX}_handleSwipe(){const t=Math.abs(this._deltaX);if(t<=40)return;const e=t/this._deltaX;this._deltaX=0,e&&_I(e>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(zI.on(this._element,sR,(t=>this._start(t))),zI.on(this._element,rR,(t=>this._end(t))),this._element.classList.add("pointer-event")):(zI.on(this._element,eR,(t=>this._start(t))),zI.on(this._element,iR,(t=>this._move(t))),zI.on(this._element,nR,(t=>this._end(t))))}_eventIsPointerPenTouch(t){return this._supportPointerEvents&&("pen"===t.pointerType||"touch"===t.pointerType)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const lR=".bs.carousel",cR=".data-api",uR="next",dR="prev",pR="left",mR="right",fR=`slide${lR}`,gR=`slid${lR}`,vR=`keydown${lR}`,yR=`mouseenter${lR}`,xR=`mouseleave${lR}`,_R=`dragstart${lR}`,bR=`load${lR}${cR}`,wR=`click${lR}${cR}`,MR="carousel",SR="active",TR=".active",ER=".carousel-item",AR=TR+ER,CR={ArrowLeft:mR,ArrowRight:pR},IR={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},RR={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class PR extends jI{constructor(t,e){super(t,e),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=XI.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===MR&&this.cycle()}static get Default(){return IR}static get DefaultType(){return RR}static get NAME(){return"carousel"}next(){this._slide(uR)}nextWhenVisible(){!document.hidden&&uI(this._element)&&this.next()}prev(){this._slide(dR)}pause(){this._isSliding&&hI(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval((()=>this.nextWhenVisible()),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?zI.one(this._element,gR,(()=>this.cycle())):this.cycle())}to(t){const e=this._getItems();if(t>e.length-1||t<0)return;if(this._isSliding)return void zI.one(this._element,gR,(()=>this.to(t)));const i=this._getItemIndex(this._getActive());if(i===t)return;const n=t>i?uR:dR;this._slide(n,e[t])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(t){return t.defaultInterval=t.interval,t}_addEventListeners(){this._config.keyboard&&zI.on(this._element,vR,(t=>this._keydown(t))),"hover"===this._config.pause&&(zI.on(this._element,yR,(()=>this.pause())),zI.on(this._element,xR,(()=>this._maybeEnableCycle()))),this._config.touch&&hR.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const t of XI.find(".carousel-item img",this._element))zI.on(t,_R,(t=>t.preventDefault()));const t={leftCallback:()=>this._slide(this._directionToOrder(pR)),rightCallback:()=>this._slide(this._directionToOrder(mR)),endCallback:()=>{"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout((()=>this._maybeEnableCycle()),500+this._config.interval))}};this._swipeHelper=new hR(this._element,t)}_keydown(t){if(/input|textarea/i.test(t.target.tagName))return;const e=CR[t.key];e&&(t.preventDefault(),this._slide(this._directionToOrder(e)))}_getItemIndex(t){return this._getItems().indexOf(t)}_setActiveIndicatorElement(t){if(!this._indicatorsElement)return;const e=XI.findOne(TR,this._indicatorsElement);e.classList.remove(SR),e.removeAttribute("aria-current");const i=XI.findOne(`[data-bs-slide-to="${t}"]`,this._indicatorsElement);i&&(i.classList.add(SR),i.setAttribute("aria-current","true"))}_updateInterval(){const t=this._activeElement||this._getActive();if(!t)return;const e=Number.parseInt(t.getAttribute("data-bs-interval"),10);this._config.interval=e||this._config.defaultInterval}_slide(t,e=null){if(this._isSliding)return;const i=this._getActive(),n=t===uR,s=e||wI(this._getItems(),i,n,this._config.wrap);if(s===i)return;const r=this._getItemIndex(s),o=e=>zI.trigger(this._element,e,{relatedTarget:s,direction:this._orderToDirection(t),from:this._getItemIndex(i),to:r});if(o(fR).defaultPrevented)return;if(!i||!s)return;const a=Boolean(this._interval);this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(r),this._activeElement=s;const h=n?"carousel-item-start":"carousel-item-end",l=n?"carousel-item-next":"carousel-item-prev";s.classList.add(l),fI(s),i.classList.add(h),s.classList.add(h);this._queueCallback((()=>{s.classList.remove(h,l),s.classList.add(SR),i.classList.remove(SR,l,h),this._isSliding=!1,o(gR)}),i,this._isAnimated()),a&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return XI.findOne(AR,this._element)}_getItems(){return XI.find(ER,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(t){return yI()?t===pR?dR:uR:t===pR?uR:dR}_orderToDirection(t){return yI()?t===dR?pR:mR:t===dR?mR:pR}static jQueryInterface(t){return this.each((function(){const e=PR.getOrCreateInstance(this,t);if("number"!=typeof t){if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t]()}}else e.to(t)}))}}zI.on(document,wR,"[data-bs-slide], [data-bs-slide-to]",(function(t){const e=XI.getElementFromSelector(this);if(!e||!e.classList.contains(MR))return;t.preventDefault();const i=PR.getOrCreateInstance(e),n=this.getAttribute("data-bs-slide-to");return n?(i.to(n),void i._maybeEnableCycle()):"next"===HI.getDataAttribute(this,"slide")?(i.next(),void i._maybeEnableCycle()):(i.prev(),void i._maybeEnableCycle())})),zI.on(window,bR,(()=>{const t=XI.find('[data-bs-ride="carousel"]');for(const e of t)PR.getOrCreateInstance(e)})),xI(PR);const kR=".bs.collapse",DR=`show${kR}`,LR=`shown${kR}`,OR=`hide${kR}`,NR=`hidden${kR}`,BR=`click${kR}.data-api`,zR="show",UR="collapse",FR="collapsing",GR=`:scope .${UR} .${UR}`,HR='[data-bs-toggle="collapse"]',VR={parent:null,toggle:!0},jR={parent:"(null|element)",toggle:"boolean"};class WR extends jI{constructor(t,e){super(t,e),this._isTransitioning=!1,this._triggerArray=[];const i=XI.find(HR);for(const t of i){const e=XI.getSelectorFromElement(t),i=XI.find(e).filter((t=>t===this._element));null!==e&&i.length&&this._triggerArray.push(t)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return VR}static get DefaultType(){return jR}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let t=[];if(this._config.parent&&(t=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter((t=>t!==this._element)).map((t=>WR.getOrCreateInstance(t,{toggle:!1})))),t.length&&t[0]._isTransitioning)return;if(zI.trigger(this._element,DR).defaultPrevented)return;for(const e of t)e.hide();const e=this._getDimension();this._element.classList.remove(UR),this._element.classList.add(FR),this._element.style[e]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const i=`scroll${e[0].toUpperCase()+e.slice(1)}`;this._queueCallback((()=>{this._isTransitioning=!1,this._element.classList.remove(FR),this._element.classList.add(UR,zR),this._element.style[e]="",zI.trigger(this._element,LR)}),this._element,!0),this._element.style[e]=`${this._element[i]}px`}hide(){if(this._isTransitioning||!this._isShown())return;if(zI.trigger(this._element,OR).defaultPrevented)return;const t=this._getDimension();this._element.style[t]=`${this._element.getBoundingClientRect()[t]}px`,fI(this._element),this._element.classList.add(FR),this._element.classList.remove(UR,zR);for(const t of this._triggerArray){const e=XI.getElementFromSelector(t);e&&!this._isShown(e)&&this._addAriaAndCollapsedClass([t],!1)}this._isTransitioning=!0;this._element.style[t]="",this._queueCallback((()=>{this._isTransitioning=!1,this._element.classList.remove(FR),this._element.classList.add(UR),zI.trigger(this._element,NR)}),this._element,!0)}_isShown(t=this._element){return t.classList.contains(zR)}_configAfterMerge(t){return t.toggle=Boolean(t.toggle),t.parent=cI(t.parent),t}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const t=this._getFirstLevelChildren(HR);for(const e of t){const t=XI.getElementFromSelector(e);t&&this._addAriaAndCollapsedClass([e],this._isShown(t))}}_getFirstLevelChildren(t){const e=XI.find(GR,this._config.parent);return XI.find(t,this._config.parent).filter((t=>!e.includes(t)))}_addAriaAndCollapsedClass(t,e){if(t.length)for(const i of t)i.classList.toggle("collapsed",!e),i.setAttribute("aria-expanded",e)}static jQueryInterface(t){const e={};return"string"==typeof t&&/show|hide/.test(t)&&(e.toggle=!1),this.each((function(){const i=WR.getOrCreateInstance(this,e);if("string"==typeof t){if(void 0===i[t])throw new TypeError(`No method named "${t}"`);i[t]()}}))}}zI.on(document,BR,HR,(function(t){("A"===t.target.tagName||t.delegateTarget&&"A"===t.delegateTarget.tagName)&&t.preventDefault();for(const t of XI.getMultipleElementsFromSelector(this))WR.getOrCreateInstance(t,{toggle:!1}).toggle()})),xI(WR);const XR="dropdown",$R=".bs.dropdown",qR=".data-api",YR="ArrowUp",KR="ArrowDown",ZR=`hide${$R}`,JR=`hidden${$R}`,QR=`show${$R}`,tP=`shown${$R}`,eP=`click${$R}${qR}`,iP=`keydown${$R}${qR}`,nP=`keyup${$R}${qR}`,sP="show",rP='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',oP=`${rP}.${sP}`,aP=".dropdown-menu",hP=yI()?"top-end":"top-start",lP=yI()?"top-start":"top-end",cP=yI()?"bottom-end":"bottom-start",uP=yI()?"bottom-start":"bottom-end",dP=yI()?"left-start":"right-start",pP=yI()?"right-start":"left-start",mP={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},fP={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class gP extends jI{constructor(t,e){super(t,e),this._popper=null,this._parent=this._element.parentNode,this._menu=XI.next(this._element,aP)[0]||XI.prev(this._element,aP)[0]||XI.findOne(aP,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return mP}static get DefaultType(){return fP}static get NAME(){return XR}toggle(){return this._isShown()?this.hide():this.show()}show(){if(dI(this._element)||this._isShown())return;const t={relatedTarget:this._element};if(!zI.trigger(this._element,QR,t).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const t of[].concat(...document.body.children))zI.on(t,"mouseover",mI);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(sP),this._element.classList.add(sP),zI.trigger(this._element,tP,t)}}hide(){if(dI(this._element)||!this._isShown())return;const t={relatedTarget:this._element};this._completeHide(t)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(t){if(!zI.trigger(this._element,ZR,t).defaultPrevented){if("ontouchstart"in document.documentElement)for(const t of[].concat(...document.body.children))zI.off(t,"mouseover",mI);this._popper&&this._popper.destroy(),this._menu.classList.remove(sP),this._element.classList.remove(sP),this._element.setAttribute("aria-expanded","false"),HI.removeDataAttribute(this._menu,"popper"),zI.trigger(this._element,JR,t)}}_getConfig(t){if("object"==typeof(t=super._getConfig(t)).reference&&!lI(t.reference)&&"function"!=typeof t.reference.getBoundingClientRect)throw new TypeError(`${XR.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return t}_createPopper(){if(void 0===t)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let e=this._element;"parent"===this._config.reference?e=this._parent:lI(this._config.reference)?e=cI(this._config.reference):"object"==typeof this._config.reference&&(e=this._config.reference);const i=this._getPopperConfig();this._popper=iI(e,this._menu,i)}_isShown(){return this._menu.classList.contains(sP)}_getPlacement(){const t=this._parent;if(t.classList.contains("dropend"))return dP;if(t.classList.contains("dropstart"))return pP;if(t.classList.contains("dropup-center"))return"top";if(t.classList.contains("dropdown-center"))return"bottom";const e="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return t.classList.contains("dropup")?e?lP:hP:e?uP:cP}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){const{offset:t}=this._config;return"string"==typeof t?t.split(",").map((t=>Number.parseInt(t,10))):"function"==typeof t?e=>t(e,this._element):t}_getPopperConfig(){const t={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||"static"===this._config.display)&&(HI.setDataAttribute(this._menu,"popper","static"),t.modifiers=[{name:"applyStyles",enabled:!1}]),{...t,..._I(this._config.popperConfig,[t])}}_selectMenuItem({key:t,target:e}){const i=XI.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter((t=>uI(t)));i.length&&wI(i,e,t===KR,!i.includes(e)).focus()}static jQueryInterface(t){return this.each((function(){const e=gP.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t]()}}))}static clearMenus(t){if(2===t.button||"keyup"===t.type&&"Tab"!==t.key)return;const e=XI.find(oP);for(const i of e){const e=gP.getInstance(i);if(!e||!1===e._config.autoClose)continue;const n=t.composedPath(),s=n.includes(e._menu);if(n.includes(e._element)||"inside"===e._config.autoClose&&!s||"outside"===e._config.autoClose&&s)continue;if(e._menu.contains(t.target)&&("keyup"===t.type&&"Tab"===t.key||/input|select|option|textarea|form/i.test(t.target.tagName)))continue;const r={relatedTarget:e._element};"click"===t.type&&(r.clickEvent=t),e._completeHide(r)}}static dataApiKeydownHandler(t){const e=/input|textarea/i.test(t.target.tagName),i="Escape"===t.key,n=[YR,KR].includes(t.key);if(!n&&!i)return;if(e&&!i)return;t.preventDefault();const s=this.matches(rP)?this:XI.prev(this,rP)[0]||XI.next(this,rP)[0]||XI.findOne(rP,t.delegateTarget.parentNode),r=gP.getOrCreateInstance(s);if(n)return t.stopPropagation(),r.show(),void r._selectMenuItem(t);r._isShown()&&(t.stopPropagation(),r.hide(),s.focus())}}zI.on(document,iP,rP,gP.dataApiKeydownHandler),zI.on(document,iP,aP,gP.dataApiKeydownHandler),zI.on(document,eP,gP.clearMenus),zI.on(document,nP,gP.clearMenus),zI.on(document,eP,rP,(function(t){t.preventDefault(),gP.getOrCreateInstance(this).toggle()})),xI(gP);const vP="backdrop",yP="show",xP=`mousedown.bs.${vP}`,_P={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},bP={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class wP extends VI{constructor(t){super(),this._config=this._getConfig(t),this._isAppended=!1,this._element=null}static get Default(){return _P}static get DefaultType(){return bP}static get NAME(){return vP}show(t){if(!this._config.isVisible)return void _I(t);this._append();const e=this._getElement();this._config.isAnimated&&fI(e),e.classList.add(yP),this._emulateAnimation((()=>{_I(t)}))}hide(t){this._config.isVisible?(this._getElement().classList.remove(yP),this._emulateAnimation((()=>{this.dispose(),_I(t)}))):_I(t)}dispose(){this._isAppended&&(zI.off(this._element,xP),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const t=document.createElement("div");t.className=this._config.className,this._config.isAnimated&&t.classList.add("fade"),this._element=t}return this._element}_configAfterMerge(t){return t.rootElement=cI(t.rootElement),t}_append(){if(this._isAppended)return;const t=this._getElement();this._config.rootElement.append(t),zI.on(t,xP,(()=>{_I(this._config.clickCallback)})),this._isAppended=!0}_emulateAnimation(t){bI(t,this._getElement(),this._config.isAnimated)}}const MP=".bs.focustrap",SP=`focusin${MP}`,TP=`keydown.tab${MP}`,EP="backward",AP={autofocus:!0,trapElement:null},CP={autofocus:"boolean",trapElement:"element"};class IP extends VI{constructor(t){super(),this._config=this._getConfig(t),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return AP}static get DefaultType(){return CP}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),zI.off(document,MP),zI.on(document,SP,(t=>this._handleFocusin(t))),zI.on(document,TP,(t=>this._handleKeydown(t))),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,zI.off(document,MP))}_handleFocusin(t){const{trapElement:e}=this._config;if(t.target===document||t.target===e||e.contains(t.target))return;const i=XI.focusableChildren(e);0===i.length?e.focus():this._lastTabNavDirection===EP?i[i.length-1].focus():i[0].focus()}_handleKeydown(t){"Tab"===t.key&&(this._lastTabNavDirection=t.shiftKey?EP:"forward")}}const RP=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",PP=".sticky-top",kP="padding-right",DP="margin-right";class LP{constructor(){this._element=document.body}getWidth(){const t=document.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}hide(){const t=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,kP,(e=>e+t)),this._setElementAttributes(RP,kP,(e=>e+t)),this._setElementAttributes(PP,DP,(e=>e-t))}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,kP),this._resetElementAttributes(RP,kP),this._resetElementAttributes(PP,DP)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(t,e,i){const n=this.getWidth();this._applyManipulationCallback(t,(t=>{if(t!==this._element&&window.innerWidth>t.clientWidth+n)return;this._saveInitialAttribute(t,e);const s=window.getComputedStyle(t).getPropertyValue(e);t.style.setProperty(e,`${i(Number.parseFloat(s))}px`)}))}_saveInitialAttribute(t,e){const i=t.style.getPropertyValue(e);i&&HI.setDataAttribute(t,e,i)}_resetElementAttributes(t,e){this._applyManipulationCallback(t,(t=>{const i=HI.getDataAttribute(t,e);null!==i?(HI.removeDataAttribute(t,e),t.style.setProperty(e,i)):t.style.removeProperty(e)}))}_applyManipulationCallback(t,e){if(lI(t))e(t);else for(const i of XI.find(t,this._element))e(i)}}const OP=".bs.modal",NP=`hide${OP}`,BP=`hidePrevented${OP}`,zP=`hidden${OP}`,UP=`show${OP}`,FP=`shown${OP}`,GP=`resize${OP}`,HP=`click.dismiss${OP}`,VP=`mousedown.dismiss${OP}`,jP=`keydown.dismiss${OP}`,WP=`click${OP}.data-api`,XP="modal-open",$P="show",qP="modal-static",YP={backdrop:!0,focus:!0,keyboard:!0},KP={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class ZP extends jI{constructor(t,e){super(t,e),this._dialog=XI.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new LP,this._addEventListeners()}static get Default(){return YP}static get DefaultType(){return KP}static get NAME(){return"modal"}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){if(this._isShown||this._isTransitioning)return;zI.trigger(this._element,UP,{relatedTarget:t}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(XP),this._adjustDialog(),this._backdrop.show((()=>this._showElement(t))))}hide(){if(!this._isShown||this._isTransitioning)return;zI.trigger(this._element,NP).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove($P),this._queueCallback((()=>this._hideModal()),this._element,this._isAnimated()))}dispose(){zI.off(window,OP),zI.off(this._dialog,OP),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new wP({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new IP({trapElement:this._element})}_showElement(t){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const e=XI.findOne(".modal-body",this._dialog);e&&(e.scrollTop=0),fI(this._element),this._element.classList.add($P);this._queueCallback((()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,zI.trigger(this._element,FP,{relatedTarget:t})}),this._dialog,this._isAnimated())}_addEventListeners(){zI.on(this._element,jP,(t=>{"Escape"===t.key&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())})),zI.on(window,GP,(()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()})),zI.on(this._element,VP,(t=>{zI.one(this._element,HP,(e=>{this._element===t.target&&this._element===e.target&&("static"!==this._config.backdrop?this._config.backdrop&&this.hide():this._triggerBackdropTransition())}))}))}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide((()=>{document.body.classList.remove(XP),this._resetAdjustments(),this._scrollBar.reset(),zI.trigger(this._element,zP)}))}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(zI.trigger(this._element,BP).defaultPrevented)return;const t=this._element.scrollHeight>document.documentElement.clientHeight,e=this._element.style.overflowY;"hidden"===e||this._element.classList.contains(qP)||(t||(this._element.style.overflowY="hidden"),this._element.classList.add(qP),this._queueCallback((()=>{this._element.classList.remove(qP),this._queueCallback((()=>{this._element.style.overflowY=e}),this._dialog)}),this._dialog),this._element.focus())}_adjustDialog(){const t=this._element.scrollHeight>document.documentElement.clientHeight,e=this._scrollBar.getWidth(),i=e>0;if(i&&!t){const t=yI()?"paddingLeft":"paddingRight";this._element.style[t]=`${e}px`}if(!i&&t){const t=yI()?"paddingRight":"paddingLeft";this._element.style[t]=`${e}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(t,e){return this.each((function(){const i=ZP.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===i[t])throw new TypeError(`No method named "${t}"`);i[t](e)}}))}}zI.on(document,WP,'[data-bs-toggle="modal"]',(function(t){const e=XI.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&t.preventDefault(),zI.one(e,UP,(t=>{t.defaultPrevented||zI.one(e,zP,(()=>{uI(this)&&this.focus()}))}));const i=XI.findOne(".modal.show");i&&ZP.getInstance(i).hide();ZP.getOrCreateInstance(e).toggle(this)})),$I(ZP),xI(ZP);const JP=".bs.offcanvas",QP=".data-api",tk=`load${JP}${QP}`,ek="show",ik="showing",nk="hiding",sk=".offcanvas.show",rk=`show${JP}`,ok=`shown${JP}`,ak=`hide${JP}`,hk=`hidePrevented${JP}`,lk=`hidden${JP}`,ck=`resize${JP}`,uk=`click${JP}${QP}`,dk=`keydown.dismiss${JP}`,pk={backdrop:!0,keyboard:!0,scroll:!1},mk={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class fk extends jI{constructor(t,e){super(t,e),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return pk}static get DefaultType(){return mk}static get NAME(){return"offcanvas"}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){if(this._isShown)return;if(zI.trigger(this._element,rk,{relatedTarget:t}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||(new LP).hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(ik);this._queueCallback((()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(ek),this._element.classList.remove(ik),zI.trigger(this._element,ok,{relatedTarget:t})}),this._element,!0)}hide(){if(!this._isShown)return;if(zI.trigger(this._element,ak).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(nk),this._backdrop.hide();this._queueCallback((()=>{this._element.classList.remove(ek,nk),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||(new LP).reset(),zI.trigger(this._element,lk)}),this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const t=Boolean(this._config.backdrop);return new wP({className:"offcanvas-backdrop",isVisible:t,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:t?()=>{"static"!==this._config.backdrop?this.hide():zI.trigger(this._element,hk)}:null})}_initializeFocusTrap(){return new IP({trapElement:this._element})}_addEventListeners(){zI.on(this._element,dk,(t=>{"Escape"===t.key&&(this._config.keyboard?this.hide():zI.trigger(this._element,hk))}))}static jQueryInterface(t){return this.each((function(){const e=fk.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t](this)}}))}}zI.on(document,uk,'[data-bs-toggle="offcanvas"]',(function(t){const e=XI.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&t.preventDefault(),dI(this))return;zI.one(e,lk,(()=>{uI(this)&&this.focus()}));const i=XI.findOne(sk);i&&i!==e&&fk.getInstance(i).hide();fk.getOrCreateInstance(e).toggle(this)})),zI.on(window,tk,(()=>{for(const t of XI.find(sk))fk.getOrCreateInstance(t).show()})),zI.on(window,ck,(()=>{for(const t of XI.find("[aria-modal][class*=show][class*=offcanvas-]"))"fixed"!==getComputedStyle(t).position&&fk.getOrCreateInstance(t).hide()})),$I(fk),xI(fk);const gk={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],div:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},vk=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),yk=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,xk=(t,e)=>{const i=t.nodeName.toLowerCase();return e.includes(i)?!vk.has(i)||Boolean(yk.test(t.nodeValue)):e.filter((t=>t instanceof RegExp)).some((t=>t.test(i)))};const _k={allowList:gk,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},bk={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},wk={entry:"(string|element|function|null)",selector:"(string|element)"};class Mk extends VI{constructor(t){super(),this._config=this._getConfig(t)}static get Default(){return _k}static get DefaultType(){return bk}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map((t=>this._resolvePossibleFunction(t))).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(t){return this._checkContent(t),this._config.content={...this._config.content,...t},this}toHtml(){const t=document.createElement("div");t.innerHTML=this._maybeSanitize(this._config.template);for(const[e,i]of Object.entries(this._config.content))this._setContent(t,i,e);const e=t.children[0],i=this._resolvePossibleFunction(this._config.extraClass);return i&&e.classList.add(...i.split(" ")),e}_typeCheckConfig(t){super._typeCheckConfig(t),this._checkContent(t.content)}_checkContent(t){for(const[e,i]of Object.entries(t))super._typeCheckConfig({selector:e,entry:i},wk)}_setContent(t,e,i){const n=XI.findOne(i,t);n&&((e=this._resolvePossibleFunction(e))?lI(e)?this._putElementInTemplate(cI(e),n):this._config.html?n.innerHTML=this._maybeSanitize(e):n.textContent=e:n.remove())}_maybeSanitize(t){return this._config.sanitize?function(t,e,i){if(!t.length)return t;if(i&&"function"==typeof i)return i(t);const n=(new window.DOMParser).parseFromString(t,"text/html"),s=[].concat(...n.body.querySelectorAll("*"));for(const t of s){const i=t.nodeName.toLowerCase();if(!Object.keys(e).includes(i)){t.remove();continue}const n=[].concat(...t.attributes),s=[].concat(e["*"]||[],e[i]||[]);for(const e of n)xk(e,s)||t.removeAttribute(e.nodeName)}return n.body.innerHTML}(t,this._config.allowList,this._config.sanitizeFn):t}_resolvePossibleFunction(t){return _I(t,[this])}_putElementInTemplate(t,e){if(this._config.html)return e.innerHTML="",void e.append(t);e.textContent=t.textContent}}const Sk=new Set(["sanitize","allowList","sanitizeFn"]),Tk="fade",Ek="show",Ak=".modal",Ck="hide.bs.modal",Ik="hover",Rk="focus",Pk={AUTO:"auto",TOP:"top",RIGHT:yI()?"left":"right",BOTTOM:"bottom",LEFT:yI()?"right":"left"},kk={allowList:gk,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},Dk={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Lk extends jI{constructor(e,i){if(void 0===t)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(e,i),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return kk}static get DefaultType(){return Dk}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),zI.off(this._element.closest(Ak),Ck,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if("none"===this._element.style.display)throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const t=zI.trigger(this._element,this.constructor.eventName("show")),e=(pI(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(t.defaultPrevented||!e)return;this._disposePopper();const i=this._getTipElement();this._element.setAttribute("aria-describedby",i.getAttribute("id"));const{container:n}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(n.append(i),zI.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(i),i.classList.add(Ek),"ontouchstart"in document.documentElement)for(const t of[].concat(...document.body.children))zI.on(t,"mouseover",mI);this._queueCallback((()=>{zI.trigger(this._element,this.constructor.eventName("shown")),!1===this._isHovered&&this._leave(),this._isHovered=!1}),this.tip,this._isAnimated())}hide(){if(!this._isShown())return;if(zI.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented)return;if(this._getTipElement().classList.remove(Ek),"ontouchstart"in document.documentElement)for(const t of[].concat(...document.body.children))zI.off(t,"mouseover",mI);this._activeTrigger.click=!1,this._activeTrigger[Rk]=!1,this._activeTrigger[Ik]=!1,this._isHovered=null;this._queueCallback((()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),zI.trigger(this._element,this.constructor.eventName("hidden")))}),this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return Boolean(this._getTitle())}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(t){const e=this._getTemplateFactory(t).toHtml();if(!e)return null;e.classList.remove(Tk,Ek),e.classList.add(`bs-${this.constructor.NAME}-auto`);const i=(t=>{do{t+=Math.floor(1e6*Math.random())}while(document.getElementById(t));return t})(this.constructor.NAME).toString();return e.setAttribute("id",i),this._isAnimated()&&e.classList.add(Tk),e}setContent(t){this._newContent=t,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(t){return this._templateFactory?this._templateFactory.changeContent(t):this._templateFactory=new Mk({...this._config,content:t,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{".tooltip-inner":this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(t){return this.constructor.getOrCreateInstance(t.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Tk)}_isShown(){return this.tip&&this.tip.classList.contains(Ek)}_createPopper(t){const e=_I(this._config.placement,[this,t,this._element]),i=Pk[e.toUpperCase()];return iI(this._element,t,this._getPopperConfig(i))}_getOffset(){const{offset:t}=this._config;return"string"==typeof t?t.split(",").map((t=>Number.parseInt(t,10))):"function"==typeof t?e=>t(e,this._element):t}_resolvePossibleFunction(t){return _I(t,[this._element])}_getPopperConfig(t){const e={placement:t,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:t=>{this._getTipElement().setAttribute("data-popper-placement",t.state.placement)}}]};return{...e,..._I(this._config.popperConfig,[e])}}_setListeners(){const t=this._config.trigger.split(" ");for(const e of t)if("click"===e)zI.on(this._element,this.constructor.eventName("click"),this._config.selector,(t=>{this._initializeOnDelegatedTarget(t).toggle()}));else if("manual"!==e){const t=e===Ik?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),i=e===Ik?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");zI.on(this._element,t,this._config.selector,(t=>{const e=this._initializeOnDelegatedTarget(t);e._activeTrigger["focusin"===t.type?Rk:Ik]=!0,e._enter()})),zI.on(this._element,i,this._config.selector,(t=>{const e=this._initializeOnDelegatedTarget(t);e._activeTrigger["focusout"===t.type?Rk:Ik]=e._element.contains(t.relatedTarget),e._leave()}))}this._hideModalHandler=()=>{this._element&&this.hide()},zI.on(this._element.closest(Ak),Ck,this._hideModalHandler)}_fixTitle(){const t=this._element.getAttribute("title");t&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",t),this._element.setAttribute("data-bs-original-title",t),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout((()=>{this._isHovered&&this.show()}),this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout((()=>{this._isHovered||this.hide()}),this._config.delay.hide))}_setTimeout(t,e){clearTimeout(this._timeout),this._timeout=setTimeout(t,e)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(t){const e=HI.getDataAttributes(this._element);for(const t of Object.keys(e))Sk.has(t)&&delete e[t];return t={...e,..."object"==typeof t&&t?t:{}},t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t.container=!1===t.container?document.body:cI(t.container),"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),"number"==typeof t.title&&(t.title=t.title.toString()),"number"==typeof t.content&&(t.content=t.content.toString()),t}_getDelegateConfig(){const t={};for(const[e,i]of Object.entries(this._config))this.constructor.Default[e]!==i&&(t[e]=i);return t.selector=!1,t.trigger="manual",t}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(t){return this.each((function(){const e=Lk.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t]()}}))}}xI(Lk);const Ok={...Lk.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},Nk={...Lk.DefaultType,content:"(null|string|element|function)"};class Bk extends Lk{static get Default(){return Ok}static get DefaultType(){return Nk}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{".popover-header":this._getTitle(),".popover-body":this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(t){return this.each((function(){const e=Bk.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t]()}}))}}xI(Bk);const zk=".bs.scrollspy",Uk=`activate${zk}`,Fk=`click${zk}`,Gk=`load${zk}.data-api`,Hk="active",Vk="[href]",jk=".nav-link",Wk=`${jk}, .nav-item > ${jk}, .list-group-item`,Xk={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},$k={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class qk extends jI{constructor(t,e){super(t,e),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement="visible"===getComputedStyle(this._element).overflowY?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return Xk}static get DefaultType(){return $k}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const t of this._observableSections.values())this._observer.observe(t)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(t){return t.target=cI(t.target)||document.body,t.rootMargin=t.offset?`${t.offset}px 0px -30%`:t.rootMargin,"string"==typeof t.threshold&&(t.threshold=t.threshold.split(",").map((t=>Number.parseFloat(t)))),t}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(zI.off(this._config.target,Fk),zI.on(this._config.target,Fk,Vk,(t=>{const e=this._observableSections.get(t.target.hash);if(e){t.preventDefault();const i=this._rootElement||window,n=e.offsetTop-this._element.offsetTop;if(i.scrollTo)return void i.scrollTo({top:n,behavior:"smooth"});i.scrollTop=n}})))}_getNewObserver(){const t={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver((t=>this._observerCallback(t)),t)}_observerCallback(t){const e=t=>this._targetLinks.get(`#${t.target.id}`),i=t=>{this._previousScrollData.visibleEntryTop=t.target.offsetTop,this._process(e(t))},n=(this._rootElement||document.documentElement).scrollTop,s=n>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=n;for(const r of t){if(!r.isIntersecting){this._activeTarget=null,this._clearActiveClass(e(r));continue}const t=r.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(s&&t){if(i(r),!n)return}else s||t||i(r)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const t=XI.find(Vk,this._config.target);for(const e of t){if(!e.hash||dI(e))continue;const t=XI.findOne(decodeURI(e.hash),this._element);uI(t)&&(this._targetLinks.set(decodeURI(e.hash),e),this._observableSections.set(e.hash,t))}}_process(t){this._activeTarget!==t&&(this._clearActiveClass(this._config.target),this._activeTarget=t,t.classList.add(Hk),this._activateParents(t),zI.trigger(this._element,Uk,{relatedTarget:t}))}_activateParents(t){if(t.classList.contains("dropdown-item"))XI.findOne(".dropdown-toggle",t.closest(".dropdown")).classList.add(Hk);else for(const e of XI.parents(t,".nav, .list-group"))for(const t of XI.prev(e,Wk))t.classList.add(Hk)}_clearActiveClass(t){t.classList.remove(Hk);const e=XI.find(`${Vk}.${Hk}`,t);for(const t of e)t.classList.remove(Hk)}static jQueryInterface(t){return this.each((function(){const e=qk.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t]()}}))}}zI.on(window,Gk,(()=>{for(const t of XI.find('[data-bs-spy="scroll"]'))qk.getOrCreateInstance(t)})),xI(qk);const Yk=".bs.tab",Kk=`hide${Yk}`,Zk=`hidden${Yk}`,Jk=`show${Yk}`,Qk=`shown${Yk}`,tD=`click${Yk}`,eD=`keydown${Yk}`,iD=`load${Yk}`,nD="ArrowLeft",sD="ArrowRight",rD="ArrowUp",oD="ArrowDown",aD="Home",hD="End",lD="active",cD="fade",uD="show",dD=".dropdown-toggle",pD=`:not(${dD})`,mD='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',fD=`${`.nav-link${pD}, .list-group-item${pD}, [role="tab"]${pD}`}, ${mD}`,gD=`.${lD}[data-bs-toggle="tab"], .${lD}[data-bs-toggle="pill"], .${lD}[data-bs-toggle="list"]`;class vD extends jI{constructor(t){super(t),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),zI.on(this._element,eD,(t=>this._keydown(t))))}static get NAME(){return"tab"}show(){const t=this._element;if(this._elemIsActive(t))return;const e=this._getActiveElem(),i=e?zI.trigger(e,Kk,{relatedTarget:t}):null;zI.trigger(t,Jk,{relatedTarget:e}).defaultPrevented||i&&i.defaultPrevented||(this._deactivate(e,t),this._activate(t,e))}_activate(t,e){if(!t)return;t.classList.add(lD),this._activate(XI.getElementFromSelector(t));this._queueCallback((()=>{"tab"===t.getAttribute("role")?(t.removeAttribute("tabindex"),t.setAttribute("aria-selected",!0),this._toggleDropDown(t,!0),zI.trigger(t,Qk,{relatedTarget:e})):t.classList.add(uD)}),t,t.classList.contains(cD))}_deactivate(t,e){if(!t)return;t.classList.remove(lD),t.blur(),this._deactivate(XI.getElementFromSelector(t));this._queueCallback((()=>{"tab"===t.getAttribute("role")?(t.setAttribute("aria-selected",!1),t.setAttribute("tabindex","-1"),this._toggleDropDown(t,!1),zI.trigger(t,Zk,{relatedTarget:e})):t.classList.remove(uD)}),t,t.classList.contains(cD))}_keydown(t){if(![nD,sD,rD,oD,aD,hD].includes(t.key))return;t.stopPropagation(),t.preventDefault();const e=this._getChildren().filter((t=>!dI(t)));let i;if([aD,hD].includes(t.key))i=e[t.key===aD?0:e.length-1];else{const n=[sD,oD].includes(t.key);i=wI(e,t.target,n,!0)}i&&(i.focus({preventScroll:!0}),vD.getOrCreateInstance(i).show())}_getChildren(){return XI.find(fD,this._parent)}_getActiveElem(){return this._getChildren().find((t=>this._elemIsActive(t)))||null}_setInitialAttributes(t,e){this._setAttributeIfNotExists(t,"role","tablist");for(const t of e)this._setInitialAttributesOnChild(t)}_setInitialAttributesOnChild(t){t=this._getInnerElement(t);const e=this._elemIsActive(t),i=this._getOuterElement(t);t.setAttribute("aria-selected",e),i!==t&&this._setAttributeIfNotExists(i,"role","presentation"),e||t.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(t,"role","tab"),this._setInitialAttributesOnTargetPanel(t)}_setInitialAttributesOnTargetPanel(t){const e=XI.getElementFromSelector(t);e&&(this._setAttributeIfNotExists(e,"role","tabpanel"),t.id&&this._setAttributeIfNotExists(e,"aria-labelledby",`${t.id}`))}_toggleDropDown(t,e){const i=this._getOuterElement(t);if(!i.classList.contains("dropdown"))return;const n=(t,n)=>{const s=XI.findOne(t,i);s&&s.classList.toggle(n,e)};n(dD,lD),n(".dropdown-menu",uD),i.setAttribute("aria-expanded",e)}_setAttributeIfNotExists(t,e,i){t.hasAttribute(e)||t.setAttribute(e,i)}_elemIsActive(t){return t.classList.contains(lD)}_getInnerElement(t){return t.matches(fD)?t:XI.findOne(fD,t)}_getOuterElement(t){return t.closest(".nav-item, .list-group-item")||t}static jQueryInterface(t){return this.each((function(){const e=vD.getOrCreateInstance(this);if("string"==typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t]()}}))}}zI.on(document,tD,mD,(function(t){["A","AREA"].includes(this.tagName)&&t.preventDefault(),dI(this)||vD.getOrCreateInstance(this).show()})),zI.on(window,iD,(()=>{for(const t of XI.find(gD))vD.getOrCreateInstance(t)})),xI(vD);const yD=".bs.toast",xD=`mouseover${yD}`,_D=`mouseout${yD}`,bD=`focusin${yD}`,wD=`focusout${yD}`,MD=`hide${yD}`,SD=`hidden${yD}`,TD=`show${yD}`,ED=`shown${yD}`,AD="hide",CD="show",ID="showing",RD={animation:"boolean",autohide:"boolean",delay:"number"},PD={animation:!0,autohide:!0,delay:5e3};class kD extends jI{constructor(t,e){super(t,e),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return PD}static get DefaultType(){return RD}static get NAME(){return"toast"}show(){if(zI.trigger(this._element,TD).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add("fade");this._element.classList.remove(AD),fI(this._element),this._element.classList.add(CD,ID),this._queueCallback((()=>{this._element.classList.remove(ID),zI.trigger(this._element,ED),this._maybeScheduleHide()}),this._element,this._config.animation)}hide(){if(!this.isShown())return;if(zI.trigger(this._element,MD).defaultPrevented)return;this._element.classList.add(ID),this._queueCallback((()=>{this._element.classList.add(AD),this._element.classList.remove(ID,CD),zI.trigger(this._element,SD)}),this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(CD),super.dispose()}isShown(){return this._element.classList.contains(CD)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout((()=>{this.hide()}),this._config.delay)))}_onInteraction(t,e){switch(t.type){case"mouseover":case"mouseout":this._hasMouseInteraction=e;break;case"focusin":case"focusout":this._hasKeyboardInteraction=e}if(e)return void this._clearTimeout();const i=t.relatedTarget;this._element===i||this._element.contains(i)||this._maybeScheduleHide()}_setListeners(){zI.on(this._element,xD,(t=>this._onInteraction(t,!0))),zI.on(this._element,_D,(t=>this._onInteraction(t,!1))),zI.on(this._element,bD,(t=>this._onInteraction(t,!0))),zI.on(this._element,wD,(t=>this._onInteraction(t,!1)))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(t){return this.each((function(){const e=kD.getOrCreateInstance(this,t);if("string"==typeof t){if(void 0===e[t])throw new TypeError(`No method named "${t}"`);e[t](this)}}))}}$I(kD),xI(kD);var DD=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class LD extends JE{constructor(t,e){super(e),this.blockStore=t,this.targetloadCnt=0,this.currenloadCnt=0,this.userlist=[]}tagResult(t){if("json"in t){return JSON.parse(t.json)}return[]}drawHtmlTaglist(t){const e=document.getElementById("taglist");let i="\n        <span class='badge bg-primary handcursor select-disable' onclick=\"ClickLoadPage('hons', false)\">#최신글</span>\n        <span class='badge bg-info handcursor select-disable' onclick=\"ClickLoadPage('newhon', false)\">#AI 체험하기</span>\n        ";t.forEach((t=>{i+=`\n            <span class='badge bg-primary handcursor select-disable' onclick="ClickLoadPage('hons', false, '&tag=${atob(t)}')">\n            ${decodeURIComponent(atob(atob(t)))}\n            </span>\n            `})),e.innerHTML=i}makeHtmlUserInfo(t){return DD(this,void 0,void 0,(function*(){if(this.currenloadCnt++,"file"in t){let e="";""!=t.file&&"file"in t?yield fetch("data:image/jpg;base64,"+t.file).then((t=>t.blob())).then((t=>{e=URL.createObjectURL(t)})):e="static/img/ghost_background_black.png";const i=`\n                <div class="container pt-2">\n                <div class="row p-1 border rounded handcursor" onclick="ClickLoadPage('hondetail', false, '&email=${t.email}')">\n                    <div class="col-auto">\n                            <span class="m-1"><img class="profile-sm" src="${e}"></span>\n                    </div>\n                    <div class="col">\n                        <b>${t.id}</b> @${t.email}\n                    </div>\n                </div>\n                </div>\n                `;this.userlist.push(i)}if(this.targetloadCnt==this.currenloadCnt){const t=document.getElementById("loadspinner");t&&(t.style.display="none")}}))}drawHtmlUserInfo(){let t='<span style="font-size: 20px;"><b>New Members</b></span>';this.userlist.forEach((e=>{t+=e}));document.getElementById("userlist").innerHTML=t}RequestTaglist(t){const e=`\n        ${window.MasterAddr}/glambda?txid=${encodeURIComponent(n)}&table=taglist&start=0&count=${t}`;fetch(e).then((t=>t.json())).then((t=>this.tagResult(t))).then((t=>this.drawHtmlTaglist(t)))}RequestUserInfo(t){const e=window.MasterAddr;this.targetloadCnt=t.length,this.currenloadCnt=0;const i=t.map((t=>DD(this,void 0,void 0,(function*(){const i=atob(t);yield this.blockStore.FetchProfile(e,i).then((t=>this.makeHtmlUserInfo(t)))}))));Promise.all(i).then((()=>this.drawHtmlUserInfo()))}RequestUserlist(t){const e=`\n        ${window.MasterAddr}/glambda?txid=${encodeURIComponent(n)}&table=member&start=0&count=${t}`;document.getElementById("userlist").innerHTML='<span style="font-size: 20px;"><b>New Members</b></span>',fetch(e).then((t=>t.json())).then((t=>this.tagResult(t))).then((t=>this.RequestUserInfo(t)))}disableMeta(){document.getElementById("avatar-bg").style.display="none";document.getElementById("progress-bar-container").style.display="none";document.getElementById("joypad_buttons").style.display="none"}bugfixCarousel(){const t=document.getElementById("carouselExampleAutoplaying"),e=new PR(t,{interval:1e3});null==e||e.cycle()}CanvasRenderer(){}Run(){return DD(this,void 0,void 0,(function*(){return yield this.LoadHtml(),this.disableMeta(),this.bugfixCarousel(),this.RequestTaglist(20),this.RequestUserlist(20),this.CanvasRenderer(),!0}))}Release(){this.ReleaseHtml(),this.userlist.length=0}}const OD="aria-description",ND="aria-expanded",BD="aria-selected",zD="aria-valuenow",UD="aria-valuetext",FD="keydown",GD="click",HD="pointermove",VD="touchmove",jD="ArrowDown",WD="ArrowUp",XD="ArrowLeft",$D="ArrowRight",qD="Enter",YD="Space",KD="tabindex",ZD=navigator.userAgentData,{userAgent:JD}=navigator,QD=JD,tL=/iPhone|iPad|iPod|Android/i;ZD?ZD.brands.some((t=>tL.test(t.brand))):tL.test(QD);const eL=/(iPhone|iPod|iPad)/;ZD?ZD.brands.some((t=>eL.test(t.brand))):eL.test(QD),QD&&QD.includes("Firefox");const{head:iL}=document;["webkitPerspective","perspective"].some((t=>t in iL.style));const nL=(t,e,i,n)=>{const s=n||!1;t.addEventListener(e,i,s)},sL=(t,e,i,n)=>{const s=n||!1;t.removeEventListener(e,i,s)},rL=()=>{};(()=>{let t=!1;try{const e=Object.defineProperty({},"passive",{get:()=>(t=!0,t)});((t,e,i,n)=>{const s=r=>{(r.target===t||r.currentTarget===t)&&(i.apply(t,[r]),sL(t,e,s,n))};nL(t,e,s,n)})(document,"DOMContentLoaded",rL,e)}catch{}})(),["webkitTransform","transform"].some((t=>t in iL.style)),["webkitAnimation","animation"].some((t=>t in iL.style)),["webkitTransition","transition"].some((t=>t in iL.style));const oL=(t,e)=>t.getAttribute(e),aL=(t,e,i)=>t.setAttribute(e,i),hL=(t,e)=>t.removeAttribute(e),lL=(t,...e)=>{t.classList.add(...e)},cL=(t,...e)=>{t.classList.remove(...e)},uL=(t,e)=>t.classList.contains(e),dL=t=>null!=t&&"object"==typeof t||!1,pL=t=>dL(t)&&"number"==typeof t.nodeType&&[1,2,3,4,5,6,7,8,9,10,11].some((e=>t.nodeType===e))||!1,mL=t=>pL(t)&&1===t.nodeType||!1,fL=new Map,gL={data:fL,set:(t,e,i)=>{mL(t)&&(fL.has(e)||fL.set(e,new Map),fL.get(e).set(t,i))},getAllFor:t=>fL.get(t)||null,get:(t,e)=>{if(!mL(t)||!e)return null;const i=gL.getAllFor(e);return t&&i&&i.get(t)||null},remove:(t,e)=>{const i=gL.getAllFor(e);!i||!mL(t)||(i.delete(t),0===i.size&&fL.delete(e))}},vL=t=>"string"==typeof t||!1,yL=t=>pL(t)&&9===t.nodeType||!1,xL=t=>(t=>dL(t)&&"Window"===t.constructor.name||!1)(t)?t.document:yL(t)?t:pL(t)?t.ownerDocument:window.document,_L=(t,...e)=>Object.assign(t,...e),bL=t=>{if(!t)return;if(vL(t))return xL().createElement(t);const{tagName:e}=t,i=bL(e);if(!i)return;const n={...t};return delete n.tagName,_L(i,n)},wL=(t,e)=>{if(!t||!e)return;if(vL(e))return xL().createElementNS(t,e);const{tagName:i}=e,n=wL(t,i);if(!n)return;const s={...e};return delete s.tagName,_L(n,s)},ML=(t,e)=>{const i=getComputedStyle(t),n=e.replace("webkit","Webkit").replace(/([A-Z])/g,"-$1").toLowerCase();return i.getPropertyValue(n)},SL=(t,e)=>t.focus(e),TL=t=>!!["true",!0].includes(t)||!["false",!1].includes(t)&&(["null","",null,void 0].includes(t)?null:""===t||Number.isNaN(+t)?t:+t),EL=t=>Object.entries(t),AL=t=>Object.fromEntries(t),CL=(t,e)=>{EL(e).forEach((([e,i])=>{if(i&&vL(e)&&e.includes("--"))t.style.setProperty(e,i);else{const n={};n[e]=i,_L(t.style,n)}}))},IL=t=>t.toUpperCase(),RL=(t,e)=>{const{width:i,height:n,top:s,right:r,bottom:o,left:a}=t.getBoundingClientRect();let h=1,l=1;if(e&&mL(t)){const{offsetWidth:e,offsetHeight:s}=t;h=e>0?Math.round(i)/e:1,l=s>0?Math.round(n)/s:1}return{width:i/h,height:n/l,top:s/l,right:r/h,bottom:o/l,left:a/h,x:a/h,y:s/l}},PL=t=>xL(t).documentElement;let kL=0,DL=0;const LL=new Map,OL=(t,e)=>{let i=e?kL:DL;if(e){const n=OL(t),s=LL.get(n)||new Map;LL.has(n)||LL.set(n,s),(t=>dL(t)&&"Map"===t.constructor.name||!1)(s)&&!s.has(e)?(s.set(e,i),kL+=1):i=s.get(e)}else{const e=t.id||t;LL.has(e)?i=LL.get(e):(LL.set(e,i),DL+=1)}return i},NL=t=>Array.isArray(t)||!1,BL=(t,e)=>t?t.closest(e)||BL(t.getRootNode().host,e):null,zL=(t,e)=>mL(t)?t:(pL(e)?e:xL()).querySelector(t),UL=(t,e)=>(e&&pL(e)?e:xL()).getElementsByClassName(t),FL=["transparent","currentColor","inherit","revert","initial"],GL=t=>{const e=Math.floor(t);return t-e<.5?e:Math.round(t)},HL=[["aliceblue",{r:240,g:248,b:255}],["antiquewhite",{r:250,g:235,b:215}],["aqua",{r:0,g:255,b:255}],["aquamarine",{r:127,g:255,b:212}],["azure",{r:240,g:255,b:255}],["beige",{r:245,g:245,b:220}],["bisque",{r:255,g:228,b:196}],["black",{r:0,g:0,b:0}],["blanchedalmond",{r:255,g:235,b:205}],["blue",{r:0,g:0,b:255}],["blueviolet",{r:138,g:43,b:226}],["brown",{r:165,g:42,b:42}],["burlywood",{r:222,g:184,b:135}],["cadetblue",{r:95,g:158,b:160}],["chartreuse",{r:127,g:255,b:0}],["chocolate",{r:210,g:105,b:30}],["coral",{r:255,g:127,b:80}],["cornflowerblue",{r:100,g:149,b:237}],["cornsilk",{r:255,g:248,b:220}],["crimson",{r:220,g:20,b:60}],["cyan",{r:0,g:255,b:255}],["darkblue",{r:0,g:0,b:139}],["darkcyan",{r:0,g:139,b:139}],["darkgoldenrod",{r:184,g:134,b:11}],["darkgray",{r:169,g:169,b:169}],["darkgreen",{r:0,g:100,b:0}],["darkgrey",{r:169,g:169,b:169}],["darkkhaki",{r:189,g:183,b:107}],["darkmagenta",{r:139,g:0,b:139}],["darkolivegreen",{r:85,g:107,b:47}],["darkorange",{r:255,g:140,b:0}],["darkorchid",{r:153,g:50,b:204}],["darkred",{r:139,g:0,b:0}],["darksalmon",{r:233,g:150,b:122}],["darkseagreen",{r:143,g:188,b:143}],["darkslateblue",{r:72,g:61,b:139}],["darkslategray",{r:47,g:79,b:79}],["darkslategrey",{r:47,g:79,b:79}],["darkturquoise",{r:0,g:206,b:209}],["darkviolet",{r:148,g:0,b:211}],["deeppink",{r:255,g:20,b:147}],["deepskyblue",{r:0,g:191,b:255}],["dimgray",{r:105,g:105,b:105}],["dimgrey",{r:105,g:105,b:105}],["dodgerblue",{r:30,g:144,b:255}],["firebrick",{r:178,g:34,b:34}],["floralwhite",{r:255,g:250,b:240}],["forestgreen",{r:34,g:139,b:34}],["fuchsia",{r:255,g:0,b:255}],["gainsboro",{r:220,g:220,b:220}],["ghostwhite",{r:248,g:248,b:255}],["goldenrod",{r:218,g:165,b:32}],["gold",{r:255,g:215,b:0}],["gray",{r:128,g:128,b:128}],["green",{r:0,g:128,b:0}],["greenyellow",{r:173,g:255,b:47}],["grey",{r:128,g:128,b:128}],["honeydew",{r:240,g:255,b:240}],["hotpink",{r:255,g:105,b:180}],["indianred",{r:205,g:92,b:92}],["indigo",{r:75,g:0,b:130}],["ivory",{r:255,g:255,b:240}],["khaki",{r:240,g:230,b:140}],["lavenderblush",{r:255,g:240,b:245}],["lavender",{r:230,g:230,b:250}],["lawngreen",{r:124,g:252,b:0}],["lemonchiffon",{r:255,g:250,b:205}],["lightblue",{r:173,g:216,b:230}],["lightcoral",{r:240,g:128,b:128}],["lightcyan",{r:224,g:255,b:255}],["lightgoldenrodyellow",{r:250,g:250,b:210}],["lightgray",{r:211,g:211,b:211}],["lightgreen",{r:144,g:238,b:144}],["lightgrey",{r:211,g:211,b:211}],["lightpink",{r:255,g:182,b:193}],["lightsalmon",{r:255,g:160,b:122}],["lightseagreen",{r:32,g:178,b:170}],["lightskyblue",{r:135,g:206,b:250}],["lightslategray",{r:119,g:136,b:153}],["lightslategrey",{r:119,g:136,b:153}],["lightsteelblue",{r:176,g:196,b:222}],["lightyellow",{r:255,g:255,b:224}],["lime",{r:0,g:255,b:0}],["limegreen",{r:50,g:205,b:50}],["linen",{r:250,g:240,b:230}],["magenta",{r:255,g:0,b:255}],["maroon",{r:128,g:0,b:0}],["mediumaquamarine",{r:102,g:205,b:170}],["mediumblue",{r:0,g:0,b:205}],["mediumorchid",{r:186,g:85,b:211}],["mediumpurple",{r:147,g:112,b:219}],["mediumseagreen",{r:60,g:179,b:113}],["mediumslateblue",{r:123,g:104,b:238}],["mediumspringgreen",{r:0,g:250,b:154}],["mediumturquoise",{r:72,g:209,b:204}],["mediumvioletred",{r:199,g:21,b:133}],["midnightblue",{r:25,g:25,b:112}],["mintcream",{r:245,g:255,b:250}],["mistyrose",{r:255,g:228,b:225}],["moccasin",{r:255,g:228,b:181}],["navajowhite",{r:255,g:222,b:173}],["navy",{r:0,g:0,b:128}],["oldlace",{r:253,g:245,b:230}],["olive",{r:128,g:128,b:0}],["olivedrab",{r:107,g:142,b:35}],["orange",{r:255,g:165,b:0}],["orangered",{r:255,g:69,b:0}],["orchid",{r:218,g:112,b:214}],["palegoldenrod",{r:238,g:232,b:170}],["palegreen",{r:152,g:251,b:152}],["paleturquoise",{r:175,g:238,b:238}],["palevioletred",{r:219,g:112,b:147}],["papayawhip",{r:255,g:239,b:213}],["peachpuff",{r:255,g:218,b:185}],["peru",{r:205,g:133,b:63}],["pink",{r:255,g:192,b:203}],["plum",{r:221,g:160,b:221}],["powderblue",{r:176,g:224,b:230}],["purple",{r:128,g:0,b:128}],["rebeccapurple",{r:102,g:51,b:153}],["red",{r:255,g:0,b:0}],["rosybrown",{r:188,g:143,b:143}],["royalblue",{r:65,g:105,b:225}],["saddlebrown",{r:139,g:69,b:19}],["salmon",{r:250,g:128,b:114}],["sandybrown",{r:244,g:164,b:96}],["seagreen",{r:46,g:139,b:87}],["seashell",{r:255,g:245,b:238}],["sienna",{r:160,g:82,b:45}],["silver",{r:192,g:192,b:192}],["skyblue",{r:135,g:206,b:235}],["slateblue",{r:106,g:90,b:205}],["slategray",{r:112,g:128,b:144}],["slategrey",{r:112,g:128,b:144}],["snow",{r:255,g:250,b:250}],["springgreen",{r:0,g:255,b:127}],["steelblue",{r:70,g:130,b:180}],["tan",{r:210,g:180,b:140}],["teal",{r:0,g:128,b:128}],["thistle",{r:216,g:191,b:216}],["tomato",{r:255,g:99,b:71}],["turquoise",{r:64,g:224,b:208}],["violet",{r:238,g:130,b:238}],["wheat",{r:245,g:222,b:179}],["white",{r:255,g:255,b:255}],["whitesmoke",{r:245,g:245,b:245}],["yellow",{r:255,g:255,b:0}],["yellowgreen",{r:154,g:205,b:50}]],VL="deg|rad|grad|turn",jL="[-\\+]?\\d+%?",WL="[-\\+]?\\d*\\.\\d+%?",XL=`[-\\+]?\\d*\\.?\\d+(?:${VL})?`,$L=`(?:${WL})|(?:${jL})`,qL=`(?:${$L})|(?:${XL}?)`,YL="(?:[,|\\s]+)",KL=`(?:[\\s|\\(\\s|\\s\\(\\s]+)?(${qL})${YL}(${$L})${YL}(${$L})(?:[,|\\/\\s]*)?(${$L})?(?:[\\s|\\)\\s]+)?`,ZL={CSS_UNIT:new RegExp(qL),ANGLES:VL,CSS_ANGLE:XL,CSS_INTEGER:jL,CSS_NUMBER:WL,CSS_UNIT2:qL,PERMISSIVE_MATCH:KL,hwb:new RegExp(`hwb${KL}`),rgb:new RegExp(`rgb(?:a)?${KL}`),hsl:new RegExp(`hsl(?:a)?${KL}`),hsv:new RegExp(`hsv(?:a)?${KL}`),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/},JL=t=>FL.includes(t),QL=(t,e)=>null!==t&&"object"==typeof t&&Object.keys(e).every((e=>e in t)),tO=t=>`${t}`.includes(".")&&1===parseFloat(t),eO=t=>"string"==typeof t&&t.includes("%"),iO=t=>!!ZL.CSS_UNIT.exec(`${t}`),nO=["rgb","hex","hsl","hsv","hwb"],sO=t=>!FL.includes(t)&&!["#",...nO].some((e=>t.includes(e)))&&HL.some((([e])=>t===e)),rO=(t,e)=>{let i=t;if("number"==typeof t&&0===Math.min(t,0)&&1===Math.max(t,1))return t;tO(t)&&(i="100%");const n=eO(i);return i=360===e?parseFloat(i):Math.min(e,Math.max(0,parseFloat(i))),n&&(i=i*e/100),Math.abs(i-e)<1e-6?1:(i=360===e?(i<0?i%e+e:i%e)/e:i%e/e,i)},oO=t=>{let e=parseFloat(t);return(Number.isNaN(e)||e<0||e>1)&&(e=1),e},aO=t=>Math.min(1,Math.max(0,t)),hO=t=>1===t.length?`0${t}`:String(t),lO=t=>{const[[,e]]=HL.filter((([e])=>e===t.toLowerCase()));return e},cO=t=>parseInt(t,16),uO=t=>cO(t)/255,dO=t=>GL(255*t).toString(16),pO=(t,e,i)=>{const n=Math.max(t,e,i),s=Math.min(t,e,i);let r=0,o=0;const a=(n+s)/2;if(n===s)o=0,r=0;else{const h=n-s;o=a>.5?h/(2-n-s):h/(n+s),n===t&&(r=(e-i)/h+(e<i?6:0)),n===e&&(r=(i-t)/h+2),n===i&&(r=(t-e)/h+4),r/=6}return{h:r,s:o,l:a}},mO=(t,e,i)=>{let n=i;return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*n*(e-t):n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t},fO=(t,e,i)=>{let n=0,s=0,r=0;if(0===e)s=i,r=i,n=i;else if(i){const o=i<.5?i*(1+e):i+e-i*e,a=2*i-o;n=mO(a,o,t+1/3),s=mO(a,o,t),r=mO(a,o,t-1/3)}return{r:n,g:s,b:r}},gO=(t,e,i)=>{let n=0,s=0;const r=Math.min(t,e,i),o=Math.max(t,e,i),a=1-o;if(o===r)return{h:0,w:r,b:a};t===r?(n=e-i,s=3):(n=e===r?i-t:t-e,s=e===r?5:1);const h=(s-n/(o-r))/6;return{h:1===h?0:h,w:r,b:a}},vO=(t,e,i)=>{if(e+i>=1){const t=e/(e+i);return{r:t,g:t,b:t}}let{r:n,g:s,b:r}=fO(t,1,.5);return[n,s,r]=[n,s,r].map((t=>t*(1-e-i)+e)),{r:n,g:s,b:r}},yO=(t,e,i)=>{const n=Math.max(t,e,i),s=Math.min(t,e,i);let r=0;const o=n-s;return n===s?r=0:(t===n&&(r=(e-i)/o+(e<i?6:0)),e===n&&(r=(i-t)/o+2),i===n&&(r=(t-e)/o+4),r/=6),{h:r,s:0===n?0:o/n,v:n}},xO=(t,e,i)=>{const n=6*t,s=e,r=i,o=Math.floor(n),a=n-o,h=r*(1-s),l=r*(1-a*s),c=r*(1-(1-a)*s),u=o%6;return{r:[r,l,h,h,c,r][u],g:[c,r,r,l,h,h][u],b:[h,h,c,r,r,l][u]}},_O=(t,e,i,n)=>{const s=[hO(GL(t).toString(16)),hO(GL(e).toString(16)),hO(GL(i).toString(16))];return n&&s[0].charAt(0)===s[0].charAt(1)&&s[1].charAt(0)===s[1].charAt(1)&&s[2].charAt(0)===s[2].charAt(1)?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0):s.join("")},bO=(t,e,i,n,s)=>{const r=[hO(GL(t).toString(16)),hO(GL(e).toString(16)),hO(GL(i).toString(16)),hO(dO(n))];return s&&r[0].charAt(0)===r[0].charAt(1)&&r[1].charAt(0)===r[1].charAt(1)&&r[2].charAt(0)===r[2].charAt(1)&&r[3].charAt(0)===r[3].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0)+r[3].charAt(0):r.join("")},wO=t=>{const e=String(t).trim().toLowerCase();if(sO(e))return Object.assign(lO(e),{a:1,format:"rgb",ok:!0});if(JL(e))return{r:0,g:0,b:0,a:"transparent"===e?0:1,format:"rgb",ok:!0};let[,i,n,s,r]=ZL.rgb.exec(e)||[];return i&&n&&s?{r:i,g:n,b:s,a:void 0!==r?r:1,format:"rgb",ok:!0}:([,i,n,s,r]=ZL.hsl.exec(e)||[],i&&n&&s?{h:i,s:n,l:s,a:void 0!==r?r:1,format:"hsl",ok:!0}:([,i,n,s,r]=ZL.hsv.exec(e)||[],i&&n&&s?{h:i,s:n,v:s,a:void 0!==r?r:1,format:"hsv",ok:!0}:([,i,n,s,r]=ZL.hwb.exec(e)||[],i&&n&&s?{h:i,w:n,b:s,a:void 0!==r?r:1,format:"hwb",ok:!0}:([,i,n,s,r]=ZL.hex8.exec(e)||[],i&&n&&s&&r?{r:cO(i),g:cO(n),b:cO(s),a:uO(r),format:"hex",ok:!0}:([,i,n,s]=ZL.hex6.exec(e)||[],i&&n&&s?{r:cO(i),g:cO(n),b:cO(s),a:1,format:"hex",ok:!0}:([,i,n,s,r]=ZL.hex4.exec(e)||[],i&&n&&s&&r?{r:cO(i+i),g:cO(n+n),b:cO(s+s),a:uO(r+r),format:"hex",ok:!0}:([,i,n,s]=ZL.hex3.exec(e)||[],i&&n&&s?{r:cO(i+i),g:cO(n+n),b:cO(s+s),a:1,format:"hex",ok:!0}:{r:0,g:0,b:0,a:1,format:"rgb",ok:!t})))))))},MO=t=>{let e,i,n,s,r,o,a,h,l={r:0,g:0,b:0},c=t,u=1,d="rgb",p=!1;return(!c||"string"==typeof c)&&(c=wO(c),p=c.ok),QL(c,l)&&iO(c.r)&&iO(c.g)&&iO(c.b)&&(({r:a,g:h,b:r}=c),[a,h,r]=[a,h,r].map((t=>rO(t,eO(t)?100:255))),l={r:a,g:h,b:r},d="format"in c?c.format:"rgb"),QL(c,{h:0,s:0,v:0})&&iO(c.h)&&iO(c.s)&&iO(c.v)&&(({h:o,s:e,v:i}=c),o=rO(o,360),e=rO(e,100),i=rO(i,100),l=xO(o,e,i),d="hsv"),QL(c,{h:0,s:0,l:0})&&iO(c.h)&&iO(c.s)&&iO(c.l)&&(({h:o,s:e,l:n}=c),o=rO(o,360),e=rO(e,100),n=rO(n,100),l=fO(o,e,n),d="hsl"),QL(c,{h:0,w:0,b:0})&&iO(c.h)&&iO(c.w)&&iO(c.b)&&(({h:o,w:s,b:r}=c),o=rO(o,360),s=rO(s,100),r=rO(r,100),l=vO(o,s,r),d="hwb"),iO(c.a)&&(u=c.a,u=eO(u)||parseFloat(`${u}`)>1?rO(u,100):u),{r:l.r,g:l.g,b:l.b,a:oO(u),format:d,ok:p}};class SO{static matchers=ZL;static isOnePointZero=tO;static isPercentage=eO;static isValidCSSUnit=iO;static isNonColor=JL;static isColorName=sO;static isColorType=QL;static pad2=hO;static clamp01=aO;static bound01=rO;static boundAlpha=oO;static getRGBFromName=lO;static convertHexToDecimal=uO;static convertDecimalToHex=dO;static rgbToHsl=pO;static rgbToHex=_O;static rgbToHsv=yO;static rgbToHwb=gO;static rgbaToHex=bO;static hslToRgb=xO;static hsvToRgb=xO;static hueToRgb=mO;static hwbToRgb=vO;static parseIntFromHex=cO;static stringInputToObject=wO;static inputToRGB=MO;static roundPart=GL;static webColors=HL;static nonColors=FL;static version="1.0.8";r;g;b;a;format;ok;originalInput;constructor(t,e){const i=e&&nO.includes(e)?e:"",{r:n,g:s,b:r,a:o,ok:a,format:h}=MO(t);this.originalInput=t,this.r=n,this.g=s,this.b=r,this.a=o,this.ok=a,this.format=i||h}get isValid(){return this.ok}get isDark(){return this.brightness<120}get luminance(){const{r:t,g:e,b:i}=this;let n=0,s=0,r=0;return n=t<=.03928?t/12.92:((t+.055)/1.055)**2.4,s=e<=.03928?e/12.92:((e+.055)/1.055)**2.4,r=i<=.03928?i/12.92:((i+.055)/1.055)**2.4,.2126*n+.7152*s+.0722*r}get brightness(){const{r:t,g:e,b:i}=this.toRgb();return(299*t+587*e+114*i)/1e3}get name(){const{r:t,g:e,b:i}=this.toRgb(),[n]=HL.map((([n,s])=>[n,((.3*(s.r-t))**2+(.6*(s.g-e))**2+(.1*(s.b-i))**2)**.5])).find((([,t],e,i)=>t===Math.min(...i.map((([,t])=>t)))));return n}toRgb(){let{r:t,g:e,b:i,a:n}=this;return[t,e,i]=[t,e,i].map((t=>GL(255*t*100)/100)),n=GL(100*n)/100,{r:t,g:e,b:i,a:n}}toRgbString(){const{r:t,g:e,b:i,a:n}=this.toRgb(),[s,r,o]=[t,e,i].map(GL);return 1===n?`rgb(${s}, ${r}, ${o})`:`rgba(${s}, ${r}, ${o}, ${n})`}toRgbCSS4String(){const{r:t,g:e,b:i,a:n}=this.toRgb(),[s,r,o]=[t,e,i].map(GL);return`rgb(${s} ${r} ${o}${1===n?"":` / ${GL(100*n)}%`})`}toHex(t){const{r:e,g:i,b:n,a:s}=this.toRgb();return 1===s?_O(e,i,n,t):bO(e,i,n,s,t)}toHexString(t){return`#${this.toHex(t)}`}toHex8(t){const{r:e,g:i,b:n,a:s}=this.toRgb();return bO(e,i,n,s,t)}toHex8String(t){return`#${this.toHex8(t)}`}toHsv(){const{r:t,g:e,b:i,a:n}=this,{h:s,s:r,v:o}=yO(t,e,i);return{h:s,s:r,v:o,a:n}}toHsl(){const{r:t,g:e,b:i,a:n}=this,{h:s,s:r,l:o}=pO(t,e,i);return{h:s,s:r,l:o,a:n}}toHslString(){let{h:t,s:e,l:i,a:n}=this.toHsl();return t=GL(360*t),e=GL(100*e),i=GL(100*i),n=GL(100*n)/100,1===n?`hsl(${t}, ${e}%, ${i}%)`:`hsla(${t}, ${e}%, ${i}%, ${n})`}toHslCSS4String(){let{h:t,s:e,l:i,a:n}=this.toHsl();t=GL(360*t),e=GL(100*e),i=GL(100*i),n=GL(100*n);return`hsl(${t}deg ${e}% ${i}%${n<100?` / ${GL(n)}%`:""})`}toHwb(){const{r:t,g:e,b:i,a:n}=this,{h:s,w:r,b:o}=gO(t,e,i);return{h:s,w:r,b:o,a:n}}toHwbString(){let{h:t,w:e,b:i,a:n}=this.toHwb();t=GL(360*t),e=GL(100*e),i=GL(100*i),n=GL(100*n);return`hwb(${t}deg ${e}% ${i}%${n<100?` / ${GL(n)}%`:""})`}setAlpha(t){return"number"!=typeof t||(this.a=oO(t)),this}saturate(t){if("number"!=typeof t)return this;const{h:e,s:i,l:n}=this.toHsl(),{r:s,g:r,b:o}=fO(e,aO(i+t/100),n);return Object.assign(this,{r:s,g:r,b:o}),this}desaturate(t){return"number"==typeof t?this.saturate(-t):this}greyscale(){return this.saturate(-100)}lighten(t){if("number"!=typeof t)return this;const{h:e,s:i,l:n}=this.toHsl(),{r:s,g:r,b:o}=fO(e,i,aO(n+t/100));return Object.assign(this,{r:s,g:r,b:o}),this}darken(t){return"number"==typeof t?this.lighten(-t):this}spin(t){if("number"!=typeof t)return this;const{h:e,s:i,l:n}=this.toHsl(),{r:s,g:r,b:o}=fO(aO((360*e+t)%360/360),i,n);return Object.assign(this,{r:s,g:r,b:o}),this}clone(){return new SO(this)}toString(t){const{format:e}=this;return"hex"===e?this.toHexString(t):"hsl"===e?this.toHslString():"hwb"===e?this.toHwbString():this.toRgbString()}}class TO{static Color=SO;hue;hueSteps;lightSteps;saturation;colors;constructor(...t){let e=0,i=12,n=10,s=[.5],r=100;if(4===t.length)[e,i,n,r]=t;else if(3===t.length)[e,i,n]=t;else if(2===t.length&&([i,n]=t,[i,n].some((t=>t<1))))throw TypeError("ColorPalette: the two minimum arguments must be numbers higher than 0.");const o=[],a=360/i,h=SO.roundPart((n-(n%2?1:0))/2),l=[[1,2,3],[4,5],[6,7],[8,9],[10,11],[12,13]],c=l.find((t=>t.includes(n))),u=c?[.25,.2,.15,.11,.09,.075][l.indexOf(c)]:100/(n+(n%2?0:1))/100;for(let t=1;t<h+1;t+=1)s=[...s,.5+u*t];for(let t=1;t<n-h;t+=1)s=[.5-u*t,...s];for(let t=0;t<i;t+=1){const i=(e+t*a)%360/360;s.forEach((t=>{const e=new SO({h:i,s:1,l:t});o.push(r<100?e.saturate(r-100):e)}))}this.hue=e,this.hueSteps=i,this.lightSteps=n,this.saturation=r,this.colors=o}}const EO={pickerLabel:"Colour Picker",appearanceLabel:"Colour Appearance",valueLabel:"Colour Value",toggleLabel:"Select Colour",presetsLabel:"Colour Presets",defaultsLabel:"Colour Defaults",formatLabel:"Format",alphaLabel:"Alpha",hexLabel:"Hexadecimal",hueLabel:"Hue",whitenessLabel:"Whiteness",blacknessLabel:"Blackness",saturationLabel:"Saturation",lightnessLabel:"Lightness",redLabel:"Red",greenLabel:"Green",blueLabel:"Blue"},AO=["white","black","grey","red","orange","brown","gold","olive","yellow","lime","green","teal","cyan","blue","violet","magenta","pink"],CO=t=>{if(!vL(t))return!1;try{JSON.parse(t)}catch{return!1}return!0},IO="v-hidden",RO=(t,e,i)=>{const{input:n,format:s,componentLabels:r}=t,{defaultsLabel:o,presetsLabel:a}=r,h="color-options"===i,l=e instanceof TO,c=h?a:o,u=l?e.colors:e,d=u.length,{lightSteps:p}=l?e:{lightSteps:null},m=p||[9,10].find((t=>d>=2*t&&!(d%t)))||5,f=h&&d>m;let g=2;g=f&&d>2*m?3:g,g=f&&d>3*m?4:g,g=f&&d>4*m?5:g;const v=g-(d<=3*m?1:2),y=f&&d>v*m;let x=i;x+=y?" scrollable":"",x+=f?" multiline":"";const _=f?"1px":"0.25rem";let b=f?1.75:2;b=m>5&&f?1.5:b;const w=v*b+"rem",M=`calc(${g} * ${b}rem + ${g-1} * ${_})`,S=bL({tagName:"ul",className:x,role:"listbox",ariaLabel:c});return y&&CL(S,{"--grid-item-size":`${b}rem`,"--grid-fit":`${m}`,"--grid-gap":_,"--grid-height":w,"--grid-hover-height":M}),u.forEach((t=>{let[e,i]="string"==typeof t?t.trim().split(":"):[];t instanceof SO&&(e=t.toHexString(),i=e);const r=new SO(t instanceof SO?t:e,s).toString()===oL(n,"value"),o=bL({tagName:"li",className:"color-option"+(r?" active":""),innerText:`${i||e}`,tabIndex:0,role:"option",ariaSelected:r?"true":"false"});aL(o,"data-value",`${e}`),h&&CL(o,{backgroundColor:e}),S.append(o)})),S},PO=t=>{const{input:e,parent:i,format:n,id:s,componentLabels:r,colorKeywords:o,colorPresets:a}=t,h=oL(e,"value")||"#fff",{nonColors:l}=SO,{toggleLabel:c,pickerLabel:u,formatLabel:d,hexLabel:p}=r,m=l.includes(h)?"#fff":h;t.color=new SO(m,n);const f="hex"===n?p:IL(n),g=bL({id:`picker-btn-${s}`,tagName:"button",type:"button",className:"picker-toggle btn-appearance",ariaExpanded:"false",ariaHasPopup:"true"});g.append(bL({tagName:"span",className:IO,innerText:`${u}. ${d}: ${f}`}));const v=bL({tagName:"div",className:"color-dropdown picker",role:"group",ariaLabelledBy:`picker-btn-${s}`}),y=(t=>{const{format:e,componentLabels:i}=t,{hueLabel:n,alphaLabel:s,lightnessLabel:r,saturationLabel:o,whitenessLabel:a,blacknessLabel:h}=i,l="hsl"===e?360:100,c="hsl"===e?100:360;let u="hsl"===e?`${n} & ${r}`:`${r} & ${o}`;u="hwb"===e?`${a} & ${h}`:u;const d="hsl"===e?`${o}`:`${n}`,p=bL({tagName:"div",className:`color-controls ${e}`}),m="color-slider";return[{i:1,c:"color-pointer",l:u,min:0,max:l},{i:2,c:m,l:d,min:0,max:c},{i:3,c:m,l:s,min:0,max:100}].forEach((t=>{const{i:e,c:i,l:n,min:s,max:r}=t,o=bL({tagName:"div",className:"color-control",role:"presentation"});o.append(bL({tagName:"div",className:`visual-control visual-control${e}`}));const a=bL({tagName:"div",className:`${i} knob`,ariaLive:"polite",ariaLabel:n,role:"slider",tabIndex:0,ariaValueMin:`${s}`,ariaValueMax:`${r}`});o.append(a),p.append(o)})),p})(t),x=(t=>{const{format:e,id:i,componentLabels:n}=t,s=bL({tagName:"div",className:`color-form ${e}`});let r=["hex"];return"rgb"===e?r=["red","green","blue","alpha"]:"hsl"===e?r=["hue","saturation","lightness","alpha"]:"hwb"===e&&(r=["hue","whiteness","blackness","alpha"]),r.forEach((t=>{const[r]="hex"===e?["#"]:IL(t).split(""),o=`color_${e}_${t}_${i}`,a=n[`${t}Label`],h=bL({tagName:"label"});aL(h,"for",o),h.append(bL({tagName:"span",ariaHidden:"true",innerText:`${r}:`}),bL({tagName:"span",className:IO,innerText:a}));const l=bL({tagName:"input",id:o,type:"hex"===e?"text":"number",value:"alpha"===t?"100":"0",className:`color-input ${t}`,autocomplete:"off",spellcheck:!1});let c="100",u="1";"alpha"!==t&&("rgb"===e?(c="255",u="1"):"hue"===t&&(c="360",u="1")),_L(l,{min:"0",max:c,step:u}),s.append(h,l)})),s})(t);if(v.append(y,x),e.before(g),i.append(v),o||a){const e=bL({tagName:"div",className:"color-dropdown scrollable menu"});a&&e.append(RO(t,a,"color-options")),o&&o.length&&e.append(RO(t,o,"color-defaults"));const n=bL({tagName:"button",type:"button",className:"menu-toggle btn-appearance",tabIndex:-1,ariaExpanded:"false",ariaHasPopup:"true"}),s=encodeURI("http://www.w3.org/2000/svg"),r=wL(s,{tagName:"svg"});aL(r,"xmlns",s),aL(r,"viewBox","0 0 512 512"),aL(r,"aria-hidden","true");const h=wL(s,{tagName:"path"});aL(h,"d","M98,158l157,156L411,158l27,27L255,368L71,185L98,158z"),aL(h,"fill","#fff"),r.append(h),n.append(bL({tagName:"span",className:IO,innerText:`${c}`}),r),i.append(n,e)}o&&l.includes(h)&&(t.value=h),aL(e,KD,"-1")},kO="color-picker",DO=`[data-function="${kO}"]`,LO=`.${kO}`,OO={componentLabels:EO,colorLabels:AO,format:"rgb",colorPresets:!1,colorKeywords:!1},{roundPart:NO,nonColors:BO}=SO,zO=t=>((t,e)=>gL.get(t,e))(t,kO),UO=t=>new WO(t),FO=(t,e)=>{const i=e?nL:sL,{input:n,pickerToggle:s,menuToggle:r}=t;i(n,"focusin",t.showPicker),i(s,GD,t.togglePicker),r&&i(r,GD,t.toggleMenu)},GO=(t,e)=>{const i=e?nL:sL,{input:n,colorMenu:s,parent:r}=t,o=xL(n),a=(t=>{var e;return t?yL(t)?t.defaultView:pL(t)?null==(e=t?.ownerDocument)?void 0:e.defaultView:t:window})(o);i(t.controls,"pointerdown",t.pointerDown),t.controlKnobs.forEach((e=>i(e,FD,t.handleKnobs))),i(a,"scroll",t.handleScroll),i(a,"resize",t.update),[n,...t.inputs].forEach((e=>i(e,"change",t.changeHandler))),s&&(i(s,GD,t.menuClickHandler),i(s,FD,t.menuKeyHandler)),i(o,HD,t.pointerMove),i(o,"pointerup",t.pointerUp),i(r,"focusout",t.handleFocusOut),i(o,"keyup",t.handleDismiss)},HO=t=>{((t,e)=>{t.dispatchEvent(e)})(t.input,new CustomEvent("colorpicker.change"))},VO=t=>{t&&["bottom","top"].forEach((e=>cL(t,e)))},jO=(t,e)=>{const{colorPicker:i,colorMenu:n,menuToggle:s,pickerToggle:r,parent:o}=t,a=e===i,h=a?n:i,l=a?s:r,c=a?r:s;uL(o,"open")||lL(o,"open"),h&&(cL(h,"show"),VO(h)),lL(e,"bottom"),(t=>{t.offsetHeight})(e),lL(e,"show"),a&&t.update(),t.isOpen||(GO(t,!0),t.updateDropdownPosition(),t.isOpen=!0,aL(t.input,KD,"0"),s&&aL(s,KD,"0")),aL(c,ND,"true"),l&&aL(l,ND,"false")};class WO{static Color=SO;static ColorPalette=TO;static getInstance=zO;static init=UO;static selector=DO;static roundPart=NO;static setElementStyle=CL;static setAttribute=aL;static getBoundingClientRect=RL;static version="2.0.0-alpha10";static colorNames=AO;static colorPickerLabels=EO;id;input;color;format="rgb";parent;dragElement;isOpen=!1;controlPositions;colorLabels=AL(AO.map((t=>[t,t])));colorKeywords;colorPresets;componentLabels;pickerToggle;menuToggle;colorPicker;colorMenu;controls;inputs;controlKnobs;visuals;constructor(t,e){const i=zL(t);if(typeof t>"u")throw new TypeError("ColorPicker target not specified.");if(vL(t)&&!i)throw new TypeError(`ColorPicker target "${t}" cannot be found.`);this.input=i;const n=BL(i,LO);if(!n)throw new TypeError("ColorPicker requires a specific markup to work.");this.parent=n,this.id=OL(i,kO),this.dragElement=void 0,this.isOpen=!1,this.controlPositions={c1x:0,c1y:0,c2y:0,c3y:0},this.colorKeywords=!1,this.colorPresets=!1;const{format:s,componentLabels:r,colorLabels:o,colorKeywords:a,colorPresets:h}=((t,e,i,n)=>{const s={...i},r={...t.dataset},o={...e},a={},h="title";return EL(r).forEach((([t,e])=>{const i=n&&"string"==typeof t&&t.includes(n)?t.replace(n,"").replace(/[A-Z]/g,(t=>(t=>t.toLowerCase())(t))):t;a[i]=TL(e)})),EL(s).forEach((([t,e])=>{s[t]=TL(e)})),EL(e).forEach((([e,i])=>{o[e]=e in s?s[e]:e in a?a[e]:e===h?oL(t,h):i})),o})(i,OO,e||{});let l=AO;NL(o)&&17===o.length?l=o:vL(o)&&17===o.split(",").length&&(l=o.split(",")),_L(this.colorLabels,AL(l.map(((t,e)=>[AO[e],t]))));const c=vL(r)&&CO(r)?JSON.parse(r):r;if(this.componentLabels=_L({...EO},c),this.color=new SO(i.value||"#fff",s),this.format=s,NL(a)&&a.length?this.colorKeywords=a:vL(a)&&a.length&&(this.colorKeywords=a.split(",").map((t=>t.trim()))),NL(h)&&h.length)this.colorPresets=h;else if(h&&CO(h)){const{hue:t,hueSteps:e,lightSteps:i,saturation:n}=JSON.parse(h);this.colorPresets=new TO(t,e,i,n)}else vL(h)&&(this.colorPresets=h.split(",").map((t=>t.trim())));PO(this);const[u,d]=UL("color-dropdown",n);this.pickerToggle=zL(".picker-toggle",n),this.menuToggle=zL(".menu-toggle",n),this.colorPicker=u,this.colorMenu=d,this.inputs=[...UL("color-input",n)];const[p]=UL("color-controls",n);this.controls=p,this.controlKnobs=[...UL("knob",p)],this.visuals=[...UL("visual-control",p)],this.update(),FO(this,!0),gL.set(i,kO,this)}get value(){return this.input.value}set value(t){this.input.value=t}get hasNonColor(){return this.colorKeywords instanceof Array&&this.colorKeywords.some((t=>BO.includes(t)))}get hex(){return this.color.toHex(!0)}get hsv(){return this.color.toHsv()}get hsl(){return this.color.toHsl()}get hwb(){return this.color.toHwb()}get rgb(){return this.color.toRgb()}get brightness(){return this.color.brightness}get luminance(){return this.color.luminance}get isDark(){const{color:t,brightness:e}=this;return e<120&&t.a>.33}get isValid(){const t=this.input.value;return""!==t&&new SO(t).isValid}get appearance(){const{colorLabels:t,hsl:e,hsv:i,format:n}=this,s=NO(360*e.h),r="hsl"===n?e.s:i.s,o=NO(100*r),a=NO(100*e.l),h=100*i.v;let l="black";if(100===a&&0===o)l=t.white;else if(0===a)l=t.black;else if(0===o)l=t.grey;else if(s<15||s>=345)l=t.red;else if(s>=15&&s<45)l=h>80&&o>80?t.orange:t.brown;else if(s>=45&&s<75){const e=s>=54&&s<75&&h<80;l=s>46&&s<54&&h<80&&o>90?t.gold:t.yellow,l=e?t.olive:l}else s>=75&&s<155?l=h<68?t.green:t.lime:s>=155&&s<175?l=t.teal:s>=175&&s<195?l=t.cyan:s>=195&&s<255?l=t.blue:s>=255&&s<270?l=t.violet:s>=270&&s<295?l=t.magenta:s>=295&&s<345&&(l=t.pink);return l}updateVisuals(){const{controlPositions:t,visuals:e}=this,[i,n,s]=e,{offsetHeight:r}=i,o=t.c2y/r,{r:a,g:h,b:l}=new SO({h:o,s:1,l:.5}).toRgb(),c=1-t.c3y/r,u=NO(100*c)/100,d=new SO({h:o,s:1,l:.5,a:c}).toRgbString();CL(i,{background:`linear-gradient(rgba(0,0,0,0) 0%, rgba(0,0,0,${u}) 100%),\n      linear-gradient(to right, rgba(255,255,255,${u}) 0%, ${d} 100%),\n      linear-gradient(rgb(255,255,255) 0%, rgb(255,255,255) 100%)`}),CL(n,{background:"linear-gradient(\n      rgb(255,0,0) 0%, rgb(255,255,0) 16.67%,\n      rgb(0,255,0) 33.33%, rgb(0,255,255) 50%,\n      rgb(0,0,255) 66.67%, rgb(255,0,255) 83.33%,\n      rgb(255,0,0) 100%)"}),CL(s,{background:`linear-gradient(rgba(${a},${h},${l},1) 0%,rgba(${a},${h},${l},0) 100%)`})}handleFocusOut=({relatedTarget:t})=>{t&&!this.parent.contains(t)&&this.hide(!0)};handleDismiss=({code:t})=>{this.isOpen&&"Escape"===t&&this.hide()};handleScroll=t=>{const{activeElement:e}=xL(this.input);this.updateDropdownPosition(),([HD,VD].includes(t.type)&&this.dragElement||e&&this.controlKnobs.includes(e))&&(t.stopPropagation(),t.preventDefault())};menuKeyHandler=t=>{const{target:e,code:i}=t,{previousElementSibling:n,nextElementSibling:s,parentElement:r}=e,o=r&&uL(r,"color-options"),a=r?[...r.children]:[],h=o&&ML(r,"grid-template-columns").split(" ").length,l=a.indexOf(e),c=l>-1&&h&&a[l-h],u=l>-1&&h&&a[l+h];[jD,WD,YD].includes(i)&&t.preventDefault(),o?c&&i===WD?SL(c):u&&i===jD?SL(u):n&&i===XD?SL(n):s&&i===$D&&SL(s):n&&[XD,WD].includes(i)?SL(n):s&&[$D,jD].includes(i)&&SL(s),[qD,YD].includes(i)&&this.menuClickHandler(t)};menuClickHandler=t=>{const{target:e}=t,{colorMenu:i}=this,n=(oL(e,"data-value")||"").trim();if(!n.length)return;const s=zL("li.active",i);let r=n;r=BO.includes(r)?"white":r,r="transparent"===r?"rgba(0,0,0,0)":r;const{r:o,g:a,b:h,a:l}=new SO(r);_L(this.color,{r:o,g:a,b:h,a:l}),this.update(),s!==e&&(s&&(cL(s,"active"),hL(s,BD)),lL(e,"active"),aL(e,BD,"true"),BO.includes(n)&&(this.value=n),HO(this))};pointerDown=t=>{if(0!==t.button)return;const{target:e,pageX:i,pageY:n}=t,{colorMenu:s,visuals:r,controlKnobs:o}=this,[a,h,l]=r,[c,u,d]=o,p=o.includes(e)?e.previousElementSibling:e,m=RL(p),f=PL(a),g=i-f.scrollLeft-m.left,v=n-f.scrollTop-m.top;if(e===a||e===c?(this.dragElement=p,this.changeControl1(g,v)):e===h||e===u?(this.dragElement=p,this.changeControl2(v)):(e===l||e===d)&&(this.dragElement=p,this.changeAlpha(v)),s){const t=zL("li.active",s);t&&(cL(t,"active"),hL(t,BD))}t.preventDefault()};pointerUp=({target:t})=>{const{parent:e}=this,i=xL(e),n=null!==zL(`${LO}.open`,i),s=i.getSelection();!this.dragElement&&(!s||!s.toString().length)&&!e.contains(t)&&this.hide(n),this.dragElement=void 0};pointerMove=t=>{const{dragElement:e,visuals:i}=this,[n,s,r]=i,{pageX:o,pageY:a}=t;if(!e)return;const h=RL(e),l=PL(n),c=o-l.scrollLeft-h.left,u=a-l.scrollTop-h.top;e===n&&this.changeControl1(c,u),e===s&&this.changeControl2(u),e===r&&this.changeAlpha(u)};handleKnobs=t=>{const{target:e,code:i}=t;if(![WD,jD,XD,$D].includes(i))return;t.preventDefault();const{controlKnobs:n,visuals:s}=this,{offsetWidth:r,offsetHeight:o}=s[0],[a,h,l]=n,{activeElement:c}=xL(a),u=o/360;if(n.find((t=>t===c))){let n=0,s=0;if(e===a){const t=r/100;[XD,$D].includes(i)?this.controlPositions.c1x+=i===$D?t:-t:[WD,jD].includes(i)&&(this.controlPositions.c1y+=i===jD?u:-u),n=this.controlPositions.c1x,s=this.controlPositions.c1y,this.changeControl1(n,s)}else e===h?(this.controlPositions.c2y+=[jD,$D].includes(i)?u:-u,s=this.controlPositions.c2y,this.changeControl2(s)):e===l&&(this.controlPositions.c3y+=[jD,$D].includes(i)?u:-u,s=this.controlPositions.c3y,this.changeAlpha(s));this.handleScroll(t)}};changeHandler=()=>{let t;const{inputs:e,format:i,value:n,input:s,controlPositions:r,visuals:o}=this,{activeElement:a}=xL(s),{offsetHeight:h}=o[0],[l,,,c]=e,[u,d,p,m]="rgb"===i?e.map((t=>parseFloat(t.value)/(t===c?100:1))):e.map((t=>parseFloat(t.value)/(t!==l?100:360))),f=this.hasNonColor&&BO.includes(n),g=c?m:1-r.c3y/h;if(a===s||a&&e.includes(a)){t=a===s?f?"transparent"===n?"rgba(0,0,0,0)":"rgb(0,0,0)":n:"hex"===i?l.value:"hsl"===i?{h:u,s:d,l:p,a:g}:"hwb"===i?{h:u,w:d,b:p,a:g}:{r:u,g:d,b:p,a:g};const{r:e,g:r,b:o,a:h}=new SO(t);_L(this.color,{r:e,g:r,b:o,a:h}),this.setControlPositions(),this.updateAppearance(),this.updateInputs(),this.updateControls(),this.updateVisuals(),a===s&&f&&(this.value=n)}};changeControl1(t,e){let[i,n]=[0,0];const{controlPositions:s,visuals:r}=this,{offsetHeight:o,offsetWidth:a}=r[0];t>a?i=a:t>=0&&(i=t),e>o?n=o:e>=0&&(n=e);const h=s.c2y/o,l=i/a,c=1-n/o,u=1-s.c3y/o,{r:d,g:p,b:m,a:f}=new SO({h,s:l,v:c,a:u});_L(this.color,{r:d,g:p,b:m,a:f}),this.controlPositions.c1x=i,this.controlPositions.c1y=n,this.updateAppearance(),this.updateInputs(),this.updateControls(),this.updateVisuals()}changeControl2(t){const{controlPositions:e,visuals:i}=this,{offsetHeight:n,offsetWidth:s}=i[0];let r=0;t>n?r=n:t>=0&&(r=t);const o=r/n,a=e.c1x/s,h=1-e.c1y/n,l=1-e.c3y/n,{r:c,g:u,b:d,a:p}=new SO({h:o,s:a,v:h,a:l});_L(this.color,{r:c,g:u,b:d,a:p}),this.controlPositions.c2y=r,this.updateAppearance(),this.updateInputs(),this.updateControls(),this.updateVisuals()}changeAlpha(t){const{visuals:e}=this,{offsetHeight:i}=e[0];let n=0;t>i?n=i:t>=0&&(n=t);const s=1-n/i;this.color.setAlpha(s),this.controlPositions.c3y=n,this.updateAppearance(),this.updateInputs(),this.updateControls(),this.updateVisuals()}update=()=>{this.updateDropdownPosition(),this.updateAppearance(),this.setControlPositions(),this.updateInputs(!0),this.updateControls(),this.updateVisuals()};updateDropdownPosition(){const{input:t,colorPicker:e,colorMenu:i}=this,n=RL(t),{top:s,bottom:r}=n,{offsetHeight:o}=t,a=PL(t).clientHeight,h=uL(e,"show")?e:i;if(!h)return;const{offsetHeight:l}=h,c=a-r,u=s,d=s+l+o>a,p=s-l<0;(uL(h,"bottom")||!p)&&c<u&&d?(cL(h,"bottom"),lL(h,"top")):(cL(h,"top"),lL(h,"bottom"))}setControlPositions(){const{visuals:t,color:e,hsv:i}=this,{offsetHeight:n,offsetWidth:s}=t[0],r=e.a,o=i.h,a=i.s,h=i.v;this.controlPositions.c1x=a*s,this.controlPositions.c1y=(1-h)*n,this.controlPositions.c2y=o*n,this.controlPositions.c3y=(1-r)*n}updateAppearance(){const{componentLabels:t,color:e,parent:i,hsv:n,hex:s,format:r,controlKnobs:o}=this,{appearanceLabel:a,hexLabel:h,valueLabel:l}=t;let{r:c,g:u,b:d}=e.toRgb();const[p,m,f]=o,g=NO(360*n.h),v=e.a,y=NO(100*n.s),x=NO(100*n.v),_=this.appearance;let b=`${h} ${s.split("").join(" ")}`;if("hwb"===r){const{hwb:t}=this,e=NO(100*t.w),i=NO(100*t.b);b=`HWB: ${g}°, ${e}%, ${i}%`,aL(p,UD,`${e}% & ${i}%`),aL(p,zD,`${e}`),aL(m,OD,`${l}: ${b}. ${a}: ${_}.`),aL(m,UD,`${g}%`),aL(m,zD,`${g}`)}else[c,u,d]=[c,u,d].map(NO),b="hsl"===r?`HSL: ${g}°, ${y}%, ${x}%`:b,b="rgb"===r?`RGB: ${c}, ${u}, ${d}`:b,aL(p,UD,`${x}% & ${y}%`),aL(p,zD,`${x}`),aL(m,OD,`${l}: ${b}. ${a}: ${_}.`),aL(m,UD,`${g}°`),aL(m,zD,`${g}`);const w=NO(100*v);aL(f,UD,`${w}%`),aL(f,zD,`${w}`);const M=e.toString();CL(this.input,{backgroundColor:M}),this.isDark?(uL(i,"txt-light")&&cL(i,"txt-light"),uL(i,"txt-dark")||lL(i,"txt-dark")):(uL(i,"txt-dark")&&cL(i,"txt-dark"),uL(i,"txt-light")||lL(i,"txt-light"))}updateControls(){const{controlKnobs:t,controlPositions:e}=this;let{c1x:i,c1y:n,c2y:s,c3y:r}=e;const[o,a,h]=t;[i,n,s,r]=[i,n,s,r].map(NO),CL(o,{transform:`translate3d(${i-4}px,${n-4}px,0)`}),CL(a,{transform:`translate3d(0,${s-4}px,0)`}),CL(h,{transform:`translate3d(0,${r-4}px,0)`})}updateInputs(t){const{value:e,format:i,inputs:n,color:s,hsl:r}=this,[o,a,h,l]=n,c=NO(100*s.a),u=NO(360*r.h);let d=s.toString();if("hex"===i)d=this.color.toHexString(!0),o.value=this.hex;else if("hsl"===i){const t=NO(100*r.l),e=NO(100*r.s);d=this.color.toHslString(),o.value=`${u}`,a.value=`${e}`,h.value=`${t}`,l.value=`${c}`}else if("hwb"===i){const{w:t,b:e}=this.hwb,i=NO(100*t),n=NO(100*e);d=this.color.toHwbString(),o.value=`${u}`,a.value=`${i}`,h.value=`${n}`,l.value=`${c}`}else if("rgb"===i){let{r:t,g:e,b:i}=this.rgb;[t,e,i]=[t,e,i].map(NO),d=this.color.toRgbString(),o.value=`${t}`,a.value=`${e}`,h.value=`${i}`,l.value=`${c}`}this.value=d,!t&&d!==e&&HO(this)}togglePicker=t=>{t&&t.preventDefault();const{colorPicker:e}=this;this.isOpen&&uL(e,"show")?this.hide(!0):jO(this,e)};showPicker=()=>{const{colorPicker:t}=this;["top","bottom"].some((e=>uL(t,e)))||jO(this,t)};toggleMenu=t=>{t&&t.preventDefault();const{colorMenu:e}=this;this.isOpen&&uL(e,"show")?this.hide(!0):jO(this,e)};hide(t){if(this.isOpen){const{pickerToggle:e,menuToggle:i,colorPicker:n,colorMenu:s,parent:r,input:o}=this,a=uL(n,"show"),h=a?n:s,l=a?e:i,c=h&&(t=>{const e=ML(t,"transitionProperty"),i=ML(t,"transitionDuration"),n=i.includes("ms")?1:1e3,s=e&&"none"!==e?parseFloat(i)*n:0;return Number.isNaN(s)?0:s})(h);this.value=this.color.toString(!0),h&&(cL(h,"show"),aL(l,ND,"false"),setTimeout((()=>{VO(h),zL(".show",r)||(cL(r,"open"),GO(this),this.isOpen=!1)}),c)),t||SL(e),aL(o,KD,"-1"),l===i&&aL(i,KD,"-1")}}dispose(){const{input:t,parent:e}=this;this.hide(!0),FO(this),[...e.children].forEach((e=>{e!==t&&e.remove()})),hL(t,KD),CL(t,{backgroundColor:""}),["txt-light","txt-dark"].forEach((t=>cL(e,t))),gL.remove(t,kO)}}class XO{constructor(t,e){this.meta=t,this.editor=e,this.visible=!1,this.firstloading=!1,this.plantDb=this.meta.Plants}toggle(){this.visible?(this.unbinding(),this.visible=!1):(this.binding(),this.visible=!0)}binding(){const t=document.getElementById("plantctrl");if(t.style.display="block",this.firstloading)return;this.firstloading=!0;let e="",i=0;this.plantDb.Items.forEach((t=>{e+=`\n    <div class="row handcursor" id="plantslot${i++}">\n        <div class="col-auto ms-1 me-0 pb-1">\n            <div class="rounded inven_slot p-1">\n                <img src="assets/icons/Misc/Crate.png">\n            </div>\n        </div>\n        <div class="col p-1"> ${t.namekr}를 심습니다.</div>\n    </div>\n            `})),t.insertAdjacentHTML("beforeend",e),i=0,this.plantDb.Items.forEach((e=>{document.getElementById("plantslot"+i).onclick=()=>{this.visible=!1,t.style.display="none",this.editor.mode=this.editor.mode!=qE.Farmer?qE.Farmer:qE.EditPlay,this.meta.ModeChange(this.editor.mode,e.plantId),this.editor.UpdateMenu()},i++}));const n=document.getElementById("plantctrlexit");n&&(n.onclick=()=>{this.unbinding()})}unbinding(){document.getElementById("plantctrl").style.display="none",this.visible=!1}htmlRelease(){this.firstloading=!1}}class $O{constructor(t,e){this.meta=t,this.editor=e,this.visible=!1,this.furnDb=this.meta.Furnitures,this.firstloading=!1}toggle(){this.visible?(this.unbinding(),this.visible=!1):(this.binding(),this.visible=!0)}binding(){const t=document.getElementById("furniturectrl");if(t.style.display="block",this.firstloading)return;this.firstloading=!0;let e="",i=0;this.furnDb.Items.forEach((t=>{e+=`\n    <div class="row handcursor" id="furnslot${i++}">\n        <div class="col-auto ms-1 me-0 pb-1">\n            <div class="rounded inven_slot p-1">\n                <img src="assets/icons/Misc/Crate.png">\n            </div>\n        </div>\n        <div class="col p-1 pe-3"> ${t.namekr}를 만듭니다.<br>가죽: 0, 나무: 0(beta)</div>\n    </div>\n            `})),t.insertAdjacentHTML("beforeend",e),i=0,this.furnDb.Items.forEach((e=>{document.getElementById("furnslot"+i).onclick=()=>{this.visible=!1,t.style.display="none",this.editor.mode=qE.Furniture,this.meta.ModeChange(this.editor.mode,e.id),this.editor.UpdateMenu()},i++}))}unbinding(){const t=document.getElementById("furniturectrl");this.visible=!1,t.style.display="none"}htmlRelease(){this.firstloading=!1}}class qO{constructor(t){this.meta=t,this.onoff=!1,this.deckItem=[]}LoadHtml(){return fetch("views/editgame.html").then((t=>t.text())).then((t=>{document.getElementById("extension").insertAdjacentHTML("beforeend",t);document.getElementById("cardlocation").style.display="none"})).then((()=>{}))}OnOff(t,e){if(!e)return;const i=document.getElementById("gamectrl");i&&(i.style.display=t?"block":"none"),this.inven=e,t&&this.loadDeck()}loadDeck(){if(!this.inven)return;this.deckItem.length=0,this.inven.data.inventroySlot.forEach((t=>{t.item.ItemType==NS.Deck&&this.deckItem.push(t.item)}));let t="";this.deckItem.forEach(((e,i)=>{t+=`\n    <div class="row handcursor" id="deck-${i}">\n        <div class="col-auto ms-1 me-0 pb-1">\n            <div class="rounded inven_slot p-1">\n                <img src="assets/icons/${e.IconPath}">\n            </div>\n        </div>\n        <div class="col p-1 me-3 text-start"> ${e.Name}</div>\n        </div>\n    </div>\n            `})),""==t&&(t='\n    <div class="row">\n        <div class="col ms-1 me-0 pb-1 text-center">\n        Deck이 없습니다.\n        </div>\n    </div>\n        ');document.getElementById("decklist").innerHTML=t,this.deckItem.forEach(((t,e)=>{document.getElementById("deck-"+e).onclick=()=>{var e,i;if(this.viewDeck&&this.viewDeck==(null===(e=t.Deck)||void 0===e?void 0:e.id)){this.viewDeck=void 0;document.getElementById("deckprofile").replaceChildren()}else this.viewDeck=null===(i=t.Deck)||void 0===i?void 0:i.id,this.loadDeckProfile(t.Deck)}}))}loadDeckProfile(t){if(null==t)throw new Error("unexpected undeined value");const e=`\n        <div class="container rounded border" style="background-image: url('static/img/card_pattern.png');">\n        <div class="row">\n            <div class="col p-2"><b>${t.title}</b></div>\n        </div>\n        <div class="row">\n            <div class="col text-start rounded border bg-white p-1 m-2 w-100" style="all:initial">\n                <p class="text-start">${t.contents}</p>\n                <p class="text-start m-0">\n                    Level: ${t.maxLv} <br>\n                    소환 가능 시간: ${t.minTime} ~ ${t.maxTime} 분 <br>\n                    소환 가능 유닛: ${t.maxSpawn}\n                </p>\n            </div>\n        </div>\n        </div>\n        `,i=document.getElementById("deckprofile");i.innerHTML=e,this.location(i,t)}location(t,e){const i=this.meta.GetDeckInfo().find((t=>t.id==e.id)),n=`\n        <div class="input-group mt-1 mb-1">\n        <button class="btn btn-light" type="button" id="locationbtn">소환위치</button>\n        <select id="decklocation" class="form-select" aria-label="Default select example">\n            <option value="0" ${(null==i?void 0:i.rand)?"selected":""}>Random</option>\n            <option value="1" ${(null==i?void 0:i.rand)?"":"selected"}>위치지정</option>\n        </select>\n        </div>\n        <div class="input-group mb-1">\n            <button class="btn btn-light" id="basic-addon1">소환시기</button>\n            <input type="text" class="form-control" id="decktime" placeholder="0" \n            aria-label="decktime" aria-describedby="basic-addon1" value="${null==i?void 0:i.time}">\n        </div>\n        <div class="form-check form-switch text-start">\n            <input class="form-check-input" type="checkbox" role="switch" id="deckenable" ${(null==i?void 0:i.enable)?"checked":""}>\n            <label class="form-check-label">카드 사용</label>\n        </div>\n        <div class="input-group mb-1 text-end">\n            <button class="btn btn-light" type="button" id="decksubmit">적용</button>\n        </div>\n        `;t.insertAdjacentHTML("beforeend",n);const s=document.getElementById("decksubmit");s&&(s.onclick=()=>{this.changeSetup(e)});const r=document.getElementById("decklocation");if(r){r.onchange=()=>{this.deckLocationChangeEvent(r,e)};const t=document.getElementById("locationbtn");t&&(t.onclick=()=>{this.deckLocationChangeEvent(r,e)})}}deckLocationChangeEvent(t,e){if("1"===t.value)this.locator(e);else this.changeSetup(e)}changeSetup(t){const e=document.getElementById("decklocation"),i=document.getElementById("decktime"),n=document.getElementById("deckenable"),s="1"!=e.value,r=i.value,o={id:t.id,time:Number(r),locatOnOff:!1,rand:s,enable:n.checked};this.meta.SendModeMessage(o)}locator(t){const e=document.getElementById("gamectrl");e&&(e.style.display="none");const i=document.getElementById("cardlocation");i&&(i.style.display="block");const n=document.getElementById("decktime").value,s=document.getElementById("deckenable"),r={id:t.id,time:Number(n),locatOnOff:!0,rand:!1,enable:s.checked};this.meta.SendModeMessage(r);const o=document.getElementById("cardlocationexit");o&&(o.onclick=()=>{e.style.display="block",i.style.display="none";const r={id:t.id,time:Number(n),locatOnOff:!1,rand:!1,enable:s.checked};this.meta.SendModeMessage(r)})}}var YO=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class KO extends JE{constructor(t,e,i,n,s){super(s),this.blockStore=t,this.session=e,this.meta=i,this.inven=n,this.m_masterAddr="",this.mode=qE.EditPlay,this.profileVisible=!0,this.brickSize=new Pe(3,3,1),this.brickRotate=new Pe,this.ui=new QE(this.meta,qE.EditPlay),this.plant=new XO(this.meta,this),this.furn=new $O(this.meta,this),this.game=new qO(this.meta),this.color="#fff",this.alarm=document.getElementById("alarm-msg"),this.alarmText=document.getElementById("alarm-msg-text")}GetElement(){const t=document.getElementById("x_up"),e=document.getElementById("x_down"),i=document.getElementById("y_up"),n=document.getElementById("y_down"),s=document.getElementById("z_up"),r=document.getElementById("z_down"),o=document.getElementById("y_rotation"),a=document.getElementById("x_rotation"),h=document.getElementById("brickmodeexit");t.onclick=()=>this.ChangeBrickSize("x",2),e.onclick=()=>this.ChangeBrickSize("x",-2),i.onclick=()=>this.ChangeBrickSize("y",2),n.onclick=()=>this.ChangeBrickSize("y",-2),s.onclick=()=>this.ChangeBrickSize("z",2),r.onclick=()=>this.ChangeBrickSize("z",-2),o.onclick=()=>this.ChangeRotation(0,90,0),a.onclick=()=>this.ChangeRotation(90,0,0),h.onclick=()=>{this.mode=qE.EditPlay,this.meta.ModeChange(qE.EditPlay),this.UpdateMenu()},this.myPicker=new WO("#myPicker"),this.myPicker.pointerMove=()=>{const t=document.getElementById("myPicker");t.value!=this.color&&(this.color=t.value,this.meta.ChangeBrickInfo({color:t.value}))}}ChangeBrickSize(t,e){if(!("x"==t&&this.brickSize.x+e<1||"y"==t&&this.brickSize.y+e<1||"z"==t&&this.brickSize.z+e<1)){switch(t){case"x":this.brickSize.x+=e;break;case"y":this.brickSize.y+=e;break;case"z":this.brickSize.z+=e}this.UpdateBrickUI(),this.meta.ChangeBrickInfo({v:this.brickSize})}}ChangeRotation(t,e,i){this.brickRotate.set(t,e,i),this.meta.ChangeBrickInfo({r:this.brickRotate})}UpdateBrickUI(){document.getElementById("x_value").innerText=this.brickSize.x.toString();document.getElementById("y_value").innerText=this.brickSize.y.toString();document.getElementById("z_value").innerText=this.brickSize.z.toString()}UpdateMenu(){const t=document.getElementById("editplaymode");t&&(t.style.backgroundColor=this.mode==qE.EditPlay?"silver":"transparent");document.getElementById("avatarmode").style.backgroundColor=this.mode==qE.Face?"silver":"transparent";document.getElementById("avatar-second").style.display=this.mode==qE.Face?"block":"none";document.getElementById("brickmode").style.backgroundColor=this.mode==qE.NonLego?"silver":"transparent";document.getElementById("funituremode").style.backgroundColor=this.mode==qE.Furniture?"silver":"transparent";document.getElementById("funiture-second").style.display=this.mode==qE.Furniture?"block":"none";document.getElementById("weaponmode").style.backgroundColor=this.mode==qE.Weapon?"silver":"transparent";document.getElementById("brickctrl").style.display=this.mode==qE.Lego||this.mode==qE.NonLego?"block":"none",this.game.OnOff(this.mode==qE.Weapon,this.inven.inven)}RequestNewMeta(t){const e=this.m_masterAddr,i=this.session.GetHonUser(),n=e+"/glambda?txid="+encodeURIComponent("+bo01CLDwef63KG0t4Rc83KekF/U2tgr6BVwcxgmCVA="),s=new FormData;s.append("key",encodeURIComponent(i.Email)),s.append("email",encodeURIComponent(i.Email)),s.append("id",i.Nickname),s.append("password",i.Password),s.append("models",t);const r=(new Date).getTime();s.append("time",r.toString()),s.append("table","meta"),fetch(n,{method:"POST",cache:"no-cache",headers:{},body:s}).then((t=>t.json())).then((()=>{this.blockStore.UpdateModels({email:i.Email,key:i.Email,id:i.Nickname,password:i.Password,models:t,time:r},i.Email),this.alarm.style.display="none"}))}MenuEvent(){document.getElementById("save").onclick=()=>{this.alarm.style.display="block",this.alarmText.innerHTML="저장 중입니다.";const t=this.meta.ModelStore();this.RequestNewMeta(t)};const t=document.getElementById("editplaymode");t&&(t.onclick=()=>{this.meta.ModeChange(qE.EditPlay),this.UpdateMenu()});document.getElementById("avatarmode").onclick=()=>{this.mode=this.mode!=qE.Face?qE.Face:qE.EditPlay,this.meta.ModeChange(this.mode),this.UpdateMenu()};document.getElementById("funituremode").onclick=()=>{this.mode=this.mode!=qE.Furniture?qE.Furniture:qE.EditPlay,this.mode==qE.EditPlay&&this.meta.ModeChange(this.mode),this.UpdateMenu()};document.getElementById("weaponmode").onclick=()=>{this.mode=this.mode!=qE.Weapon?qE.Weapon:qE.EditPlay,this.meta.ModeChange(this.mode),this.UpdateMenu()};document.getElementById("change-male").onclick=()=>{this.meta.ChangeCharactor(Zl.Male)};document.getElementById("change-female").onclick=()=>{this.meta.ChangeCharactor(Zl.Female)};document.getElementById("gate").onclick=()=>{this.mode=this.mode!=qE.Portal?qE.Portal:qE.EditPlay,this.meta.ModeChange(this.mode),this.UpdateMenu()};document.getElementById("brickmode").onclick=()=>{this.mode=this.mode!=qE.NonLego?qE.NonLego:qE.EditPlay,this.meta.ModeChange(this.mode),this.UpdateMenu();const t=document.getElementById("myPicker");this.meta.ChangeBrickInfo({v:this.brickSize,r:this.brickRotate,color:t.value})};document.getElementById("apart").onclick=()=>{this.mode=this.mode!=qE.Lego?qE.Lego:qE.EditPlay,this.meta.ModeChange(this.mode),this.UpdateMenu();const t=document.getElementById("myPicker");this.meta.ChangeBrickInfo({v:this.brickSize,r:this.brickRotate,color:t.value})};document.getElementById("eraser").onclick=()=>{this.mode=this.mode!=qE.LegoDelete?qE.LegoDelete:qE.EditPlay,this.meta.ModeChange(this.mode),this.UpdateMenu()};document.getElementById("tree").onclick=()=>{this.plant.toggle(),this.UpdateMenu()};document.getElementById("chair").onclick=()=>{this.furn.toggle(),this.UpdateMenu()};document.getElementById("reset-brick").onclick=()=>this.meta.ChangeBrickInfo({clear:!0});document.getElementById("exit").onclick=()=>{document.fullscreenElement&&document.exitFullscreen(),this.mode=qE.EditPlay,this.UpdateMenu(),window.history.back()}}CanvasRenderer(t){const e=this.blockStore.GetModel(this.session.UserId);document.getElementById("avatar-bg").style.display="block",this.meta.init().then((i=>{if(this.blockStore.FetchInventory(this.m_masterAddr,this.session.UserId).then((t=>{this.inven.LoadInven(this.meta.store.LoadInventory(t)),this.inven.loadSlot(),this.inven.inven&&this.meta.store.ChangeInventory(this.inven.inven.data)})),this.meta.ModeChange(qE.EditPlay),null==t)this.alarm.style.display="block",this.alarmText.innerText="Login이 필요합니다.",setTimeout((()=>{this.alarm.style.display="none"}),2e3);else{if(!i)return;this.alarm.style.display="block",this.alarmText.innerText="이동중입니다.",this.blockStore.FetchModel(this.m_masterAddr,t).then((t=>YO(this,void 0,void 0,(function*(){yield this.meta.LoadModel(t.models,t.id,null==e?void 0:e.models),this.alarm.style.display="none"})))).then((()=>{this.meta.ModeChange(qE.EditPlay)})).catch((()=>YO(this,void 0,void 0,(function*(){this.alarm.style.display="none",yield this.meta.LoadModelEmpty(t,null==e?void 0:e.models),this.meta.ModeChange(qE.EditPlay)}))))}})).then((()=>{this.ui.UiOff(qE.EditPlay),this.meta.render()}))}getParam(){var t;const e=new URLSearchParams(window.location.search),i=encodeURIComponent(null!==(t=e.get("email"))&&void 0!==t?t:"");return null==i?null:i}loadHelper(){fetch("views/edithelp.html").then((t=>t.text())).then((t=>{document.getElementById("modalwindow").innerHTML=t})).then((()=>{}))}Run(t){return YO(this,void 0,void 0,(function*(){yield this.LoadHtml(),yield this.game.LoadHtml(),this.GetElement(),this.UpdateBrickUI(),this.m_masterAddr=t;const e=this.getParam();return null!=e&&(this.loadHelper(),this.CanvasRenderer(e),this.MenuEvent(),this.inven.binding(),this.UpdateMenu(),!0)}))}Release(){this.ui.UiOn(),this.ReleaseHtml(),this.furn.htmlRelease(),this.plant.htmlRelease()}}var ZO=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};class JO extends JE{constructor(t,e,i,n,s){super(s),this.blockStore=t,this.session=e,this.meta=i,this.inven=n,this.m_masterAddr="",this.ui=new QE(this.meta,qE.Play),this.alarm=document.getElementById("alarm-msg"),this.alarmText=document.getElementById("alarm-msg-text"),this.defaultLv=1,this.buffQ=[]}startPlay(){const t=document.getElementById("levelview");t.replaceChildren();t.innerHTML='\n        <div class="row pb-2">\n            <div class="col xxx-large text-white text-center h2">Game Tips</div>\n        </div>\n        <div class="row p-2">\n            <div class="col-auto text-white text-weight-bold">게임 유형</div>\n            <div class="col text-white text-start">Random</div>\n        </div>\n        <div class="row p-2">\n            <div class="col text-white text-start">인벤토리의 아이템은 비워진채 시작합니다. 수집한 아이템을 저장하기 위해서는 포탈에서 종료 해야합니다. \n            포탈을 통해 탈출 해야합니다.</div>\n        </div>\n        <div class="row p-2">\n            <div class="col text-white">\n                <div class="border rounded bg-secondary p-2 d-inline-block">space</div> or\n                <span class="material-symbols-outlined align-middle">\n                close\n                </span> = 점프\n            </div>\n            <div class="col text-white">\n                <div class="border rounded bg-secondary p-2 d-inline-block ps-3 pe-3">1</div> or\n                <span class="material-symbols-outlined align-middle">\n                circle\n                </span> = 액션 1\n            </div>\n            <div class="col text-white">\n                <div class="border rounded bg-secondary p-2 d-inline-block ps-3 pe-3">2</div> or\n                <span class="material-symbols-outlined align-middle">\n                square\n                </span> = 액션 2\n            </div>\n        </div>\n        <div class="row p-2">\n            <div class="col text-white text-center">\n            <button type="button" class="btn btn-primary" id="startBtn">시작하기</button>\n            </div>\n        </div>\n\n        ';const e=document.getElementById("levelup");e.style.display="block";document.getElementById("startBtn").onclick=()=>{this.meta.Setup({OnEnd:()=>{},OnSaveInven:t=>{if(!this.session.CheckLogin()||t.inventroySlot.length<1)return;const e=this.meta.store.StoreInventory();this.SaveInventory(t,e)}}),e.style.display="none",this.ui.UiOff(qE.Play),this.LevelUp()}}CanvasRenderer(t){const e=this.blockStore.GetModel(this.session.UserId);document.getElementById("avatar-bg").style.display="block",this.meta.init().then((i=>{if(this.blockStore.FetchInventory(this.m_masterAddr,this.session.UserId).then((t=>{this.meta.store.LoadInventory(t),this.inven.LoadInven(this.meta.store.GetEmptyInventory()),this.inven.loadSlot()})),null==t)this.blockStore.FetchModels(this.m_masterAddr).then((t=>ZO(this,void 0,void 0,(function*(){yield this.meta.LoadVillage(t,null==e?void 0:e.models),this.startPlay()}))));else{if(!i)return void this.startPlay();this.alarm.style.display="block",this.alarmText.innerHTML="이동중입니다.",this.blockStore.FetchModel(this.m_masterAddr,t).then((t=>ZO(this,void 0,void 0,(function*(){yield this.meta.LoadModel(t.models,t.id,null==e?void 0:e.models),this.alarm.style.display="none",this.startPlay()})))).catch((()=>ZO(this,void 0,void 0,(function*(){this.alarm.style.display="none",yield this.meta.LoadModelEmpty(t,null==e?void 0:e.models),this.startPlay()}))))}})).then((()=>{this.meta.render()})),this.meta.RegisterChangePlayerStatusEvent((t=>{const e=document.getElementById("hp-bar"),i=document.getElementById("special-bar"),n=document.getElementById("exp-bar"),s=document.getElementById("level");e&&(e.value=t.health/t.maxHealth*100,i.value=t.mana/t.maxMana*100,n.value=t.exp/t.maxExp*100,s.innerText="Lv."+t.level,t.level>this.defaultLv&&(this.defaultLv=t.level,this.LevelUp()))}))}FirstLevelUp(){var t;const e=document.getElementById("levelview");e.replaceChildren();let i='\n        <div class="row pb-2">\n            <div class="col xxx-large text-white text-center h2">무기를 선택하세요!</div>\n        </div>\n        ';const n=[null===(t=this.inven.inven)||void 0===t?void 0:t.GetItemInfo(ZS.Hanhwasbat)];n.forEach((t=>{i+=`\n        <div class="row p-2 handcursor" id="buff_0">\n            <div class="col-auto"><img src="assets/icons/${null==t?void 0:t.icon}" style="width: 45px;"></div>\n            <div class="col text-white">${null==t?void 0:t.name}</div>\n        </div>\n            `})),e.innerHTML=i;document.getElementById("levelup").style.display="block",n.forEach(((t,e)=>{document.getElementById("buff_"+e).onclick=()=>ZO(this,void 0,void 0,(function*(){var t;if(null==this.inven.inven)return;const e=yield null===(t=this.inven.inven)||void 0===t?void 0:t.NewItem(ZS.Hanhwasbat);if(null==e)throw new Error("inventory is full");this.inven.equipmentItem(e);document.getElementById("levelup").style.display="none"}))}))}LevelUp(){if(1==this.defaultLv)return void this.FirstLevelUp();const t=this.meta.GetRandomBuff();this.buffQ.push(t),this.buffQ.length>1||this.SelectBuff(t)}SelectBuff(t){const e=document.getElementById("levelview");e.replaceChildren();let i='\n        <div class="row pb-2">\n            <div class="col xxx-large text-white text-center h2">Level Up!!</div>\n        </div>\n        ';t.forEach(((t,e)=>{i+=`\n        <div class="row p-2 handcursor" id="buff_${e}">\n            <div class="col-auto"><img src="assets/icons/${t.icon}" style="width: 45px;"></div>\n            <div class="col text-white">${t.name}<br>${0==t.lv?"신규":"Lv."+(t.lv+1)}: ${t.explain}</div>\n        </div>\n            `})),e.innerHTML=i;document.getElementById("levelup").style.display="block",t.forEach(((t,e)=>{document.getElementById("buff_"+e).onclick=()=>{this.meta.SelectRandomBuff(t);if(document.getElementById("levelup").style.display="none",this.buffQ.shift(),this.buffQ.length){const t=this.buffQ[0];if(null==t)return;this.SelectBuff(t)}}}))}SaveInventory(t,e){const i=this.m_masterAddr,n=this.session.GetHonUser(),s=i+"/glambda?txid="+encodeURIComponent("ruxUKmdYSA1fcf0/MtjjjvfcC2kXGSSyodhln57wKWQ="),r=new FormData;r.append("key",encodeURIComponent(n.Email)),r.append("email",encodeURIComponent(n.Email)),r.append("id",n.Nickname),r.append("password",n.Password),r.append("data",e);const o=(new Date).getTime();r.append("date",o.toString()),r.append("table","inventory"),fetch(s,{method:"POST",cache:"no-cache",headers:{},body:r}).then((t=>t.json())).then((e=>{this.blockStore.UpdateInventory(t,n.Email),this.alarm.style.display="none"}))}getParam(){var t;const e=new URLSearchParams(window.location.search),i=encodeURIComponent(null!==(t=e.get("email"))&&void 0!==t?t:"");return""==i?null:i}Run(t){return ZO(this,void 0,void 0,(function*(){yield this.LoadHtml(),this.m_masterAddr=t;const e=this.getParam();return this.CanvasRenderer(e),this.inven.binding(),!0}))}Release(){this.defaultLv=1,this.ReleaseHtml()}}class QO{constructor(t){this.meta=t,this.slots=[],this.colCont=5}Clear(){this.slots.length=0}LoadInven(t){this.inven=t}bindClickEvent(t){if(null==this.inven)throw new Error("inventory undefined");const e=document.getElementById("item_info");e.replaceChildren(),e.style.display="none";const i=this.inven.GetBindItem(t);if(null==i)return;const n=i.MakeInformation();let s="";if(n.forEach((t=>{t.k&&(s+=t.k+" "),s+=t.v+"<br>"})),e.insertAdjacentHTML("afterbegin",s),e.style.display="block",i.Bindable){const i=document.createElement("button");i.className="btn btn-outline-primary",i.style.width="100%",i.textContent="해제",i.onclick=()=>{this.toInvenItem(t),e.style.display="none",e.removeChild(i)},e.appendChild(i)}}toInvenItem(t){if(null==this.inven)throw new Error("inventory undefined");this.inven.MoveToInvenFromBindItem(t),this.inven=this.meta.store.ChangeInventory(this.inven.data),this.reloadSlot()}equipmentItem(t){var e;if(null!=t.Bind){if(null==this.inven)throw new Error("inventory undefined");null===(e=this.inven)||void 0===e||e.MoveToBindFromInvenItem(t.Bind,t),this.inven=this.meta.store.ChangeInventory(this.inven.data),this.reloadSlot()}}slotClickEvent(t){if(null==this.inven)throw new Error("inventory undefined");const e=document.getElementById("item_info");e.replaceChildren(),e.style.display="none";const i=this.slots[t];if(null==i)return;const n=i.item,s=n.MakeInformation();let r="";if(s.forEach((t=>{t.k&&(r+=t.k+" "),r+=t.v+"<br>"})),e.insertAdjacentHTML("afterbegin",r),e.style.display="block",n.Bindable){const t=document.createElement("button");t.className="btn btn-outline-primary",t.style.width="100%",t.textContent="장착",t.onclick=()=>{this.equipmentItem(n),e.style.display="none",e.removeChild(t)},e.appendChild(t)}}reloadSlot(){var t;if(null==this.inven)throw new Error("inventory undefined");const e=document.getElementById("headslot");e.onclick=()=>{this.bindClickEvent(Yl.Head)};const i=this.inven.GetBindItem(Yl.Head);i?e.innerHTML=`<img src="assets/icons/${i.IconPath}">`:e.replaceChildren();const n=document.getElementById("l_handslot");n.onclick=()=>{this.bindClickEvent(Yl.Hands_L)};const s=this.inven.GetBindItem(Yl.Hands_L);s?n.innerHTML=`<img src="assets/icons/${s.IconPath}">`:n.replaceChildren();const r=document.getElementById("r_handslot");r.onclick=()=>{this.bindClickEvent(Yl.Hands_R)};const o=this.inven.GetBindItem(Yl.Hands_R);o?r.innerHTML=`<img src="assets/icons/${o.IconPath}">`:r.replaceChildren(),this.slots.length=0;for(let e=0;e<3;e++)for(let i=0;i<this.colCont;i++){const n=i+e*this.colCont,s=document.getElementById(`slot${n}`),r=this.inven.GetInventory(n);if(null==r){s.innerText="";continue}const o=r.item;let a=`<img src="assets/icons/${null!==(t=o.IconPath)&&void 0!==t?t:o.property.icon}">`;a+=r.count>1?`<span class="position-absolute top-100 start-100 translate-middle badge rounded-pill bg-secondary"\n                                    id="slot${n}count">\n                                        ${r.count}\n                                    </span>\n                `:"",s.innerHTML=a,s.onclick=()=>{this.slotClickEvent(n)},this.slots.push(r)}}loadSlot(){if(null==this.inven)throw new Error("inventory undefined");const t=document.getElementById("invenslots");let e="";for(let t=0;t<3;t++){e+='<div class="row">';for(let i=0;i<this.colCont;i++){e+=`\n                    <div class="col ps-1 pe-0 pb-1">\n                        <div class="popmenu-wrap rounded inven_slot p-1" id="slot${i+t*this.colCont}"></div>\n                    </div>\n                `}e+="</div>"}t.insertAdjacentHTML("beforeend",e),this.reloadSlot()}binding(){const t=document.getElementById("invenBtn"),e=document.getElementById("invenContent");t.onclick=()=>{if(null==this.inven)throw new Error("inventory undefined");if("none"==e.style.display||""==e.style.display)this.inven=this.meta.store.ChangeInventory(this.inven.data),this.reloadSlot(),e.style.display="block";else{document.getElementById("item_info").style.display="none",e.style.display="none"}};const i=document.getElementById("fullscreen");i.onclick=()=>{document.fullscreenElement?(document.exitFullscreen(),i.innerText="fullscreen"):(document.documentElement.requestFullscreen(),i.innerText="fullscreen_exit")};const n=document.getElementById("returnSns");n&&(n.onclick=()=>{document.fullscreenElement&&(document.exitFullscreen(),i.innerText="fullscreen"),history.back()})}}var tN=function(t,e,i,n){return new(i||(i=Promise))((function(s,r){function o(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}h((n=n.apply(t,e||[])).next())}))};const eN=new class{constructor(){this.blockStore=new d,this.session=new _A(this.blockStore),this.meta=new KE,this.inven=new QO(this.meta),this.ipc=new p,this.router=new TA(this.ipc),this.newHon=new uA(this.session,this.ipc,"views/newhon.html"),this.profile=new SA(this.session,this.ipc,"views/profile.html"),this.funcMap={signin:new gA(this.session,"views/signin.html"),signup:new mA("views/signup.html"),hon:new rA(this.blockStore,this.session,"views/hon.html"),hons:new nA(this.blockStore,this.session,this.meta,"views/hons.html"),hondetail:new eA(this.blockStore,this.session,this.meta,"views/hondetail.html"),newhon:this.newHon,uploadhon:new wA("views/uploadhon.html"),profile:this.profile,main:new LD(this.blockStore,"views/main.html"),edithome:new KO(this.blockStore,this.session,this.meta,this.inven,"views/edithome.html"),play:new JO(this.blockStore,this.session,this.meta,this.inven,"views/play.html")},this.urlToFileMap={signin:"views/signin.html",signup:"views/signup.html",main:"views/main.html",hons:"views/hons.html",hon:"views/hon.html",hondetail:"views/hondetail.html",newhon:"views/newhon.html",uploadhon:"views/uploadhon.html",profile:"views/profile.html",edithome:"views/edithome.html"},this.beforPage="",this.router.RegisterClient("newhon",this.newHon),this.router.RegisterClient("profile",this.profile),window.ClickLoadPage=(t,e,...i)=>tN(this,void 0,void 0,(function*(){yield this.session.DrawHtmlSessionInfo();const n={url:window.location.href,key:t,fromEvent:e,args:i};this.beforPage=t,this.router.Activate(t),history.pushState(n,"login","./?pageid="+t+i);const s=this.CurrentPage;null!=s&&s.Release(),this.CurrentPage=this.funcMap[t],null!=this.CurrentPage&&(yield this.CurrentPage.Run(window.MasterAddr))})),window.onpopstate=()=>{this.includeContentHTML()}}includeContentHTML(){var t;return tN(this,void 0,void 0,(function*(){yield this.session.DrawHtmlSessionInfo();const e=this.getPageIdParam();this.beforPage=e,this.router.Activate(e);const i=this.CurrentPage;null==i||i.Release(),this.CurrentPage=this.funcMap[e],yield null===(t=this.CurrentPage)||void 0===t?void 0:t.Run(window.MasterAddr)}))}getPageIdParam(){var t;const e=new URLSearchParams(window.location.search).get("pageid"),i=null==e?"main":e;return null!==(t=this.beforPage)&&void 0!==t||(this.beforPage=i),i}parseResponse(t){t=t.filter((t=>"Adam"!==t.User.Nickname));const e=Math.floor(Math.random()*t.length);return window.NodeCount=t.length,t[e]}loadNodesHtml(t){return window.MasterNode=t,window.MasterAddr=`http://${t.User.ip.Ip}:${t.User.ip.Port}`,window.MasterWsAddr=`ws://${t.User.ip.Ip}:${t.User.ip.Port}`,window.MasterAddr}includeHTML(t,e){window.addEventListener("load",(()=>fetch(e).then((t=>t.text())).then((e=>{document.querySelector(t).innerHTML=e}))))}errmsg(t,e){return`\n<div class="container my-3">\n    <div class="row division-line">\n        <div class="col">\n            <h4>Notics</h4>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col text-center"> <br>\n            <div class="card">\n                <div class="card-header"> ${t} </div>\n                <div class="card-body"> ${e} </div>\n            </div>\n</div>\n    </div>\n</div>\n        `}Start(){const t=document.getElementById("contents");null!=t&&("http:"!=location.protocol?t.innerHTML=this.errmsg(" https 를 지원하지 않습니다.",'링크를 클릭해주세요. <a href="http://hons.ghostwebservice.com"> <strong class="me-auto">hons.ghostwebservice.com</strong> </a> '):addEventListener("load",(()=>fetch("http://lb.ghostnetroot.com:58083/nodes").then((t=>t.json())).then(this.parseResponse).then(this.loadNodesHtml).then((()=>this.includeContentHTML())).catch((e=>{t.innerHTML=this.errmsg(" Network Down"," 사용가능한 Node가 존재하지 않습니다.")})))))}};eN.includeHTML("header","navbar.html"),eN.includeHTML("footer","foot.html"),eN.Start()})()})();